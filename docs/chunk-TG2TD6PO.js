import{a as sy,b as oy,c as vl,d as ay,e as vs,f as _l,g as la,h as cy,i as uy,j as wl,k as ye,l as Yn,m as Pt,n as ha,o as _s,p as El,q as ly,r as Tl,s as hy,t as Dt,u as Il,v as Al,w as Sl,x as Fr,y as Ye}from"./chunk-7XYD33H2.js";import{$ as W,A as Rt,Aa as ul,B as Qn,Ba as sa,Bb as qm,D as Ju,Da as km,E as kr,F as Em,Fa as fs,G as Tm,H as cs,Ha as Lr,I as Ct,Ia as Mm,J as Zu,K as Im,L as ra,La as Om,Lb as oa,M as Mr,Ma as Vm,Mb as Gm,N as el,Na as Lm,Nb as aa,O as Or,Oa as Ce,Ob as Km,P as Me,Pa as ll,Pb as fl,Q as tl,Qa as Fm,Qb as ps,R as Am,Rb as gs,S as Re,Sb as Wm,T as Oe,Ta as Um,Tb as ca,Ua as jm,Ub as pl,V as se,Va as hl,Vb as gl,W as Qt,Wa as dl,X as Sm,Xb as Hm,Y as oe,Ya as $m,Yb as Qm,Z as nl,Zb as ua,_ as $,a as pm,aa as us,b as gm,ba as bm,bc as Ym,c as lt,ca as ls,cc as ml,d as Hu,da as ia,dc as Xm,e as Qu,ea as Rm,ec as Jm,f as bt,fa as Yt,fb as zm,fc as dt,g as ht,ga as rl,gc as Zm,h as ta,ha as hs,hc as ms,i as mm,ia as Cm,ic as ey,j as yn,ja as Vr,jc as ty,k as Ht,ka as Xt,kb as Bm,kc as ys,l as Hn,la as il,lc as yl,m as ge,n as B,o as as,p as ym,pa as sl,q as vm,qa as Pm,r as X,ra as ol,s as na,sa as al,t as rt,ta as Dm,tc as ny,u as Yu,ua as ds,v as _m,va as xm,vc as Jt,w as Xu,wa as cl,wc as ry,xa as Nm,xc as iy,y as wm,ya as st,z as it}from"./chunk-CT4AIAJD.js";import{a as z,b as Ie,c as fm,e as Wu,f as P}from"./chunk-BY3KSYET.js";var fa=class r{constructor(e){this.normalizedNames=new Map,this.lazyUpdate=null,e?typeof e=="string"?this.lazyInit=()=>{this.headers=new Map,e.split(`
`).forEach(t=>{let n=t.indexOf(":");if(n>0){let i=t.slice(0,n),s=i.toLowerCase(),o=t.slice(n+1).trim();this.maybeSetNormalizedName(i,s),this.headers.has(s)?this.headers.get(s).push(o):this.headers.set(s,[o])}})}:typeof Headers<"u"&&e instanceof Headers?(this.headers=new Map,e.forEach((t,n)=>{this.setHeaderEntries(n,t)})):this.lazyInit=()=>{this.headers=new Map,Object.entries(e).forEach(([t,n])=>{this.setHeaderEntries(t,n)})}:this.headers=new Map}has(e){return this.init(),this.headers.has(e.toLowerCase())}get(e){this.init();let t=this.headers.get(e.toLowerCase());return t&&t.length>0?t[0]:null}keys(){return this.init(),Array.from(this.normalizedNames.values())}getAll(e){return this.init(),this.headers.get(e.toLowerCase())||null}append(e,t){return this.clone({name:e,value:t,op:"a"})}set(e,t){return this.clone({name:e,value:t,op:"s"})}delete(e,t){return this.clone({name:e,value:t,op:"d"})}maybeSetNormalizedName(e,t){this.normalizedNames.has(t)||this.normalizedNames.set(t,e)}init(){this.lazyInit&&(this.lazyInit instanceof r?this.copyFrom(this.lazyInit):this.lazyInit(),this.lazyInit=null,this.lazyUpdate&&(this.lazyUpdate.forEach(e=>this.applyUpdate(e)),this.lazyUpdate=null))}copyFrom(e){e.init(),Array.from(e.headers.keys()).forEach(t=>{this.headers.set(t,e.headers.get(t)),this.normalizedNames.set(t,e.normalizedNames.get(t))})}clone(e){let t=new r;return t.lazyInit=this.lazyInit&&this.lazyInit instanceof r?this.lazyInit:this,t.lazyUpdate=(this.lazyUpdate||[]).concat([e]),t}applyUpdate(e){let t=e.name.toLowerCase();switch(e.op){case"a":case"s":let n=e.value;if(typeof n=="string"&&(n=[n]),n.length===0)return;this.maybeSetNormalizedName(e.name,t);let i=(e.op==="a"?this.headers.get(t):void 0)||[];i.push(...n),this.headers.set(t,i);break;case"d":let s=e.value;if(!s)this.headers.delete(t),this.normalizedNames.delete(t);else{let o=this.headers.get(t);if(!o)return;o=o.filter(c=>s.indexOf(c)===-1),o.length===0?(this.headers.delete(t),this.normalizedNames.delete(t)):this.headers.set(t,o)}break}}setHeaderEntries(e,t){let n=(Array.isArray(t)?t:[t]).map(s=>s.toString()),i=e.toLowerCase();this.headers.set(i,n),this.maybeSetNormalizedName(e,i)}forEach(e){this.init(),Array.from(this.normalizedNames.keys()).forEach(t=>e(this.normalizedNames.get(t),this.headers.get(t)))}};var _y=function(r){return r[r.Sent=0]="Sent",r[r.UploadProgress=1]="UploadProgress",r[r.ResponseHeader=2]="ResponseHeader",r[r.DownloadProgress=3]="DownloadProgress",r[r.Response=4]="Response",r[r.User=5]="User",r}(_y||{}),bl=class{constructor(e,t=wy.Ok,n="OK"){this.headers=e.headers||new fa,this.status=e.status!==void 0?e.status:t,this.statusText=e.statusText||n,this.url=e.url||null,this.ok=this.status>=200&&this.status<300}};var pa=class r extends bl{constructor(e={}){super(e),this.type=_y.Response,this.body=e.body!==void 0?e.body:null}clone(e={}){return new r({body:e.body!==void 0?e.body:this.body,headers:e.headers||this.headers,status:e.status!==void 0?e.status:this.status,statusText:e.statusText||this.statusText,url:e.url||this.url||void 0})}};var wy=function(r){return r[r.Continue=100]="Continue",r[r.SwitchingProtocols=101]="SwitchingProtocols",r[r.Processing=102]="Processing",r[r.EarlyHints=103]="EarlyHints",r[r.Ok=200]="Ok",r[r.Created=201]="Created",r[r.Accepted=202]="Accepted",r[r.NonAuthoritativeInformation=203]="NonAuthoritativeInformation",r[r.NoContent=204]="NoContent",r[r.ResetContent=205]="ResetContent",r[r.PartialContent=206]="PartialContent",r[r.MultiStatus=207]="MultiStatus",r[r.AlreadyReported=208]="AlreadyReported",r[r.ImUsed=226]="ImUsed",r[r.MultipleChoices=300]="MultipleChoices",r[r.MovedPermanently=301]="MovedPermanently",r[r.Found=302]="Found",r[r.SeeOther=303]="SeeOther",r[r.NotModified=304]="NotModified",r[r.UseProxy=305]="UseProxy",r[r.Unused=306]="Unused",r[r.TemporaryRedirect=307]="TemporaryRedirect",r[r.PermanentRedirect=308]="PermanentRedirect",r[r.BadRequest=400]="BadRequest",r[r.Unauthorized=401]="Unauthorized",r[r.PaymentRequired=402]="PaymentRequired",r[r.Forbidden=403]="Forbidden",r[r.NotFound=404]="NotFound",r[r.MethodNotAllowed=405]="MethodNotAllowed",r[r.NotAcceptable=406]="NotAcceptable",r[r.ProxyAuthenticationRequired=407]="ProxyAuthenticationRequired",r[r.RequestTimeout=408]="RequestTimeout",r[r.Conflict=409]="Conflict",r[r.Gone=410]="Gone",r[r.LengthRequired=411]="LengthRequired",r[r.PreconditionFailed=412]="PreconditionFailed",r[r.PayloadTooLarge=413]="PayloadTooLarge",r[r.UriTooLong=414]="UriTooLong",r[r.UnsupportedMediaType=415]="UnsupportedMediaType",r[r.RangeNotSatisfiable=416]="RangeNotSatisfiable",r[r.ExpectationFailed=417]="ExpectationFailed",r[r.ImATeapot=418]="ImATeapot",r[r.MisdirectedRequest=421]="MisdirectedRequest",r[r.UnprocessableEntity=422]="UnprocessableEntity",r[r.Locked=423]="Locked",r[r.FailedDependency=424]="FailedDependency",r[r.TooEarly=425]="TooEarly",r[r.UpgradeRequired=426]="UpgradeRequired",r[r.PreconditionRequired=428]="PreconditionRequired",r[r.TooManyRequests=429]="TooManyRequests",r[r.RequestHeaderFieldsTooLarge=431]="RequestHeaderFieldsTooLarge",r[r.UnavailableForLegalReasons=451]="UnavailableForLegalReasons",r[r.InternalServerError=500]="InternalServerError",r[r.NotImplemented=501]="NotImplemented",r[r.BadGateway=502]="BadGateway",r[r.ServiceUnavailable=503]="ServiceUnavailable",r[r.GatewayTimeout=504]="GatewayTimeout",r[r.HttpVersionNotSupported=505]="HttpVersionNotSupported",r[r.VariantAlsoNegotiates=506]="VariantAlsoNegotiates",r[r.InsufficientStorage=507]="InsufficientStorage",r[r.LoopDetected=508]="LoopDetected",r[r.NotExtended=510]="NotExtended",r[r.NetworkAuthenticationRequired=511]="NetworkAuthenticationRequired",r}(wy||{});var NT=new oe("");var dy="b",fy="h",py="s",gy="st",my="u",yy="rt",da=new oe(""),kT=["GET","HEAD"];function MT(r,e){let p=W(da),{isCacheActive:t}=p,n=fm(p,["isCacheActive"]),{transferCache:i,method:s}=r;if(!t||s==="POST"&&!n.includePostRequests&&!i||s!=="POST"&&!kT.includes(s)||i===!1||n.filter?.(r)===!1)return e(r);let o=W(sa),c=VT(r),u=o.get(c,null),l=n.includeHeaders;if(typeof i=="object"&&i.includeHeaders&&(l=i.includeHeaders),u){let{[dy]:m,[yy]:T,[fy]:x,[py]:N,[gy]:D,[my]:j}=u,G=m;switch(T){case"arraybuffer":G=new TextEncoder().encode(m).buffer;break;case"blob":G=new Blob([m]);break}let V=new fa(x);return B(new pa({body:G,headers:V,status:N,statusText:D,url:j}))}let f=Jt(W(st));return e(r).pipe(Re(m=>{m instanceof pa&&f&&o.set(c,{[dy]:m.body,[fy]:OT(m.headers,l),[py]:m.status,[gy]:m.statusText,[my]:m.url||"",[yy]:r.responseType})}))}function OT(r,e){if(!e)return{};let t={};for(let n of e){let i=r.getAll(n);i!==null&&(t[n]=i)}return t}function vy(r){return[...r.keys()].sort().map(e=>`${e}=${r.getAll(e)}`).join("&")}function VT(r){let{params:e,method:t,responseType:n,url:i}=r,s=vy(e),o=r.serializeBody();o instanceof URLSearchParams?o=vy(o):typeof o!="string"&&(o="");let c=[t,n,i,o,s].join("|"),u=LT(c);return u}function LT(r){let e=0;for(let t of r)e=Math.imul(31,e)+t.charCodeAt(0)<<0;return e+=2147483648,e.toString()}function Ey(r){return[{provide:da,useFactory:()=>(Lm("NgHttpTransferCache"),z({isCacheActive:!0},r))},{provide:NT,useValue:MT,multi:!0,deps:[sa,da]},{provide:ps,multi:!0,useFactory:()=>{let e=W(gs),t=W(da);return()=>{Wm(e).then(()=>{t.isCacheActive=!1})}}}]}var Pl=class extends Jm{constructor(){super(...arguments),this.supportsDOMEvents=!0}},Dl=class r extends Pl{static makeCurrent(){Xm(new r)}onAndCancel(e,t,n){return e.addEventListener(t,n),()=>{e.removeEventListener(t,n)}}dispatchEvent(e,t){e.dispatchEvent(t)}remove(e){e.parentNode&&e.parentNode.removeChild(e)}createElement(e,t){return t=t||this.getDefaultDocument(),t.createElement(e)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(e){return e.nodeType===Node.ELEMENT_NODE}isShadowRoot(e){return e instanceof DocumentFragment}getGlobalEventTarget(e,t){return t==="window"?window:t==="document"?e:t==="body"?e.body:null}getBaseHref(e){let t=UT();return t==null?null:jT(t)}resetBaseElement(){ws=null}getUserAgent(){return window.navigator.userAgent}getCookie(e){return yl(document.cookie,e)}},ws=null;function UT(){return ws=ws||document.querySelector("base"),ws?ws.getAttribute("href"):null}function jT(r){return new URL(r,document.baseURI).pathname}var $T=(()=>{let e=class e{build(){return new XMLHttpRequest}};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=se({token:e,factory:e.\u0275fac});let r=e;return r})(),xl=new oe(""),Sy=(()=>{let e=class e{constructor(n,i){this._zone=i,this._eventNameToPlugin=new Map,n.forEach(s=>{s.manager=this}),this._plugins=n.slice().reverse()}addEventListener(n,i,s){return this._findPluginFor(i).addEventListener(n,i,s)}getZone(){return this._zone}_findPluginFor(n){let i=this._eventNameToPlugin.get(n);if(i)return i;if(i=this._plugins.find(o=>o.supports(n)),!i)throw new Oe(5101,!1);return this._eventNameToPlugin.set(n,i),i}};e.\u0275fac=function(i){return new(i||e)($(xl),$(Ce))},e.\u0275prov=se({token:e,factory:e.\u0275fac});let r=e;return r})(),ga=class{constructor(e){this._doc=e}},Rl="ng-app-id",by=(()=>{let e=class e{constructor(n,i,s,o={}){this.doc=n,this.appId=i,this.nonce=s,this.platformId=o,this.styleRef=new Map,this.hostNodes=new Set,this.styleNodesInDOM=this.collectServerRenderedStyles(),this.platformIsServer=Jt(o),this.resetHostNodes()}addStyles(n){for(let i of n)this.changeUsageCount(i,1)===1&&this.onStyleAdded(i)}removeStyles(n){for(let i of n)this.changeUsageCount(i,-1)<=0&&this.onStyleRemoved(i)}ngOnDestroy(){let n=this.styleNodesInDOM;n&&(n.forEach(i=>i.remove()),n.clear());for(let i of this.getAllStyles())this.onStyleRemoved(i);this.resetHostNodes()}addHost(n){this.hostNodes.add(n);for(let i of this.getAllStyles())this.addStyleToHost(n,i)}removeHost(n){this.hostNodes.delete(n)}getAllStyles(){return this.styleRef.keys()}onStyleAdded(n){for(let i of this.hostNodes)this.addStyleToHost(i,n)}onStyleRemoved(n){let i=this.styleRef;i.get(n)?.elements?.forEach(s=>s.remove()),i.delete(n)}collectServerRenderedStyles(){let n=this.doc.head?.querySelectorAll(`style[${Rl}="${this.appId}"]`);if(n?.length){let i=new Map;return n.forEach(s=>{s.textContent!=null&&i.set(s.textContent,s)}),i}return null}changeUsageCount(n,i){let s=this.styleRef;if(s.has(n)){let o=s.get(n);return o.usage+=i,o.usage}return s.set(n,{usage:i,elements:[]}),i}getStyleElement(n,i){let s=this.styleNodesInDOM,o=s?.get(i);if(o?.parentNode===n)return s.delete(i),o.removeAttribute(Rl),o;{let c=this.doc.createElement("style");return this.nonce&&c.setAttribute("nonce",this.nonce),c.textContent=i,this.platformIsServer&&c.setAttribute(Rl,this.appId),n.appendChild(c),c}}addStyleToHost(n,i){let s=this.getStyleElement(n,i),o=this.styleRef,c=o.get(i)?.elements;c?c.push(s):o.set(i,{elements:[s],usage:1})}resetHostNodes(){let n=this.hostNodes;n.clear(),n.add(this.doc.head)}};e.\u0275fac=function(i){return new(i||e)($(dt),$(cl),$(ul,8),$(st))},e.\u0275prov=se({token:e,factory:e.\u0275fac});let r=e;return r})(),Cl={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/MathML/"},Ml=/%COMP%/g,Ry="%COMP%",zT=`_nghost-${Ry}`,BT=`_ngcontent-${Ry}`,qT=!0,GT=new oe("",{providedIn:"root",factory:()=>qT});function KT(r){return BT.replace(Ml,r)}function WT(r){return zT.replace(Ml,r)}function Cy(r,e){return e.map(t=>t.replace(Ml,r))}var Ty=(()=>{let e=class e{constructor(n,i,s,o,c,u,l,f=null){this.eventManager=n,this.sharedStylesHost=i,this.appId=s,this.removeStylesOnCompDestroy=o,this.doc=c,this.platformId=u,this.ngZone=l,this.nonce=f,this.rendererByCompId=new Map,this.platformIsServer=Jt(u),this.defaultRenderer=new Es(n,c,l,this.platformIsServer)}createRenderer(n,i){if(!n||!i)return this.defaultRenderer;this.platformIsServer&&i.encapsulation===ls.ShadowDom&&(i=Ie(z({},i),{encapsulation:ls.Emulated}));let s=this.getOrCreateRenderer(n,i);return s instanceof ma?s.applyToHost(n):s instanceof Ts&&s.applyStyles(),s}getOrCreateRenderer(n,i){let s=this.rendererByCompId,o=s.get(i.id);if(!o){let c=this.doc,u=this.ngZone,l=this.eventManager,f=this.sharedStylesHost,p=this.removeStylesOnCompDestroy,m=this.platformIsServer;switch(i.encapsulation){case ls.Emulated:o=new ma(l,f,i,this.appId,p,c,u,m);break;case ls.ShadowDom:return new Nl(l,f,n,i,c,u,this.nonce,m);default:o=new Ts(l,f,i,p,c,u,m);break}s.set(i.id,o)}return o}ngOnDestroy(){this.rendererByCompId.clear()}};e.\u0275fac=function(i){return new(i||e)($(Sy),$(by),$(cl),$(GT),$(dt),$(st),$(Ce),$(ul))},e.\u0275prov=se({token:e,factory:e.\u0275fac});let r=e;return r})(),Es=class{constructor(e,t,n,i){this.eventManager=e,this.doc=t,this.ngZone=n,this.platformIsServer=i,this.data=Object.create(null),this.throwOnSyntheticProps=!0,this.destroyNode=null}destroy(){}createElement(e,t){return t?this.doc.createElementNS(Cl[t]||t,e):this.doc.createElement(e)}createComment(e){return this.doc.createComment(e)}createText(e){return this.doc.createTextNode(e)}appendChild(e,t){(Iy(e)?e.content:e).appendChild(t)}insertBefore(e,t,n){e&&(Iy(e)?e.content:e).insertBefore(t,n)}removeChild(e,t){e&&e.removeChild(t)}selectRootElement(e,t){let n=typeof e=="string"?this.doc.querySelector(e):e;if(!n)throw new Oe(-5104,!1);return t||(n.textContent=""),n}parentNode(e){return e.parentNode}nextSibling(e){return e.nextSibling}setAttribute(e,t,n,i){if(i){t=i+":"+t;let s=Cl[i];s?e.setAttributeNS(s,t,n):e.setAttribute(t,n)}else e.setAttribute(t,n)}removeAttribute(e,t,n){if(n){let i=Cl[n];i?e.removeAttributeNS(i,t):e.removeAttribute(`${n}:${t}`)}else e.removeAttribute(t)}addClass(e,t){e.classList.add(t)}removeClass(e,t){e.classList.remove(t)}setStyle(e,t,n,i){i&(fs.DashCase|fs.Important)?e.style.setProperty(t,n,i&fs.Important?"important":""):e.style[t]=n}removeStyle(e,t,n){n&fs.DashCase?e.style.removeProperty(t):e.style[t]=""}setProperty(e,t,n){e!=null&&(e[t]=n)}setValue(e,t){e.nodeValue=t}listen(e,t,n){if(typeof e=="string"&&(e=ml().getGlobalEventTarget(this.doc,e),!e))throw new Error(`Unsupported event target ${e} for event ${t}`);return this.eventManager.addEventListener(e,t,this.decoratePreventDefault(n))}decoratePreventDefault(e){return t=>{if(t==="__ngUnwrap__")return e;(this.platformIsServer?this.ngZone.runGuarded(()=>e(t)):e(t))===!1&&t.preventDefault()}}};function Iy(r){return r.tagName==="TEMPLATE"&&r.content!==void 0}var Nl=class extends Es{constructor(e,t,n,i,s,o,c,u){super(e,s,o,u),this.sharedStylesHost=t,this.hostEl=n,this.shadowRoot=n.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);let l=Cy(i.id,i.styles);for(let f of l){let p=document.createElement("style");c&&p.setAttribute("nonce",c),p.textContent=f,this.shadowRoot.appendChild(p)}}nodeOrShadowRoot(e){return e===this.hostEl?this.shadowRoot:e}appendChild(e,t){return super.appendChild(this.nodeOrShadowRoot(e),t)}insertBefore(e,t,n){return super.insertBefore(this.nodeOrShadowRoot(e),t,n)}removeChild(e,t){return super.removeChild(this.nodeOrShadowRoot(e),t)}parentNode(e){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(e)))}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}},Ts=class extends Es{constructor(e,t,n,i,s,o,c,u){super(e,s,o,c),this.sharedStylesHost=t,this.removeStylesOnCompDestroy=i,this.styles=u?Cy(u,n.styles):n.styles}applyStyles(){this.sharedStylesHost.addStyles(this.styles)}destroy(){this.removeStylesOnCompDestroy&&this.sharedStylesHost.removeStyles(this.styles)}},ma=class extends Ts{constructor(e,t,n,i,s,o,c,u){let l=i+"-"+n.id;super(e,t,n,s,o,c,u,l),this.contentAttr=KT(l),this.hostAttr=WT(l)}applyToHost(e){this.applyStyles(),this.setAttribute(e,this.hostAttr,"")}createElement(e,t){let n=super.createElement(e,t);return super.setAttribute(n,this.contentAttr,""),n}},HT=(()=>{let e=class e extends ga{constructor(n){super(n)}supports(n){return!0}addEventListener(n,i,s){return n.addEventListener(i,s,!1),()=>this.removeEventListener(n,i,s)}removeEventListener(n,i,s){return n.removeEventListener(i,s)}};e.\u0275fac=function(i){return new(i||e)($(dt))},e.\u0275prov=se({token:e,factory:e.\u0275fac});let r=e;return r})(),Ay=["alt","control","meta","shift"],QT={"\b":"Backspace","	":"Tab","\x7F":"Delete","\x1B":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},YT={alt:r=>r.altKey,control:r=>r.ctrlKey,meta:r=>r.metaKey,shift:r=>r.shiftKey},XT=(()=>{let e=class e extends ga{constructor(n){super(n)}supports(n){return e.parseEventName(n)!=null}addEventListener(n,i,s){let o=e.parseEventName(i),c=e.eventCallback(o.fullKey,s,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>ml().onAndCancel(n,o.domEventName,c))}static parseEventName(n){let i=n.toLowerCase().split("."),s=i.shift();if(i.length===0||!(s==="keydown"||s==="keyup"))return null;let o=e._normalizeKey(i.pop()),c="",u=i.indexOf("code");if(u>-1&&(i.splice(u,1),c="code."),Ay.forEach(f=>{let p=i.indexOf(f);p>-1&&(i.splice(p,1),c+=f+".")}),c+=o,i.length!=0||o.length===0)return null;let l={};return l.domEventName=s,l.fullKey=c,l}static matchEventFullKeyCode(n,i){let s=QT[n.key]||n.key,o="";return i.indexOf("code.")>-1&&(s=n.code,o="code."),s==null||!s?!1:(s=s.toLowerCase(),s===" "?s="space":s==="."&&(s="dot"),Ay.forEach(c=>{if(c!==s){let u=YT[c];u(n)&&(o+=c+".")}}),o+=s,o===i)}static eventCallback(n,i,s){return o=>{e.matchEventFullKeyCode(o,n)&&s.runGuarded(()=>i(o))}}static _normalizeKey(n){return n==="esc"?"escape":n}};e.\u0275fac=function(i){return new(i||e)($(dt))},e.\u0275prov=se({token:e,factory:e.\u0275fac});let r=e;return r})();function uP(r,e){return Hm(z({rootComponent:r},JT(e)))}function JT(r){return{appProviders:[...rI,...r?.providers??[]],platformProviders:nI}}function ZT(){Dl.makeCurrent()}function eI(){return new al}function tI(){return xm(document),document}var nI=[{provide:st,useValue:ny},{provide:Nm,useValue:ZT,multi:!0},{provide:dt,useFactory:tI,deps:[]}];var rI=[{provide:Cm,useValue:"root"},{provide:al,useFactory:eI,deps:[]},{provide:xl,useClass:HT,multi:!0,deps:[dt,Ce,st]},{provide:xl,useClass:XT,multi:!0,deps:[dt]},Ty,by,Sy,{provide:Om,useExisting:Ty},{provide:iy,useClass:$T,deps:[]},[]];var Py=(()=>{let e=class e{constructor(n){this._doc=n}getTitle(){return this._doc.title}setTitle(n){this._doc.title=n||""}};e.\u0275fac=function(i){return new(i||e)($(dt))},e.\u0275prov=se({token:e,factory:e.\u0275fac,providedIn:"root"});let r=e;return r})();var kl=function(r){return r[r.NoHttpTransferCache=0]="NoHttpTransferCache",r[r.HttpTransferCacheOptions=1]="HttpTransferCacheOptions",r}(kl||{});function lP(...r){let e=[],t=new Set,n=t.has(kl.HttpTransferCacheOptions);for(let{\u0275providers:i,\u0275kind:s}of r)t.add(s),i.length&&e.push(i);return hs([[],Qm(),t.has(kl.NoHttpTransferCache)||n?[]:Ey({}),e])}var ee="primary",Fs=Symbol("RouteTitle"),Ul=class{constructor(e){this.params=e||{}}has(e){return Object.prototype.hasOwnProperty.call(this.params,e)}get(e){if(this.has(e)){let t=this.params[e];return Array.isArray(t)?t[0]:t}return null}getAll(e){if(this.has(e)){let t=this.params[e];return Array.isArray(t)?t:[t]}return[]}get keys(){return Object.keys(this.params)}};function qr(r){return new Ul(r)}function sI(r,e,t){let n=t.path.split("/");if(n.length>r.length||t.pathMatch==="full"&&(e.hasChildren()||n.length<r.length))return null;let i={};for(let s=0;s<n.length;s++){let o=n[s],c=r[s];if(o.startsWith(":"))i[o.substring(1)]=c;else if(o!==c.path)return null}return{consumed:r.slice(0,n.length),posParams:i}}function oI(r,e){if(r.length!==e.length)return!1;for(let t=0;t<r.length;++t)if(!xt(r[t],e[t]))return!1;return!0}function xt(r,e){let t=r?jl(r):void 0,n=e?jl(e):void 0;if(!t||!n||t.length!=n.length)return!1;let i;for(let s=0;s<t.length;s++)if(i=t[s],!Fy(r[i],e[i]))return!1;return!0}function jl(r){return[...Object.keys(r),...Object.getOwnPropertySymbols(r)]}function Fy(r,e){if(Array.isArray(r)&&Array.isArray(e)){if(r.length!==e.length)return!1;let t=[...r].sort(),n=[...e].sort();return t.every((i,s)=>n[s]===i)}else return r===e}function Uy(r){return r.length>0?r[r.length-1]:null}function Tn(r){return ym(r)?r:Km(r)?ge(Promise.resolve(r)):B(r)}var aI={exact:$y,subset:zy},jy={exact:cI,subset:uI,ignored:()=>!0};function Dy(r,e,t){return aI[t.paths](r.root,e.root,t.matrixParams)&&jy[t.queryParams](r.queryParams,e.queryParams)&&!(t.fragment==="exact"&&r.fragment!==e.fragment)}function cI(r,e){return xt(r,e)}function $y(r,e,t){if(!Jn(r.segments,e.segments)||!_a(r.segments,e.segments,t)||r.numberOfChildren!==e.numberOfChildren)return!1;for(let n in e.children)if(!r.children[n]||!$y(r.children[n],e.children[n],t))return!1;return!0}function uI(r,e){return Object.keys(e).length<=Object.keys(r).length&&Object.keys(e).every(t=>Fy(r[t],e[t]))}function zy(r,e,t){return By(r,e,e.segments,t)}function By(r,e,t,n){if(r.segments.length>t.length){let i=r.segments.slice(0,t.length);return!(!Jn(i,t)||e.hasChildren()||!_a(i,t,n))}else if(r.segments.length===t.length){if(!Jn(r.segments,t)||!_a(r.segments,t,n))return!1;for(let i in e.children)if(!r.children[i]||!zy(r.children[i],e.children[i],n))return!1;return!0}else{let i=t.slice(0,r.segments.length),s=t.slice(r.segments.length);return!Jn(r.segments,i)||!_a(r.segments,i,n)||!r.children[ee]?!1:By(r.children[ee],e,s,n)}}function _a(r,e,t){return e.every((n,i)=>jy[t](r[i].parameters,n.parameters))}var vn=class{constructor(e=new ce([],{}),t={},n=null){this.root=e,this.queryParams=t,this.fragment=n}get queryParamMap(){return this._queryParamMap??=qr(this.queryParams),this._queryParamMap}toString(){return dI.serialize(this)}},ce=class{constructor(e,t){this.segments=e,this.children=t,this.parent=null,Object.values(t).forEach(n=>n.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return wa(this)}},Xn=class{constructor(e,t){this.path=e,this.parameters=t}get parameterMap(){return this._parameterMap??=qr(this.parameters),this._parameterMap}toString(){return Gy(this)}};function lI(r,e){return Jn(r,e)&&r.every((t,n)=>xt(t.parameters,e[n].parameters))}function Jn(r,e){return r.length!==e.length?!1:r.every((t,n)=>t.path===e[n].path)}function hI(r,e){let t=[];return Object.entries(r.children).forEach(([n,i])=>{n===ee&&(t=t.concat(e(i,n)))}),Object.entries(r.children).forEach(([n,i])=>{n!==ee&&(t=t.concat(e(i,n)))}),t}var Us=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=se({token:e,factory:()=>new Ps,providedIn:"root"});let r=e;return r})(),Ps=class{parse(e){let t=new zl(e);return new vn(t.parseRootSegment(),t.parseQueryParams(),t.parseFragment())}serialize(e){let t=`/${Is(e.root,!0)}`,n=gI(e.queryParams),i=typeof e.fragment=="string"?`#${fI(e.fragment)}`:"";return`${t}${n}${i}`}},dI=new Ps;function wa(r){return r.segments.map(e=>Gy(e)).join("/")}function Is(r,e){if(!r.hasChildren())return wa(r);if(e){let t=r.children[ee]?Is(r.children[ee],!1):"",n=[];return Object.entries(r.children).forEach(([i,s])=>{i!==ee&&n.push(`${i}:${Is(s,!1)}`)}),n.length>0?`${t}(${n.join("//")})`:t}else{let t=hI(r,(n,i)=>i===ee?[Is(r.children[ee],!1)]:[`${i}:${Is(n,!1)}`]);return Object.keys(r.children).length===1&&r.children[ee]!=null?`${wa(r)}/${t[0]}`:`${wa(r)}/(${t.join("//")})`}}function qy(r){return encodeURIComponent(r).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function ya(r){return qy(r).replace(/%3B/gi,";")}function fI(r){return encodeURI(r)}function $l(r){return qy(r).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function Ea(r){return decodeURIComponent(r)}function xy(r){return Ea(r.replace(/\+/g,"%20"))}function Gy(r){return`${$l(r.path)}${pI(r.parameters)}`}function pI(r){return Object.entries(r).map(([e,t])=>`;${$l(e)}=${$l(t)}`).join("")}function gI(r){let e=Object.entries(r).map(([t,n])=>Array.isArray(n)?n.map(i=>`${ya(t)}=${ya(i)}`).join("&"):`${ya(t)}=${ya(n)}`).filter(t=>t);return e.length?`?${e.join("&")}`:""}var mI=/^[^\/()?;#]+/;function Ol(r){let e=r.match(mI);return e?e[0]:""}var yI=/^[^\/()?;=#]+/;function vI(r){let e=r.match(yI);return e?e[0]:""}var _I=/^[^=?&#]+/;function wI(r){let e=r.match(_I);return e?e[0]:""}var EI=/^[^&#]+/;function TI(r){let e=r.match(EI);return e?e[0]:""}var zl=class{constructor(e){this.url=e,this.remaining=e}parseRootSegment(){return this.consumeOptional("/"),this.remaining===""||this.peekStartsWith("?")||this.peekStartsWith("#")?new ce([],{}):new ce([],this.parseChildren())}parseQueryParams(){let e={};if(this.consumeOptional("?"))do this.parseQueryParam(e);while(this.consumeOptional("&"));return e}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(this.remaining==="")return{};this.consumeOptional("/");let e=[];for(this.peekStartsWith("(")||e.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),e.push(this.parseSegment());let t={};this.peekStartsWith("/(")&&(this.capture("/"),t=this.parseParens(!0));let n={};return this.peekStartsWith("(")&&(n=this.parseParens(!1)),(e.length>0||Object.keys(t).length>0)&&(n[ee]=new ce(e,t)),n}parseSegment(){let e=Ol(this.remaining);if(e===""&&this.peekStartsWith(";"))throw new Oe(4009,!1);return this.capture(e),new Xn(Ea(e),this.parseMatrixParams())}parseMatrixParams(){let e={};for(;this.consumeOptional(";");)this.parseParam(e);return e}parseParam(e){let t=vI(this.remaining);if(!t)return;this.capture(t);let n="";if(this.consumeOptional("=")){let i=Ol(this.remaining);i&&(n=i,this.capture(n))}e[Ea(t)]=Ea(n)}parseQueryParam(e){let t=wI(this.remaining);if(!t)return;this.capture(t);let n="";if(this.consumeOptional("=")){let o=TI(this.remaining);o&&(n=o,this.capture(n))}let i=xy(t),s=xy(n);if(e.hasOwnProperty(i)){let o=e[i];Array.isArray(o)||(o=[o],e[i]=o),o.push(s)}else e[i]=s}parseParens(e){let t={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){let n=Ol(this.remaining),i=this.remaining[n.length];if(i!=="/"&&i!==")"&&i!==";")throw new Oe(4010,!1);let s;n.indexOf(":")>-1?(s=n.slice(0,n.indexOf(":")),this.capture(s),this.capture(":")):e&&(s=ee);let o=this.parseChildren();t[s]=Object.keys(o).length===1?o[ee]:new ce([],o),this.consumeOptional("//")}return t}peekStartsWith(e){return this.remaining.startsWith(e)}consumeOptional(e){return this.peekStartsWith(e)?(this.remaining=this.remaining.substring(e.length),!0):!1}capture(e){if(!this.consumeOptional(e))throw new Oe(4011,!1)}};function Ky(r){return r.segments.length>0?new ce([],{[ee]:r}):r}function Wy(r){let e={};for(let[n,i]of Object.entries(r.children)){let s=Wy(i);if(n===ee&&s.segments.length===0&&s.hasChildren())for(let[o,c]of Object.entries(s.children))e[o]=c;else(s.segments.length>0||s.hasChildren())&&(e[n]=s)}let t=new ce(r.segments,e);return II(t)}function II(r){if(r.numberOfChildren===1&&r.children[ee]){let e=r.children[ee];return new ce(r.segments.concat(e.segments),e.children)}return r}function Gr(r){return r instanceof vn}function AI(r,e,t=null,n=null){let i=Hy(r);return Qy(i,e,t,n)}function Hy(r){let e;function t(s){let o={};for(let u of s.children){let l=t(u);o[u.outlet]=l}let c=new ce(s.url,o);return s===r&&(e=c),c}let n=t(r.root),i=Ky(n);return e??i}function Qy(r,e,t,n){let i=r;for(;i.parent;)i=i.parent;if(e.length===0)return Vl(i,i,i,t,n);let s=SI(e);if(s.toRoot())return Vl(i,i,new ce([],{}),t,n);let o=bI(s,i,r),c=o.processChildren?bs(o.segmentGroup,o.index,s.commands):Xy(o.segmentGroup,o.index,s.commands);return Vl(i,o.segmentGroup,c,t,n)}function Ta(r){return typeof r=="object"&&r!=null&&!r.outlets&&!r.segmentPath}function Ds(r){return typeof r=="object"&&r!=null&&r.outlets}function Vl(r,e,t,n,i){let s={};n&&Object.entries(n).forEach(([u,l])=>{s[u]=Array.isArray(l)?l.map(f=>`${f}`):`${l}`});let o;r===e?o=t:o=Yy(r,e,t);let c=Ky(Wy(o));return new vn(c,s,i)}function Yy(r,e,t){let n={};return Object.entries(r.children).forEach(([i,s])=>{s===e?n[i]=t:n[i]=Yy(s,e,t)}),new ce(r.segments,n)}var Ia=class{constructor(e,t,n){if(this.isAbsolute=e,this.numberOfDoubleDots=t,this.commands=n,e&&n.length>0&&Ta(n[0]))throw new Oe(4003,!1);let i=n.find(Ds);if(i&&i!==Uy(n))throw new Oe(4004,!1)}toRoot(){return this.isAbsolute&&this.commands.length===1&&this.commands[0]=="/"}};function SI(r){if(typeof r[0]=="string"&&r.length===1&&r[0]==="/")return new Ia(!0,0,r);let e=0,t=!1,n=r.reduce((i,s,o)=>{if(typeof s=="object"&&s!=null){if(s.outlets){let c={};return Object.entries(s.outlets).forEach(([u,l])=>{c[u]=typeof l=="string"?l.split("/"):l}),[...i,{outlets:c}]}if(s.segmentPath)return[...i,s.segmentPath]}return typeof s!="string"?[...i,s]:o===0?(s.split("/").forEach((c,u)=>{u==0&&c==="."||(u==0&&c===""?t=!0:c===".."?e++:c!=""&&i.push(c))}),i):[...i,s]},[]);return new Ia(t,e,n)}var zr=class{constructor(e,t,n){this.segmentGroup=e,this.processChildren=t,this.index=n}};function bI(r,e,t){if(r.isAbsolute)return new zr(e,!0,0);if(!t)return new zr(e,!1,NaN);if(t.parent===null)return new zr(t,!0,0);let n=Ta(r.commands[0])?0:1,i=t.segments.length-1+n;return RI(t,i,r.numberOfDoubleDots)}function RI(r,e,t){let n=r,i=e,s=t;for(;s>i;){if(s-=i,n=n.parent,!n)throw new Oe(4005,!1);i=n.segments.length}return new zr(n,!1,i-s)}function CI(r){return Ds(r[0])?r[0].outlets:{[ee]:r}}function Xy(r,e,t){if(r??=new ce([],{}),r.segments.length===0&&r.hasChildren())return bs(r,e,t);let n=PI(r,e,t),i=t.slice(n.commandIndex);if(n.match&&n.pathIndex<r.segments.length){let s=new ce(r.segments.slice(0,n.pathIndex),{});return s.children[ee]=new ce(r.segments.slice(n.pathIndex),r.children),bs(s,0,i)}else return n.match&&i.length===0?new ce(r.segments,{}):n.match&&!r.hasChildren()?Bl(r,e,t):n.match?bs(r,0,i):Bl(r,e,t)}function bs(r,e,t){if(t.length===0)return new ce(r.segments,{});{let n=CI(t),i={};if(Object.keys(n).some(s=>s!==ee)&&r.children[ee]&&r.numberOfChildren===1&&r.children[ee].segments.length===0){let s=bs(r.children[ee],e,t);return new ce(r.segments,s.children)}return Object.entries(n).forEach(([s,o])=>{typeof o=="string"&&(o=[o]),o!==null&&(i[s]=Xy(r.children[s],e,o))}),Object.entries(r.children).forEach(([s,o])=>{n[s]===void 0&&(i[s]=o)}),new ce(r.segments,i)}}function PI(r,e,t){let n=0,i=e,s={match:!1,pathIndex:0,commandIndex:0};for(;i<r.segments.length;){if(n>=t.length)return s;let o=r.segments[i],c=t[n];if(Ds(c))break;let u=`${c}`,l=n<t.length-1?t[n+1]:null;if(i>0&&u===void 0)break;if(u&&l&&typeof l=="object"&&l.outlets===void 0){if(!ky(u,l,o))return s;n+=2}else{if(!ky(u,{},o))return s;n++}i++}return{match:!0,pathIndex:i,commandIndex:n}}function Bl(r,e,t){let n=r.segments.slice(0,e),i=0;for(;i<t.length;){let s=t[i];if(Ds(s)){let u=DI(s.outlets);return new ce(n,u)}if(i===0&&Ta(t[0])){let u=r.segments[e];n.push(new Xn(u.path,Ny(t[0]))),i++;continue}let o=Ds(s)?s.outlets[ee]:`${s}`,c=i<t.length-1?t[i+1]:null;o&&c&&Ta(c)?(n.push(new Xn(o,Ny(c))),i+=2):(n.push(new Xn(o,{})),i++)}return new ce(n,{})}function DI(r){let e={};return Object.entries(r).forEach(([t,n])=>{typeof n=="string"&&(n=[n]),n!==null&&(e[t]=Bl(new ce([],{}),0,n))}),e}function Ny(r){let e={};return Object.entries(r).forEach(([t,n])=>e[t]=`${n}`),e}function ky(r,e,t){return r==t.path&&xt(e,t.parameters)}var Rs="imperative",Le=function(r){return r[r.NavigationStart=0]="NavigationStart",r[r.NavigationEnd=1]="NavigationEnd",r[r.NavigationCancel=2]="NavigationCancel",r[r.NavigationError=3]="NavigationError",r[r.RoutesRecognized=4]="RoutesRecognized",r[r.ResolveStart=5]="ResolveStart",r[r.ResolveEnd=6]="ResolveEnd",r[r.GuardsCheckStart=7]="GuardsCheckStart",r[r.GuardsCheckEnd=8]="GuardsCheckEnd",r[r.RouteConfigLoadStart=9]="RouteConfigLoadStart",r[r.RouteConfigLoadEnd=10]="RouteConfigLoadEnd",r[r.ChildActivationStart=11]="ChildActivationStart",r[r.ChildActivationEnd=12]="ChildActivationEnd",r[r.ActivationStart=13]="ActivationStart",r[r.ActivationEnd=14]="ActivationEnd",r[r.Scroll=15]="Scroll",r[r.NavigationSkipped=16]="NavigationSkipped",r}(Le||{}),ft=class{constructor(e,t){this.id=e,this.url=t}},Kr=class extends ft{constructor(e,t,n="imperative",i=null){super(e,t),this.type=Le.NavigationStart,this.navigationTrigger=n,this.restoredState=i}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}},Nt=class extends ft{constructor(e,t,n){super(e,t),this.urlAfterRedirects=n,this.type=Le.NavigationEnd}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}},at=function(r){return r[r.Redirect=0]="Redirect",r[r.SupersededByNewNavigation=1]="SupersededByNewNavigation",r[r.NoDataFromResolver=2]="NoDataFromResolver",r[r.GuardRejected=3]="GuardRejected",r}(at||{}),Aa=function(r){return r[r.IgnoredSameUrlNavigation=0]="IgnoredSameUrlNavigation",r[r.IgnoredByUrlHandlingStrategy=1]="IgnoredByUrlHandlingStrategy",r}(Aa||{}),_n=class extends ft{constructor(e,t,n,i){super(e,t),this.reason=n,this.code=i,this.type=Le.NavigationCancel}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}},wn=class extends ft{constructor(e,t,n,i){super(e,t),this.reason=n,this.code=i,this.type=Le.NavigationSkipped}},xs=class extends ft{constructor(e,t,n,i){super(e,t),this.error=n,this.target=i,this.type=Le.NavigationError}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}},Sa=class extends ft{constructor(e,t,n,i){super(e,t),this.urlAfterRedirects=n,this.state=i,this.type=Le.RoutesRecognized}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},ql=class extends ft{constructor(e,t,n,i){super(e,t),this.urlAfterRedirects=n,this.state=i,this.type=Le.GuardsCheckStart}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},Gl=class extends ft{constructor(e,t,n,i,s){super(e,t),this.urlAfterRedirects=n,this.state=i,this.shouldActivate=s,this.type=Le.GuardsCheckEnd}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}},Kl=class extends ft{constructor(e,t,n,i){super(e,t),this.urlAfterRedirects=n,this.state=i,this.type=Le.ResolveStart}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},Wl=class extends ft{constructor(e,t,n,i){super(e,t),this.urlAfterRedirects=n,this.state=i,this.type=Le.ResolveEnd}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},Hl=class{constructor(e){this.route=e,this.type=Le.RouteConfigLoadStart}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}},Ql=class{constructor(e){this.route=e,this.type=Le.RouteConfigLoadEnd}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}},Yl=class{constructor(e){this.snapshot=e,this.type=Le.ChildActivationStart}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},Xl=class{constructor(e){this.snapshot=e,this.type=Le.ChildActivationEnd}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},Jl=class{constructor(e){this.snapshot=e,this.type=Le.ActivationStart}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},Zl=class{constructor(e){this.snapshot=e,this.type=Le.ActivationEnd}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},ba=class{constructor(e,t,n){this.routerEvent=e,this.position=t,this.anchor=n,this.type=Le.Scroll}toString(){let e=this.position?`${this.position[0]}, ${this.position[1]}`:null;return`Scroll(anchor: '${this.anchor}', position: '${e}')`}},Ns=class{},ks=class{constructor(e){this.url=e}};var eh=class{constructor(){this.outlet=null,this.route=null,this.injector=null,this.children=new js,this.attachRef=null}},js=(()=>{let e=class e{constructor(){this.contexts=new Map}onChildOutletCreated(n,i){let s=this.getOrCreateContext(n);s.outlet=i,this.contexts.set(n,s)}onChildOutletDestroyed(n){let i=this.getContext(n);i&&(i.outlet=null,i.attachRef=null)}onOutletDeactivated(){let n=this.contexts;return this.contexts=new Map,n}onOutletReAttached(n){this.contexts=n}getOrCreateContext(n){let i=this.getContext(n);return i||(i=new eh,this.contexts.set(n,i)),i}getContext(n){return this.contexts.get(n)||null}};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=se({token:e,factory:e.\u0275fac,providedIn:"root"});let r=e;return r})(),Ra=class{constructor(e){this._root=e}get root(){return this._root.value}parent(e){let t=this.pathFromRoot(e);return t.length>1?t[t.length-2]:null}children(e){let t=th(e,this._root);return t?t.children.map(n=>n.value):[]}firstChild(e){let t=th(e,this._root);return t&&t.children.length>0?t.children[0].value:null}siblings(e){let t=nh(e,this._root);return t.length<2?[]:t[t.length-2].children.map(i=>i.value).filter(i=>i!==e)}pathFromRoot(e){return nh(e,this._root).map(t=>t.value)}};function th(r,e){if(r===e.value)return e;for(let t of e.children){let n=th(r,t);if(n)return n}return null}function nh(r,e){if(r===e.value)return[e];for(let t of e.children){let n=nh(r,t);if(n.length)return n.unshift(e),n}return[]}var ot=class{constructor(e,t){this.value=e,this.children=t}toString(){return`TreeNode(${this.value})`}};function $r(r){let e={};return r&&r.children.forEach(t=>e[t.value.outlet]=t),e}var Ca=class extends Ra{constructor(e,t){super(e),this.snapshot=t,dh(this,e)}toString(){return this.snapshot.toString()}};function Jy(r){let e=xI(r),t=new ht([new Xn("",{})]),n=new ht({}),i=new ht({}),s=new ht({}),o=new ht(""),c=new En(t,n,s,o,i,ee,r,e.root);return c.snapshot=e.root,new Ca(new ot(c,[]),e)}function xI(r){let e={},t={},n={},i="",s=new Ms([],e,n,i,t,ee,r,null,{});return new Pa("",new ot(s,[]))}var En=class{constructor(e,t,n,i,s,o,c,u){this.urlSubject=e,this.paramsSubject=t,this.queryParamsSubject=n,this.fragmentSubject=i,this.dataSubject=s,this.outlet=o,this.component=c,this._futureSnapshot=u,this.title=this.dataSubject?.pipe(X(l=>l[Fs]))??B(void 0),this.url=e,this.params=t,this.queryParams=n,this.fragment=i,this.data=s}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=this.params.pipe(X(e=>qr(e))),this._paramMap}get queryParamMap(){return this._queryParamMap??=this.queryParams.pipe(X(e=>qr(e))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}};function hh(r,e,t="emptyOnly"){let n,{routeConfig:i}=r;return e!==null&&(t==="always"||i?.path===""||!e.component&&!e.routeConfig?.loadComponent)?n={params:z(z({},e.params),r.params),data:z(z({},e.data),r.data),resolve:z(z(z(z({},r.data),e.data),i?.data),r._resolvedData)}:n={params:z({},r.params),data:z({},r.data),resolve:z(z({},r.data),r._resolvedData??{})},i&&ev(i)&&(n.resolve[Fs]=i.title),n}var Ms=class{get title(){return this.data?.[Fs]}constructor(e,t,n,i,s,o,c,u,l){this.url=e,this.params=t,this.queryParams=n,this.fragment=i,this.data=s,this.outlet=o,this.component=c,this.routeConfig=u,this._resolve=l}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=qr(this.params),this._paramMap}get queryParamMap(){return this._queryParamMap??=qr(this.queryParams),this._queryParamMap}toString(){let e=this.url.map(n=>n.toString()).join("/"),t=this.routeConfig?this.routeConfig.path:"";return`Route(url:'${e}', path:'${t}')`}},Pa=class extends Ra{constructor(e,t){super(t),this.url=e,dh(this,t)}toString(){return Zy(this._root)}};function dh(r,e){e.value._routerState=r,e.children.forEach(t=>dh(r,t))}function Zy(r){let e=r.children.length>0?` { ${r.children.map(Zy).join(", ")} } `:"";return`${r.value}${e}`}function Ll(r){if(r.snapshot){let e=r.snapshot,t=r._futureSnapshot;r.snapshot=t,xt(e.queryParams,t.queryParams)||r.queryParamsSubject.next(t.queryParams),e.fragment!==t.fragment&&r.fragmentSubject.next(t.fragment),xt(e.params,t.params)||r.paramsSubject.next(t.params),oI(e.url,t.url)||r.urlSubject.next(t.url),xt(e.data,t.data)||r.dataSubject.next(t.data)}else r.snapshot=r._futureSnapshot,r.dataSubject.next(r._futureSnapshot.data)}function rh(r,e){let t=xt(r.params,e.params)&&lI(r.url,e.url),n=!r.parent!=!e.parent;return t&&!n&&(!r.parent||rh(r.parent,e.parent))}function ev(r){return typeof r.title=="string"||r.title===null}var NI=(()=>{let e=class e{constructor(){this.activated=null,this._activatedRoute=null,this.name=ee,this.activateEvents=new ds,this.deactivateEvents=new ds,this.attachEvents=new ds,this.detachEvents=new ds,this.parentContexts=W(js),this.location=W(Fm),this.changeDetector=W(gl),this.environmentInjector=W(Vr),this.inputBinder=W(ka,{optional:!0}),this.supportsBindingToComponentInputs=!0}get activatedComponentRef(){return this.activated}ngOnChanges(n){if(n.name){let{firstChange:i,previousValue:s}=n.name;if(i)return;this.isTrackedInParentContexts(s)&&(this.deactivate(),this.parentContexts.onChildOutletDestroyed(s)),this.initializeOutletWithName()}}ngOnDestroy(){this.isTrackedInParentContexts(this.name)&&this.parentContexts.onChildOutletDestroyed(this.name),this.inputBinder?.unsubscribeFromRouteData(this)}isTrackedInParentContexts(n){return this.parentContexts.getContext(n)?.outlet===this}ngOnInit(){this.initializeOutletWithName()}initializeOutletWithName(){if(this.parentContexts.onChildOutletCreated(this.name,this),this.activated)return;let n=this.parentContexts.getContext(this.name);n?.route&&(n.attachRef?this.attach(n.attachRef,n.route):this.activateWith(n.route,n.injector))}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new Oe(4012,!1);return this.activated.instance}get activatedRoute(){if(!this.activated)throw new Oe(4012,!1);return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new Oe(4012,!1);this.location.detach();let n=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(n.instance),n}attach(n,i){this.activated=n,this._activatedRoute=i,this.location.insert(n.hostView),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.attachEvents.emit(n.instance)}deactivate(){if(this.activated){let n=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(n)}}activateWith(n,i){if(this.isActivated)throw new Oe(4013,!1);this._activatedRoute=n;let s=this.location,c=n.snapshot.component,u=this.parentContexts.getOrCreateContext(this.name).children,l=new ih(n,u,s.injector);this.activated=s.createComponent(c,{index:s.length,injector:l,environmentInjector:i??this.environmentInjector}),this.changeDetector.markForCheck(),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.activateEvents.emit(this.activated.instance)}};e.\u0275fac=function(i){return new(i||e)},e.\u0275dir=rl({type:e,selectors:[["router-outlet"]],inputs:{name:"name"},outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"],standalone:!0,features:[il]});let r=e;return r})(),ih=class r{__ngOutletInjector(e){return new r(this.route,this.childContexts,e)}constructor(e,t,n){this.route=e,this.childContexts=t,this.parent=n}get(e,t){return e===En?this.route:e===js?this.childContexts:this.parent.get(e,t)}},ka=new oe(""),My=(()=>{let e=class e{constructor(){this.outletDataSubscriptions=new Map}bindActivatedRouteToOutletComponent(n){this.unsubscribeFromRouteData(n),this.subscribeToRouteData(n)}unsubscribeFromRouteData(n){this.outletDataSubscriptions.get(n)?.unsubscribe(),this.outletDataSubscriptions.delete(n)}subscribeToRouteData(n){let{activatedRoute:i}=n,s=na([i.queryParams,i.params,i.data]).pipe(Me(([o,c,u],l)=>(u=z(z(z({},o),c),u),l===0?B(u):Promise.resolve(u)))).subscribe(o=>{if(!n.isActivated||!n.activatedComponentRef||n.activatedRoute!==i||i.component===null){this.unsubscribeFromRouteData(n);return}let c=Ym(i.component);if(!c){this.unsubscribeFromRouteData(n);return}for(let{templateName:u}of c.inputs)n.activatedComponentRef.setInput(u,o[u])});this.outletDataSubscriptions.set(n,s)}};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=se({token:e,factory:e.\u0275fac});let r=e;return r})();function kI(r,e,t){let n=Os(r,e._root,t?t._root:void 0);return new Ca(n,e)}function Os(r,e,t){if(t&&r.shouldReuseRoute(e.value,t.value.snapshot)){let n=t.value;n._futureSnapshot=e.value;let i=MI(r,e,t);return new ot(n,i)}else{if(r.shouldAttach(e.value)){let s=r.retrieve(e.value);if(s!==null){let o=s.route;return o.value._futureSnapshot=e.value,o.children=e.children.map(c=>Os(r,c)),o}}let n=OI(e.value),i=e.children.map(s=>Os(r,s));return new ot(n,i)}}function MI(r,e,t){return e.children.map(n=>{for(let i of t.children)if(r.shouldReuseRoute(n.value,i.value.snapshot))return Os(r,n,i);return Os(r,n)})}function OI(r){return new En(new ht(r.url),new ht(r.params),new ht(r.queryParams),new ht(r.fragment),new ht(r.data),r.outlet,r.component,r)}var tv="ngNavigationCancelingError";function nv(r,e){let{redirectTo:t,navigationBehaviorOptions:n}=Gr(e)?{redirectTo:e,navigationBehaviorOptions:void 0}:e,i=rv(!1,at.Redirect);return i.url=t,i.navigationBehaviorOptions=n,i}function rv(r,e){let t=new Error(`NavigationCancelingError: ${r||""}`);return t[tv]=!0,t.cancellationCode=e,t}function VI(r){return iv(r)&&Gr(r.url)}function iv(r){return!!r&&r[tv]}var LI=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275cmp=Rm({type:e,selectors:[["ng-component"]],standalone:!0,features:[qm],decls:1,vars:0,template:function(i,s){i&1&&zm(0,"router-outlet")},dependencies:[NI],encapsulation:2});let r=e;return r})();function FI(r,e){return r.providers&&!r._injector&&(r._injector=hl(r.providers,e,`Route: ${r.path}`)),r._injector??e}function fh(r){let e=r.children&&r.children.map(fh),t=e?Ie(z({},r),{children:e}):z({},r);return!t.component&&!t.loadComponent&&(e||t.loadChildren)&&t.outlet&&t.outlet!==ee&&(t.component=LI),t}function kt(r){return r.outlet||ee}function UI(r,e){let t=r.filter(n=>kt(n)===e);return t.push(...r.filter(n=>kt(n)!==e)),t}function $s(r){if(!r)return null;if(r.routeConfig?._injector)return r.routeConfig._injector;for(let e=r.parent;e;e=e.parent){let t=e.routeConfig;if(t?._loadedInjector)return t._loadedInjector;if(t?._injector)return t._injector}return null}var jI=(r,e,t,n)=>X(i=>(new sh(e,i.targetRouterState,i.currentRouterState,t,n).activate(r),i)),sh=class{constructor(e,t,n,i,s){this.routeReuseStrategy=e,this.futureState=t,this.currState=n,this.forwardEvent=i,this.inputBindingEnabled=s}activate(e){let t=this.futureState._root,n=this.currState?this.currState._root:null;this.deactivateChildRoutes(t,n,e),Ll(this.futureState.root),this.activateChildRoutes(t,n,e)}deactivateChildRoutes(e,t,n){let i=$r(t);e.children.forEach(s=>{let o=s.value.outlet;this.deactivateRoutes(s,i[o],n),delete i[o]}),Object.values(i).forEach(s=>{this.deactivateRouteAndItsChildren(s,n)})}deactivateRoutes(e,t,n){let i=e.value,s=t?t.value:null;if(i===s)if(i.component){let o=n.getContext(i.outlet);o&&this.deactivateChildRoutes(e,t,o.children)}else this.deactivateChildRoutes(e,t,n);else s&&this.deactivateRouteAndItsChildren(t,n)}deactivateRouteAndItsChildren(e,t){e.value.component&&this.routeReuseStrategy.shouldDetach(e.value.snapshot)?this.detachAndStoreRouteSubtree(e,t):this.deactivateRouteAndOutlet(e,t)}detachAndStoreRouteSubtree(e,t){let n=t.getContext(e.value.outlet),i=n&&e.value.component?n.children:t,s=$r(e);for(let o of Object.values(s))this.deactivateRouteAndItsChildren(o,i);if(n&&n.outlet){let o=n.outlet.detach(),c=n.children.onOutletDeactivated();this.routeReuseStrategy.store(e.value.snapshot,{componentRef:o,route:e,contexts:c})}}deactivateRouteAndOutlet(e,t){let n=t.getContext(e.value.outlet),i=n&&e.value.component?n.children:t,s=$r(e);for(let o of Object.values(s))this.deactivateRouteAndItsChildren(o,i);n&&(n.outlet&&(n.outlet.deactivate(),n.children.onOutletDeactivated()),n.attachRef=null,n.route=null)}activateChildRoutes(e,t,n){let i=$r(t);e.children.forEach(s=>{this.activateRoutes(s,i[s.value.outlet],n),this.forwardEvent(new Zl(s.value.snapshot))}),e.children.length&&this.forwardEvent(new Xl(e.value.snapshot))}activateRoutes(e,t,n){let i=e.value,s=t?t.value:null;if(Ll(i),i===s)if(i.component){let o=n.getOrCreateContext(i.outlet);this.activateChildRoutes(e,t,o.children)}else this.activateChildRoutes(e,t,n);else if(i.component){let o=n.getOrCreateContext(i.outlet);if(this.routeReuseStrategy.shouldAttach(i.snapshot)){let c=this.routeReuseStrategy.retrieve(i.snapshot);this.routeReuseStrategy.store(i.snapshot,null),o.children.onOutletReAttached(c.contexts),o.attachRef=c.componentRef,o.route=c.route.value,o.outlet&&o.outlet.attach(c.componentRef,c.route.value),Ll(c.route.value),this.activateChildRoutes(e,null,o.children)}else{let c=$s(i.snapshot);o.attachRef=null,o.route=i,o.injector=c,o.outlet&&o.outlet.activateWith(i,o.injector),this.activateChildRoutes(e,null,o.children)}}else this.activateChildRoutes(e,null,n)}},Da=class{constructor(e){this.path=e,this.route=this.path[this.path.length-1]}},Br=class{constructor(e,t){this.component=e,this.route=t}};function $I(r,e,t){let n=r._root,i=e?e._root:null;return As(n,i,t,[n.value])}function zI(r){let e=r.routeConfig?r.routeConfig.canActivateChild:null;return!e||e.length===0?null:{node:r,guards:e}}function Hr(r,e){let t=Symbol(),n=e.get(r,t);return n===t?typeof r=="function"&&!Sm(r)?r:e.get(r):n}function As(r,e,t,n,i={canDeactivateChecks:[],canActivateChecks:[]}){let s=$r(e);return r.children.forEach(o=>{BI(o,s[o.value.outlet],t,n.concat([o.value]),i),delete s[o.value.outlet]}),Object.entries(s).forEach(([o,c])=>Cs(c,t.getContext(o),i)),i}function BI(r,e,t,n,i={canDeactivateChecks:[],canActivateChecks:[]}){let s=r.value,o=e?e.value:null,c=t?t.getContext(r.value.outlet):null;if(o&&s.routeConfig===o.routeConfig){let u=qI(o,s,s.routeConfig.runGuardsAndResolvers);u?i.canActivateChecks.push(new Da(n)):(s.data=o.data,s._resolvedData=o._resolvedData),s.component?As(r,e,c?c.children:null,n,i):As(r,e,t,n,i),u&&c&&c.outlet&&c.outlet.isActivated&&i.canDeactivateChecks.push(new Br(c.outlet.component,o))}else o&&Cs(e,c,i),i.canActivateChecks.push(new Da(n)),s.component?As(r,null,c?c.children:null,n,i):As(r,null,t,n,i);return i}function qI(r,e,t){if(typeof t=="function")return t(r,e);switch(t){case"pathParamsChange":return!Jn(r.url,e.url);case"pathParamsOrQueryParamsChange":return!Jn(r.url,e.url)||!xt(r.queryParams,e.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!rh(r,e)||!xt(r.queryParams,e.queryParams);case"paramsChange":default:return!rh(r,e)}}function Cs(r,e,t){let n=$r(r),i=r.value;Object.entries(n).forEach(([s,o])=>{i.component?e?Cs(o,e.children.getContext(s),t):Cs(o,null,t):Cs(o,e,t)}),i.component?e&&e.outlet&&e.outlet.isActivated?t.canDeactivateChecks.push(new Br(e.outlet.component,i)):t.canDeactivateChecks.push(new Br(null,i)):t.canDeactivateChecks.push(new Br(null,i))}function zs(r){return typeof r=="function"}function GI(r){return typeof r=="boolean"}function KI(r){return r&&zs(r.canLoad)}function WI(r){return r&&zs(r.canActivate)}function HI(r){return r&&zs(r.canActivateChild)}function QI(r){return r&&zs(r.canDeactivate)}function YI(r){return r&&zs(r.canMatch)}function sv(r){return r instanceof vm||r?.name==="EmptyError"}var va=Symbol("INITIAL_VALUE");function Wr(){return Me(r=>na(r.map(e=>e.pipe(kr(1),Or(va)))).pipe(X(e=>{for(let t of e)if(t!==!0){if(t===va)return va;if(t===!1||t instanceof vn)return t}return!0}),it(e=>e!==va),kr(1)))}function XI(r,e){return rt(t=>{let{targetSnapshot:n,currentSnapshot:i,guards:{canActivateChecks:s,canDeactivateChecks:o}}=t;return o.length===0&&s.length===0?B(Ie(z({},t),{guardsResult:!0})):JI(o,n,i,r).pipe(rt(c=>c&&GI(c)?ZI(n,s,r,e):B(c)),X(c=>Ie(z({},t),{guardsResult:c})))})}function JI(r,e,t,n){return ge(r).pipe(rt(i=>iA(i.component,i.route,t,e,n)),Ct(i=>i!==!0,!0))}function ZI(r,e,t,n){return ge(e).pipe(Qn(i=>_m(tA(i.route.parent,n),eA(i.route,n),rA(r,i.path,t),nA(r,i.route,t))),Ct(i=>i!==!0,!0))}function eA(r,e){return r!==null&&e&&e(new Jl(r)),B(!0)}function tA(r,e){return r!==null&&e&&e(new Yl(r)),B(!0)}function nA(r,e,t){let n=e.routeConfig?e.routeConfig.canActivate:null;if(!n||n.length===0)return B(!0);let i=n.map(s=>Xu(()=>{let o=$s(e)??t,c=Hr(s,o),u=WI(c)?c.canActivate(e,r):Xt(o,()=>c(e,r));return Tn(u).pipe(Ct())}));return B(i).pipe(Wr())}function rA(r,e,t){let n=e[e.length-1],s=e.slice(0,e.length-1).reverse().map(o=>zI(o)).filter(o=>o!==null).map(o=>Xu(()=>{let c=o.guards.map(u=>{let l=$s(o.node)??t,f=Hr(u,l),p=HI(f)?f.canActivateChild(n,r):Xt(l,()=>f(n,r));return Tn(p).pipe(Ct())});return B(c).pipe(Wr())}));return B(s).pipe(Wr())}function iA(r,e,t,n,i){let s=e&&e.routeConfig?e.routeConfig.canDeactivate:null;if(!s||s.length===0)return B(!0);let o=s.map(c=>{let u=$s(e)??i,l=Hr(c,u),f=QI(l)?l.canDeactivate(r,e,t,n):Xt(u,()=>l(r,e,t,n));return Tn(f).pipe(Ct())});return B(o).pipe(Wr())}function sA(r,e,t,n){let i=e.canLoad;if(i===void 0||i.length===0)return B(!0);let s=i.map(o=>{let c=Hr(o,r),u=KI(c)?c.canLoad(e,t):Xt(r,()=>c(e,t));return Tn(u)});return B(s).pipe(Wr(),ov(n))}function ov(r){return gm(Re(e=>{if(Gr(e))throw nv(r,e)}),X(e=>e===!0))}function oA(r,e,t,n){let i=e.canMatch;if(!i||i.length===0)return B(!0);let s=i.map(o=>{let c=Hr(o,r),u=YI(c)?c.canMatch(e,t):Xt(r,()=>c(e,t));return Tn(u)});return B(s).pipe(Wr(),ov(n))}var Vs=class{constructor(e){this.segmentGroup=e||null}},xa=class extends Error{constructor(e){super(),this.urlTree=e}};function jr(r){return as(new Vs(r))}function aA(r){return as(new Oe(4e3,!1))}function cA(r){return as(rv(!1,at.GuardRejected))}var oh=class{constructor(e,t){this.urlSerializer=e,this.urlTree=t}lineralizeSegments(e,t){let n=[],i=t.root;for(;;){if(n=n.concat(i.segments),i.numberOfChildren===0)return B(n);if(i.numberOfChildren>1||!i.children[ee])return aA(e.redirectTo);i=i.children[ee]}}applyRedirectCommands(e,t,n){let i=this.applyRedirectCreateUrlTree(t,this.urlSerializer.parse(t),e,n);if(t.startsWith("/"))throw new xa(i);return i}applyRedirectCreateUrlTree(e,t,n,i){let s=this.createSegmentGroup(e,t.root,n,i);return new vn(s,this.createQueryParams(t.queryParams,this.urlTree.queryParams),t.fragment)}createQueryParams(e,t){let n={};return Object.entries(e).forEach(([i,s])=>{if(typeof s=="string"&&s.startsWith(":")){let c=s.substring(1);n[i]=t[c]}else n[i]=s}),n}createSegmentGroup(e,t,n,i){let s=this.createSegments(e,t.segments,n,i),o={};return Object.entries(t.children).forEach(([c,u])=>{o[c]=this.createSegmentGroup(e,u,n,i)}),new ce(s,o)}createSegments(e,t,n,i){return t.map(s=>s.path.startsWith(":")?this.findPosParam(e,s,i):this.findOrReturn(s,n))}findPosParam(e,t,n){let i=n[t.path.substring(1)];if(!i)throw new Oe(4001,!1);return i}findOrReturn(e,t){let n=0;for(let i of t){if(i.path===e.path)return t.splice(n),i;n++}return e}},ah={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function uA(r,e,t,n,i){let s=ph(r,e,t);return s.matched?(n=FI(e,n),oA(n,e,t,i).pipe(X(o=>o===!0?s:z({},ah)))):B(s)}function ph(r,e,t){if(e.path==="**")return lA(t);if(e.path==="")return e.pathMatch==="full"&&(r.hasChildren()||t.length>0)?z({},ah):{matched:!0,consumedSegments:[],remainingSegments:t,parameters:{},positionalParamSegments:{}};let i=(e.matcher||sI)(t,r,e);if(!i)return z({},ah);let s={};Object.entries(i.posParams??{}).forEach(([c,u])=>{s[c]=u.path});let o=i.consumed.length>0?z(z({},s),i.consumed[i.consumed.length-1].parameters):s;return{matched:!0,consumedSegments:i.consumed,remainingSegments:t.slice(i.consumed.length),parameters:o,positionalParamSegments:i.posParams??{}}}function lA(r){return{matched:!0,parameters:r.length>0?Uy(r).parameters:{},consumedSegments:r,remainingSegments:[],positionalParamSegments:{}}}function Oy(r,e,t,n){return t.length>0&&fA(r,t,n)?{segmentGroup:new ce(e,dA(n,new ce(t,r.children))),slicedSegments:[]}:t.length===0&&pA(r,t,n)?{segmentGroup:new ce(r.segments,hA(r,t,n,r.children)),slicedSegments:t}:{segmentGroup:new ce(r.segments,r.children),slicedSegments:t}}function hA(r,e,t,n){let i={};for(let s of t)if(Ma(r,e,s)&&!n[kt(s)]){let o=new ce([],{});i[kt(s)]=o}return z(z({},n),i)}function dA(r,e){let t={};t[ee]=e;for(let n of r)if(n.path===""&&kt(n)!==ee){let i=new ce([],{});t[kt(n)]=i}return t}function fA(r,e,t){return t.some(n=>Ma(r,e,n)&&kt(n)!==ee)}function pA(r,e,t){return t.some(n=>Ma(r,e,n))}function Ma(r,e,t){return(r.hasChildren()||e.length>0)&&t.pathMatch==="full"?!1:t.path===""}function gA(r,e,t,n){return kt(r)!==n&&(n===ee||!Ma(e,t,r))?!1:ph(e,r,t).matched}function mA(r,e,t){return e.length===0&&!r.children[t]}var ch=class{};function yA(r,e,t,n,i,s,o="emptyOnly"){return new uh(r,e,t,n,i,o,s).recognize()}var vA=31,uh=class{constructor(e,t,n,i,s,o,c){this.injector=e,this.configLoader=t,this.rootComponentType=n,this.config=i,this.urlTree=s,this.paramsInheritanceStrategy=o,this.urlSerializer=c,this.applyRedirects=new oh(this.urlSerializer,this.urlTree),this.absoluteRedirectCount=0,this.allowRedirects=!0}noMatchError(e){return new Oe(4002,`'${e.segmentGroup}'`)}recognize(){let e=Oy(this.urlTree.root,[],[],this.config).segmentGroup;return this.match(e).pipe(X(t=>{let n=new Ms([],Object.freeze({}),Object.freeze(z({},this.urlTree.queryParams)),this.urlTree.fragment,{},ee,this.rootComponentType,null,{}),i=new ot(n,t),s=new Pa("",i),o=AI(n,[],this.urlTree.queryParams,this.urlTree.fragment);return o.queryParams=this.urlTree.queryParams,s.url=this.urlSerializer.serialize(o),this.inheritParamsAndData(s._root,null),{state:s,tree:o}}))}match(e){return this.processSegmentGroup(this.injector,this.config,e,ee).pipe(Rt(n=>{if(n instanceof xa)return this.urlTree=n.urlTree,this.match(n.urlTree.root);throw n instanceof Vs?this.noMatchError(n):n}))}inheritParamsAndData(e,t){let n=e.value,i=hh(n,t,this.paramsInheritanceStrategy);n.params=Object.freeze(i.params),n.data=Object.freeze(i.data),e.children.forEach(s=>this.inheritParamsAndData(s,n))}processSegmentGroup(e,t,n,i){return n.segments.length===0&&n.hasChildren()?this.processChildren(e,t,n):this.processSegment(e,t,n,n.segments,i,!0).pipe(X(s=>s instanceof ot?[s]:[]))}processChildren(e,t,n){let i=[];for(let s of Object.keys(n.children))s==="primary"?i.unshift(s):i.push(s);return ge(i).pipe(Qn(s=>{let o=n.children[s],c=UI(t,s);return this.processSegmentGroup(e,c,o,s)}),Mr((s,o)=>(s.push(...o),s)),Ju(null),Im(),rt(s=>{if(s===null)return jr(n);let o=av(s);return _A(o),B(o)}))}processSegment(e,t,n,i,s,o){return ge(t).pipe(Qn(c=>this.processSegmentAgainstRoute(c._injector??e,t,c,n,i,s,o).pipe(Rt(u=>{if(u instanceof Vs)return B(null);throw u}))),Ct(c=>!!c),Rt(c=>{if(sv(c))return mA(n,i,s)?B(new ch):jr(n);throw c}))}processSegmentAgainstRoute(e,t,n,i,s,o,c){return gA(n,i,s,o)?n.redirectTo===void 0?this.matchSegmentAgainstRoute(e,i,n,s,o):this.allowRedirects&&c?this.expandSegmentAgainstRouteUsingRedirect(e,i,t,n,s,o):jr(i):jr(i)}expandSegmentAgainstRouteUsingRedirect(e,t,n,i,s,o){let{matched:c,consumedSegments:u,positionalParamSegments:l,remainingSegments:f}=ph(t,i,s);if(!c)return jr(t);i.redirectTo.startsWith("/")&&(this.absoluteRedirectCount++,this.absoluteRedirectCount>vA&&(this.allowRedirects=!1));let p=this.applyRedirects.applyRedirectCommands(u,i.redirectTo,l);return this.applyRedirects.lineralizeSegments(i,p).pipe(rt(m=>this.processSegment(e,n,t,m.concat(f),o,!1)))}matchSegmentAgainstRoute(e,t,n,i,s){let o=uA(t,n,i,e,this.urlSerializer);return n.path==="**"&&(t.children={}),o.pipe(Me(c=>c.matched?(e=n._injector??e,this.getChildConfig(e,n,i).pipe(Me(({routes:u})=>{let l=n._loadedInjector??e,{consumedSegments:f,remainingSegments:p,parameters:m}=c,T=new Ms(f,m,Object.freeze(z({},this.urlTree.queryParams)),this.urlTree.fragment,EA(n),kt(n),n.component??n._loadedComponent??null,n,TA(n)),{segmentGroup:x,slicedSegments:N}=Oy(t,f,p,u);if(N.length===0&&x.hasChildren())return this.processChildren(l,u,x).pipe(X(j=>j===null?null:new ot(T,j)));if(u.length===0&&N.length===0)return B(new ot(T,[]));let D=kt(n)===s;return this.processSegment(l,u,x,N,D?ee:s,!0).pipe(X(j=>new ot(T,j instanceof ot?[j]:[])))}))):jr(t)))}getChildConfig(e,t,n){return t.children?B({routes:t.children,injector:e}):t.loadChildren?t._loadedRoutes!==void 0?B({routes:t._loadedRoutes,injector:t._loadedInjector}):sA(e,t,n,this.urlSerializer).pipe(rt(i=>i?this.configLoader.loadChildren(e,t).pipe(Re(s=>{t._loadedRoutes=s.routes,t._loadedInjector=s.injector})):cA(t))):B({routes:[],injector:e})}};function _A(r){r.sort((e,t)=>e.value.outlet===ee?-1:t.value.outlet===ee?1:e.value.outlet.localeCompare(t.value.outlet))}function wA(r){let e=r.value.routeConfig;return e&&e.path===""}function av(r){let e=[],t=new Set;for(let n of r){if(!wA(n)){e.push(n);continue}let i=e.find(s=>n.value.routeConfig===s.value.routeConfig);i!==void 0?(i.children.push(...n.children),t.add(i)):e.push(n)}for(let n of t){let i=av(n.children);e.push(new ot(n.value,i))}return e.filter(n=>!t.has(n))}function EA(r){return r.data||{}}function TA(r){return r.resolve||{}}function IA(r,e,t,n,i,s){return rt(o=>yA(r,e,t,n,o.extractedUrl,i,s).pipe(X(({state:c,tree:u})=>Ie(z({},o),{targetSnapshot:c,urlAfterRedirects:u}))))}function AA(r,e){return rt(t=>{let{targetSnapshot:n,guards:{canActivateChecks:i}}=t;if(!i.length)return B(t);let s=new Set(i.map(u=>u.route)),o=new Set;for(let u of s)if(!o.has(u))for(let l of cv(u))o.add(l);let c=0;return ge(o).pipe(Qn(u=>s.has(u)?SA(u,n,r,e):(u.data=hh(u,u.parent,r).resolve,B(void 0))),Re(()=>c++),Zu(1),rt(u=>c===o.size?B(t):yn))})}function cv(r){let e=r.children.map(t=>cv(t)).flat();return[r,...e]}function SA(r,e,t,n){let i=r.routeConfig,s=r._resolve;return i?.title!==void 0&&!ev(i)&&(s[Fs]=i.title),bA(s,r,e,n).pipe(X(o=>(r._resolvedData=o,r.data=hh(r,r.parent,t).resolve,null)))}function bA(r,e,t,n){let i=jl(r);if(i.length===0)return B({});let s={};return ge(i).pipe(rt(o=>RA(r[o],e,t,n).pipe(Ct(),Re(c=>{s[o]=c}))),Zu(1),Em(s),Rt(o=>sv(o)?yn:as(o)))}function RA(r,e,t,n){let i=$s(e)??n,s=Hr(r,i),o=s.resolve?s.resolve(e,t):Xt(i,()=>s(e,t));return Tn(o)}function Fl(r){return Me(e=>{let t=r(e);return t?ge(t).pipe(X(()=>e)):B(e)})}var uv=(()=>{let e=class e{buildTitle(n){let i,s=n.root;for(;s!==void 0;)i=this.getResolvedTitleForRoute(s)??i,s=s.children.find(o=>o.outlet===ee);return i}getResolvedTitleForRoute(n){return n.data[Fs]}};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=se({token:e,factory:()=>W(CA),providedIn:"root"});let r=e;return r})(),CA=(()=>{let e=class e extends uv{constructor(n){super(),this.title=n}updateTitle(n){let i=this.buildTitle(n);i!==void 0&&this.title.setTitle(i)}};e.\u0275fac=function(i){return new(i||e)($(Py))},e.\u0275prov=se({token:e,factory:e.\u0275fac,providedIn:"root"});let r=e;return r})(),Bs=new oe("",{providedIn:"root",factory:()=>({})}),Ls=new oe(""),gh=(()=>{let e=class e{constructor(){this.componentLoaders=new WeakMap,this.childrenLoaders=new WeakMap,this.compiler=W(ca)}loadComponent(n){if(this.componentLoaders.get(n))return this.componentLoaders.get(n);if(n._loadedComponent)return B(n._loadedComponent);this.onLoadStartListener&&this.onLoadStartListener(n);let i=Tn(n.loadComponent()).pipe(X(lv),Re(o=>{this.onLoadEndListener&&this.onLoadEndListener(n),n._loadedComponent=o}),cs(()=>{this.componentLoaders.delete(n)})),s=new Qu(i,()=>new bt).pipe(Hu());return this.componentLoaders.set(n,s),s}loadChildren(n,i){if(this.childrenLoaders.get(i))return this.childrenLoaders.get(i);if(i._loadedRoutes)return B({routes:i._loadedRoutes,injector:i._loadedInjector});this.onLoadStartListener&&this.onLoadStartListener(i);let o=PA(i,this.compiler,n,this.onLoadEndListener).pipe(cs(()=>{this.childrenLoaders.delete(i)})),c=new Qu(o,()=>new bt).pipe(Hu());return this.childrenLoaders.set(i,c),c}};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=se({token:e,factory:e.\u0275fac,providedIn:"root"});let r=e;return r})();function PA(r,e,t,n){return Tn(r.loadChildren()).pipe(X(lv),rt(i=>i instanceof jm||Array.isArray(i)?B(i):ge(e.compileModuleAsync(i))),X(i=>{n&&n(r);let s,o,c=!1;return Array.isArray(i)?(o=i,c=!0):(s=i.create(t).injector,o=s.get(Ls,[],{optional:!0,self:!0}).flat()),{routes:o.map(fh),injector:s}}))}function DA(r){return r&&typeof r=="object"&&"default"in r}function lv(r){return DA(r)?r.default:r}var mh=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=se({token:e,factory:()=>W(xA),providedIn:"root"});let r=e;return r})(),xA=(()=>{let e=class e{shouldProcessUrl(n){return!0}extract(n){return n}merge(n,i){return n}};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=se({token:e,factory:e.\u0275fac,providedIn:"root"});let r=e;return r})(),hv=new oe(""),dv=new oe("");function NA(r,e,t){let n=r.get(dv),i=r.get(dt);return r.get(Ce).runOutsideAngular(()=>{if(!i.startViewTransition||n.skipNextTransition)return n.skipNextTransition=!1,new Promise(l=>setTimeout(l));let s,o=new Promise(l=>{s=l}),c=i.startViewTransition(()=>(s(),kA(r))),{onViewTransitionCreated:u}=n;return u&&Xt(r,()=>u({transition:c,from:e,to:t})),o})}function kA(r){return new Promise(e=>{ll(e,{injector:r})})}var yh=(()=>{let e=class e{get hasRequestedNavigation(){return this.navigationId!==0}constructor(){this.currentNavigation=null,this.currentTransition=null,this.lastSuccessfulNavigation=null,this.events=new bt,this.transitionAbortSubject=new bt,this.configLoader=W(gh),this.environmentInjector=W(Vr),this.urlSerializer=W(Us),this.rootContexts=W(js),this.location=W(ys),this.inputBindingEnabled=W(ka,{optional:!0})!==null,this.titleStrategy=W(uv),this.options=W(Bs,{optional:!0})||{},this.paramsInheritanceStrategy=this.options.paramsInheritanceStrategy||"emptyOnly",this.urlHandlingStrategy=W(mh),this.createViewTransition=W(hv,{optional:!0}),this.navigationId=0,this.afterPreactivation=()=>B(void 0),this.rootComponentType=null;let n=s=>this.events.next(new Hl(s)),i=s=>this.events.next(new Ql(s));this.configLoader.onLoadEndListener=i,this.configLoader.onLoadStartListener=n}complete(){this.transitions?.complete()}handleNavigationRequest(n){let i=++this.navigationId;this.transitions?.next(Ie(z(z({},this.transitions.value),n),{id:i}))}setupNavigations(n,i,s){return this.transitions=new ht({id:0,currentUrlTree:i,currentRawUrl:i,extractedUrl:this.urlHandlingStrategy.extract(i),urlAfterRedirects:this.urlHandlingStrategy.extract(i),rawUrl:i,extras:{},resolve:null,reject:null,promise:Promise.resolve(!0),source:Rs,restoredState:null,currentSnapshot:s.snapshot,targetSnapshot:null,currentRouterState:s,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.transitions.pipe(it(o=>o.id!==0),X(o=>Ie(z({},o),{extractedUrl:this.urlHandlingStrategy.extract(o.rawUrl)})),Me(o=>{let c=!1,u=!1;return B(o).pipe(Me(l=>{if(this.navigationId>o.id)return this.cancelNavigationTransition(o,"",at.SupersededByNewNavigation),yn;this.currentTransition=o,this.currentNavigation={id:l.id,initialUrl:l.rawUrl,extractedUrl:l.extractedUrl,trigger:l.source,extras:l.extras,previousNavigation:this.lastSuccessfulNavigation?Ie(z({},this.lastSuccessfulNavigation),{previousNavigation:null}):null};let f=!n.navigated||this.isUpdatingInternalState()||this.isUpdatedBrowserUrl(),p=l.extras.onSameUrlNavigation??n.onSameUrlNavigation;if(!f&&p!=="reload"){let m="";return this.events.next(new wn(l.id,this.urlSerializer.serialize(l.rawUrl),m,Aa.IgnoredSameUrlNavigation)),l.resolve(null),yn}if(this.urlHandlingStrategy.shouldProcessUrl(l.rawUrl))return B(l).pipe(Me(m=>{let T=this.transitions?.getValue();return this.events.next(new Kr(m.id,this.urlSerializer.serialize(m.extractedUrl),m.source,m.restoredState)),T!==this.transitions?.getValue()?yn:Promise.resolve(m)}),IA(this.environmentInjector,this.configLoader,this.rootComponentType,n.config,this.urlSerializer,this.paramsInheritanceStrategy),Re(m=>{o.targetSnapshot=m.targetSnapshot,o.urlAfterRedirects=m.urlAfterRedirects,this.currentNavigation=Ie(z({},this.currentNavigation),{finalUrl:m.urlAfterRedirects});let T=new Sa(m.id,this.urlSerializer.serialize(m.extractedUrl),this.urlSerializer.serialize(m.urlAfterRedirects),m.targetSnapshot);this.events.next(T)}));if(f&&this.urlHandlingStrategy.shouldProcessUrl(l.currentRawUrl)){let{id:m,extractedUrl:T,source:x,restoredState:N,extras:D}=l,j=new Kr(m,this.urlSerializer.serialize(T),x,N);this.events.next(j);let G=Jy(this.rootComponentType).snapshot;return this.currentTransition=o=Ie(z({},l),{targetSnapshot:G,urlAfterRedirects:T,extras:Ie(z({},D),{skipLocationChange:!1,replaceUrl:!1})}),this.currentNavigation.finalUrl=T,B(o)}else{let m="";return this.events.next(new wn(l.id,this.urlSerializer.serialize(l.extractedUrl),m,Aa.IgnoredByUrlHandlingStrategy)),l.resolve(null),yn}}),Re(l=>{let f=new ql(l.id,this.urlSerializer.serialize(l.extractedUrl),this.urlSerializer.serialize(l.urlAfterRedirects),l.targetSnapshot);this.events.next(f)}),X(l=>(this.currentTransition=o=Ie(z({},l),{guards:$I(l.targetSnapshot,l.currentSnapshot,this.rootContexts)}),o)),XI(this.environmentInjector,l=>this.events.next(l)),Re(l=>{if(o.guardsResult=l.guardsResult,Gr(l.guardsResult))throw nv(this.urlSerializer,l.guardsResult);let f=new Gl(l.id,this.urlSerializer.serialize(l.extractedUrl),this.urlSerializer.serialize(l.urlAfterRedirects),l.targetSnapshot,!!l.guardsResult);this.events.next(f)}),it(l=>l.guardsResult?!0:(this.cancelNavigationTransition(l,"",at.GuardRejected),!1)),Fl(l=>{if(l.guards.canActivateChecks.length)return B(l).pipe(Re(f=>{let p=new Kl(f.id,this.urlSerializer.serialize(f.extractedUrl),this.urlSerializer.serialize(f.urlAfterRedirects),f.targetSnapshot);this.events.next(p)}),Me(f=>{let p=!1;return B(f).pipe(AA(this.paramsInheritanceStrategy,this.environmentInjector),Re({next:()=>p=!0,complete:()=>{p||this.cancelNavigationTransition(f,"",at.NoDataFromResolver)}}))}),Re(f=>{let p=new Wl(f.id,this.urlSerializer.serialize(f.extractedUrl),this.urlSerializer.serialize(f.urlAfterRedirects),f.targetSnapshot);this.events.next(p)}))}),Fl(l=>{let f=p=>{let m=[];p.routeConfig?.loadComponent&&!p.routeConfig._loadedComponent&&m.push(this.configLoader.loadComponent(p.routeConfig).pipe(Re(T=>{p.component=T}),X(()=>{})));for(let T of p.children)m.push(...f(T));return m};return na(f(l.targetSnapshot.root)).pipe(Ju(null),kr(1))}),Fl(()=>this.afterPreactivation()),Me(()=>{let{currentSnapshot:l,targetSnapshot:f}=o,p=this.createViewTransition?.(this.environmentInjector,l.root,f.root);return p?ge(p).pipe(X(()=>o)):B(o)}),X(l=>{let f=kI(n.routeReuseStrategy,l.targetSnapshot,l.currentRouterState);return this.currentTransition=o=Ie(z({},l),{targetRouterState:f}),this.currentNavigation.targetRouterState=f,o}),Re(()=>{this.events.next(new Ns)}),jI(this.rootContexts,n.routeReuseStrategy,l=>this.events.next(l),this.inputBindingEnabled),kr(1),Re({next:l=>{c=!0,this.lastSuccessfulNavigation=this.currentNavigation,this.events.next(new Nt(l.id,this.urlSerializer.serialize(l.extractedUrl),this.urlSerializer.serialize(l.urlAfterRedirects))),this.titleStrategy?.updateTitle(l.targetRouterState.snapshot),l.resolve(!0)},complete:()=>{c=!0}}),Am(this.transitionAbortSubject.pipe(Re(l=>{throw l}))),cs(()=>{!c&&!u&&this.cancelNavigationTransition(o,"",at.SupersededByNewNavigation),this.currentTransition?.id===o.id&&(this.currentNavigation=null,this.currentTransition=null)}),Rt(l=>{if(u=!0,iv(l))this.events.next(new _n(o.id,this.urlSerializer.serialize(o.extractedUrl),l.message,l.cancellationCode)),VI(l)?this.events.next(new ks(l.url)):o.resolve(!1);else{this.events.next(new xs(o.id,this.urlSerializer.serialize(o.extractedUrl),l,o.targetSnapshot??void 0));try{o.resolve(n.errorHandler(l))}catch(f){this.options.resolveNavigationPromiseOnError?o.resolve(!1):o.reject(f)}}return yn}))}))}cancelNavigationTransition(n,i,s){let o=new _n(n.id,this.urlSerializer.serialize(n.extractedUrl),i,s);this.events.next(o),n.resolve(!1)}isUpdatingInternalState(){return this.currentTransition?.extractedUrl.toString()!==this.currentTransition?.currentUrlTree.toString()}isUpdatedBrowserUrl(){return this.urlHandlingStrategy.extract(this.urlSerializer.parse(this.location.path(!0))).toString()!==this.currentTransition?.extractedUrl.toString()&&!this.currentTransition?.extras.skipLocationChange}};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=se({token:e,factory:e.\u0275fac,providedIn:"root"});let r=e;return r})();function MA(r){return r!==Rs}var OA=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=se({token:e,factory:()=>W(VA),providedIn:"root"});let r=e;return r})(),lh=class{shouldDetach(e){return!1}store(e,t){}shouldAttach(e){return!1}retrieve(e){return null}shouldReuseRoute(e,t){return e.routeConfig===t.routeConfig}},VA=(()=>{let e=class e extends lh{};e.\u0275fac=(()=>{let n;return function(s){return(n||(n=sl(e)))(s||e)}})(),e.\u0275prov=se({token:e,factory:e.\u0275fac,providedIn:"root"});let r=e;return r})(),fv=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=se({token:e,factory:()=>W(LA),providedIn:"root"});let r=e;return r})(),LA=(()=>{let e=class e extends fv{constructor(){super(...arguments),this.location=W(ys),this.urlSerializer=W(Us),this.options=W(Bs,{optional:!0})||{},this.canceledNavigationResolution=this.options.canceledNavigationResolution||"replace",this.urlHandlingStrategy=W(mh),this.urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred",this.currentUrlTree=new vn,this.rawUrlTree=this.currentUrlTree,this.currentPageId=0,this.lastSuccessfulId=-1,this.routerState=Jy(null),this.stateMemento=this.createStateMemento()}getCurrentUrlTree(){return this.currentUrlTree}getRawUrlTree(){return this.rawUrlTree}restoredState(){return this.location.getState()}get browserPageId(){return this.canceledNavigationResolution!=="computed"?this.currentPageId:this.restoredState()?.\u0275routerPageId??this.currentPageId}getRouterState(){return this.routerState}createStateMemento(){return{rawUrlTree:this.rawUrlTree,currentUrlTree:this.currentUrlTree,routerState:this.routerState}}registerNonRouterCurrentEntryChangeListener(n){return this.location.subscribe(i=>{i.type==="popstate"&&n(i.url,i.state)})}handleRouterEvent(n,i){if(n instanceof Kr)this.stateMemento=this.createStateMemento();else if(n instanceof wn)this.rawUrlTree=i.initialUrl;else if(n instanceof Sa){if(this.urlUpdateStrategy==="eager"&&!i.extras.skipLocationChange){let s=this.urlHandlingStrategy.merge(i.finalUrl,i.initialUrl);this.setBrowserUrl(s,i)}}else n instanceof Ns?(this.currentUrlTree=i.finalUrl,this.rawUrlTree=this.urlHandlingStrategy.merge(i.finalUrl,i.initialUrl),this.routerState=i.targetRouterState,this.urlUpdateStrategy==="deferred"&&(i.extras.skipLocationChange||this.setBrowserUrl(this.rawUrlTree,i))):n instanceof _n&&(n.code===at.GuardRejected||n.code===at.NoDataFromResolver)?this.restoreHistory(i):n instanceof xs?this.restoreHistory(i,!0):n instanceof Nt&&(this.lastSuccessfulId=n.id,this.currentPageId=this.browserPageId)}setBrowserUrl(n,i){let s=this.urlSerializer.serialize(n);if(this.location.isCurrentPathEqualTo(s)||i.extras.replaceUrl){let o=this.browserPageId,c=z(z({},i.extras.state),this.generateNgRouterState(i.id,o));this.location.replaceState(s,"",c)}else{let o=z(z({},i.extras.state),this.generateNgRouterState(i.id,this.browserPageId+1));this.location.go(s,"",o)}}restoreHistory(n,i=!1){if(this.canceledNavigationResolution==="computed"){let s=this.browserPageId,o=this.currentPageId-s;o!==0?this.location.historyGo(o):this.currentUrlTree===n.finalUrl&&o===0&&(this.resetState(n),this.resetUrlToCurrentUrlTree())}else this.canceledNavigationResolution==="replace"&&(i&&this.resetState(n),this.resetUrlToCurrentUrlTree())}resetState(n){this.routerState=this.stateMemento.routerState,this.currentUrlTree=this.stateMemento.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,n.finalUrl??this.rawUrlTree)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}generateNgRouterState(n,i){return this.canceledNavigationResolution==="computed"?{navigationId:n,\u0275routerPageId:i}:{navigationId:n}}};e.\u0275fac=(()=>{let n;return function(s){return(n||(n=sl(e)))(s||e)}})(),e.\u0275prov=se({token:e,factory:e.\u0275fac,providedIn:"root"});let r=e;return r})(),Ss=function(r){return r[r.COMPLETE=0]="COMPLETE",r[r.FAILED=1]="FAILED",r[r.REDIRECTING=2]="REDIRECTING",r}(Ss||{});function pv(r,e){r.events.pipe(it(t=>t instanceof Nt||t instanceof _n||t instanceof xs||t instanceof wn),X(t=>t instanceof Nt||t instanceof wn?Ss.COMPLETE:(t instanceof _n?t.code===at.Redirect||t.code===at.SupersededByNewNavigation:!1)?Ss.REDIRECTING:Ss.FAILED),it(t=>t!==Ss.REDIRECTING),kr(1)).subscribe(()=>{e()})}function FA(r){throw r}var UA={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},jA={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"},_t=(()=>{let e=class e{get currentUrlTree(){return this.stateManager.getCurrentUrlTree()}get rawUrlTree(){return this.stateManager.getRawUrlTree()}get events(){return this._events}get routerState(){return this.stateManager.getRouterState()}constructor(){this.disposed=!1,this.isNgZoneEnabled=!1,this.console=W(aa),this.stateManager=W(fv),this.options=W(Bs,{optional:!0})||{},this.pendingTasks=W(dl),this.urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred",this.navigationTransitions=W(yh),this.urlSerializer=W(Us),this.location=W(ys),this.urlHandlingStrategy=W(mh),this._events=new bt,this.errorHandler=this.options.errorHandler||FA,this.navigated=!1,this.routeReuseStrategy=W(OA),this.onSameUrlNavigation=this.options.onSameUrlNavigation||"ignore",this.config=W(Ls,{optional:!0})?.flat()??[],this.componentInputBindingEnabled=!!W(ka,{optional:!0}),this.eventsSubscription=new pm,this.isNgZoneEnabled=W(Ce)instanceof Ce&&Ce.isInAngularZone(),this.resetConfig(this.config),this.navigationTransitions.setupNavigations(this,this.currentUrlTree,this.routerState).subscribe({error:n=>{this.console.warn(n)}}),this.subscribeToNavigationEvents()}subscribeToNavigationEvents(){let n=this.navigationTransitions.events.subscribe(i=>{try{let s=this.navigationTransitions.currentTransition,o=this.navigationTransitions.currentNavigation;if(s!==null&&o!==null){if(this.stateManager.handleRouterEvent(i,o),i instanceof _n&&i.code!==at.Redirect&&i.code!==at.SupersededByNewNavigation)this.navigated=!0;else if(i instanceof Nt)this.navigated=!0;else if(i instanceof ks){let c=this.urlHandlingStrategy.merge(i.url,s.currentRawUrl),u={info:s.extras.info,skipLocationChange:s.extras.skipLocationChange,replaceUrl:this.urlUpdateStrategy==="eager"||MA(s.source)};this.scheduleNavigation(c,Rs,null,u,{resolve:s.resolve,reject:s.reject,promise:s.promise})}}zA(i)&&this._events.next(i)}catch(s){this.navigationTransitions.transitionAbortSubject.next(s)}});this.eventsSubscription.add(n)}resetRootComponentType(n){this.routerState.root.component=n,this.navigationTransitions.rootComponentType=n}initialNavigation(){this.setUpLocationChangeListener(),this.navigationTransitions.hasRequestedNavigation||this.navigateToSyncWithBrowser(this.location.path(!0),Rs,this.stateManager.restoredState())}setUpLocationChangeListener(){this.nonRouterCurrentEntryChangeSubscription??=this.stateManager.registerNonRouterCurrentEntryChangeListener((n,i)=>{setTimeout(()=>{this.navigateToSyncWithBrowser(n,"popstate",i)},0)})}navigateToSyncWithBrowser(n,i,s){let o={replaceUrl:!0},c=s?.navigationId?s:null;if(s){let l=z({},s);delete l.navigationId,delete l.\u0275routerPageId,Object.keys(l).length!==0&&(o.state=l)}let u=this.parseUrl(n);this.scheduleNavigation(u,i,c,o)}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.navigationTransitions.currentNavigation}get lastSuccessfulNavigation(){return this.navigationTransitions.lastSuccessfulNavigation}resetConfig(n){this.config=n.map(fh),this.navigated=!1}ngOnDestroy(){this.dispose()}dispose(){this.navigationTransitions.complete(),this.nonRouterCurrentEntryChangeSubscription&&(this.nonRouterCurrentEntryChangeSubscription.unsubscribe(),this.nonRouterCurrentEntryChangeSubscription=void 0),this.disposed=!0,this.eventsSubscription.unsubscribe()}createUrlTree(n,i={}){let{relativeTo:s,queryParams:o,fragment:c,queryParamsHandling:u,preserveFragment:l}=i,f=l?this.currentUrlTree.fragment:c,p=null;switch(u){case"merge":p=z(z({},this.currentUrlTree.queryParams),o);break;case"preserve":p=this.currentUrlTree.queryParams;break;default:p=o||null}p!==null&&(p=this.removeEmptyProps(p));let m;try{let T=s?s.snapshot:this.routerState.snapshot.root;m=Hy(T)}catch{(typeof n[0]!="string"||!n[0].startsWith("/"))&&(n=[]),m=this.currentUrlTree.root}return Qy(m,n,p,f??null)}navigateByUrl(n,i={skipLocationChange:!1}){let s=Gr(n)?n:this.parseUrl(n),o=this.urlHandlingStrategy.merge(s,this.rawUrlTree);return this.scheduleNavigation(o,Rs,null,i)}navigate(n,i={skipLocationChange:!1}){return $A(n),this.navigateByUrl(this.createUrlTree(n,i),i)}serializeUrl(n){return this.urlSerializer.serialize(n)}parseUrl(n){try{return this.urlSerializer.parse(n)}catch{return this.urlSerializer.parse("/")}}isActive(n,i){let s;if(i===!0?s=z({},UA):i===!1?s=z({},jA):s=i,Gr(n))return Dy(this.currentUrlTree,n,s);let o=this.parseUrl(n);return Dy(this.currentUrlTree,o,s)}removeEmptyProps(n){return Object.entries(n).reduce((i,[s,o])=>(o!=null&&(i[s]=o),i),{})}scheduleNavigation(n,i,s,o,c){if(this.disposed)return Promise.resolve(!1);let u,l,f;c?(u=c.resolve,l=c.reject,f=c.promise):f=new Promise((m,T)=>{u=m,l=T});let p=this.pendingTasks.add();return pv(this,()=>{queueMicrotask(()=>this.pendingTasks.remove(p))}),this.navigationTransitions.handleNavigationRequest({source:i,restoredState:s,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,rawUrl:n,extras:o,resolve:u,reject:l,promise:f,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),f.catch(m=>Promise.reject(m))}};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=se({token:e,factory:e.\u0275fac,providedIn:"root"});let r=e;return r})();function $A(r){for(let e=0;e<r.length;e++)if(r[e]==null)throw new Oe(4008,!1)}function zA(r){return!(r instanceof Ns)&&!(r instanceof ks)}var kP=(()=>{let e=class e{constructor(n,i,s,o,c,u){this.router=n,this.route=i,this.tabIndexAttribute=s,this.renderer=o,this.el=c,this.locationStrategy=u,this.href=null,this.commands=null,this.onChanges=new bt,this.preserveFragment=!1,this.skipLocationChange=!1,this.replaceUrl=!1;let l=c.nativeElement.tagName?.toLowerCase();this.isAnchorElement=l==="a"||l==="area",this.isAnchorElement?this.subscription=n.events.subscribe(f=>{f instanceof Nt&&this.updateHref()}):this.setTabIndexIfNotOnNativeEl("0")}setTabIndexIfNotOnNativeEl(n){this.tabIndexAttribute!=null||this.isAnchorElement||this.applyAttributeValue("tabindex",n)}ngOnChanges(n){this.isAnchorElement&&this.updateHref(),this.onChanges.next(this)}set routerLink(n){n!=null?(this.commands=Array.isArray(n)?n:[n],this.setTabIndexIfNotOnNativeEl("0")):(this.commands=null,this.setTabIndexIfNotOnNativeEl(null))}onClick(n,i,s,o,c){let u=this.urlTree;if(u===null||this.isAnchorElement&&(n!==0||i||s||o||c||typeof this.target=="string"&&this.target!="_self"))return!0;let l={skipLocationChange:this.skipLocationChange,replaceUrl:this.replaceUrl,state:this.state,info:this.info};return this.router.navigateByUrl(u,l),!this.isAnchorElement}ngOnDestroy(){this.subscription?.unsubscribe()}updateHref(){let n=this.urlTree;this.href=n!==null&&this.locationStrategy?this.locationStrategy?.prepareExternalUrl(this.router.serializeUrl(n)):null;let i=this.href===null?null:km(this.href,this.el.nativeElement.tagName.toLowerCase(),"href");this.applyAttributeValue("href",i)}applyAttributeValue(n,i){let s=this.renderer,o=this.el.nativeElement;i!==null?s.setAttribute(o,n,i):s.removeAttribute(o,n)}get urlTree(){return this.commands===null?null:this.router.createUrlTree(this.commands,{relativeTo:this.relativeTo!==void 0?this.relativeTo:this.route,queryParams:this.queryParams,fragment:this.fragment,queryParamsHandling:this.queryParamsHandling,preserveFragment:this.preserveFragment})}};e.\u0275fac=function(i){return new(i||e)(Lr(_t),Lr(En),Pm("tabindex"),Lr(Vm),Lr(Dm),Lr(ms))},e.\u0275dir=rl({type:e,selectors:[["","routerLink",""]],hostVars:1,hostBindings:function(i,s){i&1&&Bm("click",function(c){return s.onClick(c.button,c.ctrlKey,c.shiftKey,c.altKey,c.metaKey)}),i&2&&$m("target",s.target)},inputs:{target:"target",queryParams:"queryParams",fragment:"fragment",queryParamsHandling:"queryParamsHandling",state:"state",info:"info",relativeTo:"relativeTo",preserveFragment:[ia.HasDecoratorInputTransform,"preserveFragment","preserveFragment",ua],skipLocationChange:[ia.HasDecoratorInputTransform,"skipLocationChange","skipLocationChange",ua],replaceUrl:[ia.HasDecoratorInputTransform,"replaceUrl","replaceUrl",ua],routerLink:"routerLink"},standalone:!0,features:[Um,il]});let r=e;return r})();var Na=class{};var BA=(()=>{let e=class e{constructor(n,i,s,o,c){this.router=n,this.injector=s,this.preloadingStrategy=o,this.loader=c}setUpPreloading(){this.subscription=this.router.events.pipe(it(n=>n instanceof Nt),Qn(()=>this.preload())).subscribe(()=>{})}preload(){return this.processRoutes(this.injector,this.router.config)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}processRoutes(n,i){let s=[];for(let o of i){o.providers&&!o._injector&&(o._injector=hl(o.providers,n,`Route: ${o.path}`));let c=o._injector??n,u=o._loadedInjector??c;(o.loadChildren&&!o._loadedRoutes&&o.canLoad===void 0||o.loadComponent&&!o._loadedComponent)&&s.push(this.preloadConfig(c,o)),(o.children||o._loadedRoutes)&&s.push(this.processRoutes(u,o.children??o._loadedRoutes))}return ge(s).pipe(Yu())}preloadConfig(n,i){return this.preloadingStrategy.preload(i,()=>{let s;i.loadChildren&&i.canLoad===void 0?s=this.loader.loadChildren(n,i):s=B(null);let o=s.pipe(rt(c=>c===null?B(void 0):(i._loadedRoutes=c.routes,i._loadedInjector=c.injector,this.processRoutes(c.injector??n,c.routes))));if(i.loadComponent&&!i._loadedComponent){let c=this.loader.loadComponent(i);return ge([o,c]).pipe(Yu())}else return o})}};e.\u0275fac=function(i){return new(i||e)($(_t),$(ca),$(Vr),$(Na),$(gh))},e.\u0275prov=se({token:e,factory:e.\u0275fac,providedIn:"root"});let r=e;return r})(),gv=new oe(""),qA=(()=>{let e=class e{constructor(n,i,s,o,c={}){this.urlSerializer=n,this.transitions=i,this.viewportScroller=s,this.zone=o,this.options=c,this.lastId=0,this.lastSource="imperative",this.restoredId=0,this.store={},this.environmentInjector=W(Vr),c.scrollPositionRestoration||="disabled",c.anchorScrolling||="disabled"}init(){this.options.scrollPositionRestoration!=="disabled"&&this.viewportScroller.setHistoryScrollRestoration("manual"),this.routerEventsSubscription=this.createScrollEvents(),this.scrollEventsSubscription=this.consumeScrollEvents()}createScrollEvents(){return this.transitions.events.subscribe(n=>{n instanceof Kr?(this.store[this.lastId]=this.viewportScroller.getScrollPosition(),this.lastSource=n.navigationTrigger,this.restoredId=n.restoredState?n.restoredState.navigationId:0):n instanceof Nt?(this.lastId=n.id,this.scheduleScrollEvent(n,this.urlSerializer.parse(n.urlAfterRedirects).fragment)):n instanceof wn&&n.code===Aa.IgnoredSameUrlNavigation&&(this.lastSource=void 0,this.restoredId=0,this.scheduleScrollEvent(n,this.urlSerializer.parse(n.url).fragment))})}consumeScrollEvents(){return this.transitions.events.subscribe(n=>{n instanceof ba&&(n.position?this.options.scrollPositionRestoration==="top"?this.viewportScroller.scrollToPosition([0,0]):this.options.scrollPositionRestoration==="enabled"&&this.viewportScroller.scrollToPosition(n.position):n.anchor&&this.options.anchorScrolling==="enabled"?this.viewportScroller.scrollToAnchor(n.anchor):this.options.scrollPositionRestoration!=="disabled"&&this.viewportScroller.scrollToPosition([0,0]))})}scheduleScrollEvent(n,i){this.zone.runOutsideAngular(()=>P(this,null,function*(){yield new Promise(s=>{setTimeout(()=>{s()}),ll(()=>{s()},{injector:this.environmentInjector})}),this.zone.run(()=>{this.transitions.events.next(new ba(n,this.lastSource==="popstate"?this.store[this.restoredId]:null,i))})}))}ngOnDestroy(){this.routerEventsSubscription?.unsubscribe(),this.scrollEventsSubscription?.unsubscribe()}};e.\u0275fac=function(i){Mm()},e.\u0275prov=se({token:e,factory:e.\u0275fac});let r=e;return r})();function MP(r,...e){return hs([{provide:Ls,multi:!0,useValue:r},[],{provide:En,useFactory:mv,deps:[_t]},{provide:ps,multi:!0,useFactory:yv},e.map(t=>t.\u0275providers)])}function mv(r){return r.routerState.root}function qs(r,e){return{\u0275kind:r,\u0275providers:e}}function yv(){let r=W(ol);return e=>{let t=r.get(gs);if(e!==t.components[0])return;let n=r.get(_t),i=r.get(vv);r.get(vh)===1&&n.initialNavigation(),r.get(_v,null,nl.Optional)?.setUpPreloading(),r.get(gv,null,nl.Optional)?.init(),n.resetRootComponentType(t.componentTypes[0]),i.closed||(i.next(),i.complete(),i.unsubscribe())}}var vv=new oe("",{factory:()=>new bt}),vh=new oe("",{providedIn:"root",factory:()=>1});function GA(){return qs(2,[{provide:vh,useValue:0},{provide:fl,multi:!0,deps:[ol],useFactory:e=>{let t=e.get(Zm,Promise.resolve());return()=>t.then(()=>new Promise(n=>{let i=e.get(_t),s=e.get(vv);pv(i,()=>{n(!0)}),e.get(yh).afterPreactivation=()=>(n(!0),s.closed?B(void 0):s),i.initialNavigation()}))}}])}function KA(){return qs(3,[{provide:fl,multi:!0,useFactory:()=>{let e=W(_t);return()=>{e.setUpLocationChangeListener()}}},{provide:vh,useValue:2}])}var _v=new oe("");function WA(r){return qs(0,[{provide:_v,useExisting:BA},{provide:Na,useExisting:r}])}function HA(){return qs(8,[My,{provide:ka,useExisting:My}])}function QA(r){let e=[{provide:hv,useValue:NA},{provide:dv,useValue:z({skipNextTransition:!!r?.skipInitialTransition},r)}];return qs(9,e)}var Vy=new oe("ROUTER_FORROOT_GUARD"),YA=[ys,{provide:Us,useClass:Ps},_t,js,{provide:En,useFactory:mv,deps:[_t]},gh,[]],OP=(()=>{let e=class e{constructor(n){}static forRoot(n,i){return{ngModule:e,providers:[YA,[],{provide:Ls,multi:!0,useValue:n},{provide:Vy,useFactory:eS,deps:[[_t,new us,new bm]]},{provide:Bs,useValue:i||{}},i?.useHash?JA():ZA(),XA(),i?.preloadingStrategy?WA(i.preloadingStrategy).\u0275providers:[],i?.initialNavigation?tS(i):[],i?.bindToComponentInputs?HA().\u0275providers:[],i?.enableViewTransitions?QA().\u0275providers:[],nS()]}}static forChild(n){return{ngModule:e,providers:[{provide:Ls,multi:!0,useValue:n}]}}};e.\u0275fac=function(i){return new(i||e)($(Vy,8))},e.\u0275mod=Yt({type:e}),e.\u0275inj=Qt({});let r=e;return r})();function XA(){return{provide:gv,useFactory:()=>{let r=W(ry),e=W(Ce),t=W(Bs),n=W(yh),i=W(Us);return t.scrollOffset&&r.setOffset(t.scrollOffset),new qA(i,n,r,e,t)}}}function JA(){return{provide:ms,useClass:ty}}function ZA(){return{provide:ms,useClass:ey}}function eS(r){return"guarded"}function tS(r){return[r.initialNavigation==="disabled"?KA().\u0275providers:[],r.initialNavigation==="enabledBlocking"?GA().\u0275providers:[]]}var Ly=new oe("");function nS(){return[{provide:Ly,useFactory:yv},{provide:ps,multi:!0,useExisting:Ly}]}var iS="firebase",sS="10.12.4";Dt(iS,sS,"app");var en=new oa("ANGULARFIRE2_VERSION");var wh=(r,e)=>{let t=e?[e]:hy(),n=[];return t.forEach(i=>{i.container.getProvider(r).instances.forEach(o=>{n.includes(o)||n.push(o)})}),n},Zt=class{constructor(){return wh(oS)}},oS="app-check";function Qr(){}var Oa=class{zone;delegate;constructor(e,t=mm){this.zone=e,this.delegate=t}now(){return this.delegate.now()}schedule(e,t,n){let i=this.zone,s=function(o){i.runGuarded(()=>{e.apply(this,[o])})};return this.delegate.schedule(s,t,n)}},_h=class{zone;task=null;constructor(e){this.zone=e}call(e,t){let n=this.unscheduleTask.bind(this);return this.task=this.zone.run(()=>Zone.current.scheduleMacroTask("firebaseZoneBlock",Qr,{},Qr,Qr)),t.pipe(Re({next:n,complete:n,error:n})).subscribe(e).add(n)}unscheduleTask(){setTimeout(()=>{this.task!=null&&this.task.state==="scheduled"&&(this.task.invoke(),this.task=null)},10)}},Yr=(()=>{class r{ngZone;outsideAngular;insideAngular;constructor(t){this.ngZone=t,this.outsideAngular=t.runOutsideAngular(()=>new Oa(Zone.current)),this.insideAngular=t.run(()=>new Oa(Zone.current,ta)),globalThis.\u0275AngularFireScheduler||=this}static \u0275fac=function(n){return new(n||r)($(Ce))};static \u0275prov=se({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})();function Gs(){let r=globalThis.\u0275AngularFireScheduler;if(!r)throw new Error(`Either AngularFireModule has not been provided in your AppModule (this can be done manually or implictly using
provideFirebaseApp) or you're calling an AngularFire method outside of an NgModule (which is not supported).`);return r}function aS(r){return Gs().ngZone.runOutsideAngular(()=>r())}function Zn(r){return Gs().ngZone.run(()=>r())}function GP(r){return r.pipe(Ht(Gs().outsideAngular))}function Xe(r){return cS(Gs())(r)}function cS(r){return function(t){return t=t.lift(new _h(r.ngZone)),t.pipe(Hn(r.outsideAngular),Ht(r.insideAngular))}}var uS=(r,e)=>function(){let n=arguments;return e&&setTimeout(()=>{e.state==="scheduled"&&e.invoke()},10),Zn(()=>r.apply(void 0,n))},tn=(r,e)=>function(){let t,n=arguments;for(let s=0;s<arguments.length;s++)typeof n[s]=="function"&&(e&&(t||=Zn(()=>Zone.current.scheduleMacroTask("firebaseZoneBlock",Qr,{},Qr,Qr))),n[s]=uS(n[s],t));let i=aS(()=>r.apply(this,n));if(!e)if(i instanceof lt){let s=Gs();return i.pipe(Hn(s.outsideAngular),Ht(s.insideAngular))}else return Zn(()=>i);return i instanceof lt?i.pipe(Xe):i instanceof Promise?Zn(()=>new Promise((s,o)=>i.then(c=>Zn(()=>s(c)),c=>Zn(()=>o(c))))):typeof i=="function"&&t?function(){return setTimeout(()=>{t&&t.state==="scheduled"&&t.invoke()},10),i.apply(this,arguments)}:Zn(()=>i)};var lS="firebase",hS="10.12.4";Ye.registerVersion(lS,hS,"app-compat");var dS=["ngOnDestroy"],Tv=(r,e,t,n={})=>new Proxy(r,{get:(i,s)=>t.runOutsideAngular(()=>{if(r[s])return n?.spy?.get&&n.spy.get(s,r[s]),r[s];if(dS.indexOf(s)>-1)return()=>{};let o=e.toPromise().then(c=>{let u=c?.[s];return typeof u=="function"?u.bind(c):u?.then?u.then(l=>t.run(()=>l)):t.run(()=>u)});return new Proxy(()=>{},{get:(c,u)=>o[u],apply:(c,u,l)=>o.then(f=>{let p=f?.(...l);return n?.spy?.apply&&n.spy.apply(s,l,p),p})})})});var Va=class{constructor(e){return e}},Xr=new oe("angularfire2.app.options"),Jr=new oe("angularfire2.app.name");function Ks(r,e,t){let n=typeof t=="string"&&t||"[DEFAULT]",i=typeof t=="object"&&t||{};i.name=i.name||n;let o=Ye.apps.filter(c=>c&&c.name===i.name)[0]||e.runOutsideAngular(()=>Ye.initializeApp(r,i));try{if(JSON.stringify(r)!==JSON.stringify(o.options)){let c=!!module.hot;fS("error",`${o.name} Firebase App already initialized with different options${c?", you may need to reload as Firebase is not HMR aware.":"."}`)}}catch{}return new Va(o)}var fS=(r,...e)=>{pl()&&typeof console<"u"&&console[r](...e)},pS={provide:Va,useFactory:Ks,deps:[Xr,Ce,[new us,Jr]]},eD=(()=>{class r{static initializeApp(t,n){return{ngModule:r,providers:[{provide:Xr,useValue:t},{provide:Jr,useValue:n}]}}constructor(t){Ye.registerVersion("angularfire",en.full,"core"),Ye.registerVersion("angularfire",en.full,"app-compat"),Ye.registerVersion("angular",Gm.full,t.toString())}static \u0275fac=function(n){return new(n||r)($(st))};static \u0275mod=Yt({type:r});static \u0275inj=Qt({providers:[pS]})}return r})();function La(r,e,t,n,i){let[,s,o]=globalThis.\u0275AngularfireInstanceCache.find(c=>c[0]===r)||[];if(s)return gS(i,o)||(Ev("error",`${e} was already initialized on the ${t} Firebase App with different settings.${mS?" You may need to reload as Firebase is not HMR aware.":""}`),Ev("warn",{is:i,was:o})),s;{let c=n();return globalThis.\u0275AngularfireInstanceCache.push([r,c,i]),c}}function gS(r,e){try{return r.toString()===e.toString()}catch{return r===e}}var mS=typeof module<"u"&&!!module.hot,Ev=(r,...e)=>{pl()&&typeof console<"u"&&console[r](...e)};globalThis.\u0275AngularfireInstanceCache||=[];function Fa(r){return Object.isFrozen(r)&&Object.isFrozen(r.raw)}function Ua(r){return r.toString().indexOf("`")===-1}var cD=Ua(r=>r``)||Ua(r=>r`\0`)||Ua(r=>r`\n`)||Ua(r=>r`\u0000`),uD=Fa``&&Fa`\0`&&Fa`\n`&&Fa`\u0000`;var AD=typeof window<"u"?window.TrustedHTML:void 0;var MD=typeof window<"u"?window.TrustedScriptURL:void 0;var UD=typeof window<"u"?window.TrustedScript:void 0;function nn(r){return{valueOf:r}.valueOf()}var ei=class{constructor(e,t,n,i,s){this.allowedElements=e,this.elementPolicies=t,this.allowedGlobalAttributes=n,this.globalAttributePolicies=i,this.globallyAllowedAttributePrefixes=s}isAllowedElement(e){return e!=="FORM"&&(this.allowedElements.has(e)||this.elementPolicies.has(e))}getAttributePolicy(e,t){let n=this.elementPolicies.get(t);if(n?.has(e))return n.get(e);if(this.allowedGlobalAttributes.has(e))return{policyAction:ve.KEEP};let i=this.globalAttributePolicies.get(e);return i||(this.globallyAllowedAttributePrefixes&&[...this.globallyAllowedAttributePrefixes].some(s=>e.indexOf(s)===0)?{policyAction:ve.KEEP}:{policyAction:ve.DROP})}},ve=function(r){return r[r.DROP=0]="DROP",r[r.KEEP=1]="KEEP",r[r.KEEP_AND_SANITIZE_URL=2]="KEEP_AND_SANITIZE_URL",r[r.KEEP_AND_NORMALIZE=3]="KEEP_AND_NORMALIZE",r[r.KEEP_AND_SANITIZE_STYLE=4]="KEEP_AND_SANITIZE_STYLE",r[r.KEEP_AND_USE_RESOURCE_URL_POLICY=5]="KEEP_AND_USE_RESOURCE_URL_POLICY",r[r.KEEP_AND_USE_RESOURCE_URL_POLICY_FOR_SRCSET=6]="KEEP_AND_USE_RESOURCE_URL_POLICY_FOR_SRCSET",r}(ve||{});var Sv=["ARTICLE","SECTION","NAV","ASIDE","H1","H2","H3","H4","H5","H6","HEADER","FOOTER","ADDRESS","P","HR","PRE","BLOCKQUOTE","OL","UL","LH","LI","DL","DT","DD","FIGURE","FIGCAPTION","MAIN","DIV","EM","STRONG","SMALL","S","CITE","Q","DFN","ABBR","RUBY","RB","RT","RTC","RP","DATA","TIME","CODE","VAR","SAMP","KBD","SUB","SUP","I","B","U","MARK","BDI","BDO","SPAN","BR","WBR","INS","DEL","PICTURE","PARAM","TRACK","MAP","TABLE","CAPTION","COLGROUP","COL","TBODY","THEAD","TFOOT","TR","TD","TH","SELECT","DATALIST","OPTGROUP","OPTION","OUTPUT","PROGRESS","METER","FIELDSET","LEGEND","DETAILS","SUMMARY","MENU","DIALOG","SLOT","CANVAS","FONT","CENTER","ACRONYM","BASEFONT","BIG","DIR","HGROUP","STRIKE","TT"],bv=[["A",new Map([["href",{policyAction:ve.KEEP_AND_SANITIZE_URL}]])],["AREA",new Map([["href",{policyAction:ve.KEEP_AND_SANITIZE_URL}]])],["LINK",new Map([["href",{policyAction:ve.KEEP_AND_USE_RESOURCE_URL_POLICY,conditions:new Map([["rel",new Set(["alternate","author","bookmark","canonical","cite","help","icon","license","next","prefetch","dns-prefetch","prerender","preconnect","preload","prev","search","subresource"])]])}]])],["SOURCE",new Map([["src",{policyAction:ve.KEEP_AND_USE_RESOURCE_URL_POLICY}],["srcset",{policyAction:ve.KEEP_AND_USE_RESOURCE_URL_POLICY_FOR_SRCSET}]])],["IMG",new Map([["src",{policyAction:ve.KEEP_AND_USE_RESOURCE_URL_POLICY}],["srcset",{policyAction:ve.KEEP_AND_USE_RESOURCE_URL_POLICY_FOR_SRCSET}]])],["VIDEO",new Map([["src",{policyAction:ve.KEEP_AND_USE_RESOURCE_URL_POLICY}]])],["AUDIO",new Map([["src",{policyAction:ve.KEEP_AND_USE_RESOURCE_URL_POLICY}]])]],Rv=["title","aria-atomic","aria-autocomplete","aria-busy","aria-checked","aria-current","aria-disabled","aria-dropeffect","aria-expanded","aria-haspopup","aria-hidden","aria-invalid","aria-label","aria-level","aria-live","aria-multiline","aria-multiselectable","aria-orientation","aria-posinset","aria-pressed","aria-readonly","aria-relevant","aria-required","aria-selected","aria-setsize","aria-sort","aria-valuemax","aria-valuemin","aria-valuenow","aria-valuetext","alt","align","autocapitalize","autocomplete","autocorrect","autofocus","autoplay","bgcolor","border","cellpadding","cellspacing","checked","color","cols","colspan","controls","datetime","disabled","download","draggable","enctype","face","formenctype","frameborder","height","hreflang","hidden","ismap","label","lang","loop","max","maxlength","media","minlength","min","multiple","muted","nonce","open","placeholder","preload","rel","required","reversed","role","rows","rowspan","selected","shape","size","sizes","slot","span","spellcheck","start","step","summary","translate","type","valign","value","width","wrap","itemscope","itemtype","itemid","itemprop","itemref"],Cv=[["dir",{policyAction:ve.KEEP_AND_NORMALIZE,conditions:nn(()=>new Map([["dir",new Set(["auto","ltr","rtl"])]]))}],["async",{policyAction:ve.KEEP_AND_NORMALIZE,conditions:nn(()=>new Map([["async",new Set(["async"])]]))}],["cite",{policyAction:ve.KEEP_AND_SANITIZE_URL}],["loading",{policyAction:ve.KEEP_AND_NORMALIZE,conditions:nn(()=>new Map([["loading",new Set(["eager","lazy"])]]))}],["poster",{policyAction:ve.KEEP_AND_SANITIZE_URL}],["target",{policyAction:ve.KEEP_AND_NORMALIZE,conditions:nn(()=>new Map([["target",new Set(["_self","_blank"])]]))}]],Pv=new ei(new Set(Sv),new Map(bv),new Set(Rv),new Map(Cv)),sx=new ei(new Set(nn(()=>Sv.concat(["STYLE"]))),new Map(bv),new Set(nn(()=>Rv.concat(["id","name","class"]))),new Map(nn(()=>Cv.concat([["style",{policyAction:ve.KEEP_AND_SANITIZE_STYLE}]]))));var KS=new Map,WS={activated:!1,tokenObservers:[]},HS={initialized:!1,enabled:!1};function Et(r){return KS.get(r)||Object.assign({},WS)}function Vv(){return HS}var QS="https://content-firebaseappcheck.googleapis.com/v1";var YS="exchangeDebugToken",Nv={OFFSET_DURATION:5*60*1e3,RETRIAL_MIN_WAIT:30*1e3,RETRIAL_MAX_WAIT:16*60*1e3},qk=24*60*60*1e3;var Th=class{constructor(e,t,n,i,s){if(this.operation=e,this.retryPolicy=t,this.getWaitDuration=n,this.lowerBound=i,this.upperBound=s,this.pending=null,this.nextErrorWaitInterval=i,i>s)throw new Error("Proactive refresh lower bound greater than upper bound!")}start(){this.nextErrorWaitInterval=this.lowerBound,this.process(!0).catch(()=>{})}stop(){this.pending&&(this.pending.reject("cancelled"),this.pending=null)}isRunning(){return!!this.pending}process(e){return P(this,null,function*(){this.stop();try{this.pending=new vl,this.pending.promise.catch(t=>{}),yield XS(this.getNextRun(e)),this.pending.resolve(),yield this.pending.promise,this.pending=new vl,this.pending.promise.catch(t=>{}),yield this.operation(),this.pending.resolve(),yield this.pending.promise,this.process(!0).catch(()=>{})}catch(t){this.retryPolicy(t)?this.process(!1).catch(()=>{}):this.stop()}})}getNextRun(e){if(e)return this.nextErrorWaitInterval=this.lowerBound,this.getWaitDuration();{let t=this.nextErrorWaitInterval;return this.nextErrorWaitInterval*=2,this.nextErrorWaitInterval>this.upperBound&&(this.nextErrorWaitInterval=this.upperBound),t}}};function XS(r){return new Promise(e=>{setTimeout(e,r)})}var JS={"already-initialized":"You have already called initializeAppCheck() for FirebaseApp {$appName} with different options. To avoid this error, call initializeAppCheck() with the same options as when it was originally called. This will return the already initialized instance.","use-before-activation":"App Check is being used before initializeAppCheck() is called for FirebaseApp {$appName}. Call initializeAppCheck() before instantiating other Firebase services.","fetch-network-error":"Fetch failed to connect to a network. Check Internet connection. Original error: {$originalErrorMessage}.","fetch-parse-error":"Fetch client could not parse response. Original error: {$originalErrorMessage}.","fetch-status-error":"Fetch server returned an HTTP error status. HTTP status: {$httpStatus}.","storage-open":"Error thrown when opening storage. Original error: {$originalErrorMessage}.","storage-get":"Error thrown when reading from storage. Original error: {$originalErrorMessage}.","storage-set":"Error thrown when writing to storage. Original error: {$originalErrorMessage}.","recaptcha-error":"ReCAPTCHA error.",throttled:"Requests throttled due to {$httpStatus} error. Attempts allowed again after {$time}"},In=new uy("appCheck","AppCheck",JS);function Lv(r){if(!Et(r).activated)throw In.create("use-before-activation",{appName:r.name})}function Fv(n,i){return P(this,arguments,function*({url:r,body:e},t){let s={"Content-Type":"application/json"},o=t.getImmediate({optional:!0});if(o){let T=yield o.getHeartbeatsHeader();T&&(s["X-Firebase-Client"]=T)}let c={method:"POST",body:JSON.stringify(e),headers:s},u;try{u=yield fetch(r,c)}catch(T){throw In.create("fetch-network-error",{originalErrorMessage:T?.message})}if(u.status!==200)throw In.create("fetch-status-error",{httpStatus:u.status});let l;try{l=yield u.json()}catch(T){throw In.create("fetch-parse-error",{originalErrorMessage:T?.message})}let f=l.ttl.match(/^([\d.]+)(s)$/);if(!f||!f[2]||isNaN(Number(f[1])))throw In.create("fetch-parse-error",{originalErrorMessage:`ttl field (timeToLive) is not in standard Protobuf Duration format: ${l.ttl}`});let p=Number(f[1])*1e3,m=Date.now();return{token:l.token,expireTimeMillis:m+p,issuedAtTimeMillis:m}})}function Uv(r,e){let{projectId:t,appId:n,apiKey:i}=r.options;return{url:`${QS}/projects/${t}/apps/${n}:${YS}?key=${i}`,body:{debug_token:e}}}var ZS="firebase-app-check-database",eb=1,Ih="firebase-app-check-store";var za=null;function tb(){return za||(za=new Promise((r,e)=>{try{let t=indexedDB.open(ZS,eb);t.onsuccess=n=>{r(n.target.result)},t.onerror=n=>{var i;e(In.create("storage-open",{originalErrorMessage:(i=n.target.error)===null||i===void 0?void 0:i.message}))},t.onupgradeneeded=n=>{let i=n.target.result;switch(n.oldVersion){case 0:i.createObjectStore(Ih,{keyPath:"compositeKey"})}}}catch(t){e(In.create("storage-open",{originalErrorMessage:t?.message}))}}),za)}function nb(r,e){return rb(ib(r),e)}function rb(r,e){return P(this,null,function*(){let n=(yield tb()).transaction(Ih,"readwrite"),s=n.objectStore(Ih).put({compositeKey:r,value:e});return new Promise((o,c)=>{s.onsuccess=u=>{o()},n.onerror=u=>{var l;c(In.create("storage-set",{originalErrorMessage:(l=u.target.error)===null||l===void 0?void 0:l.message}))}})})}function ib(r){return`${r.options.appId}-${r.name}`}var Ah=new ha("@firebase/app-check");function Eh(r,e){return la()?nb(r,e).catch(t=>{Ah.warn(`Failed to write token to IndexedDB. Error: ${t}`)}):Promise.resolve()}function jv(){return Vv().enabled}function $v(){return P(this,null,function*(){let r=Vv();if(r.enabled&&r.token)return r.token.promise;throw Error(`
            Can't get debug token in production mode.
        `)})}var sb={error:"UNKNOWN_ERROR"};function ob(r){return sy.encodeString(JSON.stringify(r),!1)}function Sh(r,e=!1){return P(this,null,function*(){let t=r.app;Lv(t);let n=Et(t),i=n.token,s;if(i&&!Hs(i)&&(n.token=void 0,i=void 0),!i){let u=yield n.cachedTokenPromise;u&&(Hs(u)?i=u:yield Eh(t,void 0))}if(!e&&i&&Hs(i))return{token:i.token};let o=!1;if(jv()){n.exchangeTokenPromise||(n.exchangeTokenPromise=Fv(Uv(t,yield $v()),r.heartbeatServiceProvider).finally(()=>{n.exchangeTokenPromise=void 0}),o=!0);let u=yield n.exchangeTokenPromise;return yield Eh(t,u),n.token=u,{token:u.token}}try{n.exchangeTokenPromise||(n.exchangeTokenPromise=n.provider.getToken().finally(()=>{n.exchangeTokenPromise=void 0}),o=!0),i=yield Et(t).exchangeTokenPromise}catch(u){u.code==="appCheck/throttled"?Ah.warn(u.message):Ah.error(u),s=u}let c;return i?s?Hs(i)?c={token:i.token,internalError:s}:c=Mv(s):(c={token:i.token},n.token=i,yield Eh(t,i)):c=Mv(s),o&&lb(t,c),c})}function ab(r){return P(this,null,function*(){let e=r.app;Lv(e);let{provider:t}=Et(e);if(jv()){let n=yield $v(),{token:i}=yield Fv(Uv(e,n),r.heartbeatServiceProvider);return{token:i}}else{let{token:n}=yield t.getToken();return{token:n}}})}function cb(r,e,t,n){let{app:i}=r,s=Et(i),o={next:t,error:n,type:e};if(s.tokenObservers=[...s.tokenObservers,o],s.token&&Hs(s.token)){let c=s.token;Promise.resolve().then(()=>{t({token:c.token}),kv(r)}).catch(()=>{})}s.cachedTokenPromise.then(()=>kv(r))}function zv(r,e){let t=Et(r),n=t.tokenObservers.filter(i=>i.next!==e);n.length===0&&t.tokenRefresher&&t.tokenRefresher.isRunning()&&t.tokenRefresher.stop(),t.tokenObservers=n}function kv(r){let{app:e}=r,t=Et(e),n=t.tokenRefresher;n||(n=ub(r),t.tokenRefresher=n),!n.isRunning()&&t.isTokenAutoRefreshEnabled&&n.start()}function ub(r){let{app:e}=r;return new Th(()=>P(this,null,function*(){let t=Et(e),n;if(t.token?n=yield Sh(r,!0):n=yield Sh(r),n.error)throw n.error;if(n.internalError)throw n.internalError}),()=>!0,()=>{let t=Et(e);if(t.token){let n=t.token.issuedAtTimeMillis+(t.token.expireTimeMillis-t.token.issuedAtTimeMillis)*.5+3e5,i=t.token.expireTimeMillis-5*60*1e3;return n=Math.min(n,i),Math.max(0,n-Date.now())}else return 0},Nv.RETRIAL_MIN_WAIT,Nv.RETRIAL_MAX_WAIT)}function lb(r,e){let t=Et(r).tokenObservers;for(let n of t)try{n.type==="EXTERNAL"&&e.error!=null?n.error(e.error):n.next(e)}catch{}}function Hs(r){return r.expireTimeMillis-Date.now()>0}function Mv(r){return{token:ob(sb),error:r}}var bh=class{constructor(e,t){this.app=e,this.heartbeatServiceProvider=t}_delete(){let{tokenObservers:e}=Et(this.app);for(let t of e)zv(this.app,t.next);return Promise.resolve()}};function hb(r,e){return new bh(r,e)}function db(r){return{getToken:e=>Sh(r,e),getLimitedUseToken:()=>ab(r),addTokenListener:e=>cb(r,"INTERNAL",e),removeTokenListener:e=>zv(r.app,e)}}var fb="@firebase/app-check",pb="0.8.6";var gb="app-check",Ov="app-check-internal";function mb(){_s(new Yn(gb,r=>{let e=r.getProvider("app").getImmediate(),t=r.getProvider("heartbeat");return hb(e,t)},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((r,e,t)=>{r.getProvider(Ov).initialize()})),_s(new Yn(Ov,r=>{let e=r.getProvider("app-check").getImmediate();return db(e)},"PUBLIC").setInstantiationMode("EXPLICIT")),Dt(fb,pb)}mb();var yb=["localhost","0.0.0.0","127.0.0.1"],nM=typeof window<"u"&&yb.includes(window.location.hostname);var Rh=new oe("angularfire2.auth.use-emulator"),Ch=new oe("angularfire2.auth.settings"),Ph=new oe("angularfire2.auth.tenant-id"),Dh=new oe("angularfire2.auth.langugage-code"),xh=new oe("angularfire2.auth.use-device-language"),Nh=new oe("angularfire.auth.persistence"),kh=(r,e,t,n,i,s,o,c)=>La(`${r.name}.auth`,"AngularFireAuth",r.name,()=>{let u=e.runOutsideAngular(()=>r.auth());if(t&&u.useEmulator(...t),n&&(u.tenantId=n),u.languageCode=i,s&&u.useDeviceLanguage(),o)for(let[l,f]of Object.entries(o))u.settings[l]=f;return c&&u.setPersistence(c),u},[t,n,i,s,o,c]),Mh=(()=>{class r{authState;idToken;user;idTokenResult;credential;constructor(t,n,i,s,o,c,u,l,f,p,m,T){let x=new bt,N=B(void 0).pipe(Ht(o.outsideAngular),Me(()=>s.runOutsideAngular(()=>import("./chunk-KI5MH3J7.js"))),X(()=>Ks(t,s,n)),X(D=>kh(D,s,c,l,f,p,u,m)),el({bufferSize:1,refCount:!1}));if(Jt(i))this.authState=this.user=this.idToken=this.idTokenResult=this.credential=B(null);else{N.pipe(Ct()).subscribe();let D=N.pipe(Me(V=>V.getRedirectResult().then(H=>H,()=>null)),Xe,el({bufferSize:1,refCount:!1})),j=N.pipe(Me(V=>new lt(H=>({unsubscribe:s.runOutsideAngular(()=>V.onAuthStateChanged(Q=>H.next(Q),Q=>H.error(Q),()=>H.complete()))})))),G=N.pipe(Me(V=>new lt(H=>({unsubscribe:s.runOutsideAngular(()=>V.onIdTokenChanged(Q=>H.next(Q),Q=>H.error(Q),()=>H.complete()))}))));this.authState=D.pipe(tl(j),Hn(o.outsideAngular),Ht(o.insideAngular)),this.user=D.pipe(tl(G),Hn(o.outsideAngular),Ht(o.insideAngular)),this.idToken=this.user.pipe(Me(V=>V?ge(V.getIdToken()):B(null))),this.idTokenResult=this.user.pipe(Me(V=>V?ge(V.getIdTokenResult()):B(null))),this.credential=wm(D,x,this.authState.pipe(it(V=>!V))).pipe(X(V=>V?.user?V:null),Hn(o.outsideAngular),Ht(o.insideAngular))}return Tv(this,N,s,{spy:{apply:(D,j,G)=>{(D.startsWith("signIn")||D.startsWith("createUser"))&&G.then(V=>x.next(V))}}})}static \u0275fac=function(n){return new(n||r)($(Xr),$(Jr,8),$(st),$(Ce),$(Yr),$(Rh,8),$(Ch,8),$(Ph,8),$(Dh,8),$(xh,8),$(Nh,8),$(Zt,8))};static \u0275prov=se({token:r,factory:r.\u0275fac,providedIn:"any"})}return r})(),vM=(()=>{class r{constructor(){Ye.registerVersion("angularfire",en.full,"auth-compat")}static \u0275fac=function(n){return new(n||r)};static \u0275mod=Yt({type:r});static \u0275inj=Qt({providers:[Mh]})}return r})();var qv=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Gv={};var An,Oh;(function(){var r;function e(w,y){function _(){}_.prototype=y.prototype,w.D=y.prototype,w.prototype=new _,w.prototype.constructor=w,w.C=function(E,I,S){for(var v=Array(arguments.length-2),Gt=2;Gt<arguments.length;Gt++)v[Gt-2]=arguments[Gt];return y.prototype[I].apply(E,v)}}function t(){this.blockSize=-1}function n(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(n,t),n.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function i(w,y,_){_||(_=0);var E=Array(16);if(typeof y=="string")for(var I=0;16>I;++I)E[I]=y.charCodeAt(_++)|y.charCodeAt(_++)<<8|y.charCodeAt(_++)<<16|y.charCodeAt(_++)<<24;else for(I=0;16>I;++I)E[I]=y[_++]|y[_++]<<8|y[_++]<<16|y[_++]<<24;y=w.g[0],_=w.g[1],I=w.g[2];var S=w.g[3],v=y+(S^_&(I^S))+E[0]+3614090360&4294967295;y=_+(v<<7&4294967295|v>>>25),v=S+(I^y&(_^I))+E[1]+3905402710&4294967295,S=y+(v<<12&4294967295|v>>>20),v=I+(_^S&(y^_))+E[2]+606105819&4294967295,I=S+(v<<17&4294967295|v>>>15),v=_+(y^I&(S^y))+E[3]+3250441966&4294967295,_=I+(v<<22&4294967295|v>>>10),v=y+(S^_&(I^S))+E[4]+4118548399&4294967295,y=_+(v<<7&4294967295|v>>>25),v=S+(I^y&(_^I))+E[5]+1200080426&4294967295,S=y+(v<<12&4294967295|v>>>20),v=I+(_^S&(y^_))+E[6]+2821735955&4294967295,I=S+(v<<17&4294967295|v>>>15),v=_+(y^I&(S^y))+E[7]+4249261313&4294967295,_=I+(v<<22&4294967295|v>>>10),v=y+(S^_&(I^S))+E[8]+1770035416&4294967295,y=_+(v<<7&4294967295|v>>>25),v=S+(I^y&(_^I))+E[9]+2336552879&4294967295,S=y+(v<<12&4294967295|v>>>20),v=I+(_^S&(y^_))+E[10]+4294925233&4294967295,I=S+(v<<17&4294967295|v>>>15),v=_+(y^I&(S^y))+E[11]+2304563134&4294967295,_=I+(v<<22&4294967295|v>>>10),v=y+(S^_&(I^S))+E[12]+1804603682&4294967295,y=_+(v<<7&4294967295|v>>>25),v=S+(I^y&(_^I))+E[13]+4254626195&4294967295,S=y+(v<<12&4294967295|v>>>20),v=I+(_^S&(y^_))+E[14]+2792965006&4294967295,I=S+(v<<17&4294967295|v>>>15),v=_+(y^I&(S^y))+E[15]+1236535329&4294967295,_=I+(v<<22&4294967295|v>>>10),v=y+(I^S&(_^I))+E[1]+4129170786&4294967295,y=_+(v<<5&4294967295|v>>>27),v=S+(_^I&(y^_))+E[6]+3225465664&4294967295,S=y+(v<<9&4294967295|v>>>23),v=I+(y^_&(S^y))+E[11]+643717713&4294967295,I=S+(v<<14&4294967295|v>>>18),v=_+(S^y&(I^S))+E[0]+3921069994&4294967295,_=I+(v<<20&4294967295|v>>>12),v=y+(I^S&(_^I))+E[5]+3593408605&4294967295,y=_+(v<<5&4294967295|v>>>27),v=S+(_^I&(y^_))+E[10]+38016083&4294967295,S=y+(v<<9&4294967295|v>>>23),v=I+(y^_&(S^y))+E[15]+3634488961&4294967295,I=S+(v<<14&4294967295|v>>>18),v=_+(S^y&(I^S))+E[4]+3889429448&4294967295,_=I+(v<<20&4294967295|v>>>12),v=y+(I^S&(_^I))+E[9]+568446438&4294967295,y=_+(v<<5&4294967295|v>>>27),v=S+(_^I&(y^_))+E[14]+3275163606&4294967295,S=y+(v<<9&4294967295|v>>>23),v=I+(y^_&(S^y))+E[3]+4107603335&4294967295,I=S+(v<<14&4294967295|v>>>18),v=_+(S^y&(I^S))+E[8]+1163531501&4294967295,_=I+(v<<20&4294967295|v>>>12),v=y+(I^S&(_^I))+E[13]+2850285829&4294967295,y=_+(v<<5&4294967295|v>>>27),v=S+(_^I&(y^_))+E[2]+4243563512&4294967295,S=y+(v<<9&4294967295|v>>>23),v=I+(y^_&(S^y))+E[7]+1735328473&4294967295,I=S+(v<<14&4294967295|v>>>18),v=_+(S^y&(I^S))+E[12]+2368359562&4294967295,_=I+(v<<20&4294967295|v>>>12),v=y+(_^I^S)+E[5]+4294588738&4294967295,y=_+(v<<4&4294967295|v>>>28),v=S+(y^_^I)+E[8]+2272392833&4294967295,S=y+(v<<11&4294967295|v>>>21),v=I+(S^y^_)+E[11]+1839030562&4294967295,I=S+(v<<16&4294967295|v>>>16),v=_+(I^S^y)+E[14]+4259657740&4294967295,_=I+(v<<23&4294967295|v>>>9),v=y+(_^I^S)+E[1]+2763975236&4294967295,y=_+(v<<4&4294967295|v>>>28),v=S+(y^_^I)+E[4]+1272893353&4294967295,S=y+(v<<11&4294967295|v>>>21),v=I+(S^y^_)+E[7]+4139469664&4294967295,I=S+(v<<16&4294967295|v>>>16),v=_+(I^S^y)+E[10]+3200236656&4294967295,_=I+(v<<23&4294967295|v>>>9),v=y+(_^I^S)+E[13]+681279174&4294967295,y=_+(v<<4&4294967295|v>>>28),v=S+(y^_^I)+E[0]+3936430074&4294967295,S=y+(v<<11&4294967295|v>>>21),v=I+(S^y^_)+E[3]+3572445317&4294967295,I=S+(v<<16&4294967295|v>>>16),v=_+(I^S^y)+E[6]+76029189&4294967295,_=I+(v<<23&4294967295|v>>>9),v=y+(_^I^S)+E[9]+3654602809&4294967295,y=_+(v<<4&4294967295|v>>>28),v=S+(y^_^I)+E[12]+3873151461&4294967295,S=y+(v<<11&4294967295|v>>>21),v=I+(S^y^_)+E[15]+530742520&4294967295,I=S+(v<<16&4294967295|v>>>16),v=_+(I^S^y)+E[2]+3299628645&4294967295,_=I+(v<<23&4294967295|v>>>9),v=y+(I^(_|~S))+E[0]+4096336452&4294967295,y=_+(v<<6&4294967295|v>>>26),v=S+(_^(y|~I))+E[7]+1126891415&4294967295,S=y+(v<<10&4294967295|v>>>22),v=I+(y^(S|~_))+E[14]+2878612391&4294967295,I=S+(v<<15&4294967295|v>>>17),v=_+(S^(I|~y))+E[5]+4237533241&4294967295,_=I+(v<<21&4294967295|v>>>11),v=y+(I^(_|~S))+E[12]+1700485571&4294967295,y=_+(v<<6&4294967295|v>>>26),v=S+(_^(y|~I))+E[3]+2399980690&4294967295,S=y+(v<<10&4294967295|v>>>22),v=I+(y^(S|~_))+E[10]+4293915773&4294967295,I=S+(v<<15&4294967295|v>>>17),v=_+(S^(I|~y))+E[1]+2240044497&4294967295,_=I+(v<<21&4294967295|v>>>11),v=y+(I^(_|~S))+E[8]+1873313359&4294967295,y=_+(v<<6&4294967295|v>>>26),v=S+(_^(y|~I))+E[15]+4264355552&4294967295,S=y+(v<<10&4294967295|v>>>22),v=I+(y^(S|~_))+E[6]+2734768916&4294967295,I=S+(v<<15&4294967295|v>>>17),v=_+(S^(I|~y))+E[13]+1309151649&4294967295,_=I+(v<<21&4294967295|v>>>11),v=y+(I^(_|~S))+E[4]+4149444226&4294967295,y=_+(v<<6&4294967295|v>>>26),v=S+(_^(y|~I))+E[11]+3174756917&4294967295,S=y+(v<<10&4294967295|v>>>22),v=I+(y^(S|~_))+E[2]+718787259&4294967295,I=S+(v<<15&4294967295|v>>>17),v=_+(S^(I|~y))+E[9]+3951481745&4294967295,w.g[0]=w.g[0]+y&4294967295,w.g[1]=w.g[1]+(I+(v<<21&4294967295|v>>>11))&4294967295,w.g[2]=w.g[2]+I&4294967295,w.g[3]=w.g[3]+S&4294967295}n.prototype.u=function(w,y){y===void 0&&(y=w.length);for(var _=y-this.blockSize,E=this.B,I=this.h,S=0;S<y;){if(I==0)for(;S<=_;)i(this,w,S),S+=this.blockSize;if(typeof w=="string"){for(;S<y;)if(E[I++]=w.charCodeAt(S++),I==this.blockSize){i(this,E),I=0;break}}else for(;S<y;)if(E[I++]=w[S++],I==this.blockSize){i(this,E),I=0;break}}this.h=I,this.o+=y},n.prototype.v=function(){var w=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);w[0]=128;for(var y=1;y<w.length-8;++y)w[y]=0;var _=8*this.o;for(y=w.length-8;y<w.length;++y)w[y]=_&255,_/=256;for(this.u(w),w=Array(16),y=_=0;4>y;++y)for(var E=0;32>E;E+=8)w[_++]=this.g[y]>>>E&255;return w};function s(w,y){var _=c;return Object.prototype.hasOwnProperty.call(_,w)?_[w]:_[w]=y(w)}function o(w,y){this.h=y;for(var _=[],E=!0,I=w.length-1;0<=I;I--){var S=w[I]|0;E&&S==y||(_[I]=S,E=!1)}this.g=_}var c={};function u(w){return-128<=w&&128>w?s(w,function(y){return new o([y|0],0>y?-1:0)}):new o([w|0],0>w?-1:0)}function l(w){if(isNaN(w)||!isFinite(w))return p;if(0>w)return D(l(-w));for(var y=[],_=1,E=0;w>=_;E++)y[E]=w/_|0,_*=4294967296;return new o(y,0)}function f(w,y){if(w.length==0)throw Error("number format error: empty string");if(y=y||10,2>y||36<y)throw Error("radix out of range: "+y);if(w.charAt(0)=="-")return D(f(w.substring(1),y));if(0<=w.indexOf("-"))throw Error('number format error: interior "-" character');for(var _=l(Math.pow(y,8)),E=p,I=0;I<w.length;I+=8){var S=Math.min(8,w.length-I),v=parseInt(w.substring(I,I+S),y);8>S?(S=l(Math.pow(y,S)),E=E.j(S).add(l(v))):(E=E.j(_),E=E.add(l(v)))}return E}var p=u(0),m=u(1),T=u(16777216);r=o.prototype,r.m=function(){if(N(this))return-D(this).m();for(var w=0,y=1,_=0;_<this.g.length;_++){var E=this.i(_);w+=(0<=E?E:4294967296+E)*y,y*=4294967296}return w},r.toString=function(w){if(w=w||10,2>w||36<w)throw Error("radix out of range: "+w);if(x(this))return"0";if(N(this))return"-"+D(this).toString(w);for(var y=l(Math.pow(w,6)),_=this,E="";;){var I=H(_,y).g;_=j(_,I.j(y));var S=((0<_.g.length?_.g[0]:_.h)>>>0).toString(w);if(_=I,x(_))return S+E;for(;6>S.length;)S="0"+S;E=S+E}},r.i=function(w){return 0>w?0:w<this.g.length?this.g[w]:this.h};function x(w){if(w.h!=0)return!1;for(var y=0;y<w.g.length;y++)if(w.g[y]!=0)return!1;return!0}function N(w){return w.h==-1}r.l=function(w){return w=j(this,w),N(w)?-1:x(w)?0:1};function D(w){for(var y=w.g.length,_=[],E=0;E<y;E++)_[E]=~w.g[E];return new o(_,~w.h).add(m)}r.abs=function(){return N(this)?D(this):this},r.add=function(w){for(var y=Math.max(this.g.length,w.g.length),_=[],E=0,I=0;I<=y;I++){var S=E+(this.i(I)&65535)+(w.i(I)&65535),v=(S>>>16)+(this.i(I)>>>16)+(w.i(I)>>>16);E=v>>>16,S&=65535,v&=65535,_[I]=v<<16|S}return new o(_,_[_.length-1]&-2147483648?-1:0)};function j(w,y){return w.add(D(y))}r.j=function(w){if(x(this)||x(w))return p;if(N(this))return N(w)?D(this).j(D(w)):D(D(this).j(w));if(N(w))return D(this.j(D(w)));if(0>this.l(T)&&0>w.l(T))return l(this.m()*w.m());for(var y=this.g.length+w.g.length,_=[],E=0;E<2*y;E++)_[E]=0;for(E=0;E<this.g.length;E++)for(var I=0;I<w.g.length;I++){var S=this.i(E)>>>16,v=this.i(E)&65535,Gt=w.i(I)>>>16,zi=w.i(I)&65535;_[2*E+2*I]+=v*zi,G(_,2*E+2*I),_[2*E+2*I+1]+=S*zi,G(_,2*E+2*I+1),_[2*E+2*I+1]+=v*Gt,G(_,2*E+2*I+1),_[2*E+2*I+2]+=S*Gt,G(_,2*E+2*I+2)}for(E=0;E<y;E++)_[E]=_[2*E+1]<<16|_[2*E];for(E=y;E<2*y;E++)_[E]=0;return new o(_,0)};function G(w,y){for(;(w[y]&65535)!=w[y];)w[y+1]+=w[y]>>>16,w[y]&=65535,y++}function V(w,y){this.g=w,this.h=y}function H(w,y){if(x(y))throw Error("division by zero");if(x(w))return new V(p,p);if(N(w))return y=H(D(w),y),new V(D(y.g),D(y.h));if(N(y))return y=H(w,D(y)),new V(D(y.g),y.h);if(30<w.g.length){if(N(w)||N(y))throw Error("slowDivide_ only works with positive integers.");for(var _=m,E=y;0>=E.l(w);)_=Q(_),E=Q(E);var I=Y(_,1),S=Y(E,1);for(E=Y(E,2),_=Y(_,2);!x(E);){var v=S.add(E);0>=v.l(w)&&(I=I.add(_),S=v),E=Y(E,1),_=Y(_,1)}return y=j(w,I.j(y)),new V(I,y)}for(I=p;0<=w.l(y);){for(_=Math.max(1,Math.floor(w.m()/y.m())),E=Math.ceil(Math.log(_)/Math.LN2),E=48>=E?1:Math.pow(2,E-48),S=l(_),v=S.j(y);N(v)||0<v.l(w);)_-=E,S=l(_),v=S.j(y);x(S)&&(S=m),I=I.add(S),w=j(w,v)}return new V(I,w)}r.A=function(w){return H(this,w).h},r.and=function(w){for(var y=Math.max(this.g.length,w.g.length),_=[],E=0;E<y;E++)_[E]=this.i(E)&w.i(E);return new o(_,this.h&w.h)},r.or=function(w){for(var y=Math.max(this.g.length,w.g.length),_=[],E=0;E<y;E++)_[E]=this.i(E)|w.i(E);return new o(_,this.h|w.h)},r.xor=function(w){for(var y=Math.max(this.g.length,w.g.length),_=[],E=0;E<y;E++)_[E]=this.i(E)^w.i(E);return new o(_,this.h^w.h)};function Q(w){for(var y=w.g.length+1,_=[],E=0;E<y;E++)_[E]=w.i(E)<<1|w.i(E-1)>>>31;return new o(_,w.h)}function Y(w,y){var _=y>>5;y%=32;for(var E=w.g.length-_,I=[],S=0;S<E;S++)I[S]=0<y?w.i(S+_)>>>y|w.i(S+_+1)<<32-y:w.i(S+_);return new o(I,w.h)}n.prototype.digest=n.prototype.v,n.prototype.reset=n.prototype.s,n.prototype.update=n.prototype.u,Oh=Gv.Md5=n,o.prototype.add=o.prototype.add,o.prototype.multiply=o.prototype.j,o.prototype.modulo=o.prototype.A,o.prototype.compare=o.prototype.l,o.prototype.toNumber=o.prototype.m,o.prototype.toString=o.prototype.toString,o.prototype.getBits=o.prototype.i,o.fromNumber=l,o.fromString=f,An=Gv.Integer=o}).apply(typeof qv<"u"?qv:typeof self<"u"?self:typeof window<"u"?window:{});var Ba=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},rn={};var Vh,Lh,ti,Fh,Qs,qa,Uh,jh,$h;(function(){var r,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(a,h,d){return a==Array.prototype||a==Object.prototype||(a[h]=d.value),a};function t(a){a=[typeof globalThis=="object"&&globalThis,a,typeof window=="object"&&window,typeof self=="object"&&self,typeof Ba=="object"&&Ba];for(var h=0;h<a.length;++h){var d=a[h];if(d&&d.Math==Math)return d}throw Error("Cannot find global object")}var n=t(this);function i(a,h){if(h)e:{var d=n;a=a.split(".");for(var g=0;g<a.length-1;g++){var A=a[g];if(!(A in d))break e;d=d[A]}a=a[a.length-1],g=d[a],h=h(g),h!=g&&h!=null&&e(d,a,{configurable:!0,writable:!0,value:h})}}function s(a,h){a instanceof String&&(a+="");var d=0,g=!1,A={next:function(){if(!g&&d<a.length){var R=d++;return{value:h(R,a[R]),done:!1}}return g=!0,{done:!0,value:void 0}}};return A[Symbol.iterator]=function(){return A},A}i("Array.prototype.values",function(a){return a||function(){return s(this,function(h,d){return d})}});var o=o||{},c=this||self;function u(a){var h=typeof a;return h=h!="object"?h:a?Array.isArray(a)?"array":h:"null",h=="array"||h=="object"&&typeof a.length=="number"}function l(a){var h=typeof a;return h=="object"&&a!=null||h=="function"}function f(a,h,d){return a.call.apply(a.bind,arguments)}function p(a,h,d){if(!a)throw Error();if(2<arguments.length){var g=Array.prototype.slice.call(arguments,2);return function(){var A=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(A,g),a.apply(h,A)}}return function(){return a.apply(h,arguments)}}function m(a,h,d){return m=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?f:p,m.apply(null,arguments)}function T(a,h){var d=Array.prototype.slice.call(arguments,1);return function(){var g=d.slice();return g.push.apply(g,arguments),a.apply(this,g)}}function x(a,h){function d(){}d.prototype=h.prototype,a.aa=h.prototype,a.prototype=new d,a.prototype.constructor=a,a.Qb=function(g,A,R){for(var O=Array(arguments.length-2),le=2;le<arguments.length;le++)O[le-2]=arguments[le];return h.prototype[A].apply(g,O)}}function N(a){let h=a.length;if(0<h){let d=Array(h);for(let g=0;g<h;g++)d[g]=a[g];return d}return[]}function D(a,h){for(let d=1;d<arguments.length;d++){let g=arguments[d];if(u(g)){let A=a.length||0,R=g.length||0;a.length=A+R;for(let O=0;O<R;O++)a[A+O]=g[O]}else a.push(g)}}class j{constructor(h,d){this.i=h,this.j=d,this.h=0,this.g=null}get(){let h;return 0<this.h?(this.h--,h=this.g,this.g=h.next,h.next=null):h=this.i(),h}}function G(a){return/^[\s\xa0]*$/.test(a)}function V(){var a=c.navigator;return a&&(a=a.userAgent)?a:""}function H(a){return H[" "](a),a}H[" "]=function(){};var Q=V().indexOf("Gecko")!=-1&&!(V().toLowerCase().indexOf("webkit")!=-1&&V().indexOf("Edge")==-1)&&!(V().indexOf("Trident")!=-1||V().indexOf("MSIE")!=-1)&&V().indexOf("Edge")==-1;function Y(a,h,d){for(let g in a)h.call(d,a[g],g,a)}function w(a,h){for(let d in a)h.call(void 0,a[d],d,a)}function y(a){let h={};for(let d in a)h[d]=a[d];return h}let _="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function E(a,h){let d,g;for(let A=1;A<arguments.length;A++){g=arguments[A];for(d in g)a[d]=g[d];for(let R=0;R<_.length;R++)d=_[R],Object.prototype.hasOwnProperty.call(g,d)&&(a[d]=g[d])}}function I(a){var h=1;a=a.split(":");let d=[];for(;0<h&&a.length;)d.push(a.shift()),h--;return a.length&&d.push(a.join(":")),d}function S(a){c.setTimeout(()=>{throw a},0)}function v(){var a=Tu;let h=null;return a.g&&(h=a.g,a.g=a.g.next,a.g||(a.h=null),h.next=null),h}class Gt{constructor(){this.h=this.g=null}add(h,d){let g=zi.get();g.set(h,d),this.h?this.h.next=g:this.g=g,this.h=g}}var zi=new j(()=>new YE,a=>a.reset());class YE{constructor(){this.next=this.g=this.h=null}set(h,d){this.h=h,this.g=d,this.next=null}reset(){this.next=this.g=this.h=null}}let Bi,qi=!1,Tu=new Gt,dg=()=>{let a=c.Promise.resolve(void 0);Bi=()=>{a.then(XE)}};var XE=()=>{for(var a;a=v();){try{a.h.call(a.g)}catch(d){S(d)}var h=zi;h.j(a),100>h.h&&(h.h++,a.next=h.g,h.g=a)}qi=!1};function fn(){this.s=this.s,this.C=this.C}fn.prototype.s=!1,fn.prototype.ma=function(){this.s||(this.s=!0,this.N())},fn.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function ze(a,h){this.type=a,this.g=this.target=h,this.defaultPrevented=!1}ze.prototype.h=function(){this.defaultPrevented=!0};var JE=function(){if(!c.addEventListener||!Object.defineProperty)return!1;var a=!1,h=Object.defineProperty({},"passive",{get:function(){a=!0}});try{let d=()=>{};c.addEventListener("test",d,h),c.removeEventListener("test",d,h)}catch{}return a}();function Gi(a,h){if(ze.call(this,a?a.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,a){var d=this.type=a.type,g=a.changedTouches&&a.changedTouches.length?a.changedTouches[0]:null;if(this.target=a.target||a.srcElement,this.g=h,h=a.relatedTarget){if(Q){e:{try{H(h.nodeName);var A=!0;break e}catch{}A=!1}A||(h=null)}}else d=="mouseover"?h=a.fromElement:d=="mouseout"&&(h=a.toElement);this.relatedTarget=h,g?(this.clientX=g.clientX!==void 0?g.clientX:g.pageX,this.clientY=g.clientY!==void 0?g.clientY:g.pageY,this.screenX=g.screenX||0,this.screenY=g.screenY||0):(this.clientX=a.clientX!==void 0?a.clientX:a.pageX,this.clientY=a.clientY!==void 0?a.clientY:a.pageY,this.screenX=a.screenX||0,this.screenY=a.screenY||0),this.button=a.button,this.key=a.key||"",this.ctrlKey=a.ctrlKey,this.altKey=a.altKey,this.shiftKey=a.shiftKey,this.metaKey=a.metaKey,this.pointerId=a.pointerId||0,this.pointerType=typeof a.pointerType=="string"?a.pointerType:ZE[a.pointerType]||"",this.state=a.state,this.i=a,a.defaultPrevented&&Gi.aa.h.call(this)}}x(Gi,ze);var ZE={2:"touch",3:"pen",4:"mouse"};Gi.prototype.h=function(){Gi.aa.h.call(this);var a=this.i;a.preventDefault?a.preventDefault():a.returnValue=!1};var Ki="closure_listenable_"+(1e6*Math.random()|0),eT=0;function tT(a,h,d,g,A){this.listener=a,this.proxy=null,this.src=h,this.type=d,this.capture=!!g,this.ha=A,this.key=++eT,this.da=this.fa=!1}function Fo(a){a.da=!0,a.listener=null,a.proxy=null,a.src=null,a.ha=null}function Uo(a){this.src=a,this.g={},this.h=0}Uo.prototype.add=function(a,h,d,g,A){var R=a.toString();a=this.g[R],a||(a=this.g[R]=[],this.h++);var O=Au(a,h,g,A);return-1<O?(h=a[O],d||(h.fa=!1)):(h=new tT(h,this.src,R,!!g,A),h.fa=d,a.push(h)),h};function Iu(a,h){var d=h.type;if(d in a.g){var g=a.g[d],A=Array.prototype.indexOf.call(g,h,void 0),R;(R=0<=A)&&Array.prototype.splice.call(g,A,1),R&&(Fo(h),a.g[d].length==0&&(delete a.g[d],a.h--))}}function Au(a,h,d,g){for(var A=0;A<a.length;++A){var R=a[A];if(!R.da&&R.listener==h&&R.capture==!!d&&R.ha==g)return A}return-1}var Su="closure_lm_"+(1e6*Math.random()|0),bu={};function fg(a,h,d,g,A){if(g&&g.once)return gg(a,h,d,g,A);if(Array.isArray(h)){for(var R=0;R<h.length;R++)fg(a,h[R],d,g,A);return null}return d=Du(d),a&&a[Ki]?a.K(h,d,l(g)?!!g.capture:!!g,A):pg(a,h,d,!1,g,A)}function pg(a,h,d,g,A,R){if(!h)throw Error("Invalid event type");var O=l(A)?!!A.capture:!!A,le=Cu(a);if(le||(a[Su]=le=new Uo(a)),d=le.add(h,d,g,O,R),d.proxy)return d;if(g=nT(),d.proxy=g,g.src=a,g.listener=d,a.addEventListener)JE||(A=O),A===void 0&&(A=!1),a.addEventListener(h.toString(),g,A);else if(a.attachEvent)a.attachEvent(yg(h.toString()),g);else if(a.addListener&&a.removeListener)a.addListener(g);else throw Error("addEventListener and attachEvent are unavailable.");return d}function nT(){function a(d){return h.call(a.src,a.listener,d)}let h=rT;return a}function gg(a,h,d,g,A){if(Array.isArray(h)){for(var R=0;R<h.length;R++)gg(a,h[R],d,g,A);return null}return d=Du(d),a&&a[Ki]?a.L(h,d,l(g)?!!g.capture:!!g,A):pg(a,h,d,!0,g,A)}function mg(a,h,d,g,A){if(Array.isArray(h))for(var R=0;R<h.length;R++)mg(a,h[R],d,g,A);else g=l(g)?!!g.capture:!!g,d=Du(d),a&&a[Ki]?(a=a.i,h=String(h).toString(),h in a.g&&(R=a.g[h],d=Au(R,d,g,A),-1<d&&(Fo(R[d]),Array.prototype.splice.call(R,d,1),R.length==0&&(delete a.g[h],a.h--)))):a&&(a=Cu(a))&&(h=a.g[h.toString()],a=-1,h&&(a=Au(h,d,g,A)),(d=-1<a?h[a]:null)&&Ru(d))}function Ru(a){if(typeof a!="number"&&a&&!a.da){var h=a.src;if(h&&h[Ki])Iu(h.i,a);else{var d=a.type,g=a.proxy;h.removeEventListener?h.removeEventListener(d,g,a.capture):h.detachEvent?h.detachEvent(yg(d),g):h.addListener&&h.removeListener&&h.removeListener(g),(d=Cu(h))?(Iu(d,a),d.h==0&&(d.src=null,h[Su]=null)):Fo(a)}}}function yg(a){return a in bu?bu[a]:bu[a]="on"+a}function rT(a,h){if(a.da)a=!0;else{h=new Gi(h,this);var d=a.listener,g=a.ha||a.src;a.fa&&Ru(a),a=d.call(g,h)}return a}function Cu(a){return a=a[Su],a instanceof Uo?a:null}var Pu="__closure_events_fn_"+(1e9*Math.random()>>>0);function Du(a){return typeof a=="function"?a:(a[Pu]||(a[Pu]=function(h){return a.handleEvent(h)}),a[Pu])}function Be(){fn.call(this),this.i=new Uo(this),this.M=this,this.F=null}x(Be,fn),Be.prototype[Ki]=!0,Be.prototype.removeEventListener=function(a,h,d,g){mg(this,a,h,d,g)};function He(a,h){var d,g=a.F;if(g)for(d=[];g;g=g.F)d.push(g);if(a=a.M,g=h.type||h,typeof h=="string")h=new ze(h,a);else if(h instanceof ze)h.target=h.target||a;else{var A=h;h=new ze(g,a),E(h,A)}if(A=!0,d)for(var R=d.length-1;0<=R;R--){var O=h.g=d[R];A=jo(O,g,!0,h)&&A}if(O=h.g=a,A=jo(O,g,!0,h)&&A,A=jo(O,g,!1,h)&&A,d)for(R=0;R<d.length;R++)O=h.g=d[R],A=jo(O,g,!1,h)&&A}Be.prototype.N=function(){if(Be.aa.N.call(this),this.i){var a=this.i,h;for(h in a.g){for(var d=a.g[h],g=0;g<d.length;g++)Fo(d[g]);delete a.g[h],a.h--}}this.F=null},Be.prototype.K=function(a,h,d,g){return this.i.add(String(a),h,!1,d,g)},Be.prototype.L=function(a,h,d,g){return this.i.add(String(a),h,!0,d,g)};function jo(a,h,d,g){if(h=a.i.g[String(h)],!h)return!0;h=h.concat();for(var A=!0,R=0;R<h.length;++R){var O=h[R];if(O&&!O.da&&O.capture==d){var le=O.listener,je=O.ha||O.src;O.fa&&Iu(a.i,O),A=le.call(je,g)!==!1&&A}}return A&&!g.defaultPrevented}function vg(a,h,d){if(typeof a=="function")d&&(a=m(a,d));else if(a&&typeof a.handleEvent=="function")a=m(a.handleEvent,a);else throw Error("Invalid listener argument");return 2147483647<Number(h)?-1:c.setTimeout(a,h||0)}function _g(a){a.g=vg(()=>{a.g=null,a.i&&(a.i=!1,_g(a))},a.l);let h=a.h;a.h=null,a.m.apply(null,h)}class iT extends fn{constructor(h,d){super(),this.m=h,this.l=d,this.h=null,this.i=!1,this.g=null}j(h){this.h=arguments,this.g?this.i=!0:_g(this)}N(){super.N(),this.g&&(c.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Wi(a){fn.call(this),this.h=a,this.g={}}x(Wi,fn);var wg=[];function Eg(a){Y(a.g,function(h,d){this.g.hasOwnProperty(d)&&Ru(h)},a),a.g={}}Wi.prototype.N=function(){Wi.aa.N.call(this),Eg(this)},Wi.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var xu=c.JSON.stringify,sT=c.JSON.parse,oT=class{stringify(a){return c.JSON.stringify(a,void 0)}parse(a){return c.JSON.parse(a,void 0)}};function Nu(){}Nu.prototype.h=null;function Tg(a){return a.h||(a.h=a.i())}function Ig(){}var Hi={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function ku(){ze.call(this,"d")}x(ku,ze);function Mu(){ze.call(this,"c")}x(Mu,ze);var qn={},Ag=null;function $o(){return Ag=Ag||new Be}qn.La="serverreachability";function Sg(a){ze.call(this,qn.La,a)}x(Sg,ze);function Qi(a){let h=$o();He(h,new Sg(h))}qn.STAT_EVENT="statevent";function bg(a,h){ze.call(this,qn.STAT_EVENT,a),this.stat=h}x(bg,ze);function Qe(a){let h=$o();He(h,new bg(h,a))}qn.Ma="timingevent";function Rg(a,h){ze.call(this,qn.Ma,a),this.size=h}x(Rg,ze);function Yi(a,h){if(typeof a!="function")throw Error("Fn must not be null and must be a function");return c.setTimeout(function(){a()},h)}function Xi(){this.g=!0}Xi.prototype.xa=function(){this.g=!1};function aT(a,h,d,g,A,R){a.info(function(){if(a.g)if(R)for(var O="",le=R.split("&"),je=0;je<le.length;je++){var ae=le[je].split("=");if(1<ae.length){var qe=ae[0];ae=ae[1];var Ge=qe.split("_");O=2<=Ge.length&&Ge[1]=="type"?O+(qe+"="+ae+"&"):O+(qe+"=redacted&")}}else O=null;else O=R;return"XMLHTTP REQ ("+g+") [attempt "+A+"]: "+h+`
`+d+`
`+O})}function cT(a,h,d,g,A,R,O){a.info(function(){return"XMLHTTP RESP ("+g+") [ attempt "+A+"]: "+h+`
`+d+`
`+R+" "+O})}function Pr(a,h,d,g){a.info(function(){return"XMLHTTP TEXT ("+h+"): "+lT(a,d)+(g?" "+g:"")})}function uT(a,h){a.info(function(){return"TIMEOUT: "+h})}Xi.prototype.info=function(){};function lT(a,h){if(!a.g)return h;if(!h)return null;try{var d=JSON.parse(h);if(d){for(a=0;a<d.length;a++)if(Array.isArray(d[a])){var g=d[a];if(!(2>g.length)){var A=g[1];if(Array.isArray(A)&&!(1>A.length)){var R=A[0];if(R!="noop"&&R!="stop"&&R!="close")for(var O=1;O<A.length;O++)A[O]=""}}}}return xu(d)}catch{return h}}var zo={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},Cg={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},Ou;function Bo(){}x(Bo,Nu),Bo.prototype.g=function(){return new XMLHttpRequest},Bo.prototype.i=function(){return{}},Ou=new Bo;function pn(a,h,d,g){this.j=a,this.i=h,this.l=d,this.R=g||1,this.U=new Wi(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new Pg}function Pg(){this.i=null,this.g="",this.h=!1}var Dg={},Vu={};function Lu(a,h,d){a.L=1,a.v=Wo(Kt(h)),a.m=d,a.P=!0,xg(a,null)}function xg(a,h){a.F=Date.now(),qo(a),a.A=Kt(a.v);var d=a.A,g=a.R;Array.isArray(g)||(g=[String(g)]),Gg(d.i,"t",g),a.C=0,d=a.j.J,a.h=new Pg,a.g=um(a.j,d?h:null,!a.m),0<a.O&&(a.M=new iT(m(a.Y,a,a.g),a.O)),h=a.U,d=a.g,g=a.ca;var A="readystatechange";Array.isArray(A)||(A&&(wg[0]=A.toString()),A=wg);for(var R=0;R<A.length;R++){var O=fg(d,A[R],g||h.handleEvent,!1,h.h||h);if(!O)break;h.g[O.key]=O}h=a.H?y(a.H):{},a.m?(a.u||(a.u="POST"),h["Content-Type"]="application/x-www-form-urlencoded",a.g.ea(a.A,a.u,a.m,h)):(a.u="GET",a.g.ea(a.A,a.u,null,h)),Qi(),aT(a.i,a.u,a.A,a.l,a.R,a.m)}pn.prototype.ca=function(a){a=a.target;let h=this.M;h&&Wt(a)==3?h.j():this.Y(a)},pn.prototype.Y=function(a){try{if(a==this.g)e:{let Ge=Wt(this.g);var h=this.g.Ba();let Nr=this.g.Z();if(!(3>Ge)&&(Ge!=3||this.g&&(this.h.h||this.g.oa()||Jg(this.g)))){this.J||Ge!=4||h==7||(h==8||0>=Nr?Qi(3):Qi(2)),Fu(this);var d=this.g.Z();this.X=d;t:if(Ng(this)){var g=Jg(this.g);a="";var A=g.length,R=Wt(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){Gn(this),Ji(this);var O="";break t}this.h.i=new c.TextDecoder}for(h=0;h<A;h++)this.h.h=!0,a+=this.h.i.decode(g[h],{stream:!(R&&h==A-1)});g.length=0,this.h.g+=a,this.C=0,O=this.h.g}else O=this.g.oa();if(this.o=d==200,cT(this.i,this.u,this.A,this.l,this.R,Ge,d),this.o){if(this.T&&!this.K){t:{if(this.g){var le,je=this.g;if((le=je.g?je.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!G(le)){var ae=le;break t}}ae=null}if(d=ae)Pr(this.i,this.l,d,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,Uu(this,d);else{this.o=!1,this.s=3,Qe(12),Gn(this),Ji(this);break e}}if(this.P){d=!0;let vt;for(;!this.J&&this.C<O.length;)if(vt=hT(this,O),vt==Vu){Ge==4&&(this.s=4,Qe(14),d=!1),Pr(this.i,this.l,null,"[Incomplete Response]");break}else if(vt==Dg){this.s=4,Qe(15),Pr(this.i,this.l,O,"[Invalid Chunk]"),d=!1;break}else Pr(this.i,this.l,vt,null),Uu(this,vt);if(Ng(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),Ge!=4||O.length!=0||this.h.h||(this.s=1,Qe(16),d=!1),this.o=this.o&&d,!d)Pr(this.i,this.l,O,"[Invalid Chunked Response]"),Gn(this),Ji(this);else if(0<O.length&&!this.W){this.W=!0;var qe=this.j;qe.g==this&&qe.ba&&!qe.M&&(qe.j.info("Great, no buffering proxy detected. Bytes received: "+O.length),Gu(qe),qe.M=!0,Qe(11))}}else Pr(this.i,this.l,O,null),Uu(this,O);Ge==4&&Gn(this),this.o&&!this.J&&(Ge==4?sm(this.j,this):(this.o=!1,qo(this)))}else CT(this.g),d==400&&0<O.indexOf("Unknown SID")?(this.s=3,Qe(12)):(this.s=0,Qe(13)),Gn(this),Ji(this)}}}catch{}finally{}};function Ng(a){return a.g?a.u=="GET"&&a.L!=2&&a.j.Ca:!1}function hT(a,h){var d=a.C,g=h.indexOf(`
`,d);return g==-1?Vu:(d=Number(h.substring(d,g)),isNaN(d)?Dg:(g+=1,g+d>h.length?Vu:(h=h.slice(g,g+d),a.C=g+d,h)))}pn.prototype.cancel=function(){this.J=!0,Gn(this)};function qo(a){a.S=Date.now()+a.I,kg(a,a.I)}function kg(a,h){if(a.B!=null)throw Error("WatchDog timer not null");a.B=Yi(m(a.ba,a),h)}function Fu(a){a.B&&(c.clearTimeout(a.B),a.B=null)}pn.prototype.ba=function(){this.B=null;let a=Date.now();0<=a-this.S?(uT(this.i,this.A),this.L!=2&&(Qi(),Qe(17)),Gn(this),this.s=2,Ji(this)):kg(this,this.S-a)};function Ji(a){a.j.G==0||a.J||sm(a.j,a)}function Gn(a){Fu(a);var h=a.M;h&&typeof h.ma=="function"&&h.ma(),a.M=null,Eg(a.U),a.g&&(h=a.g,a.g=null,h.abort(),h.ma())}function Uu(a,h){try{var d=a.j;if(d.G!=0&&(d.g==a||ju(d.h,a))){if(!a.K&&ju(d.h,a)&&d.G==3){try{var g=d.Da.g.parse(h)}catch{g=null}if(Array.isArray(g)&&g.length==3){var A=g;if(A[0]==0){e:if(!d.u){if(d.g)if(d.g.F+3e3<a.F)Jo(d),Yo(d);else break e;qu(d),Qe(18)}}else d.za=A[1],0<d.za-d.T&&37500>A[2]&&d.F&&d.v==0&&!d.C&&(d.C=Yi(m(d.Za,d),6e3));if(1>=Vg(d.h)&&d.ca){try{d.ca()}catch{}d.ca=void 0}}else Wn(d,11)}else if((a.K||d.g==a)&&Jo(d),!G(h))for(A=d.Da.g.parse(h),h=0;h<A.length;h++){let ae=A[h];if(d.T=ae[0],ae=ae[1],d.G==2)if(ae[0]=="c"){d.K=ae[1],d.ia=ae[2];let qe=ae[3];qe!=null&&(d.la=qe,d.j.info("VER="+d.la));let Ge=ae[4];Ge!=null&&(d.Aa=Ge,d.j.info("SVER="+d.Aa));let Nr=ae[5];Nr!=null&&typeof Nr=="number"&&0<Nr&&(g=1.5*Nr,d.L=g,d.j.info("backChannelRequestTimeoutMs_="+g)),g=d;let vt=a.g;if(vt){let ea=vt.g?vt.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(ea){var R=g.h;R.g||ea.indexOf("spdy")==-1&&ea.indexOf("quic")==-1&&ea.indexOf("h2")==-1||(R.j=R.l,R.g=new Set,R.h&&($u(R,R.h),R.h=null))}if(g.D){let Ku=vt.g?vt.g.getResponseHeader("X-HTTP-Session-Id"):null;Ku&&(g.ya=Ku,fe(g.I,g.D,Ku))}}d.G=3,d.l&&d.l.ua(),d.ba&&(d.R=Date.now()-a.F,d.j.info("Handshake RTT: "+d.R+"ms")),g=d;var O=a;if(g.qa=cm(g,g.J?g.ia:null,g.W),O.K){Lg(g.h,O);var le=O,je=g.L;je&&(le.I=je),le.B&&(Fu(le),qo(le)),g.g=O}else rm(g);0<d.i.length&&Xo(d)}else ae[0]!="stop"&&ae[0]!="close"||Wn(d,7);else d.G==3&&(ae[0]=="stop"||ae[0]=="close"?ae[0]=="stop"?Wn(d,7):Bu(d):ae[0]!="noop"&&d.l&&d.l.ta(ae),d.v=0)}}Qi(4)}catch{}}var dT=class{constructor(a,h){this.g=a,this.map=h}};function Mg(a){this.l=a||10,c.PerformanceNavigationTiming?(a=c.performance.getEntriesByType("navigation"),a=0<a.length&&(a[0].nextHopProtocol=="hq"||a[0].nextHopProtocol=="h2")):a=!!(c.chrome&&c.chrome.loadTimes&&c.chrome.loadTimes()&&c.chrome.loadTimes().wasFetchedViaSpdy),this.j=a?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function Og(a){return a.h?!0:a.g?a.g.size>=a.j:!1}function Vg(a){return a.h?1:a.g?a.g.size:0}function ju(a,h){return a.h?a.h==h:a.g?a.g.has(h):!1}function $u(a,h){a.g?a.g.add(h):a.h=h}function Lg(a,h){a.h&&a.h==h?a.h=null:a.g&&a.g.has(h)&&a.g.delete(h)}Mg.prototype.cancel=function(){if(this.i=Fg(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(let a of this.g.values())a.cancel();this.g.clear()}};function Fg(a){if(a.h!=null)return a.i.concat(a.h.D);if(a.g!=null&&a.g.size!==0){let h=a.i;for(let d of a.g.values())h=h.concat(d.D);return h}return N(a.i)}function fT(a){if(a.V&&typeof a.V=="function")return a.V();if(typeof Map<"u"&&a instanceof Map||typeof Set<"u"&&a instanceof Set)return Array.from(a.values());if(typeof a=="string")return a.split("");if(u(a)){for(var h=[],d=a.length,g=0;g<d;g++)h.push(a[g]);return h}h=[],d=0;for(g in a)h[d++]=a[g];return h}function pT(a){if(a.na&&typeof a.na=="function")return a.na();if(!a.V||typeof a.V!="function"){if(typeof Map<"u"&&a instanceof Map)return Array.from(a.keys());if(!(typeof Set<"u"&&a instanceof Set)){if(u(a)||typeof a=="string"){var h=[];a=a.length;for(var d=0;d<a;d++)h.push(d);return h}h=[],d=0;for(let g in a)h[d++]=g;return h}}}function Ug(a,h){if(a.forEach&&typeof a.forEach=="function")a.forEach(h,void 0);else if(u(a)||typeof a=="string")Array.prototype.forEach.call(a,h,void 0);else for(var d=pT(a),g=fT(a),A=g.length,R=0;R<A;R++)h.call(void 0,g[R],d&&d[R],a)}var jg=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function gT(a,h){if(a){a=a.split("&");for(var d=0;d<a.length;d++){var g=a[d].indexOf("="),A=null;if(0<=g){var R=a[d].substring(0,g);A=a[d].substring(g+1)}else R=a[d];h(R,A?decodeURIComponent(A.replace(/\+/g," ")):"")}}}function Kn(a){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,a instanceof Kn){this.h=a.h,Go(this,a.j),this.o=a.o,this.g=a.g,Ko(this,a.s),this.l=a.l;var h=a.i,d=new ts;d.i=h.i,h.g&&(d.g=new Map(h.g),d.h=h.h),$g(this,d),this.m=a.m}else a&&(h=String(a).match(jg))?(this.h=!1,Go(this,h[1]||"",!0),this.o=Zi(h[2]||""),this.g=Zi(h[3]||"",!0),Ko(this,h[4]),this.l=Zi(h[5]||"",!0),$g(this,h[6]||"",!0),this.m=Zi(h[7]||"")):(this.h=!1,this.i=new ts(null,this.h))}Kn.prototype.toString=function(){var a=[],h=this.j;h&&a.push(es(h,zg,!0),":");var d=this.g;return(d||h=="file")&&(a.push("//"),(h=this.o)&&a.push(es(h,zg,!0),"@"),a.push(encodeURIComponent(String(d)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),d=this.s,d!=null&&a.push(":",String(d))),(d=this.l)&&(this.g&&d.charAt(0)!="/"&&a.push("/"),a.push(es(d,d.charAt(0)=="/"?vT:yT,!0))),(d=this.i.toString())&&a.push("?",d),(d=this.m)&&a.push("#",es(d,wT)),a.join("")};function Kt(a){return new Kn(a)}function Go(a,h,d){a.j=d?Zi(h,!0):h,a.j&&(a.j=a.j.replace(/:$/,""))}function Ko(a,h){if(h){if(h=Number(h),isNaN(h)||0>h)throw Error("Bad port number "+h);a.s=h}else a.s=null}function $g(a,h,d){h instanceof ts?(a.i=h,ET(a.i,a.h)):(d||(h=es(h,_T)),a.i=new ts(h,a.h))}function fe(a,h,d){a.i.set(h,d)}function Wo(a){return fe(a,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),a}function Zi(a,h){return a?h?decodeURI(a.replace(/%25/g,"%2525")):decodeURIComponent(a):""}function es(a,h,d){return typeof a=="string"?(a=encodeURI(a).replace(h,mT),d&&(a=a.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),a):null}function mT(a){return a=a.charCodeAt(0),"%"+(a>>4&15).toString(16)+(a&15).toString(16)}var zg=/[#\/\?@]/g,yT=/[#\?:]/g,vT=/[#\?]/g,_T=/[#\?@]/g,wT=/#/g;function ts(a,h){this.h=this.g=null,this.i=a||null,this.j=!!h}function gn(a){a.g||(a.g=new Map,a.h=0,a.i&&gT(a.i,function(h,d){a.add(decodeURIComponent(h.replace(/\+/g," ")),d)}))}r=ts.prototype,r.add=function(a,h){gn(this),this.i=null,a=Dr(this,a);var d=this.g.get(a);return d||this.g.set(a,d=[]),d.push(h),this.h+=1,this};function Bg(a,h){gn(a),h=Dr(a,h),a.g.has(h)&&(a.i=null,a.h-=a.g.get(h).length,a.g.delete(h))}function qg(a,h){return gn(a),h=Dr(a,h),a.g.has(h)}r.forEach=function(a,h){gn(this),this.g.forEach(function(d,g){d.forEach(function(A){a.call(h,A,g,this)},this)},this)},r.na=function(){gn(this);let a=Array.from(this.g.values()),h=Array.from(this.g.keys()),d=[];for(let g=0;g<h.length;g++){let A=a[g];for(let R=0;R<A.length;R++)d.push(h[g])}return d},r.V=function(a){gn(this);let h=[];if(typeof a=="string")qg(this,a)&&(h=h.concat(this.g.get(Dr(this,a))));else{a=Array.from(this.g.values());for(let d=0;d<a.length;d++)h=h.concat(a[d])}return h},r.set=function(a,h){return gn(this),this.i=null,a=Dr(this,a),qg(this,a)&&(this.h-=this.g.get(a).length),this.g.set(a,[h]),this.h+=1,this},r.get=function(a,h){return a?(a=this.V(a),0<a.length?String(a[0]):h):h};function Gg(a,h,d){Bg(a,h),0<d.length&&(a.i=null,a.g.set(Dr(a,h),N(d)),a.h+=d.length)}r.toString=function(){if(this.i)return this.i;if(!this.g)return"";let a=[],h=Array.from(this.g.keys());for(var d=0;d<h.length;d++){var g=h[d];let R=encodeURIComponent(String(g)),O=this.V(g);for(g=0;g<O.length;g++){var A=R;O[g]!==""&&(A+="="+encodeURIComponent(String(O[g]))),a.push(A)}}return this.i=a.join("&")};function Dr(a,h){return h=String(h),a.j&&(h=h.toLowerCase()),h}function ET(a,h){h&&!a.j&&(gn(a),a.i=null,a.g.forEach(function(d,g){var A=g.toLowerCase();g!=A&&(Bg(this,g),Gg(this,A,d))},a)),a.j=h}function TT(a,h){let d=new Xi;if(c.Image){let g=new Image;g.onload=T(mn,d,"TestLoadImage: loaded",!0,h,g),g.onerror=T(mn,d,"TestLoadImage: error",!1,h,g),g.onabort=T(mn,d,"TestLoadImage: abort",!1,h,g),g.ontimeout=T(mn,d,"TestLoadImage: timeout",!1,h,g),c.setTimeout(function(){g.ontimeout&&g.ontimeout()},1e4),g.src=a}else h(!1)}function IT(a,h){let d=new Xi,g=new AbortController,A=setTimeout(()=>{g.abort(),mn(d,"TestPingServer: timeout",!1,h)},1e4);fetch(a,{signal:g.signal}).then(R=>{clearTimeout(A),R.ok?mn(d,"TestPingServer: ok",!0,h):mn(d,"TestPingServer: server error",!1,h)}).catch(()=>{clearTimeout(A),mn(d,"TestPingServer: error",!1,h)})}function mn(a,h,d,g,A){try{A&&(A.onload=null,A.onerror=null,A.onabort=null,A.ontimeout=null),g(d)}catch{}}function AT(){this.g=new oT}function ST(a,h,d){let g=d||"";try{Ug(a,function(A,R){let O=A;l(A)&&(O=xu(A)),h.push(g+R+"="+encodeURIComponent(O))})}catch(A){throw h.push(g+"type="+encodeURIComponent("_badmap")),A}}function ns(a){this.l=a.Ub||null,this.j=a.eb||!1}x(ns,Nu),ns.prototype.g=function(){return new Ho(this.l,this.j)},ns.prototype.i=function(a){return function(){return a}}({});function Ho(a,h){Be.call(this),this.D=a,this.o=h,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}x(Ho,Be),r=Ho.prototype,r.open=function(a,h){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=a,this.A=h,this.readyState=1,is(this)},r.send=function(a){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;let h={headers:this.u,method:this.B,credentials:this.m,cache:void 0};a&&(h.body=a),(this.D||c).fetch(new Request(this.A,h)).then(this.Sa.bind(this),this.ga.bind(this))},r.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,rs(this)),this.readyState=0},r.Sa=function(a){if(this.g&&(this.l=a,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=a.headers,this.readyState=2,is(this)),this.g&&(this.readyState=3,is(this),this.g)))if(this.responseType==="arraybuffer")a.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof c.ReadableStream<"u"&&"body"in a){if(this.j=a.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;Kg(this)}else a.text().then(this.Ra.bind(this),this.ga.bind(this))};function Kg(a){a.j.read().then(a.Pa.bind(a)).catch(a.ga.bind(a))}r.Pa=function(a){if(this.g){if(this.o&&a.value)this.response.push(a.value);else if(!this.o){var h=a.value?a.value:new Uint8Array(0);(h=this.v.decode(h,{stream:!a.done}))&&(this.response=this.responseText+=h)}a.done?rs(this):is(this),this.readyState==3&&Kg(this)}},r.Ra=function(a){this.g&&(this.response=this.responseText=a,rs(this))},r.Qa=function(a){this.g&&(this.response=a,rs(this))},r.ga=function(){this.g&&rs(this)};function rs(a){a.readyState=4,a.l=null,a.j=null,a.v=null,is(a)}r.setRequestHeader=function(a,h){this.u.append(a,h)},r.getResponseHeader=function(a){return this.h&&this.h.get(a.toLowerCase())||""},r.getAllResponseHeaders=function(){if(!this.h)return"";let a=[],h=this.h.entries();for(var d=h.next();!d.done;)d=d.value,a.push(d[0]+": "+d[1]),d=h.next();return a.join(`\r
`)};function is(a){a.onreadystatechange&&a.onreadystatechange.call(a)}Object.defineProperty(Ho.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(a){this.m=a?"include":"same-origin"}});function Wg(a){let h="";return Y(a,function(d,g){h+=g,h+=":",h+=d,h+=`\r
`}),h}function zu(a,h,d){e:{for(g in d){var g=!1;break e}g=!0}g||(d=Wg(d),typeof a=="string"?d!=null&&encodeURIComponent(String(d)):fe(a,h,d))}function we(a){Be.call(this),this.headers=new Map,this.o=a||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}x(we,Be);var bT=/^https?$/i,RT=["POST","PUT"];r=we.prototype,r.Ha=function(a){this.J=a},r.ea=function(a,h,d,g){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+a);h=h?h.toUpperCase():"GET",this.D=a,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():Ou.g(),this.v=this.o?Tg(this.o):Tg(Ou),this.g.onreadystatechange=m(this.Ea,this);try{this.B=!0,this.g.open(h,String(a),!0),this.B=!1}catch(R){Hg(this,R);return}if(a=d||"",d=new Map(this.headers),g)if(Object.getPrototypeOf(g)===Object.prototype)for(var A in g)d.set(A,g[A]);else if(typeof g.keys=="function"&&typeof g.get=="function")for(let R of g.keys())d.set(R,g.get(R));else throw Error("Unknown input type for opt_headers: "+String(g));g=Array.from(d.keys()).find(R=>R.toLowerCase()=="content-type"),A=c.FormData&&a instanceof c.FormData,!(0<=Array.prototype.indexOf.call(RT,h,void 0))||g||A||d.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(let[R,O]of d)this.g.setRequestHeader(R,O);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{Xg(this),this.u=!0,this.g.send(a),this.u=!1}catch(R){Hg(this,R)}};function Hg(a,h){a.h=!1,a.g&&(a.j=!0,a.g.abort(),a.j=!1),a.l=h,a.m=5,Qg(a),Qo(a)}function Qg(a){a.A||(a.A=!0,He(a,"complete"),He(a,"error"))}r.abort=function(a){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=a||7,He(this,"complete"),He(this,"abort"),Qo(this))},r.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Qo(this,!0)),we.aa.N.call(this)},r.Ea=function(){this.s||(this.B||this.u||this.j?Yg(this):this.bb())},r.bb=function(){Yg(this)};function Yg(a){if(a.h&&typeof o<"u"&&(!a.v[1]||Wt(a)!=4||a.Z()!=2)){if(a.u&&Wt(a)==4)vg(a.Ea,0,a);else if(He(a,"readystatechange"),Wt(a)==4){a.h=!1;try{let O=a.Z();e:switch(O){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var h=!0;break e;default:h=!1}var d;if(!(d=h)){var g;if(g=O===0){var A=String(a.D).match(jg)[1]||null;!A&&c.self&&c.self.location&&(A=c.self.location.protocol.slice(0,-1)),g=!bT.test(A?A.toLowerCase():"")}d=g}if(d)He(a,"complete"),He(a,"success");else{a.m=6;try{var R=2<Wt(a)?a.g.statusText:""}catch{R=""}a.l=R+" ["+a.Z()+"]",Qg(a)}}finally{Qo(a)}}}}function Qo(a,h){if(a.g){Xg(a);let d=a.g,g=a.v[0]?()=>{}:null;a.g=null,a.v=null,h||He(a,"ready");try{d.onreadystatechange=g}catch{}}}function Xg(a){a.I&&(c.clearTimeout(a.I),a.I=null)}r.isActive=function(){return!!this.g};function Wt(a){return a.g?a.g.readyState:0}r.Z=function(){try{return 2<Wt(this)?this.g.status:-1}catch{return-1}},r.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},r.Oa=function(a){if(this.g){var h=this.g.responseText;return a&&h.indexOf(a)==0&&(h=h.substring(a.length)),sT(h)}};function Jg(a){try{if(!a.g)return null;if("response"in a.g)return a.g.response;switch(a.H){case"":case"text":return a.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in a.g)return a.g.mozResponseArrayBuffer}return null}catch{return null}}function CT(a){let h={};a=(a.g&&2<=Wt(a)&&a.g.getAllResponseHeaders()||"").split(`\r
`);for(let g=0;g<a.length;g++){if(G(a[g]))continue;var d=I(a[g]);let A=d[0];if(d=d[1],typeof d!="string")continue;d=d.trim();let R=h[A]||[];h[A]=R,R.push(d)}w(h,function(g){return g.join(", ")})}r.Ba=function(){return this.m},r.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function ss(a,h,d){return d&&d.internalChannelParams&&d.internalChannelParams[a]||h}function Zg(a){this.Aa=0,this.i=[],this.j=new Xi,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=ss("failFast",!1,a),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=ss("baseRetryDelayMs",5e3,a),this.cb=ss("retryDelaySeedMs",1e4,a),this.Wa=ss("forwardChannelMaxRetries",2,a),this.wa=ss("forwardChannelRequestTimeoutMs",2e4,a),this.pa=a&&a.xmlHttpFactory||void 0,this.Xa=a&&a.Tb||void 0,this.Ca=a&&a.useFetchStreams||!1,this.L=void 0,this.J=a&&a.supportsCrossDomainXhr||!1,this.K="",this.h=new Mg(a&&a.concurrentRequestLimit),this.Da=new AT,this.P=a&&a.fastHandshake||!1,this.O=a&&a.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=a&&a.Rb||!1,a&&a.xa&&this.j.xa(),a&&a.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&a&&a.detectBufferingProxy||!1,this.ja=void 0,a&&a.longPollingTimeout&&0<a.longPollingTimeout&&(this.ja=a.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}r=Zg.prototype,r.la=8,r.G=1,r.connect=function(a,h,d,g){Qe(0),this.W=a,this.H=h||{},d&&g!==void 0&&(this.H.OSID=d,this.H.OAID=g),this.F=this.X,this.I=cm(this,null,this.W),Xo(this)};function Bu(a){if(em(a),a.G==3){var h=a.U++,d=Kt(a.I);if(fe(d,"SID",a.K),fe(d,"RID",h),fe(d,"TYPE","terminate"),os(a,d),h=new pn(a,a.j,h),h.L=2,h.v=Wo(Kt(d)),d=!1,c.navigator&&c.navigator.sendBeacon)try{d=c.navigator.sendBeacon(h.v.toString(),"")}catch{}!d&&c.Image&&(new Image().src=h.v,d=!0),d||(h.g=um(h.j,null),h.g.ea(h.v)),h.F=Date.now(),qo(h)}am(a)}function Yo(a){a.g&&(Gu(a),a.g.cancel(),a.g=null)}function em(a){Yo(a),a.u&&(c.clearTimeout(a.u),a.u=null),Jo(a),a.h.cancel(),a.s&&(typeof a.s=="number"&&c.clearTimeout(a.s),a.s=null)}function Xo(a){if(!Og(a.h)&&!a.s){a.s=!0;var h=a.Ga;Bi||dg(),qi||(Bi(),qi=!0),Tu.add(h,a),a.B=0}}function PT(a,h){return Vg(a.h)>=a.h.j-(a.s?1:0)?!1:a.s?(a.i=h.D.concat(a.i),!0):a.G==1||a.G==2||a.B>=(a.Va?0:a.Wa)?!1:(a.s=Yi(m(a.Ga,a,h),om(a,a.B)),a.B++,!0)}r.Ga=function(a){if(this.s)if(this.s=null,this.G==1){if(!a){this.U=Math.floor(1e5*Math.random()),a=this.U++;let A=new pn(this,this.j,a),R=this.o;if(this.S&&(R?(R=y(R),E(R,this.S)):R=this.S),this.m!==null||this.O||(A.H=R,R=null),this.P)e:{for(var h=0,d=0;d<this.i.length;d++){t:{var g=this.i[d];if("__data__"in g.map&&(g=g.map.__data__,typeof g=="string")){g=g.length;break t}g=void 0}if(g===void 0)break;if(h+=g,4096<h){h=d;break e}if(h===4096||d===this.i.length-1){h=d+1;break e}}h=1e3}else h=1e3;h=nm(this,A,h),d=Kt(this.I),fe(d,"RID",a),fe(d,"CVER",22),this.D&&fe(d,"X-HTTP-Session-Id",this.D),os(this,d),R&&(this.O?h="headers="+encodeURIComponent(String(Wg(R)))+"&"+h:this.m&&zu(d,this.m,R)),$u(this.h,A),this.Ua&&fe(d,"TYPE","init"),this.P?(fe(d,"$req",h),fe(d,"SID","null"),A.T=!0,Lu(A,d,null)):Lu(A,d,h),this.G=2}}else this.G==3&&(a?tm(this,a):this.i.length==0||Og(this.h)||tm(this))};function tm(a,h){var d;h?d=h.l:d=a.U++;let g=Kt(a.I);fe(g,"SID",a.K),fe(g,"RID",d),fe(g,"AID",a.T),os(a,g),a.m&&a.o&&zu(g,a.m,a.o),d=new pn(a,a.j,d,a.B+1),a.m===null&&(d.H=a.o),h&&(a.i=h.D.concat(a.i)),h=nm(a,d,1e3),d.I=Math.round(.5*a.wa)+Math.round(.5*a.wa*Math.random()),$u(a.h,d),Lu(d,g,h)}function os(a,h){a.H&&Y(a.H,function(d,g){fe(h,g,d)}),a.l&&Ug({},function(d,g){fe(h,g,d)})}function nm(a,h,d){d=Math.min(a.i.length,d);var g=a.l?m(a.l.Na,a.l,a):null;e:{var A=a.i;let R=-1;for(;;){let O=["count="+d];R==-1?0<d?(R=A[0].g,O.push("ofs="+R)):R=0:O.push("ofs="+R);let le=!0;for(let je=0;je<d;je++){let ae=A[je].g,qe=A[je].map;if(ae-=R,0>ae)R=Math.max(0,A[je].g-100),le=!1;else try{ST(qe,O,"req"+ae+"_")}catch{g&&g(qe)}}if(le){g=O.join("&");break e}}}return a=a.i.splice(0,d),h.D=a,g}function rm(a){if(!a.g&&!a.u){a.Y=1;var h=a.Fa;Bi||dg(),qi||(Bi(),qi=!0),Tu.add(h,a),a.v=0}}function qu(a){return a.g||a.u||3<=a.v?!1:(a.Y++,a.u=Yi(m(a.Fa,a),om(a,a.v)),a.v++,!0)}r.Fa=function(){if(this.u=null,im(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var a=2*this.R;this.j.info("BP detection timer enabled: "+a),this.A=Yi(m(this.ab,this),a)}},r.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,Qe(10),Yo(this),im(this))};function Gu(a){a.A!=null&&(c.clearTimeout(a.A),a.A=null)}function im(a){a.g=new pn(a,a.j,"rpc",a.Y),a.m===null&&(a.g.H=a.o),a.g.O=0;var h=Kt(a.qa);fe(h,"RID","rpc"),fe(h,"SID",a.K),fe(h,"AID",a.T),fe(h,"CI",a.F?"0":"1"),!a.F&&a.ja&&fe(h,"TO",a.ja),fe(h,"TYPE","xmlhttp"),os(a,h),a.m&&a.o&&zu(h,a.m,a.o),a.L&&(a.g.I=a.L);var d=a.g;a=a.ia,d.L=1,d.v=Wo(Kt(h)),d.m=null,d.P=!0,xg(d,a)}r.Za=function(){this.C!=null&&(this.C=null,Yo(this),qu(this),Qe(19))};function Jo(a){a.C!=null&&(c.clearTimeout(a.C),a.C=null)}function sm(a,h){var d=null;if(a.g==h){Jo(a),Gu(a),a.g=null;var g=2}else if(ju(a.h,h))d=h.D,Lg(a.h,h),g=1;else return;if(a.G!=0){if(h.o)if(g==1){d=h.m?h.m.length:0,h=Date.now()-h.F;var A=a.B;g=$o(),He(g,new Rg(g,d)),Xo(a)}else rm(a);else if(A=h.s,A==3||A==0&&0<h.X||!(g==1&&PT(a,h)||g==2&&qu(a)))switch(d&&0<d.length&&(h=a.h,h.i=h.i.concat(d)),A){case 1:Wn(a,5);break;case 4:Wn(a,10);break;case 3:Wn(a,6);break;default:Wn(a,2)}}}function om(a,h){let d=a.Ta+Math.floor(Math.random()*a.cb);return a.isActive()||(d*=2),d*h}function Wn(a,h){if(a.j.info("Error code "+h),h==2){var d=m(a.fb,a),g=a.Xa;let A=!g;g=new Kn(g||"//www.google.com/images/cleardot.gif"),c.location&&c.location.protocol=="http"||Go(g,"https"),Wo(g),A?TT(g.toString(),d):IT(g.toString(),d)}else Qe(2);a.G=0,a.l&&a.l.sa(h),am(a),em(a)}r.fb=function(a){a?(this.j.info("Successfully pinged google.com"),Qe(2)):(this.j.info("Failed to ping google.com"),Qe(1))};function am(a){if(a.G=0,a.ka=[],a.l){let h=Fg(a.h);(h.length!=0||a.i.length!=0)&&(D(a.ka,h),D(a.ka,a.i),a.h.i.length=0,N(a.i),a.i.length=0),a.l.ra()}}function cm(a,h,d){var g=d instanceof Kn?Kt(d):new Kn(d);if(g.g!="")h&&(g.g=h+"."+g.g),Ko(g,g.s);else{var A=c.location;g=A.protocol,h=h?h+"."+A.hostname:A.hostname,A=+A.port;var R=new Kn(null);g&&Go(R,g),h&&(R.g=h),A&&Ko(R,A),d&&(R.l=d),g=R}return d=a.D,h=a.ya,d&&h&&fe(g,d,h),fe(g,"VER",a.la),os(a,g),g}function um(a,h,d){if(h&&!a.J)throw Error("Can't create secondary domain capable XhrIo object.");return h=a.Ca&&!a.pa?new we(new ns({eb:d})):new we(a.pa),h.Ha(a.J),h}r.isActive=function(){return!!this.l&&this.l.isActive(this)};function lm(){}r=lm.prototype,r.ua=function(){},r.ta=function(){},r.sa=function(){},r.ra=function(){},r.isActive=function(){return!0},r.Na=function(){};function Zo(){}Zo.prototype.g=function(a,h){return new nt(a,h)};function nt(a,h){Be.call(this),this.g=new Zg(h),this.l=a,this.h=h&&h.messageUrlParams||null,a=h&&h.messageHeaders||null,h&&h.clientProtocolHeaderRequired&&(a?a["X-Client-Protocol"]="webchannel":a={"X-Client-Protocol":"webchannel"}),this.g.o=a,a=h&&h.initMessageHeaders||null,h&&h.messageContentType&&(a?a["X-WebChannel-Content-Type"]=h.messageContentType:a={"X-WebChannel-Content-Type":h.messageContentType}),h&&h.va&&(a?a["X-WebChannel-Client-Profile"]=h.va:a={"X-WebChannel-Client-Profile":h.va}),this.g.S=a,(a=h&&h.Sb)&&!G(a)&&(this.g.m=a),this.v=h&&h.supportsCrossDomainXhr||!1,this.u=h&&h.sendRawJson||!1,(h=h&&h.httpSessionIdParam)&&!G(h)&&(this.g.D=h,a=this.h,a!==null&&h in a&&(a=this.h,h in a&&delete a[h])),this.j=new xr(this)}x(nt,Be),nt.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},nt.prototype.close=function(){Bu(this.g)},nt.prototype.o=function(a){var h=this.g;if(typeof a=="string"){var d={};d.__data__=a,a=d}else this.u&&(d={},d.__data__=xu(a),a=d);h.i.push(new dT(h.Ya++,a)),h.G==3&&Xo(h)},nt.prototype.N=function(){this.g.l=null,delete this.j,Bu(this.g),delete this.g,nt.aa.N.call(this)};function hm(a){ku.call(this),a.__headers__&&(this.headers=a.__headers__,this.statusCode=a.__status__,delete a.__headers__,delete a.__status__);var h=a.__sm__;if(h){e:{for(let d in h){a=d;break e}a=void 0}(this.i=a)&&(a=this.i,h=h!==null&&a in h?h[a]:void 0),this.data=h}else this.data=a}x(hm,ku);function dm(){Mu.call(this),this.status=1}x(dm,Mu);function xr(a){this.g=a}x(xr,lm),xr.prototype.ua=function(){He(this.g,"a")},xr.prototype.ta=function(a){He(this.g,new hm(a))},xr.prototype.sa=function(a){He(this.g,new dm)},xr.prototype.ra=function(){He(this.g,"b")},Zo.prototype.createWebChannel=Zo.prototype.g,nt.prototype.send=nt.prototype.o,nt.prototype.open=nt.prototype.m,nt.prototype.close=nt.prototype.close,$h=rn.createWebChannelTransport=function(){return new Zo},jh=rn.getStatEventTarget=function(){return $o()},Uh=rn.Event=qn,qa=rn.Stat={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},zo.NO_ERROR=0,zo.TIMEOUT=8,zo.HTTP_ERROR=6,Qs=rn.ErrorCode=zo,Cg.COMPLETE="complete",Fh=rn.EventType=Cg,Ig.EventType=Hi,Hi.OPEN="a",Hi.CLOSE="b",Hi.ERROR="c",Hi.MESSAGE="d",Be.prototype.listen=Be.prototype.K,ti=rn.WebChannel=Ig,Lh=rn.FetchXmlHttpFactory=ns,we.prototype.listenOnce=we.prototype.L,we.prototype.getLastError=we.prototype.Ka,we.prototype.getLastErrorCode=we.prototype.Ba,we.prototype.getStatus=we.prototype.Z,we.prototype.getResponseJson=we.prototype.Oa,we.prototype.getResponseText=we.prototype.oa,we.prototype.send=we.prototype.ea,we.prototype.setWithCredentials=we.prototype.Ha,Vh=rn.XhrIo=we}).apply(typeof Ba<"u"?Ba:typeof self<"u"?self:typeof window<"u"?window:{});var Kv="@firebase/firestore";var xe=class{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}};xe.UNAUTHENTICATED=new xe(null),xe.GOOGLE_CREDENTIALS=new xe("google-credentials-uid"),xe.FIRST_PARTY=new xe("first-party-uid"),xe.MOCK_USER=new xe("mock-user");var Ni="10.12.3";var xn=new ha("@firebase/firestore");function oi(){return xn.logLevel}function Gf(r){xn.setLogLevel(r)}function M(r,...e){if(xn.logLevel<=Pt.DEBUG){let t=e.map(Kf);xn.debug(`Firestore (${Ni}): ${r}`,...t)}}function Ae(r,...e){if(xn.logLevel<=Pt.ERROR){let t=e.map(Kf);xn.error(`Firestore (${Ni}): ${r}`,...t)}}function gt(r,...e){if(xn.logLevel<=Pt.WARN){let t=e.map(Kf);xn.warn(`Firestore (${Ni}): ${r}`,...t)}}function Kf(r){if(typeof r=="string")return r;try{return function(t){return JSON.stringify(t)}(r)}catch{return r}}function U(r="Unexpected state"){let e=`FIRESTORE (${Ni}) INTERNAL ASSERTION FAILED: `+r;throw Ae(e),new Error(e)}function q(r,e){r||U()}function K_(r,e){r||U()}function F(r,e){return r}var C={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},k=class extends cy{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}};var Ne=class{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}};var tc=class{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}},Kh=class{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(xe.UNAUTHENTICATED))}shutdown(){}},Wh=class{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}},Hh=class{constructor(e){this.t=e,this.currentUser=xe.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){let n=this.i,i=u=>this.i!==n?(n=this.i,t(u)):Promise.resolve(),s=new Ne;this.o=()=>{this.i++,this.currentUser=this.u(),s.resolve(),s=new Ne,e.enqueueRetryable(()=>i(this.currentUser))};let o=()=>{let u=s;e.enqueueRetryable(()=>P(this,null,function*(){yield u.promise,yield i(this.currentUser)}))},c=u=>{M("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=u,this.auth.addAuthTokenListener(this.o),o()};this.t.onInit(u=>c(u)),setTimeout(()=>{if(!this.auth){let u=this.t.getImmediate({optional:!0});u?c(u):(M("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new Ne)}},0),o()}getToken(){let e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(n=>this.i!==e?(M("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):n?(q(typeof n.accessToken=="string"),new tc(n.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){let e=this.auth&&this.auth.getUid();return q(e===null||typeof e=="string"),new xe(e)}},Qh=class{constructor(e,t,n){this.l=e,this.h=t,this.P=n,this.type="FirstParty",this.user=xe.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);let e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}},Yh=class{constructor(e,t,n){this.l=e,this.h=t,this.P=n}getToken(){return Promise.resolve(new Qh(this.l,this.h,this.P))}start(e,t){e.enqueueRetryable(()=>t(xe.FIRST_PARTY))}shutdown(){}invalidateToken(){}},Xh=class{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}},Jh=class{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,t){let n=s=>{s.error!=null&&M("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${s.error.message}`);let o=s.token!==this.R;return this.R=s.token,M("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?t(s.token):Promise.resolve()};this.o=s=>{e.enqueueRetryable(()=>n(s))};let i=s=>{M("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=s,this.appCheck.addTokenListener(this.o)};this.A.onInit(s=>i(s)),setTimeout(()=>{if(!this.appCheck){let s=this.A.getImmediate({optional:!0});s?i(s):M("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){let e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(q(typeof t.token=="string"),this.R=t.token,new Xh(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}};function _b(r){let e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(r);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let n=0;n<r;n++)t[n]=Math.floor(256*Math.random());return t}var nc=class{static newId(){let e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length,n="";for(;n.length<20;){let i=_b(40);for(let s=0;s<i.length;++s)n.length<20&&i[s]<t&&(n+=e.charAt(i[s]%e.length))}return n}};function J(r,e){return r<e?-1:r>e?1:0}function gi(r,e,t){return r.length===e.length&&r.every((n,i)=>t(n,e[i]))}function W_(r){return r+"\0"}var _e=class r{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new k(C.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new k(C.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new k(C.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new k(C.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return r.fromMillis(Date.now())}static fromDate(e){return r.fromMillis(e.getTime())}static fromMillis(e){let t=Math.floor(e/1e3),n=Math.floor(1e6*(e-1e3*t));return new r(t,n)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?J(this.nanoseconds,e.nanoseconds):J(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){let e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}};var K=class r{constructor(e){this.timestamp=e}static fromTimestamp(e){return new r(e)}static min(){return new r(new _e(0,0))}static max(){return new r(new _e(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}};var rc=class r{constructor(e,t,n){t===void 0?t=0:t>e.length&&U(),n===void 0?n=e.length-t:n>e.length-t&&U(),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return r.comparator(this,e)===0}child(e){let t=this.segments.slice(this.offset,this.limit());return e instanceof r?e.forEach(n=>{t.push(n)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){let n=Math.min(e.length,t.length);for(let i=0;i<n;i++){let s=e.get(i),o=t.get(i);if(s<o)return-1;if(s>o)return 1}return e.length<t.length?-1:e.length>t.length?1:0}},re=class r extends rc{construct(e,t,n){return new r(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){let t=[];for(let n of e){if(n.indexOf("//")>=0)throw new k(C.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);t.push(...n.split("/").filter(i=>i.length>0))}return new r(t)}static emptyPath(){return new r([])}},wb=/^[_a-zA-Z][_a-zA-Z0-9]*$/,Se=class r extends rc{construct(e,t,n){return new r(e,t,n)}static isValidIdentifier(e){return wb.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),r.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)==="__name__"}static keyField(){return new r(["__name__"])}static fromServerFormat(e){let t=[],n="",i=0,s=()=>{if(n.length===0)throw new k(C.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(n),n=""},o=!1;for(;i<e.length;){let c=e[i];if(c==="\\"){if(i+1===e.length)throw new k(C.INVALID_ARGUMENT,"Path has trailing escape character: "+e);let u=e[i+1];if(u!=="\\"&&u!=="."&&u!=="`")throw new k(C.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=u,i+=2}else c==="`"?(o=!o,i++):c!=="."||o?(n+=c,i++):(s(),i++)}if(s(),o)throw new k(C.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new r(t)}static emptyPath(){return new r([])}};var L=class r{constructor(e){this.path=e}static fromPath(e){return new r(re.fromString(e))}static fromName(e){return new r(re.fromString(e).popFirst(5))}static empty(){return new r(re.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&re.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return re.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new r(new re(e.slice()))}};var mi=class{constructor(e,t,n,i){this.indexId=e,this.collectionGroup=t,this.fields=n,this.indexState=i}};function Zh(r){return r.fields.find(e=>e.kind===2)}function rr(r){return r.fields.filter(e=>e.kind!==2)}mi.UNKNOWN_ID=-1;var di=class{constructor(e,t){this.fieldPath=e,this.kind=t}};var ao=class r{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new r(0,mt.min())}};function H_(r,e){let t=r.toTimestamp().seconds,n=r.toTimestamp().nanoseconds+1,i=K.fromTimestamp(n===1e9?new _e(t+1,0):new _e(t,n));return new mt(i,L.empty(),e)}function Q_(r){return new mt(r.readTime,r.key,-1)}var mt=class r{constructor(e,t,n){this.readTime=e,this.documentKey=t,this.largestBatchId=n}static min(){return new r(K.min(),L.empty(),-1)}static max(){return new r(K.max(),L.empty(),-1)}};function Wf(r,e){let t=r.readTime.compareTo(e.readTime);return t!==0?t:(t=L.comparator(r.documentKey,e.documentKey),t!==0?t:J(r.largestBatchId,e.largestBatchId))}var Y_="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",ic=class{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}};function $n(r){return P(this,null,function*(){if(r.code!==C.FAILED_PRECONDITION||r.message!==Y_)throw r;M("LocalStore","Unexpectedly lost primary lease")})}var b=class r{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&U(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new r((n,i)=>{this.nextCallback=s=>{this.wrapSuccess(e,s).next(n,i)},this.catchCallback=s=>{this.wrapFailure(t,s).next(n,i)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{let t=e();return t instanceof r?t:r.resolve(t)}catch(t){return r.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):r.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):r.reject(t)}static resolve(e){return new r((t,n)=>{t(e)})}static reject(e){return new r((t,n)=>{n(e)})}static waitFor(e){return new r((t,n)=>{let i=0,s=0,o=!1;e.forEach(c=>{++i,c.next(()=>{++s,o&&s===i&&t()},u=>n(u))}),o=!0,s===i&&t()})}static or(e){let t=r.resolve(!1);for(let n of e)t=t.next(i=>i?r.resolve(i):n());return t}static forEach(e,t){let n=[];return e.forEach((i,s)=>{n.push(t.call(this,i,s))}),this.waitFor(n)}static mapArray(e,t){return new r((n,i)=>{let s=e.length,o=new Array(s),c=0;for(let u=0;u<s;u++){let l=u;t(e[l]).next(f=>{o[l]=f,++c,c===s&&n(o)},f=>i(f))}})}static doWhile(e,t){return new r((n,i)=>{let s=()=>{e()===!0?t().next(()=>{s()},i):n()};s()})}};var sc=class r{constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.V=new Ne,this.transaction.oncomplete=()=>{this.V.resolve()},this.transaction.onabort=()=>{t.error?this.V.reject(new ur(e,t.error)):this.V.resolve()},this.transaction.onerror=n=>{let i=Hf(n.target.error);this.V.reject(new ur(e,i))}}static open(e,t,n,i){try{return new r(t,e.transaction(i,n))}catch(s){throw new ur(t,s)}}get m(){return this.V.promise}abort(e){e&&this.V.reject(e),this.aborted||(M("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}g(){let e=this.transaction;this.aborted||typeof e.commit!="function"||e.commit()}store(e){let t=this.transaction.objectStore(e);return new td(t)}},Nn=class r{constructor(e,t,n){this.name=e,this.version=t,this.p=n,r.S(vs())===12.2&&Ae("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return M("SimpleDb","Removing database:",e),ir(window.indexedDB.deleteDatabase(e)).toPromise()}static D(){if(!la())return!1;if(r.C())return!0;let e=vs(),t=r.S(e),n=0<t&&t<10,i=X_(e),s=0<i&&i<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||n||s)}static C(){var e;return typeof process<"u"&&((e=process.__PRIVATE_env)===null||e===void 0?void 0:e.v)==="YES"}static F(e,t){return e.store(t)}static S(e){let t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(n)}M(e){return P(this,null,function*(){return this.db||(M("SimpleDb","Opening database:",this.name),this.db=yield new Promise((t,n)=>{let i=indexedDB.open(this.name,this.version);i.onsuccess=s=>{let o=s.target.result;t(o)},i.onblocked=()=>{n(new ur(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=s=>{let o=s.target.error;o.name==="VersionError"?n(new k(C.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):o.name==="InvalidStateError"?n(new k(C.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+o)):n(new ur(e,o))},i.onupgradeneeded=s=>{M("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',s.oldVersion);let o=s.target.result;this.p.O(o,i.transaction,s.oldVersion,this.version).next(()=>{M("SimpleDb","Database upgrade to version "+this.version+" complete")})}})),this.N&&(this.db.onversionchange=t=>this.N(t)),this.db})}L(e){this.N=e,this.db&&(this.db.onversionchange=t=>e(t))}runTransaction(e,t,n,i){return P(this,null,function*(){let s=t==="readonly",o=0;for(;;){++o;try{this.db=yield this.M(e);let c=sc.open(this.db,e,s?"readonly":"readwrite",n),u=i(c).next(l=>(c.g(),l)).catch(l=>(c.abort(l),b.reject(l))).toPromise();return u.catch(()=>{}),yield c.m,u}catch(c){let u=c,l=u.name!=="FirebaseError"&&o<3;if(M("SimpleDb","Transaction failed with error:",u.message,"Retrying:",l),this.close(),!l)return Promise.reject(u)}}})}close(){this.db&&this.db.close(),this.db=void 0}};function X_(r){let e=r.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}var ed=class{constructor(e){this.B=e,this.k=!1,this.q=null}get isDone(){return this.k}get K(){return this.q}set cursor(e){this.B=e}done(){this.k=!0}$(e){this.q=e}delete(){return ir(this.B.delete())}},ur=class extends k{constructor(e,t){super(C.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}};function zn(r){return r.name==="IndexedDbTransactionError"}var td=class{constructor(e){this.store=e}put(e,t){let n;return t!==void 0?(M("SimpleDb","PUT",this.store.name,e,t),n=this.store.put(t,e)):(M("SimpleDb","PUT",this.store.name,"<auto-key>",e),n=this.store.put(e)),ir(n)}add(e){return M("SimpleDb","ADD",this.store.name,e,e),ir(this.store.add(e))}get(e){return ir(this.store.get(e)).next(t=>(t===void 0&&(t=null),M("SimpleDb","GET",this.store.name,e,t),t))}delete(e){return M("SimpleDb","DELETE",this.store.name,e),ir(this.store.delete(e))}count(){return M("SimpleDb","COUNT",this.store.name),ir(this.store.count())}U(e,t){let n=this.options(e,t),i=n.index?this.store.index(n.index):this.store;if(typeof i.getAll=="function"){let s=i.getAll(n.range);return new b((o,c)=>{s.onerror=u=>{c(u.target.error)},s.onsuccess=u=>{o(u.target.result)}})}{let s=this.cursor(n),o=[];return this.W(s,(c,u)=>{o.push(u)}).next(()=>o)}}G(e,t){let n=this.store.getAll(e,t===null?void 0:t);return new b((i,s)=>{n.onerror=o=>{s(o.target.error)},n.onsuccess=o=>{i(o.target.result)}})}j(e,t){M("SimpleDb","DELETE ALL",this.store.name);let n=this.options(e,t);n.H=!1;let i=this.cursor(n);return this.W(i,(s,o,c)=>c.delete())}J(e,t){let n;t?n=e:(n={},t=e);let i=this.cursor(n);return this.W(i,t)}Y(e){let t=this.cursor({});return new b((n,i)=>{t.onerror=s=>{let o=Hf(s.target.error);i(o)},t.onsuccess=s=>{let o=s.target.result;o?e(o.primaryKey,o.value).next(c=>{c?o.continue():n()}):n()}})}W(e,t){let n=[];return new b((i,s)=>{e.onerror=o=>{s(o.target.error)},e.onsuccess=o=>{let c=o.target.result;if(!c)return void i();let u=new ed(c),l=t(c.primaryKey,c.value,u);if(l instanceof b){let f=l.catch(p=>(u.done(),b.reject(p)));n.push(f)}u.isDone?i():u.K===null?c.continue():c.continue(u.K)}}).next(()=>b.waitFor(n))}options(e,t){let n;return e!==void 0&&(typeof e=="string"?n=e:t=e),{index:n,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){let n=this.store.index(e.index);return e.H?n.openKeyCursor(e.range,t):n.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}};function ir(r){return new b((e,t)=>{r.onsuccess=n=>{let i=n.target.result;e(i)},r.onerror=n=>{let i=Hf(n.target.error);t(i)}})}var Wv=!1;function Hf(r){let e=Nn.S(vs());if(e>=12.2&&e<13){let t="An internal error was encountered in the Indexed Database server";if(r.message.indexOf(t)>=0){let n=new k("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return Wv||(Wv=!0,setTimeout(()=>{throw n},0)),n}}return r}var nd=class{constructor(e,t){this.asyncQueue=e,this.Z=t,this.task=null}start(){this.X(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return this.task!==null}X(e){M("IndexBackfiller",`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,()=>P(this,null,function*(){this.task=null;try{M("IndexBackfiller",`Documents written: ${yield this.Z.ee()}`)}catch(t){zn(t)?M("IndexBackfiller","Ignoring IndexedDB error during index backfill: ",t):yield $n(t)}yield this.X(6e4)}))}},rd=class{constructor(e,t){this.localStore=e,this.persistence=t}ee(e=50){return P(this,null,function*(){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",t=>this.te(t,e))})}te(e,t){let n=new Set,i=t,s=!0;return b.doWhile(()=>s===!0&&i>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(o=>{if(o!==null&&!n.has(o))return M("IndexBackfiller",`Processing collection: ${o}`),this.ne(e,o,i).next(c=>{i-=c,n.add(o)});s=!1})).next(()=>t-i)}ne(e,t,n){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(i=>this.localStore.localDocuments.getNextDocuments(e,t,i,n).next(s=>{let o=s.changes;return this.localStore.indexManager.updateIndexEntries(e,o).next(()=>this.re(i,s)).next(c=>(M("IndexBackfiller",`Updating offset: ${c}`),this.localStore.indexManager.updateCollectionGroup(e,t,c))).next(()=>o.size)}))}re(e,t){let n=e;return t.changes.forEach((i,s)=>{let o=Q_(s);Wf(o,n)>0&&(n=o)}),new mt(n.readTime,n.documentKey,Math.max(t.batchId,e.largestBatchId))}};var ct=(()=>{class r{constructor(t,n){this.previousValue=t,n&&(n.sequenceNumberHandler=i=>this.ie(i),this.se=i=>n.writeSequenceNumber(i))}ie(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){let t=++this.previousValue;return this.se&&this.se(t),t}}return r.oe=-1,r})();function Do(r){return r==null}function co(r){return r===0&&1/r==-1/0}function J_(r){return typeof r=="number"&&Number.isInteger(r)&&!co(r)&&r<=Number.MAX_SAFE_INTEGER&&r>=Number.MIN_SAFE_INTEGER}function Je(r){let e="";for(let t=0;t<r.length;t++)e.length>0&&(e=Hv(e)),e=Eb(r.get(t),e);return Hv(e)}function Eb(r,e){let t=e,n=r.length;for(let i=0;i<n;i++){let s=r.charAt(i);switch(s){case"\0":t+="";break;case"":t+="";break;default:t+=s}}return t}function Hv(r){return r+""}function Mt(r){let e=r.length;if(q(e>=2),e===2)return q(r.charAt(0)===""&&r.charAt(1)===""),re.emptyPath();let t=e-2,n=[],i="";for(let s=0;s<e;){let o=r.indexOf("",s);switch((o<0||o>t)&&U(),r.charAt(o+1)){case"":let c=r.substring(s,o),u;i.length===0?u=c:(i+=c,u=i,i=""),n.push(u);break;case"":i+=r.substring(s,o),i+="\0";break;case"":i+=r.substring(s,o+1);break;default:U()}s=o+2}return new re(n)}var Qv=["userId","batchId"];function Qa(r,e){return[r,Je(e)]}function Z_(r,e,t){return[r,Je(e),t]}var Tb={},Ib=["prefixPath","collectionGroup","readTime","documentId"],Ab=["prefixPath","collectionGroup","documentId"],Sb=["collectionGroup","readTime","prefixPath","documentId"],bb=["canonicalId","targetId"],Rb=["targetId","path"],Cb=["path","targetId"],Pb=["collectionId","parent"],Db=["indexId","uid"],xb=["uid","sequenceNumber"],Nb=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],kb=["indexId","uid","orderedDocumentKey"],Mb=["userId","collectionPath","documentId"],Ob=["userId","collectionPath","largestBatchId"],Vb=["userId","collectionGroup","largestBatchId"],ew=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],Lb=[...ew,"documentOverlays"],tw=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],nw=tw,rw=[...nw,"indexConfiguration","indexState","indexEntries"],Fb=rw;var uo=class extends ic{constructor(e,t){super(),this._e=e,this.currentSequenceNumber=t}};function Ue(r,e){let t=F(r);return Nn.F(t._e,e)}function Yv(r){let e=0;for(let t in r)Object.prototype.hasOwnProperty.call(r,t)&&e++;return e}function Er(r,e){for(let t in r)Object.prototype.hasOwnProperty.call(r,t)&&e(t,r[t])}function iw(r){for(let e in r)if(Object.prototype.hasOwnProperty.call(r,e))return!1;return!0}var pe=class r{constructor(e,t){this.comparator=e,this.root=t||Vt.EMPTY}insert(e,t){return new r(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Vt.BLACK,null,null))}remove(e){return new r(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Vt.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){let n=this.comparator(e,t.key);if(n===0)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){let i=this.comparator(e,n.key);if(i===0)return t+n.left.size;i<0?n=n.left:(t+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,n)=>(e(t,n),!1))}toString(){let e=[];return this.inorderTraversal((t,n)=>(e.push(`${t}:${n}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new hi(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new hi(this.root,e,this.comparator,!1)}getReverseIterator(){return new hi(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new hi(this.root,e,this.comparator,!0)}},hi=class{constructor(e,t,n,i){this.isReverse=i,this.nodeStack=[];let s=1;for(;!e.isEmpty();)if(s=t?n(e.key,t):1,t&&i&&(s*=-1),s<0)e=this.isReverse?e.left:e.right;else{if(s===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop(),t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;let e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}},Vt=class r{constructor(e,t,n,i,s){this.key=e,this.value=t,this.color=n??r.RED,this.left=i??r.EMPTY,this.right=s??r.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,i,s){return new r(e??this.key,t??this.value,n??this.color,i??this.left,s??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let i=this,s=n(e,i.key);return i=s<0?i.copy(null,null,null,i.left.insert(e,t,n),null):s===0?i.copy(null,t,null,null,null):i.copy(null,null,null,null,i.right.insert(e,t,n)),i.fixUp()}removeMin(){if(this.left.isEmpty())return r.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let n,i=this;if(t(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,t),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),t(e,i.key)===0){if(i.right.isEmpty())return r.EMPTY;n=i.right.min(),i=i.copy(n.key,n.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,t))}return i.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){let e=this.copy(null,null,r.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){let e=this.copy(null,null,r.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){let e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){let e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw U();let e=this.left.check();if(e!==this.right.check())throw U();return e+(this.isRed()?0:1)}};Vt.EMPTY=null,Vt.RED=!0,Vt.BLACK=!1;Vt.EMPTY=new class{constructor(){this.size=0}get key(){throw U()}get value(){throw U()}get color(){throw U()}get left(){throw U()}get right(){throw U()}copy(e,t,n,i,s){return this}insert(e,t,n){return new Vt(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};var he=class r{constructor(e){this.comparator=e,this.data=new pe(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,n)=>(e(t),!1))}forEachInRange(e,t){let n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){let i=n.getNext();if(this.comparator(i.key,e[1])>=0)return;t(i.key)}}forEachWhile(e,t){let n;for(n=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){let t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new oc(this.data.getIterator())}getIteratorFrom(e){return new oc(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(n=>{t=t.add(n)}),t}isEqual(e){if(!(e instanceof r)||this.size!==e.size)return!1;let t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){let i=t.getNext().key,s=n.getNext().key;if(this.comparator(i,s)!==0)return!1}return!0}toArray(){let e=[];return this.forEach(t=>{e.push(t)}),e}toString(){let e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){let t=new r(this.comparator);return t.data=e,t}},oc=class{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}};function ni(r){return r.hasNext()?r.getNext():void 0}var ut=class r{constructor(e){this.fields=e,e.sort(Se.comparator)}static empty(){return new r([])}unionWith(e){let t=new he(Se.comparator);for(let n of this.fields)t=t.add(n);for(let n of e)t=t.add(n);return new r(t.toArray())}covers(e){for(let t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return gi(this.fields,e.fields,(t,n)=>t.isEqual(n))}};var ac=class extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}};function sw(){return typeof atob<"u"}var Fe=class r{constructor(e){this.binaryString=e}static fromBase64String(e){let t=function(i){try{return atob(i)}catch(s){throw typeof DOMException<"u"&&s instanceof DOMException?new ac("Invalid base64 string: "+s):s}}(e);return new r(t)}static fromUint8Array(e){let t=function(i){let s="";for(let o=0;o<i.length;++o)s+=String.fromCharCode(i[o]);return s}(e);return new r(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(t){return btoa(t)}(this.binaryString)}toUint8Array(){return function(t){let n=new Uint8Array(t.length);for(let i=0;i<t.length;i++)n[i]=t.charCodeAt(i);return n}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return J(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}};Fe.EMPTY_BYTE_STRING=new Fe("");var Ub=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function an(r){if(q(!!r),typeof r=="string"){let e=0,t=Ub.exec(r);if(q(!!t),t[1]){let i=t[1];i=(i+"000000000").substr(0,9),e=Number(i)}let n=new Date(r);return{seconds:Math.floor(n.getTime()/1e3),nanos:e}}return{seconds:Ee(r.seconds),nanos:Ee(r.nanos)}}function Ee(r){return typeof r=="number"?r:typeof r=="string"?Number(r):0}function kn(r){return typeof r=="string"?Fe.fromBase64String(r):Fe.fromUint8Array(r)}function Xc(r){var e,t;return((t=(((e=r?.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||t===void 0?void 0:t.stringValue)==="server_timestamp"}function Qf(r){let e=r.mapValue.fields.__previous_value__;return Xc(e)?Qf(e):e}function lo(r){let e=an(r.mapValue.fields.__local_write_time__.timestampValue);return new _e(e.seconds,e.nanos)}var id=class{constructor(e,t,n,i,s,o,c,u,l){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=i,this.ssl=s,this.forceLongPolling=o,this.autoDetectLongPolling=c,this.longPollingOptions=u,this.useFetchStreams=l}},Mn=class r{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new r("","")}get isDefaultDatabase(){return this.database==="(default)"}isEqual(e){return e instanceof r&&e.projectId===this.projectId&&e.database===this.database}};var Pn={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},Ya={nullValue:"NULL_VALUE"};function lr(r){return"nullValue"in r?0:"booleanValue"in r?1:"integerValue"in r||"doubleValue"in r?2:"timestampValue"in r?3:"stringValue"in r?5:"bytesValue"in r?6:"referenceValue"in r?7:"geoPointValue"in r?8:"arrayValue"in r?9:"mapValue"in r?Xc(r)?4:ow(r)?9007199254740991:10:U()}function Ut(r,e){if(r===e)return!0;let t=lr(r);if(t!==lr(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return r.booleanValue===e.booleanValue;case 4:return lo(r).isEqual(lo(e));case 3:return function(i,s){if(typeof i.timestampValue=="string"&&typeof s.timestampValue=="string"&&i.timestampValue.length===s.timestampValue.length)return i.timestampValue===s.timestampValue;let o=an(i.timestampValue),c=an(s.timestampValue);return o.seconds===c.seconds&&o.nanos===c.nanos}(r,e);case 5:return r.stringValue===e.stringValue;case 6:return function(i,s){return kn(i.bytesValue).isEqual(kn(s.bytesValue))}(r,e);case 7:return r.referenceValue===e.referenceValue;case 8:return function(i,s){return Ee(i.geoPointValue.latitude)===Ee(s.geoPointValue.latitude)&&Ee(i.geoPointValue.longitude)===Ee(s.geoPointValue.longitude)}(r,e);case 2:return function(i,s){if("integerValue"in i&&"integerValue"in s)return Ee(i.integerValue)===Ee(s.integerValue);if("doubleValue"in i&&"doubleValue"in s){let o=Ee(i.doubleValue),c=Ee(s.doubleValue);return o===c?co(o)===co(c):isNaN(o)&&isNaN(c)}return!1}(r,e);case 9:return gi(r.arrayValue.values||[],e.arrayValue.values||[],Ut);case 10:return function(i,s){let o=i.mapValue.fields||{},c=s.mapValue.fields||{};if(Yv(o)!==Yv(c))return!1;for(let u in o)if(o.hasOwnProperty(u)&&(c[u]===void 0||!Ut(o[u],c[u])))return!1;return!0}(r,e);default:return U()}}function ho(r,e){return(r.values||[]).find(t=>Ut(t,e))!==void 0}function On(r,e){if(r===e)return 0;let t=lr(r),n=lr(e);if(t!==n)return J(t,n);switch(t){case 0:case 9007199254740991:return 0;case 1:return J(r.booleanValue,e.booleanValue);case 2:return function(s,o){let c=Ee(s.integerValue||s.doubleValue),u=Ee(o.integerValue||o.doubleValue);return c<u?-1:c>u?1:c===u?0:isNaN(c)?isNaN(u)?0:-1:1}(r,e);case 3:return Xv(r.timestampValue,e.timestampValue);case 4:return Xv(lo(r),lo(e));case 5:return J(r.stringValue,e.stringValue);case 6:return function(s,o){let c=kn(s),u=kn(o);return c.compareTo(u)}(r.bytesValue,e.bytesValue);case 7:return function(s,o){let c=s.split("/"),u=o.split("/");for(let l=0;l<c.length&&l<u.length;l++){let f=J(c[l],u[l]);if(f!==0)return f}return J(c.length,u.length)}(r.referenceValue,e.referenceValue);case 8:return function(s,o){let c=J(Ee(s.latitude),Ee(o.latitude));return c!==0?c:J(Ee(s.longitude),Ee(o.longitude))}(r.geoPointValue,e.geoPointValue);case 9:return function(s,o){let c=s.values||[],u=o.values||[];for(let l=0;l<c.length&&l<u.length;++l){let f=On(c[l],u[l]);if(f)return f}return J(c.length,u.length)}(r.arrayValue,e.arrayValue);case 10:return function(s,o){if(s===Pn.mapValue&&o===Pn.mapValue)return 0;if(s===Pn.mapValue)return 1;if(o===Pn.mapValue)return-1;let c=s.fields||{},u=Object.keys(c),l=o.fields||{},f=Object.keys(l);u.sort(),f.sort();for(let p=0;p<u.length&&p<f.length;++p){let m=J(u[p],f[p]);if(m!==0)return m;let T=On(c[u[p]],l[f[p]]);if(T!==0)return T}return J(u.length,f.length)}(r.mapValue,e.mapValue);default:throw U()}}function Xv(r,e){if(typeof r=="string"&&typeof e=="string"&&r.length===e.length)return J(r,e);let t=an(r),n=an(e),i=J(t.seconds,n.seconds);return i!==0?i:J(t.nanos,n.nanos)}function yi(r){return sd(r)}function sd(r){return"nullValue"in r?"null":"booleanValue"in r?""+r.booleanValue:"integerValue"in r?""+r.integerValue:"doubleValue"in r?""+r.doubleValue:"timestampValue"in r?function(t){let n=an(t);return`time(${n.seconds},${n.nanos})`}(r.timestampValue):"stringValue"in r?r.stringValue:"bytesValue"in r?function(t){return kn(t).toBase64()}(r.bytesValue):"referenceValue"in r?function(t){return L.fromName(t).toString()}(r.referenceValue):"geoPointValue"in r?function(t){return`geo(${t.latitude},${t.longitude})`}(r.geoPointValue):"arrayValue"in r?function(t){let n="[",i=!0;for(let s of t.values||[])i?i=!1:n+=",",n+=sd(s);return n+"]"}(r.arrayValue):"mapValue"in r?function(t){let n=Object.keys(t.fields||{}).sort(),i="{",s=!0;for(let o of n)s?s=!1:i+=",",i+=`${o}:${sd(t.fields[o])}`;return i+"}"}(r.mapValue):U()}function hr(r,e){return{referenceValue:`projects/${r.projectId}/databases/${r.database}/documents/${e.path.canonicalString()}`}}function od(r){return!!r&&"integerValue"in r}function fo(r){return!!r&&"arrayValue"in r}function Jv(r){return!!r&&"nullValue"in r}function Zv(r){return!!r&&"doubleValue"in r&&isNaN(Number(r.doubleValue))}function Xa(r){return!!r&&"mapValue"in r}function no(r){if(r.geoPointValue)return{geoPointValue:Object.assign({},r.geoPointValue)};if(r.timestampValue&&typeof r.timestampValue=="object")return{timestampValue:Object.assign({},r.timestampValue)};if(r.mapValue){let e={mapValue:{fields:{}}};return Er(r.mapValue.fields,(t,n)=>e.mapValue.fields[t]=no(n)),e}if(r.arrayValue){let e={arrayValue:{values:[]}};for(let t=0;t<(r.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=no(r.arrayValue.values[t]);return e}return Object.assign({},r)}function ow(r){return(((r.mapValue||{}).fields||{}).__type__||{}).stringValue==="__max__"}function jb(r){return"nullValue"in r?Ya:"booleanValue"in r?{booleanValue:!1}:"integerValue"in r||"doubleValue"in r?{doubleValue:NaN}:"timestampValue"in r?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in r?{stringValue:""}:"bytesValue"in r?{bytesValue:""}:"referenceValue"in r?hr(Mn.empty(),L.empty()):"geoPointValue"in r?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in r?{arrayValue:{}}:"mapValue"in r?{mapValue:{}}:U()}function $b(r){return"nullValue"in r?{booleanValue:!1}:"booleanValue"in r?{doubleValue:NaN}:"integerValue"in r||"doubleValue"in r?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in r?{stringValue:""}:"stringValue"in r?{bytesValue:""}:"bytesValue"in r?hr(Mn.empty(),L.empty()):"referenceValue"in r?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in r?{arrayValue:{}}:"arrayValue"in r?{mapValue:{}}:"mapValue"in r?Pn:U()}function e_(r,e){let t=On(r.value,e.value);return t!==0?t:r.inclusive&&!e.inclusive?-1:!r.inclusive&&e.inclusive?1:0}function t_(r,e){let t=On(r.value,e.value);return t!==0?t:r.inclusive&&!e.inclusive?1:!r.inclusive&&e.inclusive?-1:0}var We=class r{constructor(e){this.value=e}static empty(){return new r({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let n=0;n<e.length-1;++n)if(t=(t.mapValue.fields||{})[e.get(n)],!Xa(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=no(t)}setAll(e){let t=Se.emptyPath(),n={},i=[];e.forEach((o,c)=>{if(!t.isImmediateParentOf(c)){let u=this.getFieldsMap(t);this.applyChanges(u,n,i),n={},i=[],t=c.popLast()}o?n[c.lastSegment()]=no(o):i.push(c.lastSegment())});let s=this.getFieldsMap(t);this.applyChanges(s,n,i)}delete(e){let t=this.field(e.popLast());Xa(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Ut(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let n=0;n<e.length;++n){let i=t.mapValue.fields[e.get(n)];Xa(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=i),t=i}return t.mapValue.fields}applyChanges(e,t,n){Er(t,(i,s)=>e[i]=s);for(let i of n)delete e[i]}clone(){return new r(no(this.value))}};function aw(r){let e=[];return Er(r.fields,(t,n)=>{let i=new Se([t]);if(Xa(n)){let s=aw(n.mapValue).fields;if(s.length===0)e.push(i);else for(let o of s)e.push(i.child(o))}else e.push(i)}),new ut(e)}var ke=class r{constructor(e,t,n,i,s,o,c){this.key=e,this.documentType=t,this.version=n,this.readTime=i,this.createTime=s,this.data=o,this.documentState=c}static newInvalidDocument(e){return new r(e,0,K.min(),K.min(),K.min(),We.empty(),0)}static newFoundDocument(e,t,n,i){return new r(e,1,t,K.min(),n,i,0)}static newNoDocument(e,t){return new r(e,2,t,K.min(),K.min(),We.empty(),0)}static newUnknownDocument(e,t){return new r(e,3,t,K.min(),K.min(),We.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(K.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=We.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=We.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=K.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof r&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new r(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}};var jt=class{constructor(e,t){this.position=e,this.inclusive=t}};function n_(r,e,t){let n=0;for(let i=0;i<r.position.length;i++){let s=e[i],o=r.position[i];if(s.field.isKeyField()?n=L.comparator(L.fromName(o.referenceValue),t.key):n=On(o,t.data.field(s.field)),s.dir==="desc"&&(n*=-1),n!==0)break}return n}function r_(r,e){if(r===null)return e===null;if(e===null||r.inclusive!==e.inclusive||r.position.length!==e.position.length)return!1;for(let t=0;t<r.position.length;t++)if(!Ut(r.position[t],e.position[t]))return!1;return!0}var dr=class{constructor(e,t="asc"){this.field=e,this.dir=t}};function zb(r,e){return r.dir===e.dir&&r.field.isEqual(e.field)}var cc=class{},te=class r extends cc{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,n):new ud(e,t,n):t==="array-contains"?new dd(e,n):t==="in"?new uc(e,n):t==="not-in"?new fd(e,n):t==="array-contains-any"?new pd(e,n):new r(e,t,n)}static createKeyFieldInFilter(e,t,n){return t==="in"?new ld(e,n):new hd(e,n)}matches(e){let t=e.data.field(this.field);return this.op==="!="?t!==null&&this.matchesComparison(On(t,this.value)):t!==null&&lr(this.value)===lr(t)&&this.matchesComparison(On(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return U()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}},ue=class r extends cc{constructor(e,t){super(),this.filters=e,this.op=t,this.ae=null}static create(e,t){return new r(e,t)}matches(e){return vi(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.ae!==null||(this.ae=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.ae}getFilters(){return Object.assign([],this.filters)}};function vi(r){return r.op==="and"}function ad(r){return r.op==="or"}function Yf(r){return cw(r)&&vi(r)}function cw(r){for(let e of r.filters)if(e instanceof ue)return!1;return!0}function cd(r){if(r instanceof te)return r.field.canonicalString()+r.op.toString()+yi(r.value);if(Yf(r))return r.filters.map(e=>cd(e)).join(",");{let e=r.filters.map(t=>cd(t)).join(",");return`${r.op}(${e})`}}function uw(r,e){return r instanceof te?function(n,i){return i instanceof te&&n.op===i.op&&n.field.isEqual(i.field)&&Ut(n.value,i.value)}(r,e):r instanceof ue?function(n,i){return i instanceof ue&&n.op===i.op&&n.filters.length===i.filters.length?n.filters.reduce((s,o,c)=>s&&uw(o,i.filters[c]),!0):!1}(r,e):void U()}function lw(r,e){let t=r.filters.concat(e);return ue.create(t,r.op)}function hw(r){return r instanceof te?function(t){return`${t.field.canonicalString()} ${t.op} ${yi(t.value)}`}(r):r instanceof ue?function(t){return t.op.toString()+" {"+t.getFilters().map(hw).join(" ,")+"}"}(r):"Filter"}var ud=class extends te{constructor(e,t,n){super(e,t,n),this.key=L.fromName(n.referenceValue)}matches(e){let t=L.comparator(e.key,this.key);return this.matchesComparison(t)}},ld=class extends te{constructor(e,t){super(e,"in",t),this.keys=dw("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}},hd=class extends te{constructor(e,t){super(e,"not-in",t),this.keys=dw("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}};function dw(r,e){var t;return(((t=e.arrayValue)===null||t===void 0?void 0:t.values)||[]).map(n=>L.fromName(n.referenceValue))}var dd=class extends te{constructor(e,t){super(e,"array-contains",t)}matches(e){let t=e.data.field(this.field);return fo(t)&&ho(t.arrayValue,this.value)}},uc=class extends te{constructor(e,t){super(e,"in",t)}matches(e){let t=e.data.field(this.field);return t!==null&&ho(this.value.arrayValue,t)}},fd=class extends te{constructor(e,t){super(e,"not-in",t)}matches(e){if(ho(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let t=e.data.field(this.field);return t!==null&&!ho(this.value.arrayValue,t)}},pd=class extends te{constructor(e,t){super(e,"array-contains-any",t)}matches(e){let t=e.data.field(this.field);return!(!fo(t)||!t.arrayValue.values)&&t.arrayValue.values.some(n=>ho(this.value.arrayValue,n))}};var gd=class{constructor(e,t=null,n=[],i=[],s=null,o=null,c=null){this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=i,this.limit=s,this.startAt=o,this.endAt=c,this.ue=null}};function md(r,e=null,t=[],n=[],i=null,s=null,o=null){return new gd(r,e,t,n,i,s,o)}function fr(r){let e=F(r);if(e.ue===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(n=>cd(n)).join(","),t+="|ob:",t+=e.orderBy.map(n=>function(s){return s.field.canonicalString()+s.dir}(n)).join(","),Do(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(n=>yi(n)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(n=>yi(n)).join(",")),e.ue=t}return e.ue}function xo(r,e){if(r.limit!==e.limit||r.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<r.orderBy.length;t++)if(!zb(r.orderBy[t],e.orderBy[t]))return!1;if(r.filters.length!==e.filters.length)return!1;for(let t=0;t<r.filters.length;t++)if(!uw(r.filters[t],e.filters[t]))return!1;return r.collectionGroup===e.collectionGroup&&!!r.path.isEqual(e.path)&&!!r_(r.startAt,e.startAt)&&r_(r.endAt,e.endAt)}function lc(r){return L.isDocumentKey(r.path)&&r.collectionGroup===null&&r.filters.length===0}function hc(r,e){return r.filters.filter(t=>t instanceof te&&t.field.isEqual(e))}function i_(r,e,t){let n=Ya,i=!0;for(let s of hc(r,e)){let o=Ya,c=!0;switch(s.op){case"<":case"<=":o=jb(s.value);break;case"==":case"in":case">=":o=s.value;break;case">":o=s.value,c=!1;break;case"!=":case"not-in":o=Ya}e_({value:n,inclusive:i},{value:o,inclusive:c})<0&&(n=o,i=c)}if(t!==null){for(let s=0;s<r.orderBy.length;++s)if(r.orderBy[s].field.isEqual(e)){let o=t.position[s];e_({value:n,inclusive:i},{value:o,inclusive:t.inclusive})<0&&(n=o,i=t.inclusive);break}}return{value:n,inclusive:i}}function s_(r,e,t){let n=Pn,i=!0;for(let s of hc(r,e)){let o=Pn,c=!0;switch(s.op){case">=":case">":o=$b(s.value),c=!1;break;case"==":case"in":case"<=":o=s.value;break;case"<":o=s.value,c=!1;break;case"!=":case"not-in":o=Pn}t_({value:n,inclusive:i},{value:o,inclusive:c})>0&&(n=o,i=c)}if(t!==null){for(let s=0;s<r.orderBy.length;++s)if(r.orderBy[s].field.isEqual(e)){let o=t.position[s];t_({value:n,inclusive:i},{value:o,inclusive:t.inclusive})>0&&(n=o,i=t.inclusive);break}}return{value:n,inclusive:i}}var Tt=class{constructor(e,t=null,n=[],i=[],s=null,o="F",c=null,u=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=i,this.limit=s,this.limitType=o,this.startAt=c,this.endAt=u,this.ce=null,this.le=null,this.he=null,this.startAt,this.endAt}};function fw(r,e,t,n,i,s,o,c){return new Tt(r,e,t,n,i,s,o,c)}function ki(r){return new Tt(r)}function o_(r){return r.filters.length===0&&r.limit===null&&r.startAt==null&&r.endAt==null&&(r.explicitOrderBy.length===0||r.explicitOrderBy.length===1&&r.explicitOrderBy[0].field.isKeyField())}function Xf(r){return r.collectionGroup!==null}function fi(r){let e=F(r);if(e.ce===null){e.ce=[];let t=new Set;for(let s of e.explicitOrderBy)e.ce.push(s),t.add(s.field.canonicalString());let n=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(o){let c=new he(Se.comparator);return o.filters.forEach(u=>{u.getFlattenedFilters().forEach(l=>{l.isInequality()&&(c=c.add(l.field))})}),c})(e).forEach(s=>{t.has(s.canonicalString())||s.isKeyField()||e.ce.push(new dr(s,n))}),t.has(Se.keyField().canonicalString())||e.ce.push(new dr(Se.keyField(),n))}return e.ce}function Ze(r){let e=F(r);return e.le||(e.le=Bb(e,fi(r))),e.le}function Bb(r,e){if(r.limitType==="F")return md(r.path,r.collectionGroup,e,r.filters,r.limit,r.startAt,r.endAt);{e=e.map(i=>{let s=i.dir==="desc"?"asc":"desc";return new dr(i.field,s)});let t=r.endAt?new jt(r.endAt.position,r.endAt.inclusive):null,n=r.startAt?new jt(r.startAt.position,r.startAt.inclusive):null;return md(r.path,r.collectionGroup,e,r.filters,r.limit,t,n)}}function yd(r,e){let t=r.filters.concat([e]);return new Tt(r.path,r.collectionGroup,r.explicitOrderBy.slice(),t,r.limit,r.limitType,r.startAt,r.endAt)}function dc(r,e,t){return new Tt(r.path,r.collectionGroup,r.explicitOrderBy.slice(),r.filters.slice(),e,t,r.startAt,r.endAt)}function No(r,e){return xo(Ze(r),Ze(e))&&r.limitType===e.limitType}function pw(r){return`${fr(Ze(r))}|lt:${r.limitType}`}function ai(r){return`Query(target=${function(t){let n=t.path.canonicalString();return t.collectionGroup!==null&&(n+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(n+=`, filters: [${t.filters.map(i=>hw(i)).join(", ")}]`),Do(t.limit)||(n+=", limit: "+t.limit),t.orderBy.length>0&&(n+=`, orderBy: [${t.orderBy.map(i=>function(o){return`${o.field.canonicalString()} (${o.dir})`}(i)).join(", ")}]`),t.startAt&&(n+=", startAt: ",n+=t.startAt.inclusive?"b:":"a:",n+=t.startAt.position.map(i=>yi(i)).join(",")),t.endAt&&(n+=", endAt: ",n+=t.endAt.inclusive?"a:":"b:",n+=t.endAt.position.map(i=>yi(i)).join(",")),`Target(${n})`}(Ze(r))}; limitType=${r.limitType})`}function ko(r,e){return e.isFoundDocument()&&function(n,i){let s=i.key.path;return n.collectionGroup!==null?i.key.hasCollectionId(n.collectionGroup)&&n.path.isPrefixOf(s):L.isDocumentKey(n.path)?n.path.isEqual(s):n.path.isImmediateParentOf(s)}(r,e)&&function(n,i){for(let s of fi(n))if(!s.field.isKeyField()&&i.data.field(s.field)===null)return!1;return!0}(r,e)&&function(n,i){for(let s of n.filters)if(!s.matches(i))return!1;return!0}(r,e)&&function(n,i){return!(n.startAt&&!function(o,c,u){let l=n_(o,c,u);return o.inclusive?l<=0:l<0}(n.startAt,fi(n),i)||n.endAt&&!function(o,c,u){let l=n_(o,c,u);return o.inclusive?l>=0:l>0}(n.endAt,fi(n),i))}(r,e)}function gw(r){return r.collectionGroup||(r.path.length%2==1?r.path.lastSegment():r.path.get(r.path.length-2))}function mw(r){return(e,t)=>{let n=!1;for(let i of fi(r)){let s=qb(i,e,t);if(s!==0)return s;n=n||i.field.isKeyField()}return 0}}function qb(r,e,t){let n=r.field.isKeyField()?L.comparator(e.key,t.key):function(s,o,c){let u=o.data.field(s),l=c.data.field(s);return u!==null&&l!==null?On(u,l):U()}(r.field,e,t);switch(r.dir){case"asc":return n;case"desc":return-1*n;default:return U()}}var $t=class{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){let t=this.mapKeyFn(e),n=this.inner[t];if(n!==void 0){for(let[i,s]of n)if(this.equalsFn(i,e))return s}}has(e){return this.get(e)!==void 0}set(e,t){let n=this.mapKeyFn(e),i=this.inner[n];if(i===void 0)return this.inner[n]=[[e,t]],void this.innerSize++;for(let s=0;s<i.length;s++)if(this.equalsFn(i[s][0],e))return void(i[s]=[e,t]);i.push([e,t]),this.innerSize++}delete(e){let t=this.mapKeyFn(e),n=this.inner[t];if(n===void 0)return!1;for(let i=0;i<n.length;i++)if(this.equalsFn(n[i][0],e))return n.length===1?delete this.inner[t]:n.splice(i,1),this.innerSize--,!0;return!1}forEach(e){Er(this.inner,(t,n)=>{for(let[i,s]of n)e(i,s)})}isEmpty(){return iw(this.inner)}size(){return this.innerSize}};var Gb=new pe(L.comparator);function tt(){return Gb}var yw=new pe(L.comparator);function eo(...r){let e=yw;for(let t of r)e=e.insert(t.key,t);return e}function vw(r){let e=yw;return r.forEach((t,n)=>e=e.insert(t,n.overlayedDocument)),e}function Ot(){return ro()}function _w(){return ro()}function ro(){return new $t(r=>r.toString(),(r,e)=>r.isEqual(e))}var Kb=new pe(L.comparator),Wb=new he(L.comparator);function Z(...r){let e=Wb;for(let t of r)e=e.add(t);return e}var Hb=new he(J);function Jf(){return Hb}function ww(r,e){if(r.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:co(e)?"-0":e}}function Ew(r){return{integerValue:""+r}}function Tw(r,e){return J_(e)?Ew(e):ww(r,e)}var _i=class{constructor(){this._=void 0}};function Qb(r,e,t){return r instanceof Vn?function(i,s){let o={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:i.seconds,nanos:i.nanoseconds}}}};return s&&Xc(s)&&(s=Qf(s)),s&&(o.fields.__previous_value__=s),{mapValue:o}}(t,e):r instanceof cn?Aw(r,e):r instanceof un?Sw(r,e):function(i,s){let o=Iw(i,s),c=a_(o)+a_(i.Pe);return od(o)&&od(i.Pe)?Ew(c):ww(i.serializer,c)}(r,e)}function Yb(r,e,t){return r instanceof cn?Aw(r,e):r instanceof un?Sw(r,e):t}function Iw(r,e){return r instanceof Ln?function(n){return od(n)||function(s){return!!s&&"doubleValue"in s}(n)}(e)?e:{integerValue:0}:null}var Vn=class extends _i{},cn=class extends _i{constructor(e){super(),this.elements=e}};function Aw(r,e){let t=bw(e);for(let n of r.elements)t.some(i=>Ut(i,n))||t.push(n);return{arrayValue:{values:t}}}var un=class extends _i{constructor(e){super(),this.elements=e}};function Sw(r,e){let t=bw(e);for(let n of r.elements)t=t.filter(i=>!Ut(i,n));return{arrayValue:{values:t}}}var Ln=class extends _i{constructor(e,t){super(),this.serializer=e,this.Pe=t}};function a_(r){return Ee(r.integerValue||r.doubleValue)}function bw(r){return fo(r)&&r.arrayValue.values?r.arrayValue.values.slice():[]}var pr=class{constructor(e,t){this.field=e,this.transform=t}};function Xb(r,e){return r.field.isEqual(e.field)&&function(n,i){return n instanceof cn&&i instanceof cn||n instanceof un&&i instanceof un?gi(n.elements,i.elements,Ut):n instanceof Ln&&i instanceof Ln?Ut(n.Pe,i.Pe):n instanceof Vn&&i instanceof Vn}(r.transform,e.transform)}var vd=class{constructor(e,t){this.version=e,this.transformResults=t}},Te=class r{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new r}static exists(e){return new r(void 0,e)}static updateTime(e){return new r(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}};function Ja(r,e){return r.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(r.updateTime):r.exists===void 0||r.exists===e.isFoundDocument()}var wi=class{};function Rw(r,e){if(!r.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return r.isNoDocument()?new Un(r.key,Te.none()):new Fn(r.key,r.data,Te.none());{let t=r.data,n=We.empty(),i=new he(Se.comparator);for(let s of e.fields)if(!i.has(s)){let o=t.field(s);o===null&&s.length>1&&(s=s.popLast(),o=t.field(s)),o===null?n.delete(s):n.set(s,o),i=i.add(s)}return new It(r.key,n,new ut(i.toArray()),Te.none())}}function Jb(r,e,t){r instanceof Fn?function(i,s,o){let c=i.value.clone(),u=u_(i.fieldTransforms,s,o.transformResults);c.setAll(u),s.convertToFoundDocument(o.version,c).setHasCommittedMutations()}(r,e,t):r instanceof It?function(i,s,o){if(!Ja(i.precondition,s))return void s.convertToUnknownDocument(o.version);let c=u_(i.fieldTransforms,s,o.transformResults),u=s.data;u.setAll(Cw(i)),u.setAll(c),s.convertToFoundDocument(o.version,u).setHasCommittedMutations()}(r,e,t):function(i,s,o){s.convertToNoDocument(o.version).setHasCommittedMutations()}(0,e,t)}function io(r,e,t,n){return r instanceof Fn?function(s,o,c,u){if(!Ja(s.precondition,o))return c;let l=s.value.clone(),f=l_(s.fieldTransforms,u,o);return l.setAll(f),o.convertToFoundDocument(o.version,l).setHasLocalMutations(),null}(r,e,t,n):r instanceof It?function(s,o,c,u){if(!Ja(s.precondition,o))return c;let l=l_(s.fieldTransforms,u,o),f=o.data;return f.setAll(Cw(s)),f.setAll(l),o.convertToFoundDocument(o.version,f).setHasLocalMutations(),c===null?null:c.unionWith(s.fieldMask.fields).unionWith(s.fieldTransforms.map(p=>p.field))}(r,e,t,n):function(s,o,c){return Ja(s.precondition,o)?(o.convertToNoDocument(o.version).setHasLocalMutations(),null):c}(r,e,t)}function Zb(r,e){let t=null;for(let n of r.fieldTransforms){let i=e.data.field(n.field),s=Iw(n.transform,i||null);s!=null&&(t===null&&(t=We.empty()),t.set(n.field,s))}return t||null}function c_(r,e){return r.type===e.type&&!!r.key.isEqual(e.key)&&!!r.precondition.isEqual(e.precondition)&&!!function(n,i){return n===void 0&&i===void 0||!(!n||!i)&&gi(n,i,(s,o)=>Xb(s,o))}(r.fieldTransforms,e.fieldTransforms)&&(r.type===0?r.value.isEqual(e.value):r.type!==1||r.data.isEqual(e.data)&&r.fieldMask.isEqual(e.fieldMask))}var Fn=class extends wi{constructor(e,t,n,i=[]){super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}},It=class extends wi{constructor(e,t,n,i,s=[]){super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=i,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}};function Cw(r){let e=new Map;return r.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){let n=r.data.field(t);e.set(t,n)}}),e}function u_(r,e,t){let n=new Map;q(r.length===t.length);for(let i=0;i<t.length;i++){let s=r[i],o=s.transform,c=e.data.field(s.field);n.set(s.field,Yb(o,c,t[i]))}return n}function l_(r,e,t){let n=new Map;for(let i of r){let s=i.transform,o=t.data.field(i.field);n.set(i.field,Qb(s,o,e))}return n}var Un=class extends wi{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}},po=class extends wi{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}};var go=class{constructor(e,t,n,i){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=i}applyToRemoteDocument(e,t){let n=t.mutationResults;for(let i=0;i<this.mutations.length;i++){let s=this.mutations[i];s.key.isEqual(e.key)&&Jb(s,e,n[i])}}applyToLocalView(e,t){for(let n of this.baseMutations)n.key.isEqual(e.key)&&(t=io(n,e,t,this.localWriteTime));for(let n of this.mutations)n.key.isEqual(e.key)&&(t=io(n,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){let n=_w();return this.mutations.forEach(i=>{let s=e.get(i.key),o=s.overlayedDocument,c=this.applyToLocalView(o,s.mutatedFields);c=t.has(i.key)?null:c;let u=Rw(o,c);u!==null&&n.set(i.key,u),o.isValidDocument()||o.convertToNoDocument(K.min())}),n}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),Z())}isEqual(e){return this.batchId===e.batchId&&gi(this.mutations,e.mutations,(t,n)=>c_(t,n))&&gi(this.baseMutations,e.baseMutations,(t,n)=>c_(t,n))}},_d=class r{constructor(e,t,n,i){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=i}static from(e,t,n){q(e.mutations.length===n.length);let i=function(){return Kb}(),s=e.mutations;for(let o=0;o<s.length;o++)i=i.insert(s[o].key,n[o].version);return new r(e,t,n,i)}};var mo=class{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}};var wd=class{constructor(e,t){this.count=e,this.unchangedNames=t}};var Pe,ne;function Pw(r){switch(r){default:return U();case C.CANCELLED:case C.UNKNOWN:case C.DEADLINE_EXCEEDED:case C.RESOURCE_EXHAUSTED:case C.INTERNAL:case C.UNAVAILABLE:case C.UNAUTHENTICATED:return!1;case C.INVALID_ARGUMENT:case C.NOT_FOUND:case C.ALREADY_EXISTS:case C.PERMISSION_DENIED:case C.FAILED_PRECONDITION:case C.ABORTED:case C.OUT_OF_RANGE:case C.UNIMPLEMENTED:case C.DATA_LOSS:return!0}}function Dw(r){if(r===void 0)return Ae("GRPC error has no .code"),C.UNKNOWN;switch(r){case Pe.OK:return C.OK;case Pe.CANCELLED:return C.CANCELLED;case Pe.UNKNOWN:return C.UNKNOWN;case Pe.DEADLINE_EXCEEDED:return C.DEADLINE_EXCEEDED;case Pe.RESOURCE_EXHAUSTED:return C.RESOURCE_EXHAUSTED;case Pe.INTERNAL:return C.INTERNAL;case Pe.UNAVAILABLE:return C.UNAVAILABLE;case Pe.UNAUTHENTICATED:return C.UNAUTHENTICATED;case Pe.INVALID_ARGUMENT:return C.INVALID_ARGUMENT;case Pe.NOT_FOUND:return C.NOT_FOUND;case Pe.ALREADY_EXISTS:return C.ALREADY_EXISTS;case Pe.PERMISSION_DENIED:return C.PERMISSION_DENIED;case Pe.FAILED_PRECONDITION:return C.FAILED_PRECONDITION;case Pe.ABORTED:return C.ABORTED;case Pe.OUT_OF_RANGE:return C.OUT_OF_RANGE;case Pe.UNIMPLEMENTED:return C.UNIMPLEMENTED;case Pe.DATA_LOSS:return C.DATA_LOSS;default:return U()}}(ne=Pe||(Pe={}))[ne.OK=0]="OK",ne[ne.CANCELLED=1]="CANCELLED",ne[ne.UNKNOWN=2]="UNKNOWN",ne[ne.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",ne[ne.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",ne[ne.NOT_FOUND=5]="NOT_FOUND",ne[ne.ALREADY_EXISTS=6]="ALREADY_EXISTS",ne[ne.PERMISSION_DENIED=7]="PERMISSION_DENIED",ne[ne.UNAUTHENTICATED=16]="UNAUTHENTICATED",ne[ne.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",ne[ne.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",ne[ne.ABORTED=10]="ABORTED",ne[ne.OUT_OF_RANGE=11]="OUT_OF_RANGE",ne[ne.UNIMPLEMENTED=12]="UNIMPLEMENTED",ne[ne.INTERNAL=13]="INTERNAL",ne[ne.UNAVAILABLE=14]="UNAVAILABLE",ne[ne.DATA_LOSS=15]="DATA_LOSS";var h_=null;function xw(){return new TextEncoder}var eR=new An([4294967295,4294967295],0);function d_(r){let e=xw().encode(r),t=new Oh;return t.update(e),new Uint8Array(t.digest())}function f_(r){let e=new DataView(r.buffer),t=e.getUint32(0,!0),n=e.getUint32(4,!0),i=e.getUint32(8,!0),s=e.getUint32(12,!0);return[new An([t,n],0),new An([i,s],0)]}var Ed=class r{constructor(e,t,n){if(this.bitmap=e,this.padding=t,this.hashCount=n,t<0||t>=8)throw new cr(`Invalid padding: ${t}`);if(n<0)throw new cr(`Invalid hash count: ${n}`);if(e.length>0&&this.hashCount===0)throw new cr(`Invalid hash count: ${n}`);if(e.length===0&&t!==0)throw new cr(`Invalid padding when bitmap length is 0: ${t}`);this.Ie=8*e.length-t,this.Te=An.fromNumber(this.Ie)}Ee(e,t,n){let i=e.add(t.multiply(An.fromNumber(n)));return i.compare(eR)===1&&(i=new An([i.getBits(0),i.getBits(1)],0)),i.modulo(this.Te).toNumber()}de(e){return(this.bitmap[Math.floor(e/8)]&1<<e%8)!=0}mightContain(e){if(this.Ie===0)return!1;let t=d_(e),[n,i]=f_(t);for(let s=0;s<this.hashCount;s++){let o=this.Ee(n,i,s);if(!this.de(o))return!1}return!0}static create(e,t,n){let i=e%8==0?0:8-e%8,s=new Uint8Array(Math.ceil(e/8)),o=new r(s,i,t);return n.forEach(c=>o.insert(c)),o}insert(e){if(this.Ie===0)return;let t=d_(e),[n,i]=f_(t);for(let s=0;s<this.hashCount;s++){let o=this.Ee(n,i,s);this.Ae(o)}}Ae(e){let t=Math.floor(e/8),n=e%8;this.bitmap[t]|=1<<n}},cr=class extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}};var yo=class r{constructor(e,t,n,i,s){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=i,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(e,t,n){let i=new Map;return i.set(e,vo.createSynthesizedTargetChangeForCurrentChange(e,t,n)),new r(K.min(),i,new pe(J),tt(),Z())}},vo=class r{constructor(e,t,n,i,s){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=i,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(e,t,n){return new r(n,t,Z(),Z(),Z())}};var pi=class{constructor(e,t,n,i){this.Re=e,this.removedTargetIds=t,this.key=n,this.Ve=i}},fc=class{constructor(e,t){this.targetId=e,this.me=t}},pc=class{constructor(e,t,n=Fe.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=i}},gc=class{constructor(){this.fe=0,this.ge=g_(),this.pe=Fe.EMPTY_BYTE_STRING,this.ye=!1,this.we=!0}get current(){return this.ye}get resumeToken(){return this.pe}get Se(){return this.fe!==0}get be(){return this.we}De(e){e.approximateByteSize()>0&&(this.we=!0,this.pe=e)}Ce(){let e=Z(),t=Z(),n=Z();return this.ge.forEach((i,s)=>{switch(s){case 0:e=e.add(i);break;case 2:t=t.add(i);break;case 1:n=n.add(i);break;default:U()}}),new vo(this.pe,this.ye,e,t,n)}ve(){this.we=!1,this.ge=g_()}Fe(e,t){this.we=!0,this.ge=this.ge.insert(e,t)}Me(e){this.we=!0,this.ge=this.ge.remove(e)}xe(){this.fe+=1}Oe(){this.fe-=1,q(this.fe>=0)}Ne(){this.we=!0,this.ye=!0}},Td=class{constructor(e){this.Le=e,this.Be=new Map,this.ke=tt(),this.qe=p_(),this.Qe=new pe(J)}Ke(e){for(let t of e.Re)e.Ve&&e.Ve.isFoundDocument()?this.$e(t,e.Ve):this.Ue(t,e.key,e.Ve);for(let t of e.removedTargetIds)this.Ue(t,e.key,e.Ve)}We(e){this.forEachTarget(e,t=>{let n=this.Ge(t);switch(e.state){case 0:this.ze(t)&&n.De(e.resumeToken);break;case 1:n.Oe(),n.Se||n.ve(),n.De(e.resumeToken);break;case 2:n.Oe(),n.Se||this.removeTarget(t);break;case 3:this.ze(t)&&(n.Ne(),n.De(e.resumeToken));break;case 4:this.ze(t)&&(this.je(t),n.De(e.resumeToken));break;default:U()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Be.forEach((n,i)=>{this.ze(i)&&t(i)})}He(e){let t=e.targetId,n=e.me.count,i=this.Je(t);if(i){let s=i.target;if(lc(s))if(n===0){let o=new L(s.path);this.Ue(t,o,ke.newNoDocument(o,K.min()))}else q(n===1);else{let o=this.Ye(t);if(o!==n){let c=this.Ze(e),u=c?this.Xe(c,e,o):1;if(u!==0){this.je(t);let l=u===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Qe=this.Qe.insert(t,l)}h_?.et(function(f,p,m,T,x){var N,D,j,G,V,H;let Q={localCacheCount:f,existenceFilterCount:p.count,databaseId:m.database,projectId:m.projectId},Y=p.unchangedNames;return Y&&(Q.bloomFilter={applied:x===0,hashCount:(N=Y?.hashCount)!==null&&N!==void 0?N:0,bitmapLength:(G=(j=(D=Y?.bits)===null||D===void 0?void 0:D.bitmap)===null||j===void 0?void 0:j.length)!==null&&G!==void 0?G:0,padding:(H=(V=Y?.bits)===null||V===void 0?void 0:V.padding)!==null&&H!==void 0?H:0,mightContain:w=>{var y;return(y=T?.mightContain(w))!==null&&y!==void 0&&y}}),Q}(o,e.me,this.Le.tt(),c,u))}}}}Ze(e){let t=e.me.unchangedNames;if(!t||!t.bits)return null;let{bits:{bitmap:n="",padding:i=0},hashCount:s=0}=t,o,c;try{o=kn(n).toUint8Array()}catch(u){if(u instanceof ac)return gt("Decoding the base64 bloom filter in existence filter failed ("+u.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw u}try{c=new Ed(o,i,s)}catch(u){return gt(u instanceof cr?"BloomFilter error: ":"Applying bloom filter failed: ",u),null}return c.Ie===0?null:c}Xe(e,t,n){return t.me.count===n-this.nt(e,t.targetId)?0:2}nt(e,t){let n=this.Le.getRemoteKeysForTarget(t),i=0;return n.forEach(s=>{let o=this.Le.tt(),c=`projects/${o.projectId}/databases/${o.database}/documents/${s.path.canonicalString()}`;e.mightContain(c)||(this.Ue(t,s,null),i++)}),i}rt(e){let t=new Map;this.Be.forEach((s,o)=>{let c=this.Je(o);if(c){if(s.current&&lc(c.target)){let u=new L(c.target.path);this.ke.get(u)!==null||this.it(o,u)||this.Ue(o,u,ke.newNoDocument(u,e))}s.be&&(t.set(o,s.Ce()),s.ve())}});let n=Z();this.qe.forEach((s,o)=>{let c=!0;o.forEachWhile(u=>{let l=this.Je(u);return!l||l.purpose==="TargetPurposeLimboResolution"||(c=!1,!1)}),c&&(n=n.add(s))}),this.ke.forEach((s,o)=>o.setReadTime(e));let i=new yo(e,t,this.Qe,this.ke,n);return this.ke=tt(),this.qe=p_(),this.Qe=new pe(J),i}$e(e,t){if(!this.ze(e))return;let n=this.it(e,t.key)?2:0;this.Ge(e).Fe(t.key,n),this.ke=this.ke.insert(t.key,t),this.qe=this.qe.insert(t.key,this.st(t.key).add(e))}Ue(e,t,n){if(!this.ze(e))return;let i=this.Ge(e);this.it(e,t)?i.Fe(t,1):i.Me(t),this.qe=this.qe.insert(t,this.st(t).delete(e)),n&&(this.ke=this.ke.insert(t,n))}removeTarget(e){this.Be.delete(e)}Ye(e){let t=this.Ge(e).Ce();return this.Le.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}xe(e){this.Ge(e).xe()}Ge(e){let t=this.Be.get(e);return t||(t=new gc,this.Be.set(e,t)),t}st(e){let t=this.qe.get(e);return t||(t=new he(J),this.qe=this.qe.insert(e,t)),t}ze(e){let t=this.Je(e)!==null;return t||M("WatchChangeAggregator","Detected inactive target",e),t}Je(e){let t=this.Be.get(e);return t&&t.Se?null:this.Le.ot(e)}je(e){this.Be.set(e,new gc),this.Le.getRemoteKeysForTarget(e).forEach(t=>{this.Ue(e,t,null)})}it(e,t){return this.Le.getRemoteKeysForTarget(e).has(t)}};function p_(){return new pe(L.comparator)}function g_(){return new pe(L.comparator)}var tR={asc:"ASCENDING",desc:"DESCENDING"},nR={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},rR={and:"AND",or:"OR"},Id=class{constructor(e,t){this.databaseId=e,this.useProto3Json=t}};function Ad(r,e){return r.useProto3Json||Do(e)?e:{value:e}}function Ei(r,e){return r.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function Nw(r,e){return r.useProto3Json?e.toBase64():e.toUint8Array()}function iR(r,e){return Ei(r,e.toTimestamp())}function be(r){return q(!!r),K.fromTimestamp(function(t){let n=an(t);return new _e(n.seconds,n.nanos)}(r))}function Zf(r,e){return Sd(r,e).canonicalString()}function Sd(r,e){let t=function(i){return new re(["projects",i.projectId,"databases",i.database])}(r).child("documents");return e===void 0?t:t.child(e)}function kw(r){let e=re.fromString(r);return q(Bw(e)),e}function _o(r,e){return Zf(r.databaseId,e.path)}function Lt(r,e){let t=kw(e);if(t.get(1)!==r.databaseId.projectId)throw new k(C.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+r.databaseId.projectId);if(t.get(3)!==r.databaseId.database)throw new k(C.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+r.databaseId.database);return new L(Vw(t))}function Mw(r,e){return Zf(r.databaseId,e)}function Ow(r){let e=kw(r);return e.length===4?re.emptyPath():Vw(e)}function bd(r){return new re(["projects",r.databaseId.projectId,"databases",r.databaseId.database]).canonicalString()}function Vw(r){return q(r.length>4&&r.get(4)==="documents"),r.popFirst(5)}function m_(r,e,t){return{name:_o(r,e),fields:t.value.mapValue.fields}}function Lw(r,e,t){let n=Lt(r,e.name),i=be(e.updateTime),s=e.createTime?be(e.createTime):K.min(),o=new We({mapValue:{fields:e.fields}}),c=ke.newFoundDocument(n,i,s,o);return t&&c.setHasCommittedMutations(),t?c.setHasCommittedMutations():c}function sR(r,e){return"found"in e?function(n,i){q(!!i.found),i.found.name,i.found.updateTime;let s=Lt(n,i.found.name),o=be(i.found.updateTime),c=i.found.createTime?be(i.found.createTime):K.min(),u=new We({mapValue:{fields:i.found.fields}});return ke.newFoundDocument(s,o,c,u)}(r,e):"missing"in e?function(n,i){q(!!i.missing),q(!!i.readTime);let s=Lt(n,i.missing),o=be(i.readTime);return ke.newNoDocument(s,o)}(r,e):U()}function oR(r,e){let t;if("targetChange"in e){e.targetChange;let n=function(l){return l==="NO_CHANGE"?0:l==="ADD"?1:l==="REMOVE"?2:l==="CURRENT"?3:l==="RESET"?4:U()}(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],s=function(l,f){return l.useProto3Json?(q(f===void 0||typeof f=="string"),Fe.fromBase64String(f||"")):(q(f===void 0||f instanceof Buffer||f instanceof Uint8Array),Fe.fromUint8Array(f||new Uint8Array))}(r,e.targetChange.resumeToken),o=e.targetChange.cause,c=o&&function(l){let f=l.code===void 0?C.UNKNOWN:Dw(l.code);return new k(f,l.message||"")}(o);t=new pc(n,i,s,c||null)}else if("documentChange"in e){e.documentChange;let n=e.documentChange;n.document,n.document.name,n.document.updateTime;let i=Lt(r,n.document.name),s=be(n.document.updateTime),o=n.document.createTime?be(n.document.createTime):K.min(),c=new We({mapValue:{fields:n.document.fields}}),u=ke.newFoundDocument(i,s,o,c),l=n.targetIds||[],f=n.removedTargetIds||[];t=new pi(l,f,u.key,u)}else if("documentDelete"in e){e.documentDelete;let n=e.documentDelete;n.document;let i=Lt(r,n.document),s=n.readTime?be(n.readTime):K.min(),o=ke.newNoDocument(i,s),c=n.removedTargetIds||[];t=new pi([],c,o.key,o)}else if("documentRemove"in e){e.documentRemove;let n=e.documentRemove;n.document;let i=Lt(r,n.document),s=n.removedTargetIds||[];t=new pi([],s,i,null)}else{if(!("filter"in e))return U();{e.filter;let n=e.filter;n.targetId;let{count:i=0,unchangedNames:s}=n,o=new wd(i,s),c=n.targetId;t=new fc(c,o)}}return t}function wo(r,e){let t;if(e instanceof Fn)t={update:m_(r,e.key,e.value)};else if(e instanceof Un)t={delete:_o(r,e.key)};else if(e instanceof It)t={update:m_(r,e.key,e.data),updateMask:dR(e.fieldMask)};else{if(!(e instanceof po))return U();t={verify:_o(r,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(n=>function(s,o){let c=o.transform;if(c instanceof Vn)return{fieldPath:o.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(c instanceof cn)return{fieldPath:o.field.canonicalString(),appendMissingElements:{values:c.elements}};if(c instanceof un)return{fieldPath:o.field.canonicalString(),removeAllFromArray:{values:c.elements}};if(c instanceof Ln)return{fieldPath:o.field.canonicalString(),increment:c.Pe};throw U()}(0,n))),e.precondition.isNone||(t.currentDocument=function(i,s){return s.updateTime!==void 0?{updateTime:iR(i,s.updateTime)}:s.exists!==void 0?{exists:s.exists}:U()}(r,e.precondition)),t}function Rd(r,e){let t=e.currentDocument?function(s){return s.updateTime!==void 0?Te.updateTime(be(s.updateTime)):s.exists!==void 0?Te.exists(s.exists):Te.none()}(e.currentDocument):Te.none(),n=e.updateTransforms?e.updateTransforms.map(i=>function(o,c){let u=null;if("setToServerValue"in c)q(c.setToServerValue==="REQUEST_TIME"),u=new Vn;else if("appendMissingElements"in c){let f=c.appendMissingElements.values||[];u=new cn(f)}else if("removeAllFromArray"in c){let f=c.removeAllFromArray.values||[];u=new un(f)}else"increment"in c?u=new Ln(o,c.increment):U();let l=Se.fromServerFormat(c.fieldPath);return new pr(l,u)}(r,i)):[];if(e.update){e.update.name;let i=Lt(r,e.update.name),s=new We({mapValue:{fields:e.update.fields}});if(e.updateMask){let o=function(u){let l=u.fieldPaths||[];return new ut(l.map(f=>Se.fromServerFormat(f)))}(e.updateMask);return new It(i,s,o,t,n)}return new Fn(i,s,t,n)}if(e.delete){let i=Lt(r,e.delete);return new Un(i,t)}if(e.verify){let i=Lt(r,e.verify);return new po(i,t)}return U()}function aR(r,e){return r&&r.length>0?(q(e!==void 0),r.map(t=>function(i,s){let o=i.updateTime?be(i.updateTime):be(s);return o.isEqual(K.min())&&(o=be(s)),new vd(o,i.transformResults||[])}(t,e))):[]}function Fw(r,e){return{documents:[Mw(r,e.path)]}}function Uw(r,e){let t={structuredQuery:{}},n=e.path,i;e.collectionGroup!==null?(i=n,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(i=n.popLast(),t.structuredQuery.from=[{collectionId:n.lastSegment()}]),t.parent=Mw(r,i);let s=function(l){if(l.length!==0)return zw(ue.create(l,"and"))}(e.filters);s&&(t.structuredQuery.where=s);let o=function(l){if(l.length!==0)return l.map(f=>function(m){return{field:ci(m.field),direction:uR(m.dir)}}(f))}(e.orderBy);o&&(t.structuredQuery.orderBy=o);let c=Ad(r,e.limit);return c!==null&&(t.structuredQuery.limit=c),e.startAt&&(t.structuredQuery.startAt=function(l){return{before:l.inclusive,values:l.position}}(e.startAt)),e.endAt&&(t.structuredQuery.endAt=function(l){return{before:!l.inclusive,values:l.position}}(e.endAt)),{_t:t,parent:i}}function jw(r){let e=Ow(r.parent),t=r.structuredQuery,n=t.from?t.from.length:0,i=null;if(n>0){q(n===1);let f=t.from[0];f.allDescendants?i=f.collectionId:e=e.child(f.collectionId)}let s=[];t.where&&(s=function(p){let m=$w(p);return m instanceof ue&&Yf(m)?m.getFilters():[m]}(t.where));let o=[];t.orderBy&&(o=function(p){return p.map(m=>function(x){return new dr(ui(x.field),function(D){switch(D){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(x.direction))}(m))}(t.orderBy));let c=null;t.limit&&(c=function(p){let m;return m=typeof p=="object"?p.value:p,Do(m)?null:m}(t.limit));let u=null;t.startAt&&(u=function(p){let m=!!p.before,T=p.values||[];return new jt(T,m)}(t.startAt));let l=null;return t.endAt&&(l=function(p){let m=!p.before,T=p.values||[];return new jt(T,m)}(t.endAt)),fw(e,i,o,s,c,"F",u,l)}function cR(r,e){let t=function(i){switch(i){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return U()}}(e.purpose);return t==null?null:{"goog-listen-tags":t}}function $w(r){return r.unaryFilter!==void 0?function(t){switch(t.unaryFilter.op){case"IS_NAN":let n=ui(t.unaryFilter.field);return te.create(n,"==",{doubleValue:NaN});case"IS_NULL":let i=ui(t.unaryFilter.field);return te.create(i,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let s=ui(t.unaryFilter.field);return te.create(s,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let o=ui(t.unaryFilter.field);return te.create(o,"!=",{nullValue:"NULL_VALUE"});default:return U()}}(r):r.fieldFilter!==void 0?function(t){return te.create(ui(t.fieldFilter.field),function(i){switch(i){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return U()}}(t.fieldFilter.op),t.fieldFilter.value)}(r):r.compositeFilter!==void 0?function(t){return ue.create(t.compositeFilter.filters.map(n=>$w(n)),function(i){switch(i){case"AND":return"and";case"OR":return"or";default:return U()}}(t.compositeFilter.op))}(r):U()}function uR(r){return tR[r]}function lR(r){return nR[r]}function hR(r){return rR[r]}function ci(r){return{fieldPath:r.canonicalString()}}function ui(r){return Se.fromServerFormat(r.fieldPath)}function zw(r){return r instanceof te?function(t){if(t.op==="=="){if(Zv(t.value))return{unaryFilter:{field:ci(t.field),op:"IS_NAN"}};if(Jv(t.value))return{unaryFilter:{field:ci(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(Zv(t.value))return{unaryFilter:{field:ci(t.field),op:"IS_NOT_NAN"}};if(Jv(t.value))return{unaryFilter:{field:ci(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:ci(t.field),op:lR(t.op),value:t.value}}}(r):r instanceof ue?function(t){let n=t.getFilters().map(i=>zw(i));return n.length===1?n[0]:{compositeFilter:{op:hR(t.op),filters:n}}}(r):U()}function dR(r){let e=[];return r.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function Bw(r){return r.length>=4&&r.get(0)==="projects"&&r.get(2)==="databases"}var Ti=class r{constructor(e,t,n,i,s=K.min(),o=K.min(),c=Fe.EMPTY_BYTE_STRING,u=null){this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=i,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=c,this.expectedCount=u}withSequenceNumber(e){return new r(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new r(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new r(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new r(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}};var mc=class{constructor(e){this.ct=e}};function fR(r,e){let t;if(e.document)t=Lw(r.ct,e.document,!!e.hasCommittedMutations);else if(e.noDocument){let n=L.fromSegments(e.noDocument.path),i=mr(e.noDocument.readTime);t=ke.newNoDocument(n,i),e.hasCommittedMutations&&t.setHasCommittedMutations()}else{if(!e.unknownDocument)return U();{let n=L.fromSegments(e.unknownDocument.path),i=mr(e.unknownDocument.version);t=ke.newUnknownDocument(n,i)}}return e.readTime&&t.setReadTime(function(i){let s=new _e(i[0],i[1]);return K.fromTimestamp(s)}(e.readTime)),t}function y_(r,e){let t=e.key,n={prefixPath:t.getCollectionPath().popLast().toArray(),collectionGroup:t.collectionGroup,documentId:t.path.lastSegment(),readTime:yc(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())n.document=function(s,o){return{name:_o(s,o.key),fields:o.data.value.mapValue.fields,updateTime:Ei(s,o.version.toTimestamp()),createTime:Ei(s,o.createTime.toTimestamp())}}(r.ct,e);else if(e.isNoDocument())n.noDocument={path:t.path.toArray(),readTime:gr(e.version)};else{if(!e.isUnknownDocument())return U();n.unknownDocument={path:t.path.toArray(),version:gr(e.version)}}return n}function yc(r){let e=r.toTimestamp();return[e.seconds,e.nanoseconds]}function gr(r){let e=r.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function mr(r){let e=new _e(r.seconds,r.nanoseconds);return K.fromTimestamp(e)}function sr(r,e){let t=(e.baseMutations||[]).map(s=>Rd(r.ct,s));for(let s=0;s<e.mutations.length-1;++s){let o=e.mutations[s];if(s+1<e.mutations.length&&e.mutations[s+1].transform!==void 0){let c=e.mutations[s+1];o.updateTransforms=c.transform.fieldTransforms,e.mutations.splice(s+1,1),++s}}let n=e.mutations.map(s=>Rd(r.ct,s)),i=_e.fromMillis(e.localWriteTimeMs);return new go(e.batchId,i,t,n)}function to(r){let e=mr(r.readTime),t=r.lastLimboFreeSnapshotVersion!==void 0?mr(r.lastLimboFreeSnapshotVersion):K.min(),n;return n=function(s){return s.documents!==void 0}(r.query)?function(s){return q(s.documents.length===1),Ze(ki(Ow(s.documents[0])))}(r.query):function(s){return Ze(jw(s))}(r.query),new Ti(n,r.targetId,"TargetPurposeListen",r.lastListenSequenceNumber,e,t,Fe.fromBase64String(r.resumeToken))}function qw(r,e){let t=gr(e.snapshotVersion),n=gr(e.lastLimboFreeSnapshotVersion),i;i=lc(e.target)?Fw(r.ct,e.target):Uw(r.ct,e.target)._t;let s=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:fr(e.target),readTime:t,resumeToken:s,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:n,query:i}}function ep(r){let e=jw({parent:r.parent,structuredQuery:r.structuredQuery});return r.limitType==="LAST"?dc(e,e.limit,"L"):e}function zh(r,e){return new mo(e.largestBatchId,Rd(r.ct,e.overlayMutation))}function v_(r,e){let t=e.path.lastSegment();return[r,Je(e.path.popLast()),t]}function __(r,e,t,n){return{indexId:r,uid:e,sequenceNumber:t,readTime:gr(n.readTime),documentKey:Je(n.documentKey.path),largestBatchId:n.largestBatchId}}var Cd=class{getBundleMetadata(e,t){return w_(e).get(t).next(n=>{if(n)return function(s){return{id:s.bundleId,createTime:mr(s.createTime),version:s.version}}(n)})}saveBundleMetadata(e,t){return w_(e).put(function(i){return{bundleId:i.id,createTime:gr(be(i.createTime)),version:i.version}}(t))}getNamedQuery(e,t){return E_(e).get(t).next(n=>{if(n)return function(s){return{name:s.name,query:ep(s.bundledQuery),readTime:mr(s.readTime)}}(n)})}saveNamedQuery(e,t){return E_(e).put(function(i){return{name:i.name,readTime:gr(be(i.readTime)),bundledQuery:i.bundledQuery}}(t))}};function w_(r){return Ue(r,"bundles")}function E_(r){return Ue(r,"namedQueries")}var vc=class r{constructor(e,t){this.serializer=e,this.userId=t}static lt(e,t){let n=t.uid||"";return new r(e,n)}getOverlay(e,t){return Ys(e).get(v_(this.userId,t)).next(n=>n?zh(this.serializer,n):null)}getOverlays(e,t){let n=Ot();return b.forEach(t,i=>this.getOverlay(e,i).next(s=>{s!==null&&n.set(i,s)})).next(()=>n)}saveOverlays(e,t,n){let i=[];return n.forEach((s,o)=>{let c=new mo(t,o);i.push(this.ht(e,c))}),b.waitFor(i)}removeOverlaysForBatchId(e,t,n){let i=new Set;t.forEach(o=>i.add(Je(o.getCollectionPath())));let s=[];return i.forEach(o=>{let c=IDBKeyRange.bound([this.userId,o,n],[this.userId,o,n+1],!1,!0);s.push(Ys(e).j("collectionPathOverlayIndex",c))}),b.waitFor(s)}getOverlaysForCollection(e,t,n){let i=Ot(),s=Je(t),o=IDBKeyRange.bound([this.userId,s,n],[this.userId,s,Number.POSITIVE_INFINITY],!0);return Ys(e).U("collectionPathOverlayIndex",o).next(c=>{for(let u of c){let l=zh(this.serializer,u);i.set(l.getKey(),l)}return i})}getOverlaysForCollectionGroup(e,t,n,i){let s=Ot(),o,c=IDBKeyRange.bound([this.userId,t,n],[this.userId,t,Number.POSITIVE_INFINITY],!0);return Ys(e).J({index:"collectionGroupOverlayIndex",range:c},(u,l,f)=>{let p=zh(this.serializer,l);s.size()<i||p.largestBatchId===o?(s.set(p.getKey(),p),o=p.largestBatchId):f.done()}).next(()=>s)}ht(e,t){return Ys(e).put(function(i,s,o){let[c,u,l]=v_(s,o.mutation.key);return{userId:s,collectionPath:u,documentId:l,collectionGroup:o.mutation.key.getCollectionGroup(),largestBatchId:o.largestBatchId,overlayMutation:wo(i.ct,o.mutation)}}(this.serializer,this.userId,t))}};function Ys(r){return Ue(r,"documentOverlays")}var sn=class{constructor(){}Pt(e,t){this.It(e,t),t.Tt()}It(e,t){if("nullValue"in e)this.Et(t,5);else if("booleanValue"in e)this.Et(t,10),t.dt(e.booleanValue?1:0);else if("integerValue"in e)this.Et(t,15),t.dt(Ee(e.integerValue));else if("doubleValue"in e){let n=Ee(e.doubleValue);isNaN(n)?this.Et(t,13):(this.Et(t,15),co(n)?t.dt(0):t.dt(n))}else if("timestampValue"in e){let n=e.timestampValue;this.Et(t,20),typeof n=="string"&&(n=an(n)),t.At(`${n.seconds||""}`),t.dt(n.nanos||0)}else if("stringValue"in e)this.Rt(e.stringValue,t),this.Vt(t);else if("bytesValue"in e)this.Et(t,30),t.ft(kn(e.bytesValue)),this.Vt(t);else if("referenceValue"in e)this.gt(e.referenceValue,t);else if("geoPointValue"in e){let n=e.geoPointValue;this.Et(t,45),t.dt(n.latitude||0),t.dt(n.longitude||0)}else"mapValue"in e?ow(e)?this.Et(t,Number.MAX_SAFE_INTEGER):(this.yt(e.mapValue,t),this.Vt(t)):"arrayValue"in e?(this.wt(e.arrayValue,t),this.Vt(t)):U()}Rt(e,t){this.Et(t,25),this.St(e,t)}St(e,t){t.At(e)}yt(e,t){let n=e.fields||{};this.Et(t,55);for(let i of Object.keys(n))this.Rt(i,t),this.It(n[i],t)}wt(e,t){let n=e.values||[];this.Et(t,50);for(let i of n)this.It(i,t)}gt(e,t){this.Et(t,37),L.fromName(e).path.forEach(n=>{this.Et(t,60),this.St(n,t)})}Et(e,t){e.dt(t)}Vt(e){e.dt(2)}};sn.bt=new sn;function pR(r){if(r===0)return 8;let e=0;return!(r>>4)&&(e+=4,r<<=4),!(r>>6)&&(e+=2,r<<=2),!(r>>7)&&(e+=1),e}function T_(r){let e=64-function(n){let i=0;for(let s=0;s<8;++s){let o=pR(255&n[s]);if(i+=o,o!==8)break}return i}(r);return Math.ceil(e/8)}var Pd=class{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Dt(e){let t=e[Symbol.iterator](),n=t.next();for(;!n.done;)this.Ct(n.value),n=t.next();this.vt()}Ft(e){let t=e[Symbol.iterator](),n=t.next();for(;!n.done;)this.Mt(n.value),n=t.next();this.xt()}Ot(e){for(let t of e){let n=t.charCodeAt(0);if(n<128)this.Ct(n);else if(n<2048)this.Ct(960|n>>>6),this.Ct(128|63&n);else if(t<"\uD800"||"\uDBFF"<t)this.Ct(480|n>>>12),this.Ct(128|63&n>>>6),this.Ct(128|63&n);else{let i=t.codePointAt(0);this.Ct(240|i>>>18),this.Ct(128|63&i>>>12),this.Ct(128|63&i>>>6),this.Ct(128|63&i)}}this.vt()}Nt(e){for(let t of e){let n=t.charCodeAt(0);if(n<128)this.Mt(n);else if(n<2048)this.Mt(960|n>>>6),this.Mt(128|63&n);else if(t<"\uD800"||"\uDBFF"<t)this.Mt(480|n>>>12),this.Mt(128|63&n>>>6),this.Mt(128|63&n);else{let i=t.codePointAt(0);this.Mt(240|i>>>18),this.Mt(128|63&i>>>12),this.Mt(128|63&i>>>6),this.Mt(128|63&i)}}this.xt()}Lt(e){let t=this.Bt(e),n=T_(t);this.kt(1+n),this.buffer[this.position++]=255&n;for(let i=t.length-n;i<t.length;++i)this.buffer[this.position++]=255&t[i]}qt(e){let t=this.Bt(e),n=T_(t);this.kt(1+n),this.buffer[this.position++]=~(255&n);for(let i=t.length-n;i<t.length;++i)this.buffer[this.position++]=~(255&t[i])}Qt(){this.Kt(255),this.Kt(255)}$t(){this.Ut(255),this.Ut(255)}reset(){this.position=0}seed(e){this.kt(e.length),this.buffer.set(e,this.position),this.position+=e.length}Wt(){return this.buffer.slice(0,this.position)}Bt(e){let t=function(s){let o=new DataView(new ArrayBuffer(8));return o.setFloat64(0,s,!1),new Uint8Array(o.buffer)}(e),n=(128&t[0])!=0;t[0]^=n?255:128;for(let i=1;i<t.length;++i)t[i]^=n?255:0;return t}Ct(e){let t=255&e;t===0?(this.Kt(0),this.Kt(255)):t===255?(this.Kt(255),this.Kt(0)):this.Kt(t)}Mt(e){let t=255&e;t===0?(this.Ut(0),this.Ut(255)):t===255?(this.Ut(255),this.Ut(0)):this.Ut(e)}vt(){this.Kt(0),this.Kt(1)}xt(){this.Ut(0),this.Ut(1)}Kt(e){this.kt(1),this.buffer[this.position++]=e}Ut(e){this.kt(1),this.buffer[this.position++]=~e}kt(e){let t=e+this.position;if(t<=this.buffer.length)return;let n=2*this.buffer.length;n<t&&(n=t);let i=new Uint8Array(n);i.set(this.buffer),this.buffer=i}},Dd=class{constructor(e){this.Gt=e}ft(e){this.Gt.Dt(e)}At(e){this.Gt.Ot(e)}dt(e){this.Gt.Lt(e)}Tt(){this.Gt.Qt()}},xd=class{constructor(e){this.Gt=e}ft(e){this.Gt.Ft(e)}At(e){this.Gt.Nt(e)}dt(e){this.Gt.qt(e)}Tt(){this.Gt.$t()}},or=class{constructor(){this.Gt=new Pd,this.zt=new Dd(this.Gt),this.jt=new xd(this.Gt)}seed(e){this.Gt.seed(e)}Ht(e){return e===0?this.zt:this.jt}Wt(){return this.Gt.Wt()}reset(){this.Gt.reset()}};var ar=class r{constructor(e,t,n,i){this.indexId=e,this.documentKey=t,this.arrayValue=n,this.directionalValue=i}Jt(){let e=this.directionalValue.length,t=e===0||this.directionalValue[e-1]===255?e+1:e,n=new Uint8Array(t);return n.set(this.directionalValue,0),t!==e?n.set([0],this.directionalValue.length):++n[n.length-1],new r(this.indexId,this.documentKey,this.arrayValue,n)}};function Sn(r,e){let t=r.indexId-e.indexId;return t!==0?t:(t=I_(r.arrayValue,e.arrayValue),t!==0?t:(t=I_(r.directionalValue,e.directionalValue),t!==0?t:L.comparator(r.documentKey,e.documentKey)))}function I_(r,e){for(let t=0;t<r.length&&t<e.length;++t){let n=r[t]-e[t];if(n!==0)return n}return r.length-e.length}var _c=class{constructor(e){this.Yt=new he((t,n)=>Se.comparator(t.field,n.field)),this.collectionId=e.collectionGroup!=null?e.collectionGroup:e.path.lastSegment(),this.Zt=e.orderBy,this.Xt=[];for(let t of e.filters){let n=t;n.isInequality()?this.Yt=this.Yt.add(n):this.Xt.push(n)}}get en(){return this.Yt.size>1}tn(e){if(q(e.collectionGroup===this.collectionId),this.en)return!1;let t=Zh(e);if(t!==void 0&&!this.nn(t))return!1;let n=rr(e),i=new Set,s=0,o=0;for(;s<n.length&&this.nn(n[s]);++s)i=i.add(n[s].fieldPath.canonicalString());if(s===n.length)return!0;if(this.Yt.size>0){let c=this.Yt.getIterator().getNext();if(!i.has(c.field.canonicalString())){let u=n[s];if(!this.rn(c,u)||!this.sn(this.Zt[o++],u))return!1}++s}for(;s<n.length;++s){let c=n[s];if(o>=this.Zt.length||!this.sn(this.Zt[o++],c))return!1}return!0}on(){if(this.en)return null;let e=new he(Se.comparator),t=[];for(let n of this.Xt)if(!n.field.isKeyField())if(n.op==="array-contains"||n.op==="array-contains-any")t.push(new di(n.field,2));else{if(e.has(n.field))continue;e=e.add(n.field),t.push(new di(n.field,0))}for(let n of this.Zt)n.field.isKeyField()||e.has(n.field)||(e=e.add(n.field),t.push(new di(n.field,n.dir==="asc"?0:1)));return new mi(mi.UNKNOWN_ID,this.collectionId,t,ao.empty())}nn(e){for(let t of this.Xt)if(this.rn(t,e))return!0;return!1}rn(e,t){if(e===void 0||!e.field.isEqual(t.fieldPath))return!1;let n=e.op==="array-contains"||e.op==="array-contains-any";return t.kind===2===n}sn(e,t){return!!e.field.isEqual(t.fieldPath)&&(t.kind===0&&e.dir==="asc"||t.kind===1&&e.dir==="desc")}};function Gw(r){var e,t;if(q(r instanceof te||r instanceof ue),r instanceof te){if(r instanceof uc){let i=((t=(e=r.value.arrayValue)===null||e===void 0?void 0:e.values)===null||t===void 0?void 0:t.map(s=>te.create(r.field,"==",s)))||[];return ue.create(i,"or")}return r}let n=r.filters.map(i=>Gw(i));return ue.create(n,r.op)}function gR(r){if(r.getFilters().length===0)return[];let e=Md(Gw(r));return q(Kw(e)),Nd(e)||kd(e)?[e]:e.getFilters()}function Nd(r){return r instanceof te}function kd(r){return r instanceof ue&&Yf(r)}function Kw(r){return Nd(r)||kd(r)||function(t){if(t instanceof ue&&ad(t)){for(let n of t.getFilters())if(!Nd(n)&&!kd(n))return!1;return!0}return!1}(r)}function Md(r){if(q(r instanceof te||r instanceof ue),r instanceof te)return r;if(r.filters.length===1)return Md(r.filters[0]);let e=r.filters.map(n=>Md(n)),t=ue.create(e,r.op);return t=wc(t),Kw(t)?t:(q(t instanceof ue),q(vi(t)),q(t.filters.length>1),t.filters.reduce((n,i)=>tp(n,i)))}function tp(r,e){let t;return q(r instanceof te||r instanceof ue),q(e instanceof te||e instanceof ue),t=r instanceof te?e instanceof te?function(i,s){return ue.create([i,s],"and")}(r,e):A_(r,e):e instanceof te?A_(e,r):function(i,s){if(q(i.filters.length>0&&s.filters.length>0),vi(i)&&vi(s))return lw(i,s.getFilters());let o=ad(i)?i:s,c=ad(i)?s:i,u=o.filters.map(l=>tp(l,c));return ue.create(u,"or")}(r,e),wc(t)}function A_(r,e){if(vi(e))return lw(e,r.getFilters());{let t=e.filters.map(n=>tp(r,n));return ue.create(t,"or")}}function wc(r){if(q(r instanceof te||r instanceof ue),r instanceof te)return r;let e=r.getFilters();if(e.length===1)return wc(e[0]);if(cw(r))return r;let t=e.map(i=>wc(i)),n=[];return t.forEach(i=>{i instanceof te?n.push(i):i instanceof ue&&(i.op===r.op?n.push(...i.filters):n.push(i))}),n.length===1?n[0]:ue.create(n,r.op)}var Od=class{constructor(){this._n=new Eo}addToCollectionParentIndex(e,t){return this._n.add(t),b.resolve()}getCollectionParents(e,t){return b.resolve(this._n.getEntries(t))}addFieldIndex(e,t){return b.resolve()}deleteFieldIndex(e,t){return b.resolve()}deleteAllFieldIndexes(e){return b.resolve()}createTargetIndexes(e,t){return b.resolve()}getDocumentsMatchingTarget(e,t){return b.resolve(null)}getIndexType(e,t){return b.resolve(0)}getFieldIndexes(e,t){return b.resolve([])}getNextCollectionGroupToUpdate(e){return b.resolve(null)}getMinOffset(e,t){return b.resolve(mt.min())}getMinOffsetFromCollectionGroup(e,t){return b.resolve(mt.min())}updateCollectionGroup(e,t,n){return b.resolve()}updateIndexEntries(e,t){return b.resolve()}},Eo=class{constructor(){this.index={}}add(e){let t=e.lastSegment(),n=e.popLast(),i=this.index[t]||new he(re.comparator),s=!i.has(n);return this.index[t]=i.add(n),s}has(e){let t=e.lastSegment(),n=e.popLast(),i=this.index[t];return i&&i.has(n)}getEntries(e){return(this.index[e]||new he(re.comparator)).toArray()}};var Ga=new Uint8Array(0),Vd=class{constructor(e,t){this.databaseId=t,this.an=new Eo,this.un=new $t(n=>fr(n),(n,i)=>xo(n,i)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.an.has(t)){let n=t.lastSegment(),i=t.popLast();e.addOnCommittedListener(()=>{this.an.add(t)});let s={collectionId:n,parent:Je(i)};return S_(e).put(s)}return b.resolve()}getCollectionParents(e,t){let n=[],i=IDBKeyRange.bound([t,""],[W_(t),""],!1,!0);return S_(e).U(i).next(s=>{for(let o of s){if(o.collectionId!==t)break;n.push(Mt(o.parent))}return n})}addFieldIndex(e,t){let n=Xs(e),i=function(c){return{indexId:c.indexId,collectionGroup:c.collectionGroup,fields:c.fields.map(u=>[u.fieldPath.canonicalString(),u.kind])}}(t);delete i.indexId;let s=n.add(i);if(t.indexState){let o=ii(e);return s.next(c=>{o.put(__(c,this.uid,t.indexState.sequenceNumber,t.indexState.offset))})}return s.next()}deleteFieldIndex(e,t){let n=Xs(e),i=ii(e),s=ri(e);return n.delete(t.indexId).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>s.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){let t=Xs(e),n=ri(e),i=ii(e);return t.j().next(()=>n.j()).next(()=>i.j())}createTargetIndexes(e,t){return b.forEach(this.cn(t),n=>this.getIndexType(e,n).next(i=>{if(i===0||i===1){let s=new _c(n).on();if(s!=null)return this.addFieldIndex(e,s)}}))}getDocumentsMatchingTarget(e,t){let n=ri(e),i=!0,s=new Map;return b.forEach(this.cn(t),o=>this.ln(e,o).next(c=>{i&&(i=!!c),s.set(o,c)})).next(()=>{if(i){let o=Z(),c=[];return b.forEach(s,(u,l)=>{M("IndexedDbIndexManager",`Using index ${function(V){return`id=${V.indexId}|cg=${V.collectionGroup}|f=${V.fields.map(H=>`${H.fieldPath}:${H.kind}`).join(",")}`}(u)} to execute ${fr(t)}`);let f=function(V,H){let Q=Zh(H);if(Q===void 0)return null;for(let Y of hc(V,Q.fieldPath))switch(Y.op){case"array-contains-any":return Y.value.arrayValue.values||[];case"array-contains":return[Y.value]}return null}(l,u),p=function(V,H){let Q=new Map;for(let Y of rr(H))for(let w of hc(V,Y.fieldPath))switch(w.op){case"==":case"in":Q.set(Y.fieldPath.canonicalString(),w.value);break;case"not-in":case"!=":return Q.set(Y.fieldPath.canonicalString(),w.value),Array.from(Q.values())}return null}(l,u),m=function(V,H){let Q=[],Y=!0;for(let w of rr(H)){let y=w.kind===0?i_(V,w.fieldPath,V.startAt):s_(V,w.fieldPath,V.startAt);Q.push(y.value),Y&&(Y=y.inclusive)}return new jt(Q,Y)}(l,u),T=function(V,H){let Q=[],Y=!0;for(let w of rr(H)){let y=w.kind===0?s_(V,w.fieldPath,V.endAt):i_(V,w.fieldPath,V.endAt);Q.push(y.value),Y&&(Y=y.inclusive)}return new jt(Q,Y)}(l,u),x=this.hn(u,l,m),N=this.hn(u,l,T),D=this.Pn(u,l,p),j=this.In(u.indexId,f,x,m.inclusive,N,T.inclusive,D);return b.forEach(j,G=>n.G(G,t.limit).next(V=>{V.forEach(H=>{let Q=L.fromSegments(H.documentKey);o.has(Q)||(o=o.add(Q),c.push(Q))})}))}).next(()=>c)}return b.resolve(null)})}cn(e){let t=this.un.get(e);return t||(e.filters.length===0?t=[e]:t=gR(ue.create(e.filters,"and")).map(n=>md(e.path,e.collectionGroup,e.orderBy,n.getFilters(),e.limit,e.startAt,e.endAt)),this.un.set(e,t),t)}In(e,t,n,i,s,o,c){let u=(t!=null?t.length:1)*Math.max(n.length,s.length),l=u/(t!=null?t.length:1),f=[];for(let p=0;p<u;++p){let m=t?this.Tn(t[p/l]):Ga,T=this.En(e,m,n[p%l],i),x=this.dn(e,m,s[p%l],o),N=c.map(D=>this.En(e,m,D,!0));f.push(...this.createRange(T,x,N))}return f}En(e,t,n,i){let s=new ar(e,L.empty(),t,n);return i?s:s.Jt()}dn(e,t,n,i){let s=new ar(e,L.empty(),t,n);return i?s.Jt():s}ln(e,t){let n=new _c(t),i=t.collectionGroup!=null?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,i).next(s=>{let o=null;for(let c of s)n.tn(c)&&(!o||c.fields.length>o.fields.length)&&(o=c);return o})}getIndexType(e,t){let n=2,i=this.cn(t);return b.forEach(i,s=>this.ln(e,s).next(o=>{o?n!==0&&o.fields.length<function(u){let l=new he(Se.comparator),f=!1;for(let p of u.filters)for(let m of p.getFlattenedFilters())m.field.isKeyField()||(m.op==="array-contains"||m.op==="array-contains-any"?f=!0:l=l.add(m.field));for(let p of u.orderBy)p.field.isKeyField()||(l=l.add(p.field));return l.size+(f?1:0)}(s)&&(n=1):n=0})).next(()=>function(o){return o.limit!==null}(t)&&i.length>1&&n===2?1:n)}An(e,t){let n=new or;for(let i of rr(e)){let s=t.data.field(i.fieldPath);if(s==null)return null;let o=n.Ht(i.kind);sn.bt.Pt(s,o)}return n.Wt()}Tn(e){let t=new or;return sn.bt.Pt(e,t.Ht(0)),t.Wt()}Rn(e,t){let n=new or;return sn.bt.Pt(hr(this.databaseId,t),n.Ht(function(s){let o=rr(s);return o.length===0?0:o[o.length-1].kind}(e))),n.Wt()}Pn(e,t,n){if(n===null)return[];let i=[];i.push(new or);let s=0;for(let o of rr(e)){let c=n[s++];for(let u of i)if(this.Vn(t,o.fieldPath)&&fo(c))i=this.mn(i,o,c);else{let l=u.Ht(o.kind);sn.bt.Pt(c,l)}}return this.fn(i)}hn(e,t,n){return this.Pn(e,t,n.position)}fn(e){let t=[];for(let n=0;n<e.length;++n)t[n]=e[n].Wt();return t}mn(e,t,n){let i=[...e],s=[];for(let o of n.arrayValue.values||[])for(let c of i){let u=new or;u.seed(c.Wt()),sn.bt.Pt(o,u.Ht(t.kind)),s.push(u)}return s}Vn(e,t){return!!e.filters.find(n=>n instanceof te&&n.field.isEqual(t)&&(n.op==="in"||n.op==="not-in"))}getFieldIndexes(e,t){let n=Xs(e),i=ii(e);return(t?n.U("collectionGroupIndex",IDBKeyRange.bound(t,t)):n.U()).next(s=>{let o=[];return b.forEach(s,c=>i.get([c.indexId,this.uid]).next(u=>{o.push(function(f,p){let m=p?new ao(p.sequenceNumber,new mt(mr(p.readTime),new L(Mt(p.documentKey)),p.largestBatchId)):ao.empty(),T=f.fields.map(([x,N])=>new di(Se.fromServerFormat(x),N));return new mi(f.indexId,f.collectionGroup,T,m)}(c,u))})).next(()=>o)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(t=>t.length===0?null:(t.sort((n,i)=>{let s=n.indexState.sequenceNumber-i.indexState.sequenceNumber;return s!==0?s:J(n.collectionGroup,i.collectionGroup)}),t[0].collectionGroup))}updateCollectionGroup(e,t,n){let i=Xs(e),s=ii(e);return this.gn(e).next(o=>i.U("collectionGroupIndex",IDBKeyRange.bound(t,t)).next(c=>b.forEach(c,u=>s.put(__(u.indexId,this.uid,o,n)))))}updateIndexEntries(e,t){let n=new Map;return b.forEach(t,(i,s)=>{let o=n.get(i.collectionGroup);return(o?b.resolve(o):this.getFieldIndexes(e,i.collectionGroup)).next(c=>(n.set(i.collectionGroup,c),b.forEach(c,u=>this.pn(e,i,u).next(l=>{let f=this.yn(s,u);return l.isEqual(f)?b.resolve():this.wn(e,s,u,l,f)}))))})}Sn(e,t,n,i){return ri(e).put({indexId:i.indexId,uid:this.uid,arrayValue:i.arrayValue,directionalValue:i.directionalValue,orderedDocumentKey:this.Rn(n,t.key),documentKey:t.key.path.toArray()})}bn(e,t,n,i){return ri(e).delete([i.indexId,this.uid,i.arrayValue,i.directionalValue,this.Rn(n,t.key),t.key.path.toArray()])}pn(e,t,n){let i=ri(e),s=new he(Sn);return i.J({index:"documentKeyIndex",range:IDBKeyRange.only([n.indexId,this.uid,this.Rn(n,t)])},(o,c)=>{s=s.add(new ar(n.indexId,t,c.arrayValue,c.directionalValue))}).next(()=>s)}yn(e,t){let n=new he(Sn),i=this.An(t,e);if(i==null)return n;let s=Zh(t);if(s!=null){let o=e.data.field(s.fieldPath);if(fo(o))for(let c of o.arrayValue.values||[])n=n.add(new ar(t.indexId,e.key,this.Tn(c),i))}else n=n.add(new ar(t.indexId,e.key,Ga,i));return n}wn(e,t,n,i,s){M("IndexedDbIndexManager","Updating index entries for document '%s'",t.key);let o=[];return function(u,l,f,p,m){let T=u.getIterator(),x=l.getIterator(),N=ni(T),D=ni(x);for(;N||D;){let j=!1,G=!1;if(N&&D){let V=f(N,D);V<0?G=!0:V>0&&(j=!0)}else N!=null?G=!0:j=!0;j?(p(D),D=ni(x)):G?(m(N),N=ni(T)):(N=ni(T),D=ni(x))}}(i,s,Sn,c=>{o.push(this.Sn(e,t,n,c))},c=>{o.push(this.bn(e,t,n,c))}),b.waitFor(o)}gn(e){let t=1;return ii(e).J({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(n,i,s)=>{s.done(),t=i.sequenceNumber+1}).next(()=>t)}createRange(e,t,n){n=n.sort((o,c)=>Sn(o,c)).filter((o,c,u)=>!c||Sn(o,u[c-1])!==0);let i=[];i.push(e);for(let o of n){let c=Sn(o,e),u=Sn(o,t);if(c===0)i[0]=e.Jt();else if(c>0&&u<0)i.push(o),i.push(o.Jt());else if(u>0)break}i.push(t);let s=[];for(let o=0;o<i.length;o+=2){if(this.Dn(i[o],i[o+1]))return[];let c=[i[o].indexId,this.uid,i[o].arrayValue,i[o].directionalValue,Ga,[]],u=[i[o+1].indexId,this.uid,i[o+1].arrayValue,i[o+1].directionalValue,Ga,[]];s.push(IDBKeyRange.bound(c,u))}return s}Dn(e,t){return Sn(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(b_)}getMinOffset(e,t){return b.mapArray(this.cn(t),n=>this.ln(e,n).next(i=>i||U())).next(b_)}};function S_(r){return Ue(r,"collectionParents")}function ri(r){return Ue(r,"indexEntries")}function Xs(r){return Ue(r,"indexConfiguration")}function ii(r){return Ue(r,"indexState")}function b_(r){q(r.length!==0);let e=r[0].indexState.offset,t=e.largestBatchId;for(let n=1;n<r.length;n++){let i=r[n].indexState.offset;Wf(i,e)<0&&(e=i),t<i.largestBatchId&&(t=i.largestBatchId)}return new mt(e.readTime,e.documentKey,t)}var R_={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},pt=class r{constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}static withCacheSize(e){return new r(e,r.DEFAULT_COLLECTION_PERCENTILE,r.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}};function Ww(r,e,t){let n=r.store("mutations"),i=r.store("documentMutations"),s=[],o=IDBKeyRange.only(t.batchId),c=0,u=n.J({range:o},(f,p,m)=>(c++,m.delete()));s.push(u.next(()=>{q(c===1)}));let l=[];for(let f of t.mutations){let p=Z_(e,f.key.path,t.batchId);s.push(i.delete(p)),l.push(f.key)}return b.waitFor(s).next(()=>l)}function Ec(r){if(!r)return 0;let e;if(r.document)e=r.document;else if(r.unknownDocument)e=r.unknownDocument;else{if(!r.noDocument)throw U();e=r.noDocument}return JSON.stringify(e).length}pt.DEFAULT_COLLECTION_PERCENTILE=10,pt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,pt.DEFAULT=new pt(41943040,pt.DEFAULT_COLLECTION_PERCENTILE,pt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),pt.DISABLED=new pt(-1,0,0);var Tc=class r{constructor(e,t,n,i){this.userId=e,this.serializer=t,this.indexManager=n,this.referenceDelegate=i,this.Cn={}}static lt(e,t,n,i){q(e.uid!=="");let s=e.isAuthenticated()?e.uid:"";return new r(s,t,n,i)}checkEmpty(e){let t=!0,n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return bn(e).J({index:"userMutationsIndex",range:n},(i,s,o)=>{t=!1,o.done()}).next(()=>t)}addMutationBatch(e,t,n,i){let s=li(e),o=bn(e);return o.add({}).next(c=>{q(typeof c=="number");let u=new go(c,t,n,i),l=function(T,x,N){let D=N.baseMutations.map(G=>wo(T.ct,G)),j=N.mutations.map(G=>wo(T.ct,G));return{userId:x,batchId:N.batchId,localWriteTimeMs:N.localWriteTime.toMillis(),baseMutations:D,mutations:j}}(this.serializer,this.userId,u),f=[],p=new he((m,T)=>J(m.canonicalString(),T.canonicalString()));for(let m of i){let T=Z_(this.userId,m.key.path,c);p=p.add(m.key.path.popLast()),f.push(o.put(l)),f.push(s.put(T,Tb))}return p.forEach(m=>{f.push(this.indexManager.addToCollectionParentIndex(e,m))}),e.addOnCommittedListener(()=>{this.Cn[c]=u.keys()}),b.waitFor(f).next(()=>u)})}lookupMutationBatch(e,t){return bn(e).get(t).next(n=>n?(q(n.userId===this.userId),sr(this.serializer,n)):null)}vn(e,t){return this.Cn[t]?b.resolve(this.Cn[t]):this.lookupMutationBatch(e,t).next(n=>{if(n){let i=n.keys();return this.Cn[t]=i,i}return null})}getNextMutationBatchAfterBatchId(e,t){let n=t+1,i=IDBKeyRange.lowerBound([this.userId,n]),s=null;return bn(e).J({index:"userMutationsIndex",range:i},(o,c,u)=>{c.userId===this.userId&&(q(c.batchId>=n),s=sr(this.serializer,c)),u.done()}).next(()=>s)}getHighestUnacknowledgedBatchId(e){let t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),n=-1;return bn(e).J({index:"userMutationsIndex",range:t,reverse:!0},(i,s,o)=>{n=s.batchId,o.done()}).next(()=>n)}getAllMutationBatches(e){let t=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return bn(e).U("userMutationsIndex",t).next(n=>n.map(i=>sr(this.serializer,i)))}getAllMutationBatchesAffectingDocumentKey(e,t){let n=Qa(this.userId,t.path),i=IDBKeyRange.lowerBound(n),s=[];return li(e).J({range:i},(o,c,u)=>{let[l,f,p]=o,m=Mt(f);if(l===this.userId&&t.path.isEqual(m))return bn(e).get(p).next(T=>{if(!T)throw U();q(T.userId===this.userId),s.push(sr(this.serializer,T))});u.done()}).next(()=>s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new he(J),i=[];return t.forEach(s=>{let o=Qa(this.userId,s.path),c=IDBKeyRange.lowerBound(o),u=li(e).J({range:c},(l,f,p)=>{let[m,T,x]=l,N=Mt(T);m===this.userId&&s.path.isEqual(N)?n=n.add(x):p.done()});i.push(u)}),b.waitFor(i).next(()=>this.Fn(e,n))}getAllMutationBatchesAffectingQuery(e,t){let n=t.path,i=n.length+1,s=Qa(this.userId,n),o=IDBKeyRange.lowerBound(s),c=new he(J);return li(e).J({range:o},(u,l,f)=>{let[p,m,T]=u,x=Mt(m);p===this.userId&&n.isPrefixOf(x)?x.length===i&&(c=c.add(T)):f.done()}).next(()=>this.Fn(e,c))}Fn(e,t){let n=[],i=[];return t.forEach(s=>{i.push(bn(e).get(s).next(o=>{if(o===null)throw U();q(o.userId===this.userId),n.push(sr(this.serializer,o))}))}),b.waitFor(i).next(()=>n)}removeMutationBatch(e,t){return Ww(e._e,this.userId,t).next(n=>(e.addOnCommittedListener(()=>{this.Mn(t.batchId)}),b.forEach(n,i=>this.referenceDelegate.markPotentiallyOrphaned(e,i))))}Mn(e){delete this.Cn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return b.resolve();let n=IDBKeyRange.lowerBound(function(o){return[o]}(this.userId)),i=[];return li(e).J({range:n},(s,o,c)=>{if(s[0]===this.userId){let u=Mt(s[1]);i.push(u)}else c.done()}).next(()=>{q(i.length===0)})})}containsKey(e,t){return Hw(e,this.userId,t)}xn(e){return Qw(e).get(this.userId).next(t=>t||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""})}};function Hw(r,e,t){let n=Qa(e,t.path),i=n[1],s=IDBKeyRange.lowerBound(n),o=!1;return li(r).J({range:s,H:!0},(c,u,l)=>{let[f,p,m]=c;f===e&&p===i&&(o=!0),l.done()}).next(()=>o)}function bn(r){return Ue(r,"mutations")}function li(r){return Ue(r,"documentMutations")}function Qw(r){return Ue(r,"mutationQueues")}var Ii=class r{constructor(e){this.On=e}next(){return this.On+=2,this.On}static Nn(){return new r(0)}static Ln(){return new r(-1)}};var Ld=class{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.Bn(e).next(t=>{let n=new Ii(t.highestTargetId);return t.highestTargetId=n.next(),this.kn(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.Bn(e).next(t=>K.fromTimestamp(new _e(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.Bn(e).next(t=>t.highestListenSequenceNumber)}setTargetsMetadata(e,t,n){return this.Bn(e).next(i=>(i.highestListenSequenceNumber=t,n&&(i.lastRemoteSnapshotVersion=n.toTimestamp()),t>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=t),this.kn(e,i)))}addTargetData(e,t){return this.qn(e,t).next(()=>this.Bn(e).next(n=>(n.targetCount+=1,this.Qn(t,n),this.kn(e,n))))}updateTargetData(e,t){return this.qn(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>si(e).delete(t.targetId)).next(()=>this.Bn(e)).next(n=>(q(n.targetCount>0),n.targetCount-=1,this.kn(e,n)))}removeTargets(e,t,n){let i=0,s=[];return si(e).J((o,c)=>{let u=to(c);u.sequenceNumber<=t&&n.get(u.targetId)===null&&(i++,s.push(this.removeTargetData(e,u)))}).next(()=>b.waitFor(s)).next(()=>i)}forEachTarget(e,t){return si(e).J((n,i)=>{let s=to(i);t(s)})}Bn(e){return C_(e).get("targetGlobalKey").next(t=>(q(t!==null),t))}kn(e,t){return C_(e).put("targetGlobalKey",t)}qn(e,t){return si(e).put(qw(this.serializer,t))}Qn(e,t){let n=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,n=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,n=!0),n}getTargetCount(e){return this.Bn(e).next(t=>t.targetCount)}getTargetData(e,t){let n=fr(t),i=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]),s=null;return si(e).J({range:i,index:"queryTargetsIndex"},(o,c,u)=>{let l=to(c);xo(t,l.target)&&(s=l,u.done())}).next(()=>s)}addMatchingKeys(e,t,n){let i=[],s=Rn(e);return t.forEach(o=>{let c=Je(o.path);i.push(s.put({targetId:n,path:c})),i.push(this.referenceDelegate.addReference(e,n,o))}),b.waitFor(i)}removeMatchingKeys(e,t,n){let i=Rn(e);return b.forEach(t,s=>{let o=Je(s.path);return b.waitFor([i.delete([n,o]),this.referenceDelegate.removeReference(e,n,s)])})}removeMatchingKeysForTargetId(e,t){let n=Rn(e),i=IDBKeyRange.bound([t],[t+1],!1,!0);return n.delete(i)}getMatchingKeysForTargetId(e,t){let n=IDBKeyRange.bound([t],[t+1],!1,!0),i=Rn(e),s=Z();return i.J({range:n,H:!0},(o,c,u)=>{let l=Mt(o[1]),f=new L(l);s=s.add(f)}).next(()=>s)}containsKey(e,t){let n=Je(t.path),i=IDBKeyRange.bound([n],[W_(n)],!1,!0),s=0;return Rn(e).J({index:"documentTargetsIndex",H:!0,range:i},([o,c],u,l)=>{o!==0&&(s++,l.done())}).next(()=>s>0)}ot(e,t){return si(e).get(t).next(n=>n?to(n):null)}};function si(r){return Ue(r,"targets")}function C_(r){return Ue(r,"targetGlobal")}function Rn(r){return Ue(r,"targetDocuments")}function P_([r,e],[t,n]){let i=J(r,t);return i===0?J(e,n):i}var Fd=class{constructor(e){this.Kn=e,this.buffer=new he(P_),this.$n=0}Un(){return++this.$n}Wn(e){let t=[e,this.Un()];if(this.buffer.size<this.Kn)this.buffer=this.buffer.add(t);else{let n=this.buffer.last();P_(t,n)<0&&(this.buffer=this.buffer.delete(n).add(t))}}get maxValue(){return this.buffer.last()[0]}},Ud=class{constructor(e,t,n){this.garbageCollector=e,this.asyncQueue=t,this.localStore=n,this.Gn=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.zn(6e4)}stop(){this.Gn&&(this.Gn.cancel(),this.Gn=null)}get started(){return this.Gn!==null}zn(e){M("LruGarbageCollector",`Garbage collection scheduled in ${e}ms`),this.Gn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,()=>P(this,null,function*(){this.Gn=null;try{yield this.localStore.collectGarbage(this.garbageCollector)}catch(t){zn(t)?M("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",t):yield $n(t)}yield this.zn(3e5)}))}},jd=class{constructor(e,t){this.jn=e,this.params=t}calculateTargetCount(e,t){return this.jn.Hn(e).next(n=>Math.floor(t/100*n))}nthSequenceNumber(e,t){if(t===0)return b.resolve(ct.oe);let n=new Fd(t);return this.jn.forEachTarget(e,i=>n.Wn(i.sequenceNumber)).next(()=>this.jn.Jn(e,i=>n.Wn(i))).next(()=>n.maxValue)}removeTargets(e,t,n){return this.jn.removeTargets(e,t,n)}removeOrphanedDocuments(e,t){return this.jn.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(M("LruGarbageCollector","Garbage collection skipped; disabled"),b.resolve(R_)):this.getCacheSize(e).next(n=>n<this.params.cacheSizeCollectionThreshold?(M("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),R_):this.Yn(e,t))}getCacheSize(e){return this.jn.getCacheSize(e)}Yn(e,t){let n,i,s,o,c,u,l,f=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(p=>(p>this.params.maximumSequenceNumbersToCollect?(M("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${p}`),i=this.params.maximumSequenceNumbersToCollect):i=p,o=Date.now(),this.nthSequenceNumber(e,i))).next(p=>(n=p,c=Date.now(),this.removeTargets(e,n,t))).next(p=>(s=p,u=Date.now(),this.removeOrphanedDocuments(e,n))).next(p=>(l=Date.now(),oi()<=Pt.DEBUG&&M("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${o-f}ms
	Determined least recently used ${i} in `+(c-o)+`ms
	Removed ${s} targets in `+(u-c)+`ms
	Removed ${p} documents in `+(l-u)+`ms
Total Duration: ${l-f}ms`),b.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:s,documentsRemoved:p})))}};function mR(r,e){return new jd(r,e)}var $d=class{constructor(e,t){this.db=e,this.garbageCollector=mR(this,t)}Hn(e){let t=this.Zn(e);return this.db.getTargetCache().getTargetCount(e).next(n=>t.next(i=>n+i))}Zn(e){let t=0;return this.Jn(e,n=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}Jn(e,t){return this.Xn(e,(n,i)=>t(i))}addReference(e,t,n){return Ka(e,n)}removeReference(e,t,n){return Ka(e,n)}removeTargets(e,t,n){return this.db.getTargetCache().removeTargets(e,t,n)}markPotentiallyOrphaned(e,t){return Ka(e,t)}er(e,t){return function(i,s){let o=!1;return Qw(i).Y(c=>Hw(i,c,s).next(u=>(u&&(o=!0),b.resolve(!u)))).next(()=>o)}(e,t)}removeOrphanedDocuments(e,t){let n=this.db.getRemoteDocumentCache().newChangeBuffer(),i=[],s=0;return this.Xn(e,(o,c)=>{if(c<=t){let u=this.er(e,o).next(l=>{if(!l)return s++,n.getEntry(e,o).next(()=>(n.removeEntry(o,K.min()),Rn(e).delete(function(p){return[0,Je(p.path)]}(o))))});i.push(u)}}).next(()=>b.waitFor(i)).next(()=>n.apply(e)).next(()=>s)}removeTarget(e,t){let n=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,n)}updateLimboDocument(e,t){return Ka(e,t)}Xn(e,t){let n=Rn(e),i,s=ct.oe;return n.J({index:"documentTargetsIndex"},([o,c],{path:u,sequenceNumber:l})=>{o===0?(s!==ct.oe&&t(new L(Mt(i)),s),s=l,i=u):s=ct.oe}).next(()=>{s!==ct.oe&&t(new L(Mt(i)),s)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}};function Ka(r,e){return Rn(r).put(function(n,i){return{targetId:0,path:Je(n.path),sequenceNumber:i}}(e,r.currentSequenceNumber))}var Ic=class{constructor(){this.changes=new $t(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,ke.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();let n=this.changes.get(t);return n!==void 0?b.resolve(n):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}};var zd=class{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,n){return nr(e).put(n)}removeEntry(e,t,n){return nr(e).delete(function(s,o){let c=s.path.toArray();return[c.slice(0,c.length-2),c[c.length-2],yc(o),c[c.length-1]]}(t,n))}updateMetadata(e,t){return this.getMetadata(e).next(n=>(n.byteSize+=t,this.tr(e,n)))}getEntry(e,t){let n=ke.newInvalidDocument(t);return nr(e).J({index:"documentKeyIndex",range:IDBKeyRange.only(Js(t))},(i,s)=>{n=this.nr(t,s)}).next(()=>n)}rr(e,t){let n={size:0,document:ke.newInvalidDocument(t)};return nr(e).J({index:"documentKeyIndex",range:IDBKeyRange.only(Js(t))},(i,s)=>{n={document:this.nr(t,s),size:Ec(s)}}).next(()=>n)}getEntries(e,t){let n=tt();return this.ir(e,t,(i,s)=>{let o=this.nr(i,s);n=n.insert(i,o)}).next(()=>n)}sr(e,t){let n=tt(),i=new pe(L.comparator);return this.ir(e,t,(s,o)=>{let c=this.nr(s,o);n=n.insert(s,c),i=i.insert(s,Ec(o))}).next(()=>({documents:n,_r:i}))}ir(e,t,n){if(t.isEmpty())return b.resolve();let i=new he(N_);t.forEach(u=>i=i.add(u));let s=IDBKeyRange.bound(Js(i.first()),Js(i.last())),o=i.getIterator(),c=o.getNext();return nr(e).J({index:"documentKeyIndex",range:s},(u,l,f)=>{let p=L.fromSegments([...l.prefixPath,l.collectionGroup,l.documentId]);for(;c&&N_(c,p)<0;)n(c,null),c=o.getNext();c&&c.isEqual(p)&&(n(c,l),c=o.hasNext()?o.getNext():null),c?f.$(Js(c)):f.done()}).next(()=>{for(;c;)n(c,null),c=o.hasNext()?o.getNext():null})}getDocumentsMatchingQuery(e,t,n,i,s){let o=t.path,c=[o.popLast().toArray(),o.lastSegment(),yc(n.readTime),n.documentKey.path.isEmpty()?"":n.documentKey.path.lastSegment()],u=[o.popLast().toArray(),o.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return nr(e).U(IDBKeyRange.bound(c,u,!0)).next(l=>{s?.incrementDocumentReadCount(l.length);let f=tt();for(let p of l){let m=this.nr(L.fromSegments(p.prefixPath.concat(p.collectionGroup,p.documentId)),p);m.isFoundDocument()&&(ko(t,m)||i.has(m.key))&&(f=f.insert(m.key,m))}return f})}getAllFromCollectionGroup(e,t,n,i){let s=tt(),o=x_(t,n),c=x_(t,mt.max());return nr(e).J({index:"collectionGroupIndex",range:IDBKeyRange.bound(o,c,!0)},(u,l,f)=>{let p=this.nr(L.fromSegments(l.prefixPath.concat(l.collectionGroup,l.documentId)),l);s=s.insert(p.key,p),s.size===i&&f.done()}).next(()=>s)}newChangeBuffer(e){return new Bd(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(t=>t.byteSize)}getMetadata(e){return D_(e).get("remoteDocumentGlobalKey").next(t=>(q(!!t),t))}tr(e,t){return D_(e).put("remoteDocumentGlobalKey",t)}nr(e,t){if(t){let n=fR(this.serializer,t);if(!(n.isNoDocument()&&n.version.isEqual(K.min())))return n}return ke.newInvalidDocument(e)}};function Yw(r){return new zd(r)}var Bd=class extends Ic{constructor(e,t){super(),this.ar=e,this.trackRemovals=t,this.ur=new $t(n=>n.toString(),(n,i)=>n.isEqual(i))}applyChanges(e){let t=[],n=0,i=new he((s,o)=>J(s.canonicalString(),o.canonicalString()));return this.changes.forEach((s,o)=>{let c=this.ur.get(s);if(t.push(this.ar.removeEntry(e,s,c.readTime)),o.isValidDocument()){let u=y_(this.ar.serializer,o);i=i.add(s.path.popLast());let l=Ec(u);n+=l-c.size,t.push(this.ar.addEntry(e,s,u))}else if(n-=c.size,this.trackRemovals){let u=y_(this.ar.serializer,o.convertToNoDocument(K.min()));t.push(this.ar.addEntry(e,s,u))}}),i.forEach(s=>{t.push(this.ar.indexManager.addToCollectionParentIndex(e,s))}),t.push(this.ar.updateMetadata(e,n)),b.waitFor(t)}getFromCache(e,t){return this.ar.rr(e,t).next(n=>(this.ur.set(t,{size:n.size,readTime:n.document.readTime}),n.document))}getAllFromCache(e,t){return this.ar.sr(e,t).next(({documents:n,_r:i})=>(i.forEach((s,o)=>{this.ur.set(s,{size:o,readTime:n.get(s).readTime})}),n))}};function D_(r){return Ue(r,"remoteDocumentGlobal")}function nr(r){return Ue(r,"remoteDocumentsV14")}function Js(r){let e=r.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function x_(r,e){let t=e.documentKey.path.toArray();return[r,yc(e.readTime),t.slice(0,t.length-2),t.length>0?t[t.length-1]:""]}function N_(r,e){let t=r.path.toArray(),n=e.path.toArray(),i=0;for(let s=0;s<t.length-2&&s<n.length-2;++s)if(i=J(t[s],n[s]),i)return i;return i=J(t.length,n.length),i||(i=J(t[t.length-2],n[n.length-2]),i||J(t[t.length-1],n[n.length-1]))}var qd=class{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}};var Ac=class{constructor(e,t,n,i){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=n,this.indexManager=i}getDocument(e,t){let n=null;return this.documentOverlayCache.getOverlay(e,t).next(i=>(n=i,this.remoteDocumentCache.getEntry(e,t))).next(i=>(n!==null&&io(n.mutation,i,ut.empty(),_e.now()),i))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(n=>this.getLocalViewOfDocuments(e,n,Z()).next(()=>n))}getLocalViewOfDocuments(e,t,n=Z()){let i=Ot();return this.populateOverlays(e,i,t).next(()=>this.computeViews(e,t,i,n).next(s=>{let o=eo();return s.forEach((c,u)=>{o=o.insert(c,u.overlayedDocument)}),o}))}getOverlayedDocuments(e,t){let n=Ot();return this.populateOverlays(e,n,t).next(()=>this.computeViews(e,t,n,Z()))}populateOverlays(e,t,n){let i=[];return n.forEach(s=>{t.has(s)||i.push(s)}),this.documentOverlayCache.getOverlays(e,i).next(s=>{s.forEach((o,c)=>{t.set(o,c)})})}computeViews(e,t,n,i){let s=tt(),o=ro(),c=function(){return ro()}();return t.forEach((u,l)=>{let f=n.get(l.key);i.has(l.key)&&(f===void 0||f.mutation instanceof It)?s=s.insert(l.key,l):f!==void 0?(o.set(l.key,f.mutation.getFieldMask()),io(f.mutation,l,f.mutation.getFieldMask(),_e.now())):o.set(l.key,ut.empty())}),this.recalculateAndSaveOverlays(e,s).next(u=>(u.forEach((l,f)=>o.set(l,f)),t.forEach((l,f)=>{var p;return c.set(l,new qd(f,(p=o.get(l))!==null&&p!==void 0?p:null))}),c))}recalculateAndSaveOverlays(e,t){let n=ro(),i=new pe((o,c)=>o-c),s=Z();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(o=>{for(let c of o)c.keys().forEach(u=>{let l=t.get(u);if(l===null)return;let f=n.get(u)||ut.empty();f=c.applyToLocalView(l,f),n.set(u,f);let p=(i.get(c.batchId)||Z()).add(u);i=i.insert(c.batchId,p)})}).next(()=>{let o=[],c=i.getReverseIterator();for(;c.hasNext();){let u=c.getNext(),l=u.key,f=u.value,p=_w();f.forEach(m=>{if(!s.has(m)){let T=Rw(t.get(m),n.get(m));T!==null&&p.set(m,T),s=s.add(m)}}),o.push(this.documentOverlayCache.saveOverlays(e,l,p))}return b.waitFor(o)}).next(()=>n)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(n=>this.recalculateAndSaveOverlays(e,n))}getDocumentsMatchingQuery(e,t,n,i){return function(o){return L.isDocumentKey(o.path)&&o.collectionGroup===null&&o.filters.length===0}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):Xf(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,n,i):this.getDocumentsMatchingCollectionQuery(e,t,n,i)}getNextDocuments(e,t,n,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,n,i).next(s=>{let o=i-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,n.largestBatchId,i-s.size):b.resolve(Ot()),c=-1,u=s;return o.next(l=>b.forEach(l,(f,p)=>(c<p.largestBatchId&&(c=p.largestBatchId),s.get(f)?b.resolve():this.remoteDocumentCache.getEntry(e,f).next(m=>{u=u.insert(f,m)}))).next(()=>this.populateOverlays(e,l,s)).next(()=>this.computeViews(e,u,l,Z())).next(f=>({batchId:c,changes:vw(f)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new L(t)).next(n=>{let i=eo();return n.isFoundDocument()&&(i=i.insert(n.key,n)),i})}getDocumentsMatchingCollectionGroupQuery(e,t,n,i){let s=t.collectionGroup,o=eo();return this.indexManager.getCollectionParents(e,s).next(c=>b.forEach(c,u=>{let l=function(p,m){return new Tt(m,null,p.explicitOrderBy.slice(),p.filters.slice(),p.limit,p.limitType,p.startAt,p.endAt)}(t,u.child(s));return this.getDocumentsMatchingCollectionQuery(e,l,n,i).next(f=>{f.forEach((p,m)=>{o=o.insert(p,m)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(e,t,n,i){let s;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,n.largestBatchId).next(o=>(s=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,n,s,i))).next(o=>{s.forEach((u,l)=>{let f=l.getKey();o.get(f)===null&&(o=o.insert(f,ke.newInvalidDocument(f)))});let c=eo();return o.forEach((u,l)=>{let f=s.get(u);f!==void 0&&io(f.mutation,l,ut.empty(),_e.now()),ko(t,l)&&(c=c.insert(u,l))}),c})}};var Gd=class{constructor(e){this.serializer=e,this.cr=new Map,this.lr=new Map}getBundleMetadata(e,t){return b.resolve(this.cr.get(t))}saveBundleMetadata(e,t){return this.cr.set(t.id,function(i){return{id:i.id,version:i.version,createTime:be(i.createTime)}}(t)),b.resolve()}getNamedQuery(e,t){return b.resolve(this.lr.get(t))}saveNamedQuery(e,t){return this.lr.set(t.name,function(i){return{name:i.name,query:ep(i.bundledQuery),readTime:be(i.readTime)}}(t)),b.resolve()}};var Kd=class{constructor(){this.overlays=new pe(L.comparator),this.hr=new Map}getOverlay(e,t){return b.resolve(this.overlays.get(t))}getOverlays(e,t){let n=Ot();return b.forEach(t,i=>this.getOverlay(e,i).next(s=>{s!==null&&n.set(i,s)})).next(()=>n)}saveOverlays(e,t,n){return n.forEach((i,s)=>{this.ht(e,t,s)}),b.resolve()}removeOverlaysForBatchId(e,t,n){let i=this.hr.get(n);return i!==void 0&&(i.forEach(s=>this.overlays=this.overlays.remove(s)),this.hr.delete(n)),b.resolve()}getOverlaysForCollection(e,t,n){let i=Ot(),s=t.length+1,o=new L(t.child("")),c=this.overlays.getIteratorFrom(o);for(;c.hasNext();){let u=c.getNext().value,l=u.getKey();if(!t.isPrefixOf(l.path))break;l.path.length===s&&u.largestBatchId>n&&i.set(u.getKey(),u)}return b.resolve(i)}getOverlaysForCollectionGroup(e,t,n,i){let s=new pe((l,f)=>l-f),o=this.overlays.getIterator();for(;o.hasNext();){let l=o.getNext().value;if(l.getKey().getCollectionGroup()===t&&l.largestBatchId>n){let f=s.get(l.largestBatchId);f===null&&(f=Ot(),s=s.insert(l.largestBatchId,f)),f.set(l.getKey(),l)}}let c=Ot(),u=s.getIterator();for(;u.hasNext()&&(u.getNext().value.forEach((l,f)=>c.set(l,f)),!(c.size()>=i)););return b.resolve(c)}ht(e,t,n){let i=this.overlays.get(n.key);if(i!==null){let o=this.hr.get(i.largestBatchId).delete(n.key);this.hr.set(i.largestBatchId,o)}this.overlays=this.overlays.insert(n.key,new mo(t,n));let s=this.hr.get(t);s===void 0&&(s=Z(),this.hr.set(t,s)),this.hr.set(t,s.add(n.key))}};var To=class{constructor(){this.Pr=new he(De.Ir),this.Tr=new he(De.Er)}isEmpty(){return this.Pr.isEmpty()}addReference(e,t){let n=new De(e,t);this.Pr=this.Pr.add(n),this.Tr=this.Tr.add(n)}dr(e,t){e.forEach(n=>this.addReference(n,t))}removeReference(e,t){this.Ar(new De(e,t))}Rr(e,t){e.forEach(n=>this.removeReference(n,t))}Vr(e){let t=new L(new re([])),n=new De(t,e),i=new De(t,e+1),s=[];return this.Tr.forEachInRange([n,i],o=>{this.Ar(o),s.push(o.key)}),s}mr(){this.Pr.forEach(e=>this.Ar(e))}Ar(e){this.Pr=this.Pr.delete(e),this.Tr=this.Tr.delete(e)}gr(e){let t=new L(new re([])),n=new De(t,e),i=new De(t,e+1),s=Z();return this.Tr.forEachInRange([n,i],o=>{s=s.add(o.key)}),s}containsKey(e){let t=new De(e,0),n=this.Pr.firstAfterOrEqual(t);return n!==null&&e.isEqual(n.key)}},De=class{constructor(e,t){this.key=e,this.pr=t}static Ir(e,t){return L.comparator(e.key,t.key)||J(e.pr,t.pr)}static Er(e,t){return J(e.pr,t.pr)||L.comparator(e.key,t.key)}};var Wd=class{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.yr=1,this.wr=new he(De.Ir)}checkEmpty(e){return b.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,n,i){let s=this.yr;this.yr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let o=new go(s,t,n,i);this.mutationQueue.push(o);for(let c of i)this.wr=this.wr.add(new De(c.key,s)),this.indexManager.addToCollectionParentIndex(e,c.key.path.popLast());return b.resolve(o)}lookupMutationBatch(e,t){return b.resolve(this.Sr(t))}getNextMutationBatchAfterBatchId(e,t){let n=t+1,i=this.br(n),s=i<0?0:i;return b.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return b.resolve(this.mutationQueue.length===0?-1:this.yr-1)}getAllMutationBatches(e){return b.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){let n=new De(t,0),i=new De(t,Number.POSITIVE_INFINITY),s=[];return this.wr.forEachInRange([n,i],o=>{let c=this.Sr(o.pr);s.push(c)}),b.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new he(J);return t.forEach(i=>{let s=new De(i,0),o=new De(i,Number.POSITIVE_INFINITY);this.wr.forEachInRange([s,o],c=>{n=n.add(c.pr)})}),b.resolve(this.Dr(n))}getAllMutationBatchesAffectingQuery(e,t){let n=t.path,i=n.length+1,s=n;L.isDocumentKey(s)||(s=s.child(""));let o=new De(new L(s),0),c=new he(J);return this.wr.forEachWhile(u=>{let l=u.key.path;return!!n.isPrefixOf(l)&&(l.length===i&&(c=c.add(u.pr)),!0)},o),b.resolve(this.Dr(c))}Dr(e){let t=[];return e.forEach(n=>{let i=this.Sr(n);i!==null&&t.push(i)}),t}removeMutationBatch(e,t){q(this.Cr(t.batchId,"removed")===0),this.mutationQueue.shift();let n=this.wr;return b.forEach(t.mutations,i=>{let s=new De(i.key,t.batchId);return n=n.delete(s),this.referenceDelegate.markPotentiallyOrphaned(e,i.key)}).next(()=>{this.wr=n})}Mn(e){}containsKey(e,t){let n=new De(t,0),i=this.wr.firstAfterOrEqual(n);return b.resolve(t.isEqual(i&&i.key))}performConsistencyCheck(e){return this.mutationQueue.length,b.resolve()}Cr(e,t){return this.br(e)}br(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Sr(e){let t=this.br(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}};var Hd=class{constructor(e){this.vr=e,this.docs=function(){return new pe(L.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){let n=t.key,i=this.docs.get(n),s=i?i.size:0,o=this.vr(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:o}),this.size+=o-s,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){let t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){let n=this.docs.get(t);return b.resolve(n?n.document.mutableCopy():ke.newInvalidDocument(t))}getEntries(e,t){let n=tt();return t.forEach(i=>{let s=this.docs.get(i);n=n.insert(i,s?s.document.mutableCopy():ke.newInvalidDocument(i))}),b.resolve(n)}getDocumentsMatchingQuery(e,t,n,i){let s=tt(),o=t.path,c=new L(o.child("")),u=this.docs.getIteratorFrom(c);for(;u.hasNext();){let{key:l,value:{document:f}}=u.getNext();if(!o.isPrefixOf(l.path))break;l.path.length>o.length+1||Wf(Q_(f),n)<=0||(i.has(f.key)||ko(t,f))&&(s=s.insert(f.key,f.mutableCopy()))}return b.resolve(s)}getAllFromCollectionGroup(e,t,n,i){U()}Fr(e,t){return b.forEach(this.docs,n=>t(n))}newChangeBuffer(e){return new Qd(this)}getSize(e){return b.resolve(this.size)}},Qd=class extends Ic{constructor(e){super(),this.ar=e}applyChanges(e){let t=[];return this.changes.forEach((n,i)=>{i.isValidDocument()?t.push(this.ar.addEntry(e,i)):this.ar.removeEntry(n)}),b.waitFor(t)}getFromCache(e,t){return this.ar.getEntry(e,t)}getAllFromCache(e,t){return this.ar.getEntries(e,t)}};var Yd=class{constructor(e){this.persistence=e,this.Mr=new $t(t=>fr(t),xo),this.lastRemoteSnapshotVersion=K.min(),this.highestTargetId=0,this.Or=0,this.Nr=new To,this.targetCount=0,this.Lr=Ii.Nn()}forEachTarget(e,t){return this.Mr.forEach((n,i)=>t(i)),b.resolve()}getLastRemoteSnapshotVersion(e){return b.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return b.resolve(this.Or)}allocateTargetId(e){return this.highestTargetId=this.Lr.next(),b.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.Or&&(this.Or=t),b.resolve()}qn(e){this.Mr.set(e.target,e);let t=e.targetId;t>this.highestTargetId&&(this.Lr=new Ii(t),this.highestTargetId=t),e.sequenceNumber>this.Or&&(this.Or=e.sequenceNumber)}addTargetData(e,t){return this.qn(t),this.targetCount+=1,b.resolve()}updateTargetData(e,t){return this.qn(t),b.resolve()}removeTargetData(e,t){return this.Mr.delete(t.target),this.Nr.Vr(t.targetId),this.targetCount-=1,b.resolve()}removeTargets(e,t,n){let i=0,s=[];return this.Mr.forEach((o,c)=>{c.sequenceNumber<=t&&n.get(c.targetId)===null&&(this.Mr.delete(o),s.push(this.removeMatchingKeysForTargetId(e,c.targetId)),i++)}),b.waitFor(s).next(()=>i)}getTargetCount(e){return b.resolve(this.targetCount)}getTargetData(e,t){let n=this.Mr.get(t)||null;return b.resolve(n)}addMatchingKeys(e,t,n){return this.Nr.dr(t,n),b.resolve()}removeMatchingKeys(e,t,n){this.Nr.Rr(t,n);let i=this.persistence.referenceDelegate,s=[];return i&&t.forEach(o=>{s.push(i.markPotentiallyOrphaned(e,o))}),b.waitFor(s)}removeMatchingKeysForTargetId(e,t){return this.Nr.Vr(t),b.resolve()}getMatchingKeysForTargetId(e,t){let n=this.Nr.gr(t);return b.resolve(n)}containsKey(e,t){return b.resolve(this.Nr.containsKey(t))}};var Sc=class{constructor(e,t){this.Br={},this.overlays={},this.kr=new ct(0),this.qr=!1,this.qr=!0,this.referenceDelegate=e(this),this.Qr=new Yd(this),this.indexManager=new Od,this.remoteDocumentCache=function(i){return new Hd(i)}(n=>this.referenceDelegate.Kr(n)),this.serializer=new mc(t),this.$r=new Gd(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.qr=!1,Promise.resolve()}get started(){return this.qr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new Kd,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let n=this.Br[e.toKey()];return n||(n=new Wd(t,this.referenceDelegate),this.Br[e.toKey()]=n),n}getTargetCache(){return this.Qr}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.$r}runTransaction(e,t,n){M("MemoryPersistence","Starting transaction:",e);let i=new Xd(this.kr.next());return this.referenceDelegate.Ur(),n(i).next(s=>this.referenceDelegate.Wr(i).next(()=>s)).toPromise().then(s=>(i.raiseOnCommittedEvent(),s))}Gr(e,t){return b.or(Object.values(this.Br).map(n=>()=>n.containsKey(e,t)))}},Xd=class extends ic{constructor(e){super(),this.currentSequenceNumber=e}},bc=class r{constructor(e){this.persistence=e,this.zr=new To,this.jr=null}static Hr(e){return new r(e)}get Jr(){if(this.jr)return this.jr;throw U()}addReference(e,t,n){return this.zr.addReference(n,t),this.Jr.delete(n.toString()),b.resolve()}removeReference(e,t,n){return this.zr.removeReference(n,t),this.Jr.add(n.toString()),b.resolve()}markPotentiallyOrphaned(e,t){return this.Jr.add(t.toString()),b.resolve()}removeTarget(e,t){this.zr.Vr(t.targetId).forEach(i=>this.Jr.add(i.toString()));let n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next(i=>{i.forEach(s=>this.Jr.add(s.toString()))}).next(()=>n.removeTargetData(e,t))}Ur(){this.jr=new Set}Wr(e){let t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return b.forEach(this.Jr,n=>{let i=L.fromPath(n);return this.Yr(e,i).next(s=>{s||t.removeEntry(i,K.min())})}).next(()=>(this.jr=null,t.apply(e)))}updateLimboDocument(e,t){return this.Yr(e,t).next(n=>{n?this.Jr.delete(t.toString()):this.Jr.add(t.toString())})}Kr(e){return 0}Yr(e,t){return b.or([()=>b.resolve(this.zr.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Gr(e,t)])}};var Jd=class{constructor(e){this.serializer=e}O(e,t,n,i){let s=new sc("createOrUpgrade",t);n<1&&i>=1&&(function(u){u.createObjectStore("owner")}(e),function(u){u.createObjectStore("mutationQueues",{keyPath:"userId"}),u.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",Qv,{unique:!0}),u.createObjectStore("documentMutations")}(e),k_(e),function(u){u.createObjectStore("remoteDocuments")}(e));let o=b.resolve();return n<3&&i>=3&&(n!==0&&(function(u){u.deleteObjectStore("targetDocuments"),u.deleteObjectStore("targets"),u.deleteObjectStore("targetGlobal")}(e),k_(e)),o=o.next(()=>function(u){let l=u.store("targetGlobal"),f={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:K.min().toTimestamp(),targetCount:0};return l.put("targetGlobalKey",f)}(s))),n<4&&i>=4&&(n!==0&&(o=o.next(()=>function(u,l){return l.store("mutations").U().next(f=>{u.deleteObjectStore("mutations"),u.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",Qv,{unique:!0});let p=l.store("mutations"),m=f.map(T=>p.put(T));return b.waitFor(m)})}(e,s))),o=o.next(()=>{(function(u){u.createObjectStore("clientMetadata",{keyPath:"clientId"})})(e)})),n<5&&i>=5&&(o=o.next(()=>this.Xr(s))),n<6&&i>=6&&(o=o.next(()=>(function(u){u.createObjectStore("remoteDocumentGlobal")}(e),this.ei(s)))),n<7&&i>=7&&(o=o.next(()=>this.ti(s))),n<8&&i>=8&&(o=o.next(()=>this.ni(e,s))),n<9&&i>=9&&(o=o.next(()=>{(function(u){u.objectStoreNames.contains("remoteDocumentChanges")&&u.deleteObjectStore("remoteDocumentChanges")})(e)})),n<10&&i>=10&&(o=o.next(()=>this.ri(s))),n<11&&i>=11&&(o=o.next(()=>{(function(u){u.createObjectStore("bundles",{keyPath:"bundleId"})})(e),function(u){u.createObjectStore("namedQueries",{keyPath:"name"})}(e)})),n<12&&i>=12&&(o=o.next(()=>{(function(u){let l=u.createObjectStore("documentOverlays",{keyPath:Mb});l.createIndex("collectionPathOverlayIndex",Ob,{unique:!1}),l.createIndex("collectionGroupOverlayIndex",Vb,{unique:!1})})(e)})),n<13&&i>=13&&(o=o.next(()=>function(u){let l=u.createObjectStore("remoteDocumentsV14",{keyPath:Ib});l.createIndex("documentKeyIndex",Ab),l.createIndex("collectionGroupIndex",Sb)}(e)).next(()=>this.ii(e,s)).next(()=>e.deleteObjectStore("remoteDocuments"))),n<14&&i>=14&&(o=o.next(()=>this.si(e,s))),n<15&&i>=15&&(o=o.next(()=>function(u){u.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1}),u.createObjectStore("indexState",{keyPath:Db}).createIndex("sequenceNumberIndex",xb,{unique:!1}),u.createObjectStore("indexEntries",{keyPath:Nb}).createIndex("documentKeyIndex",kb,{unique:!1})}(e))),n<16&&i>=16&&(o=o.next(()=>{t.objectStore("indexState").clear()}).next(()=>{t.objectStore("indexEntries").clear()})),o}ei(e){let t=0;return e.store("remoteDocuments").J((n,i)=>{t+=Ec(i)}).next(()=>{let n={byteSize:t};return e.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",n)})}Xr(e){let t=e.store("mutationQueues"),n=e.store("mutations");return t.U().next(i=>b.forEach(i,s=>{let o=IDBKeyRange.bound([s.userId,-1],[s.userId,s.lastAcknowledgedBatchId]);return n.U("userMutationsIndex",o).next(c=>b.forEach(c,u=>{q(u.userId===s.userId);let l=sr(this.serializer,u);return Ww(e,s.userId,l).next(()=>{})}))}))}ti(e){let t=e.store("targetDocuments"),n=e.store("remoteDocuments");return e.store("targetGlobal").get("targetGlobalKey").next(i=>{let s=[];return n.J((o,c)=>{let u=new re(o),l=function(p){return[0,Je(p)]}(u);s.push(t.get(l).next(f=>f?b.resolve():(p=>t.put({targetId:0,path:Je(p),sequenceNumber:i.highestListenSequenceNumber}))(u)))}).next(()=>b.waitFor(s))})}ni(e,t){e.createObjectStore("collectionParents",{keyPath:Pb});let n=t.store("collectionParents"),i=new Eo,s=o=>{if(i.add(o)){let c=o.lastSegment(),u=o.popLast();return n.put({collectionId:c,parent:Je(u)})}};return t.store("remoteDocuments").J({H:!0},(o,c)=>{let u=new re(o);return s(u.popLast())}).next(()=>t.store("documentMutations").J({H:!0},([o,c,u],l)=>{let f=Mt(c);return s(f.popLast())}))}ri(e){let t=e.store("targets");return t.J((n,i)=>{let s=to(i),o=qw(this.serializer,s);return t.put(o)})}ii(e,t){let n=t.store("remoteDocuments"),i=[];return n.J((s,o)=>{let c=t.store("remoteDocumentsV14"),u=function(p){return p.document?new L(re.fromString(p.document.name).popFirst(5)):p.noDocument?L.fromSegments(p.noDocument.path):p.unknownDocument?L.fromSegments(p.unknownDocument.path):U()}(o).path.toArray(),l={prefixPath:u.slice(0,u.length-2),collectionGroup:u[u.length-2],documentId:u[u.length-1],readTime:o.readTime||[0,0],unknownDocument:o.unknownDocument,noDocument:o.noDocument,document:o.document,hasCommittedMutations:!!o.hasCommittedMutations};i.push(c.put(l))}).next(()=>b.waitFor(i))}si(e,t){let n=t.store("mutations"),i=Yw(this.serializer),s=new Sc(bc.Hr,this.serializer.ct);return n.U().next(o=>{let c=new Map;return o.forEach(u=>{var l;let f=(l=c.get(u.userId))!==null&&l!==void 0?l:Z();sr(this.serializer,u).keys().forEach(p=>f=f.add(p)),c.set(u.userId,f)}),b.forEach(c,(u,l)=>{let f=new xe(l),p=vc.lt(this.serializer,f),m=s.getIndexManager(f),T=Tc.lt(f,this.serializer,m,s.referenceDelegate);return new Ac(i,T,p,m).recalculateAndSaveOverlaysForDocumentKeys(new uo(t,ct.oe),u).next()})})}};function k_(r){r.createObjectStore("targetDocuments",{keyPath:Rb}).createIndex("documentTargetsIndex",Cb,{unique:!0}),r.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",bb,{unique:!0}),r.createObjectStore("targetGlobal")}var Bh="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",Zd=class r{constructor(e,t,n,i,s,o,c,u,l,f,p=16){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=n,this.oi=s,this.window=o,this.document=c,this._i=l,this.ai=f,this.ui=p,this.kr=null,this.qr=!1,this.isPrimary=!1,this.networkEnabled=!0,this.ci=null,this.inForeground=!1,this.li=null,this.hi=null,this.Pi=Number.NEGATIVE_INFINITY,this.Ii=m=>Promise.resolve(),!r.D())throw new k(C.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new $d(this,i),this.Ti=t+"main",this.serializer=new mc(u),this.Ei=new Nn(this.Ti,this.ui,new Jd(this.serializer)),this.Qr=new Ld(this.referenceDelegate,this.serializer),this.remoteDocumentCache=Yw(this.serializer),this.$r=new Cd,this.window&&this.window.localStorage?this.di=this.window.localStorage:(this.di=null,f===!1&&Ae("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.Ai().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new k(C.FAILED_PRECONDITION,Bh);return this.Ri(),this.Vi(),this.mi(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.Qr.getHighestSequenceNumber(e))}).then(e=>{this.kr=new ct(e,this._i)}).then(()=>{this.qr=!0}).catch(e=>(this.Ei&&this.Ei.close(),Promise.reject(e)))}fi(e){return this.Ii=t=>P(this,null,function*(){if(this.started)return e(t)}),e(this.isPrimary)}setDatabaseDeletedListener(e){this.Ei.L(t=>P(this,null,function*(){t.newVersion===null&&(yield e())}))}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.oi.enqueueAndForget(()=>P(this,null,function*(){this.started&&(yield this.Ai())})))}Ai(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>Wa(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.gi(e).next(t=>{t||(this.isPrimary=!1,this.oi.enqueueRetryable(()=>this.Ii(!1)))})}).next(()=>this.pi(e)).next(t=>this.isPrimary&&!t?this.yi(e).next(()=>!1):!!t&&this.wi(e).next(()=>!0))).catch(e=>{if(zn(e))return M("IndexedDbPersistence","Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return M("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.oi.enqueueRetryable(()=>this.Ii(e)),this.isPrimary=e})}gi(e){return Zs(e).get("owner").next(t=>b.resolve(this.Si(t)))}bi(e){return Wa(e).delete(this.clientId)}Di(){return P(this,null,function*(){if(this.isPrimary&&!this.Ci(this.Pi,18e5)){this.Pi=Date.now();let e=yield this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",t=>{let n=Ue(t,"clientMetadata");return n.U().next(i=>{let s=this.vi(i,18e5),o=i.filter(c=>s.indexOf(c)===-1);return b.forEach(o,c=>n.delete(c.clientId)).next(()=>o)})}).catch(()=>[]);if(this.di)for(let t of e)this.di.removeItem(this.Fi(t.clientId))}})}mi(){this.hi=this.oi.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.Ai().then(()=>this.Di()).then(()=>this.mi()))}Si(e){return!!e&&e.ownerId===this.clientId}pi(e){return this.ai?b.resolve(!0):Zs(e).get("owner").next(t=>{if(t!==null&&this.Ci(t.leaseTimestampMs,5e3)&&!this.Mi(t.ownerId)){if(this.Si(t)&&this.networkEnabled)return!0;if(!this.Si(t)){if(!t.allowTabSynchronization)throw new k(C.FAILED_PRECONDITION,Bh);return!1}}return!(!this.networkEnabled||!this.inForeground)||Wa(e).U().next(n=>this.vi(n,5e3).find(i=>{if(this.clientId!==i.clientId){let s=!this.networkEnabled&&i.networkEnabled,o=!this.inForeground&&i.inForeground,c=this.networkEnabled===i.networkEnabled;if(s||o&&c)return!0}return!1})===void 0)}).next(t=>(this.isPrimary!==t&&M("IndexedDbPersistence",`Client ${t?"is":"is not"} eligible for a primary lease.`),t))}shutdown(){return P(this,null,function*(){this.qr=!1,this.xi(),this.hi&&(this.hi.cancel(),this.hi=null),this.Oi(),this.Ni(),yield this.Ei.runTransaction("shutdown","readwrite",["owner","clientMetadata"],e=>{let t=new uo(e,ct.oe);return this.yi(t).next(()=>this.bi(t))}),this.Ei.close(),this.Li()})}vi(e,t){return e.filter(n=>this.Ci(n.updateTimeMs,t)&&!this.Mi(n.clientId))}Bi(){return this.runTransaction("getActiveClients","readonly",e=>Wa(e).U().next(t=>this.vi(t,18e5).map(n=>n.clientId)))}get started(){return this.qr}getMutationQueue(e,t){return Tc.lt(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.Qr}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new Vd(e,this.serializer.ct.databaseId)}getDocumentOverlayCache(e){return vc.lt(this.serializer,e)}getBundleCache(){return this.$r}runTransaction(e,t,n){M("IndexedDbPersistence","Starting transaction:",e);let i=t==="readonly"?"readonly":"readwrite",s=function(u){return u===16?Fb:u===15?rw:u===14?nw:u===13?tw:u===12?Lb:u===11?ew:void U()}(this.ui),o;return this.Ei.runTransaction(e,i,s,c=>(o=new uo(c,this.kr?this.kr.next():ct.oe),t==="readwrite-primary"?this.gi(o).next(u=>!!u||this.pi(o)).next(u=>{if(!u)throw Ae(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.oi.enqueueRetryable(()=>this.Ii(!1)),new k(C.FAILED_PRECONDITION,Y_);return n(o)}).next(u=>this.wi(o).next(()=>u)):this.ki(o).next(()=>n(o)))).then(c=>(o.raiseOnCommittedEvent(),c))}ki(e){return Zs(e).get("owner").next(t=>{if(t!==null&&this.Ci(t.leaseTimestampMs,5e3)&&!this.Mi(t.ownerId)&&!this.Si(t)&&!(this.ai||this.allowTabSynchronization&&t.allowTabSynchronization))throw new k(C.FAILED_PRECONDITION,Bh)})}wi(e){let t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return Zs(e).put("owner",t)}static D(){return Nn.D()}yi(e){let t=Zs(e);return t.get("owner").next(n=>this.Si(n)?(M("IndexedDbPersistence","Releasing primary lease."),t.delete("owner")):b.resolve())}Ci(e,t){let n=Date.now();return!(e<n-t)&&(!(e>n)||(Ae(`Detected an update time that is in the future: ${e} > ${n}`),!1))}Ri(){this.document!==null&&typeof this.document.addEventListener=="function"&&(this.li=()=>{this.oi.enqueueAndForget(()=>(this.inForeground=this.document.visibilityState==="visible",this.Ai()))},this.document.addEventListener("visibilitychange",this.li),this.inForeground=this.document.visibilityState==="visible")}Oi(){this.li&&(this.document.removeEventListener("visibilitychange",this.li),this.li=null)}Vi(){var e;typeof((e=this.window)===null||e===void 0?void 0:e.addEventListener)=="function"&&(this.ci=()=>{this.xi();let t=/(?:Version|Mobile)\/1[456]/;_l()&&(navigator.appVersion.match(t)||navigator.userAgent.match(t))&&this.oi.enterRestrictedMode(!0),this.oi.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.ci))}Ni(){this.ci&&(this.window.removeEventListener("pagehide",this.ci),this.ci=null)}Mi(e){var t;try{let n=((t=this.di)===null||t===void 0?void 0:t.getItem(this.Fi(e)))!==null;return M("IndexedDbPersistence",`Client '${e}' ${n?"is":"is not"} zombied in LocalStorage`),n}catch(n){return Ae("IndexedDbPersistence","Failed to get zombied client id.",n),!1}}xi(){if(this.di)try{this.di.setItem(this.Fi(this.clientId),String(Date.now()))}catch(e){Ae("Failed to set zombie client id.",e)}}Li(){if(this.di)try{this.di.removeItem(this.Fi(this.clientId))}catch{}}Fi(e){return`firestore_zombie_${this.persistenceKey}_${e}`}};function Zs(r){return Ue(r,"owner")}function Wa(r){return Ue(r,"clientMetadata")}function np(r,e){let t=r.projectId;return r.isDefaultDatabase||(t+="."+r.database),"firestore/"+e+"/"+t+"/"}var ef=class r{constructor(e,t,n,i){this.targetId=e,this.fromCache=t,this.qi=n,this.Qi=i}static Ki(e,t){let n=Z(),i=Z();for(let s of t.docChanges)switch(s.type){case 0:n=n.add(s.doc.key);break;case 1:i=i.add(s.doc.key)}return new r(e,t.fromCache,n,i)}};var tf=class{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}};var Rc=class{constructor(){this.$i=!1,this.Ui=!1,this.Wi=100,this.Gi=function(){return _l()?8:X_(vs())>0?6:4}()}initialize(e,t){this.zi=e,this.indexManager=t,this.$i=!0}getDocumentsMatchingQuery(e,t,n,i){let s={result:null};return this.ji(e,t).next(o=>{s.result=o}).next(()=>{if(!s.result)return this.Hi(e,t,i,n).next(o=>{s.result=o})}).next(()=>{if(s.result)return;let o=new tf;return this.Ji(e,t,o).next(c=>{if(s.result=c,this.Ui)return this.Yi(e,t,o,c.size)})}).next(()=>s.result)}Yi(e,t,n,i){return n.documentReadCount<this.Wi?(oi()<=Pt.DEBUG&&M("QueryEngine","SDK will not create cache indexes for query:",ai(t),"since it only creates cache indexes for collection contains","more than or equal to",this.Wi,"documents"),b.resolve()):(oi()<=Pt.DEBUG&&M("QueryEngine","Query:",ai(t),"scans",n.documentReadCount,"local documents and returns",i,"documents as results."),n.documentReadCount>this.Gi*i?(oi()<=Pt.DEBUG&&M("QueryEngine","The SDK decides to create cache indexes for query:",ai(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Ze(t))):b.resolve())}ji(e,t){if(o_(t))return b.resolve(null);let n=Ze(t);return this.indexManager.getIndexType(e,n).next(i=>i===0?null:(t.limit!==null&&i===1&&(t=dc(t,null,"F"),n=Ze(t)),this.indexManager.getDocumentsMatchingTarget(e,n).next(s=>{let o=Z(...s);return this.zi.getDocuments(e,o).next(c=>this.indexManager.getMinOffset(e,n).next(u=>{let l=this.Zi(t,c);return this.Xi(t,l,o,u.readTime)?this.ji(e,dc(t,null,"F")):this.es(e,l,t,u)}))})))}Hi(e,t,n,i){return o_(t)||i.isEqual(K.min())?b.resolve(null):this.zi.getDocuments(e,n).next(s=>{let o=this.Zi(t,s);return this.Xi(t,o,n,i)?b.resolve(null):(oi()<=Pt.DEBUG&&M("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),ai(t)),this.es(e,o,t,H_(i,-1)).next(c=>c))})}Zi(e,t){let n=new he(mw(e));return t.forEach((i,s)=>{ko(e,s)&&(n=n.add(s))}),n}Xi(e,t,n,i){if(e.limit===null)return!1;if(n.size!==t.size)return!0;let s=e.limitType==="F"?t.last():t.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(i)>0)}Ji(e,t,n){return oi()<=Pt.DEBUG&&M("QueryEngine","Using full collection scan to execute query:",ai(t)),this.zi.getDocumentsMatchingQuery(e,t,mt.min(),n)}es(e,t,n,i){return this.zi.getDocumentsMatchingQuery(e,n,i).next(s=>(t.forEach(o=>{s=s.insert(o.key,o)}),s))}};var nf=class{constructor(e,t,n,i){this.persistence=e,this.ts=t,this.serializer=i,this.ns=new pe(J),this.rs=new $t(s=>fr(s),xo),this.ss=new Map,this.os=e.getRemoteDocumentCache(),this.Qr=e.getTargetCache(),this.$r=e.getBundleCache(),this._s(n)}_s(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new Ac(this.os,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.os.setIndexManager(this.indexManager),this.ts.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.ns))}};function Xw(r,e,t,n){return new nf(r,e,t,n)}function Jw(r,e){return P(this,null,function*(){let t=F(r);return yield t.persistence.runTransaction("Handle user change","readonly",n=>{let i;return t.mutationQueue.getAllMutationBatches(n).next(s=>(i=s,t._s(e),t.mutationQueue.getAllMutationBatches(n))).next(s=>{let o=[],c=[],u=Z();for(let l of i){o.push(l.batchId);for(let f of l.mutations)u=u.add(f.key)}for(let l of s){c.push(l.batchId);for(let f of l.mutations)u=u.add(f.key)}return t.localDocuments.getDocuments(n,u).next(l=>({us:l,removedBatchIds:o,addedBatchIds:c}))})})})}function yR(r,e){let t=F(r);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",n=>{let i=e.batch.keys(),s=t.os.newChangeBuffer({trackRemovals:!0});return function(c,u,l,f){let p=l.batch,m=p.keys(),T=b.resolve();return m.forEach(x=>{T=T.next(()=>f.getEntry(u,x)).next(N=>{let D=l.docVersions.get(x);q(D!==null),N.version.compareTo(D)<0&&(p.applyToRemoteDocument(N,l),N.isValidDocument()&&(N.setReadTime(l.commitVersion),f.addEntry(N)))})}),T.next(()=>c.mutationQueue.removeMutationBatch(u,p))}(t,n,e,s).next(()=>s.apply(n)).next(()=>t.mutationQueue.performConsistencyCheck(n)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(n,i,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(n,function(c){let u=Z();for(let l=0;l<c.mutationResults.length;++l)c.mutationResults[l].transformResults.length>0&&(u=u.add(c.batch.mutations[l].key));return u}(e))).next(()=>t.localDocuments.getDocuments(n,i))})}function Zw(r){let e=F(r);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Qr.getLastRemoteSnapshotVersion(t))}function vR(r,e){let t=F(r),n=e.snapshotVersion,i=t.ns;return t.persistence.runTransaction("Apply remote event","readwrite-primary",s=>{let o=t.os.newChangeBuffer({trackRemovals:!0});i=t.ns;let c=[];e.targetChanges.forEach((f,p)=>{let m=i.get(p);if(!m)return;c.push(t.Qr.removeMatchingKeys(s,f.removedDocuments,p).next(()=>t.Qr.addMatchingKeys(s,f.addedDocuments,p)));let T=m.withSequenceNumber(s.currentSequenceNumber);e.targetMismatches.get(p)!==null?T=T.withResumeToken(Fe.EMPTY_BYTE_STRING,K.min()).withLastLimboFreeSnapshotVersion(K.min()):f.resumeToken.approximateByteSize()>0&&(T=T.withResumeToken(f.resumeToken,n)),i=i.insert(p,T),function(N,D,j){return N.resumeToken.approximateByteSize()===0||D.snapshotVersion.toMicroseconds()-N.snapshotVersion.toMicroseconds()>=3e8?!0:j.addedDocuments.size+j.modifiedDocuments.size+j.removedDocuments.size>0}(m,T,f)&&c.push(t.Qr.updateTargetData(s,T))});let u=tt(),l=Z();if(e.documentUpdates.forEach(f=>{e.resolvedLimboDocuments.has(f)&&c.push(t.persistence.referenceDelegate.updateLimboDocument(s,f))}),c.push(eE(s,o,e.documentUpdates).next(f=>{u=f.cs,l=f.ls})),!n.isEqual(K.min())){let f=t.Qr.getLastRemoteSnapshotVersion(s).next(p=>t.Qr.setTargetsMetadata(s,s.currentSequenceNumber,n));c.push(f)}return b.waitFor(c).next(()=>o.apply(s)).next(()=>t.localDocuments.getLocalViewOfDocuments(s,u,l)).next(()=>u)}).then(s=>(t.ns=i,s))}function eE(r,e,t){let n=Z(),i=Z();return t.forEach(s=>n=n.add(s)),e.getEntries(r,n).next(s=>{let o=tt();return t.forEach((c,u)=>{let l=s.get(c);u.isFoundDocument()!==l.isFoundDocument()&&(i=i.add(c)),u.isNoDocument()&&u.version.isEqual(K.min())?(e.removeEntry(c,u.readTime),o=o.insert(c,u)):!l.isValidDocument()||u.version.compareTo(l.version)>0||u.version.compareTo(l.version)===0&&l.hasPendingWrites?(e.addEntry(u),o=o.insert(c,u)):M("LocalStore","Ignoring outdated watch update for ",c,". Current version:",l.version," Watch version:",u.version)}),{cs:o,ls:i}})}function _R(r,e){let t=F(r);return t.persistence.runTransaction("Get next mutation batch","readonly",n=>(e===void 0&&(e=-1),t.mutationQueue.getNextMutationBatchAfterBatchId(n,e)))}function Ai(r,e){let t=F(r);return t.persistence.runTransaction("Allocate target","readwrite",n=>{let i;return t.Qr.getTargetData(n,e).next(s=>s?(i=s,b.resolve(i)):t.Qr.allocateTargetId(n).next(o=>(i=new Ti(e,o,"TargetPurposeListen",n.currentSequenceNumber),t.Qr.addTargetData(n,i).next(()=>i))))}).then(n=>{let i=t.ns.get(n.targetId);return(i===null||n.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(t.ns=t.ns.insert(n.targetId,n),t.rs.set(e,n.targetId)),n})}function Si(r,e,t){return P(this,null,function*(){let n=F(r),i=n.ns.get(e),s=t?"readwrite":"readwrite-primary";try{t||(yield n.persistence.runTransaction("Release target",s,o=>n.persistence.referenceDelegate.removeTarget(o,i)))}catch(o){if(!zn(o))throw o;M("LocalStore",`Failed to update sequence numbers for target ${e}: ${o}`)}n.ns=n.ns.remove(e),n.rs.delete(i.target)})}function Cc(r,e,t){let n=F(r),i=K.min(),s=Z();return n.persistence.runTransaction("Execute query","readwrite",o=>function(u,l,f){let p=F(u),m=p.rs.get(f);return m!==void 0?b.resolve(p.ns.get(m)):p.Qr.getTargetData(l,f)}(n,o,Ze(e)).next(c=>{if(c)return i=c.lastLimboFreeSnapshotVersion,n.Qr.getMatchingKeysForTargetId(o,c.targetId).next(u=>{s=u})}).next(()=>n.ts.getDocumentsMatchingQuery(o,e,t?i:K.min(),t?s:Z())).next(c=>(rE(n,gw(e),c),{documents:c,hs:s})))}function tE(r,e){let t=F(r),n=F(t.Qr),i=t.ns.get(e);return i?Promise.resolve(i.target):t.persistence.runTransaction("Get target data","readonly",s=>n.ot(s,e).next(o=>o?o.target:null))}function nE(r,e){let t=F(r),n=t.ss.get(e)||K.min();return t.persistence.runTransaction("Get new document changes","readonly",i=>t.os.getAllFromCollectionGroup(i,e,H_(n,-1),Number.MAX_SAFE_INTEGER)).then(i=>(rE(t,e,i),i))}function rE(r,e,t){let n=r.ss.get(e)||K.min();t.forEach((i,s)=>{s.readTime.compareTo(n)>0&&(n=s.readTime)}),r.ss.set(e,n)}function wR(r,e,t,n){return P(this,null,function*(){let i=F(r),s=Z(),o=tt();for(let l of t){let f=e.Ps(l.metadata.name);l.document&&(s=s.add(f));let p=e.Is(l);p.setReadTime(e.Ts(l.metadata.readTime)),o=o.insert(f,p)}let c=i.os.newChangeBuffer({trackRemovals:!0}),u=yield Ai(i,function(f){return Ze(ki(re.fromString(`__bundle__/docs/${f}`)))}(n));return i.persistence.runTransaction("Apply bundle documents","readwrite",l=>eE(l,c,o).next(f=>(c.apply(l),f)).next(f=>i.Qr.removeMatchingKeysForTargetId(l,u.targetId).next(()=>i.Qr.addMatchingKeys(l,s,u.targetId)).next(()=>i.localDocuments.getLocalViewOfDocuments(l,f.cs,f.ls)).next(()=>f.cs)))})}function ER(n,i){return P(this,arguments,function*(r,e,t=Z()){let s=yield Ai(r,Ze(ep(e.bundledQuery))),o=F(r);return o.persistence.runTransaction("Save named query","readwrite",c=>{let u=be(e.readTime);if(s.snapshotVersion.compareTo(u)>=0)return o.$r.saveNamedQuery(c,e);let l=s.withResumeToken(Fe.EMPTY_BYTE_STRING,u);return o.ns=o.ns.insert(l.targetId,l),o.Qr.updateTargetData(c,l).next(()=>o.Qr.removeMatchingKeysForTargetId(c,s.targetId)).next(()=>o.Qr.addMatchingKeys(c,t,s.targetId)).next(()=>o.$r.saveNamedQuery(c,e))})})}function M_(r,e){return`firestore_clients_${r}_${e}`}function O_(r,e,t){let n=`firestore_mutations_${r}_${t}`;return e.isAuthenticated()&&(n+=`_${e.uid}`),n}function qh(r,e){return`firestore_targets_${r}_${e}`}var Pc=class r{constructor(e,t,n,i){this.user=e,this.batchId=t,this.state=n,this.error=i}static Es(e,t,n){let i=JSON.parse(n),s,o=typeof i=="object"&&["pending","acknowledged","rejected"].indexOf(i.state)!==-1&&(i.error===void 0||typeof i.error=="object");return o&&i.error&&(o=typeof i.error.message=="string"&&typeof i.error.code=="string",o&&(s=new k(i.error.code,i.error.message))),o?new r(e,t,i.state,s):(Ae("SharedClientState",`Failed to parse mutation state for ID '${t}': ${n}`),null)}ds(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}},so=class r{constructor(e,t,n){this.targetId=e,this.state=t,this.error=n}static Es(e,t){let n=JSON.parse(t),i,s=typeof n=="object"&&["not-current","current","rejected"].indexOf(n.state)!==-1&&(n.error===void 0||typeof n.error=="object");return s&&n.error&&(s=typeof n.error.message=="string"&&typeof n.error.code=="string",s&&(i=new k(n.error.code,n.error.message))),s?new r(e,n.state,i):(Ae("SharedClientState",`Failed to parse target state for ID '${e}': ${t}`),null)}ds(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}},Dc=class r{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static Es(e,t){let n=JSON.parse(t),i=typeof n=="object"&&n.activeTargetIds instanceof Array,s=Jf();for(let o=0;i&&o<n.activeTargetIds.length;++o)i=J_(n.activeTargetIds[o]),s=s.add(n.activeTargetIds[o]);return i?new r(e,s):(Ae("SharedClientState",`Failed to parse client data for instance '${e}': ${t}`),null)}},rf=class r{constructor(e,t){this.clientId=e,this.onlineState=t}static Es(e){let t=JSON.parse(e);return typeof t=="object"&&["Unknown","Online","Offline"].indexOf(t.onlineState)!==-1&&typeof t.clientId=="string"?new r(t.clientId,t.onlineState):(Ae("SharedClientState",`Failed to parse online state: ${e}`),null)}},Io=class{constructor(){this.activeTargetIds=Jf()}As(e){this.activeTargetIds=this.activeTargetIds.add(e)}Rs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}ds(){let e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}},oo=class{constructor(e,t,n,i,s){this.window=e,this.oi=t,this.persistenceKey=n,this.Vs=i,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.fs=this.gs.bind(this),this.ps=new pe(J),this.started=!1,this.ys=[];let o=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=s,this.ws=M_(this.persistenceKey,this.Vs),this.Ss=function(u){return`firestore_sequence_number_${u}`}(this.persistenceKey),this.ps=this.ps.insert(this.Vs,new Io),this.bs=new RegExp(`^firestore_clients_${o}_([^_]*)$`),this.Ds=new RegExp(`^firestore_mutations_${o}_(\\d+)(?:_(.*))?$`),this.Cs=new RegExp(`^firestore_targets_${o}_(\\d+)$`),this.vs=function(u){return`firestore_online_state_${u}`}(this.persistenceKey),this.Fs=function(u){return`firestore_bundle_loaded_v2_${u}`}(this.persistenceKey),this.window.addEventListener("storage",this.fs)}static D(e){return!(!e||!e.localStorage)}start(){return P(this,null,function*(){let e=yield this.syncEngine.Bi();for(let n of e){if(n===this.Vs)continue;let i=this.getItem(M_(this.persistenceKey,n));if(i){let s=Dc.Es(n,i);s&&(this.ps=this.ps.insert(s.clientId,s))}}this.Ms();let t=this.storage.getItem(this.vs);if(t){let n=this.xs(t);n&&this.Os(n)}for(let n of this.ys)this.gs(n);this.ys=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0})}writeSequenceNumber(e){this.setItem(this.Ss,JSON.stringify(e))}getAllActiveQueryTargets(){return this.Ns(this.ps)}isActiveQueryTarget(e){let t=!1;return this.ps.forEach((n,i)=>{i.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.Ls(e,"pending")}updateMutationState(e,t,n){this.Ls(e,t,n),this.Bs(e)}addLocalQueryTarget(e){let t="not-current";if(this.isActiveQueryTarget(e)){let n=this.storage.getItem(qh(this.persistenceKey,e));if(n){let i=so.Es(e,n);i&&(t=i.state)}}return this.ks.As(e),this.Ms(),t}removeLocalQueryTarget(e){this.ks.Rs(e),this.Ms()}isLocalQueryTarget(e){return this.ks.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(qh(this.persistenceKey,e))}updateQueryState(e,t,n){this.qs(e,t,n)}handleUserChange(e,t,n){t.forEach(i=>{this.Bs(i)}),this.currentUser=e,n.forEach(i=>{this.addPendingMutation(i)})}setOnlineState(e){this.Qs(e)}notifyBundleLoaded(e){this.Ks(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.fs),this.removeItem(this.ws),this.started=!1)}getItem(e){let t=this.storage.getItem(e);return M("SharedClientState","READ",e,t),t}setItem(e,t){M("SharedClientState","SET",e,t),this.storage.setItem(e,t)}removeItem(e){M("SharedClientState","REMOVE",e),this.storage.removeItem(e)}gs(e){let t=e;if(t.storageArea===this.storage){if(M("SharedClientState","EVENT",t.key,t.newValue),t.key===this.ws)return void Ae("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.oi.enqueueRetryable(()=>P(this,null,function*(){if(this.started){if(t.key!==null){if(this.bs.test(t.key)){if(t.newValue==null){let n=this.$s(t.key);return this.Us(n,null)}{let n=this.Ws(t.key,t.newValue);if(n)return this.Us(n.clientId,n)}}else if(this.Ds.test(t.key)){if(t.newValue!==null){let n=this.Gs(t.key,t.newValue);if(n)return this.zs(n)}}else if(this.Cs.test(t.key)){if(t.newValue!==null){let n=this.js(t.key,t.newValue);if(n)return this.Hs(n)}}else if(t.key===this.vs){if(t.newValue!==null){let n=this.xs(t.newValue);if(n)return this.Os(n)}}else if(t.key===this.Ss){let n=function(s){let o=ct.oe;if(s!=null)try{let c=JSON.parse(s);q(typeof c=="number"),o=c}catch(c){Ae("SharedClientState","Failed to read sequence number from WebStorage",c)}return o}(t.newValue);n!==ct.oe&&this.sequenceNumberHandler(n)}else if(t.key===this.Fs){let n=this.Js(t.newValue);yield Promise.all(n.map(i=>this.syncEngine.Ys(i)))}}}else this.ys.push(t)}))}}get ks(){return this.ps.get(this.Vs)}Ms(){this.setItem(this.ws,this.ks.ds())}Ls(e,t,n){let i=new Pc(this.currentUser,e,t,n),s=O_(this.persistenceKey,this.currentUser,e);this.setItem(s,i.ds())}Bs(e){let t=O_(this.persistenceKey,this.currentUser,e);this.removeItem(t)}Qs(e){let t={clientId:this.Vs,onlineState:e};this.storage.setItem(this.vs,JSON.stringify(t))}qs(e,t,n){let i=qh(this.persistenceKey,e),s=new so(e,t,n);this.setItem(i,s.ds())}Ks(e){let t=JSON.stringify(Array.from(e));this.setItem(this.Fs,t)}$s(e){let t=this.bs.exec(e);return t?t[1]:null}Ws(e,t){let n=this.$s(e);return Dc.Es(n,t)}Gs(e,t){let n=this.Ds.exec(e),i=Number(n[1]),s=n[2]!==void 0?n[2]:null;return Pc.Es(new xe(s),i,t)}js(e,t){let n=this.Cs.exec(e),i=Number(n[1]);return so.Es(i,t)}xs(e){return rf.Es(e)}Js(e){return JSON.parse(e)}zs(e){return P(this,null,function*(){if(e.user.uid===this.currentUser.uid)return this.syncEngine.Zs(e.batchId,e.state,e.error);M("SharedClientState",`Ignoring mutation for non-active user ${e.user.uid}`)})}Hs(e){return this.syncEngine.Xs(e.targetId,e.state,e.error)}Us(e,t){let n=t?this.ps.insert(e,t):this.ps.remove(e),i=this.Ns(this.ps),s=this.Ns(n),o=[],c=[];return s.forEach(u=>{i.has(u)||o.push(u)}),i.forEach(u=>{s.has(u)||c.push(u)}),this.syncEngine.eo(o,c).then(()=>{this.ps=n})}Os(e){this.ps.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}Ns(e){let t=Jf();return e.forEach((n,i)=>{t=t.unionWith(i.activeTargetIds)}),t}},xc=class{constructor(){this.no=new Io,this.ro={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e){return this.no.As(e),this.ro[e]||"not-current"}updateQueryState(e,t,n){this.ro[e]=t}removeLocalQueryTarget(e){this.no.Rs(e)}isLocalQueryTarget(e){return this.no.activeTargetIds.has(e)}clearQueryState(e){delete this.ro[e]}getAllActiveQueryTargets(){return this.no.activeTargetIds}isActiveQueryTarget(e){return this.no.activeTargetIds.has(e)}start(){return this.no=new Io,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}};var sf=class{io(e){}shutdown(){}};var Nc=class{constructor(){this.so=()=>this.oo(),this._o=()=>this.ao(),this.uo=[],this.co()}io(e){this.uo.push(e)}shutdown(){window.removeEventListener("online",this.so),window.removeEventListener("offline",this._o)}co(){window.addEventListener("online",this.so),window.addEventListener("offline",this._o)}oo(){M("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(let e of this.uo)e(0)}ao(){M("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(let e of this.uo)e(1)}static D(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}};var Ha=null;function Gh(){return Ha===null?Ha=function(){return 268435456+Math.round(2147483648*Math.random())}():Ha++,"0x"+Ha.toString(16)}var TR={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};var of=class{constructor(e){this.lo=e.lo,this.ho=e.ho}Po(e){this.Io=e}To(e){this.Eo=e}Ao(e){this.Ro=e}onMessage(e){this.Vo=e}close(){this.ho()}send(e){this.lo(e)}mo(){this.Io()}fo(){this.Eo()}po(e){this.Ro(e)}yo(e){this.Vo(e)}};var Ke="WebChannelConnection",af=class extends class{constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;let n=t.ssl?"https":"http",i=encodeURIComponent(this.databaseId.projectId),s=encodeURIComponent(this.databaseId.database);this.wo=n+"://"+t.host,this.So=`projects/${i}/databases/${s}`,this.bo=this.databaseId.database==="(default)"?`project_id=${i}`:`project_id=${i}&database_id=${s}`}get Do(){return!1}Co(t,n,i,s,o){let c=Gh(),u=this.vo(t,n.toUriEncodedString());M("RestConnection",`Sending RPC '${t}' ${c}:`,u,i);let l={"google-cloud-resource-prefix":this.So,"x-goog-request-params":this.bo};return this.Fo(l,s,o),this.Mo(t,u,l,i).then(f=>(M("RestConnection",`Received RPC '${t}' ${c}: `,f),f),f=>{throw gt("RestConnection",`RPC '${t}' ${c} failed with error: `,f,"url: ",u,"request:",i),f})}xo(t,n,i,s,o,c){return this.Co(t,n,i,s,o)}Fo(t,n,i){t["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+Ni}(),t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),n&&n.headers.forEach((s,o)=>t[o]=s),i&&i.headers.forEach((s,o)=>t[o]=s)}vo(t,n){let i=TR[t];return`${this.wo}/v1/${n}:${i}`}terminate(){}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Mo(e,t,n,i){let s=Gh();return new Promise((o,c)=>{let u=new Vh;u.setWithCredentials(!0),u.listenOnce(Fh.COMPLETE,()=>{try{switch(u.getLastErrorCode()){case Qs.NO_ERROR:let f=u.getResponseJson();M(Ke,`XHR for RPC '${e}' ${s} received:`,JSON.stringify(f)),o(f);break;case Qs.TIMEOUT:M(Ke,`RPC '${e}' ${s} timed out`),c(new k(C.DEADLINE_EXCEEDED,"Request time out"));break;case Qs.HTTP_ERROR:let p=u.getStatus();if(M(Ke,`RPC '${e}' ${s} failed with status:`,p,"response text:",u.getResponseText()),p>0){let m=u.getResponseJson();Array.isArray(m)&&(m=m[0]);let T=m?.error;if(T&&T.status&&T.message){let x=function(D){let j=D.toLowerCase().replace(/_/g,"-");return Object.values(C).indexOf(j)>=0?j:C.UNKNOWN}(T.status);c(new k(x,T.message))}else c(new k(C.UNKNOWN,"Server responded with status "+u.getStatus()))}else c(new k(C.UNAVAILABLE,"Connection failed."));break;default:U()}}finally{M(Ke,`RPC '${e}' ${s} completed.`)}});let l=JSON.stringify(i);M(Ke,`RPC '${e}' ${s} sending request:`,i),u.send(t,"POST",l,n,15)})}Oo(e,t,n){let i=Gh(),s=[this.wo,"/","google.firestore.v1.Firestore","/",e,"/channel"],o=$h(),c=jh(),u={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},l=this.longPollingOptions.timeoutSeconds;l!==void 0&&(u.longPollingTimeout=Math.round(1e3*l)),this.useFetchStreams&&(u.xmlHttpFactory=new Lh({})),this.Fo(u.initMessageHeaders,t,n),u.encodeInitMessageHeaders=!0;let f=s.join("");M(Ke,`Creating RPC '${e}' stream ${i}: ${f}`,u);let p=o.createWebChannel(f,u),m=!1,T=!1,x=new of({lo:D=>{T?M(Ke,`Not sending because RPC '${e}' stream ${i} is closed:`,D):(m||(M(Ke,`Opening RPC '${e}' stream ${i} transport.`),p.open(),m=!0),M(Ke,`RPC '${e}' stream ${i} sending:`,D),p.send(D))},ho:()=>p.close()}),N=(D,j,G)=>{D.listen(j,V=>{try{G(V)}catch(H){setTimeout(()=>{throw H},0)}})};return N(p,ti.EventType.OPEN,()=>{T||(M(Ke,`RPC '${e}' stream ${i} transport opened.`),x.mo())}),N(p,ti.EventType.CLOSE,()=>{T||(T=!0,M(Ke,`RPC '${e}' stream ${i} transport closed`),x.po())}),N(p,ti.EventType.ERROR,D=>{T||(T=!0,gt(Ke,`RPC '${e}' stream ${i} transport errored:`,D),x.po(new k(C.UNAVAILABLE,"The operation could not be completed")))}),N(p,ti.EventType.MESSAGE,D=>{var j;if(!T){let G=D.data[0];q(!!G);let V=G,H=V.error||((j=V[0])===null||j===void 0?void 0:j.error);if(H){M(Ke,`RPC '${e}' stream ${i} received error:`,H);let Q=H.status,Y=function(_){let E=Pe[_];if(E!==void 0)return Dw(E)}(Q),w=H.message;Y===void 0&&(Y=C.INTERNAL,w="Unknown error status: "+Q+" with message "+H.message),T=!0,x.po(new k(Y,w)),p.close()}else M(Ke,`RPC '${e}' stream ${i} received:`,G),x.yo(G)}}),N(c,Uh.STAT_EVENT,D=>{D.stat===qa.PROXY?M(Ke,`RPC '${e}' stream ${i} detected buffering proxy`):D.stat===qa.NOPROXY&&M(Ke,`RPC '${e}' stream ${i} detected no buffering proxy`)}),setTimeout(()=>{x.fo()},0),x}};function iE(){return typeof window<"u"?window:null}function Za(){return typeof document<"u"?document:null}function Mo(r){return new Id(r,!0)}var Ao=class{constructor(e,t,n=1e3,i=1.5,s=6e4){this.oi=e,this.timerId=t,this.No=n,this.Lo=i,this.Bo=s,this.ko=0,this.qo=null,this.Qo=Date.now(),this.reset()}reset(){this.ko=0}Ko(){this.ko=this.Bo}$o(e){this.cancel();let t=Math.floor(this.ko+this.Uo()),n=Math.max(0,Date.now()-this.Qo),i=Math.max(0,t-n);i>0&&M("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.ko} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.qo=this.oi.enqueueAfterDelay(this.timerId,i,()=>(this.Qo=Date.now(),e())),this.ko*=this.Lo,this.ko<this.No&&(this.ko=this.No),this.ko>this.Bo&&(this.ko=this.Bo)}Wo(){this.qo!==null&&(this.qo.skipDelay(),this.qo=null)}cancel(){this.qo!==null&&(this.qo.cancel(),this.qo=null)}Uo(){return(Math.random()-.5)*this.ko}};var kc=class{constructor(e,t,n,i,s,o,c,u){this.oi=e,this.Go=n,this.zo=i,this.connection=s,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=c,this.listener=u,this.state=0,this.jo=0,this.Ho=null,this.Jo=null,this.stream=null,this.Yo=new Ao(e,t)}Zo(){return this.state===1||this.state===5||this.Xo()}Xo(){return this.state===2||this.state===3}start(){this.state!==4?this.auth():this.e_()}stop(){return P(this,null,function*(){this.Zo()&&(yield this.close(0))})}t_(){this.state=0,this.Yo.reset()}n_(){this.Xo()&&this.Ho===null&&(this.Ho=this.oi.enqueueAfterDelay(this.Go,6e4,()=>this.r_()))}i_(e){this.s_(),this.stream.send(e)}r_(){return P(this,null,function*(){if(this.Xo())return this.close(0)})}s_(){this.Ho&&(this.Ho.cancel(),this.Ho=null)}o_(){this.Jo&&(this.Jo.cancel(),this.Jo=null)}close(e,t){return P(this,null,function*(){this.s_(),this.o_(),this.Yo.cancel(),this.jo++,e!==4?this.Yo.reset():t&&t.code===C.RESOURCE_EXHAUSTED?(Ae(t.toString()),Ae("Using maximum backoff delay to prevent overloading the backend."),this.Yo.Ko()):t&&t.code===C.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.__(),this.stream.close(),this.stream=null),this.state=e,yield this.listener.Ao(t)})}__(){}auth(){this.state=1;let e=this.a_(this.jo),t=this.jo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([n,i])=>{this.jo===t&&this.u_(n,i)},n=>{e(()=>{let i=new k(C.UNKNOWN,"Fetching auth token failed: "+n.message);return this.c_(i)})})}u_(e,t){let n=this.a_(this.jo);this.stream=this.l_(e,t),this.stream.Po(()=>{n(()=>this.listener.Po())}),this.stream.To(()=>{n(()=>(this.state=2,this.Jo=this.oi.enqueueAfterDelay(this.zo,1e4,()=>(this.Xo()&&(this.state=3),Promise.resolve())),this.listener.To()))}),this.stream.Ao(i=>{n(()=>this.c_(i))}),this.stream.onMessage(i=>{n(()=>this.onMessage(i))})}e_(){this.state=5,this.Yo.$o(()=>P(this,null,function*(){this.state=0,this.start()}))}c_(e){return M("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}a_(e){return t=>{this.oi.enqueueAndForget(()=>this.jo===e?t():(M("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}},cf=class extends kc{constructor(e,t,n,i,s,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,n,i,o),this.serializer=s}l_(e,t){return this.connection.Oo("Listen",e,t)}onMessage(e){this.Yo.reset();let t=oR(this.serializer,e),n=function(s){if(!("targetChange"in s))return K.min();let o=s.targetChange;return o.targetIds&&o.targetIds.length?K.min():o.readTime?be(o.readTime):K.min()}(e);return this.listener.h_(t,n)}P_(e){let t={};t.database=bd(this.serializer),t.addTarget=function(s,o){let c,u=o.target;if(c=lc(u)?{documents:Fw(s,u)}:{query:Uw(s,u)._t},c.targetId=o.targetId,o.resumeToken.approximateByteSize()>0){c.resumeToken=Nw(s,o.resumeToken);let l=Ad(s,o.expectedCount);l!==null&&(c.expectedCount=l)}else if(o.snapshotVersion.compareTo(K.min())>0){c.readTime=Ei(s,o.snapshotVersion.toTimestamp());let l=Ad(s,o.expectedCount);l!==null&&(c.expectedCount=l)}return c}(this.serializer,e);let n=cR(this.serializer,e);n&&(t.labels=n),this.i_(t)}I_(e){let t={};t.database=bd(this.serializer),t.removeTarget=e,this.i_(t)}},uf=class extends kc{constructor(e,t,n,i,s,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,n,i,o),this.serializer=s,this.T_=!1}get E_(){return this.T_}start(){this.T_=!1,this.lastStreamToken=void 0,super.start()}__(){this.T_&&this.d_([])}l_(e,t){return this.connection.Oo("Write",e,t)}onMessage(e){if(q(!!e.streamToken),this.lastStreamToken=e.streamToken,this.T_){this.Yo.reset();let t=aR(e.writeResults,e.commitTime),n=be(e.commitTime);return this.listener.A_(n,t)}return q(!e.writeResults||e.writeResults.length===0),this.T_=!0,this.listener.R_()}V_(){let e={};e.database=bd(this.serializer),this.i_(e)}d_(e){let t={streamToken:this.lastStreamToken,writes:e.map(n=>wo(this.serializer,n))};this.i_(t)}};var lf=class extends class{}{constructor(e,t,n,i){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=n,this.serializer=i,this.m_=!1}f_(){if(this.m_)throw new k(C.FAILED_PRECONDITION,"The client has already been terminated.")}Co(e,t,n,i){return this.f_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,o])=>this.connection.Co(e,Sd(t,n),i,s,o)).catch(s=>{throw s.name==="FirebaseError"?(s.code===C.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new k(C.UNKNOWN,s.toString())})}xo(e,t,n,i,s){return this.f_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,c])=>this.connection.xo(e,Sd(t,n),i,o,c,s)).catch(o=>{throw o.name==="FirebaseError"?(o.code===C.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new k(C.UNKNOWN,o.toString())})}terminate(){this.m_=!0,this.connection.terminate()}},hf=class{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.g_=0,this.p_=null,this.y_=!0}w_(){this.g_===0&&(this.S_("Unknown"),this.p_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.p_=null,this.b_("Backend didn't respond within 10 seconds."),this.S_("Offline"),Promise.resolve())))}D_(e){this.state==="Online"?this.S_("Unknown"):(this.g_++,this.g_>=1&&(this.C_(),this.b_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.S_("Offline")))}set(e){this.C_(),this.g_=0,e==="Online"&&(this.y_=!1),this.S_(e)}S_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}b_(e){let t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.y_?(Ae(t),this.y_=!1):M("OnlineStateTracker",t)}C_(){this.p_!==null&&(this.p_.cancel(),this.p_=null)}};var df=class{constructor(e,t,n,i,s){this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.v_=[],this.F_=new Map,this.M_=new Set,this.x_=[],this.O_=s,this.O_.io(o=>{n.enqueueAndForget(()=>P(this,null,function*(){Bn(this)&&(M("RemoteStore","Restarting streams for network reachability change."),yield function(u){return P(this,null,function*(){let l=F(u);l.M_.add(4),yield Mi(l),l.N_.set("Unknown"),l.M_.delete(4),yield Oo(l)})}(this))}))}),this.N_=new hf(n,i)}};function Oo(r){return P(this,null,function*(){if(Bn(r))for(let e of r.x_)yield e(!0)})}function Mi(r){return P(this,null,function*(){for(let e of r.x_)yield e(!1)})}function Jc(r,e){let t=F(r);t.F_.has(e.targetId)||(t.F_.set(e.targetId,e),sp(t)?ip(t):Vi(t).Xo()&&rp(t,e))}function bi(r,e){let t=F(r),n=Vi(t);t.F_.delete(e),n.Xo()&&sE(t,e),t.F_.size===0&&(n.Xo()?n.n_():Bn(t)&&t.N_.set("Unknown"))}function rp(r,e){if(r.L_.xe(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(K.min())>0){let t=r.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}Vi(r).P_(e)}function sE(r,e){r.L_.xe(e),Vi(r).I_(e)}function ip(r){r.L_=new Td({getRemoteKeysForTarget:e=>r.remoteSyncer.getRemoteKeysForTarget(e),ot:e=>r.F_.get(e)||null,tt:()=>r.datastore.serializer.databaseId}),Vi(r).start(),r.N_.w_()}function sp(r){return Bn(r)&&!Vi(r).Zo()&&r.F_.size>0}function Bn(r){return F(r).M_.size===0}function oE(r){r.L_=void 0}function IR(r){return P(this,null,function*(){r.N_.set("Online")})}function AR(r){return P(this,null,function*(){r.F_.forEach((e,t)=>{rp(r,e)})})}function SR(r,e){return P(this,null,function*(){oE(r),sp(r)?(r.N_.D_(e),ip(r)):r.N_.set("Unknown")})}function bR(r,e,t){return P(this,null,function*(){if(r.N_.set("Online"),e instanceof pc&&e.state===2&&e.cause)try{yield function(i,s){return P(this,null,function*(){let o=s.cause;for(let c of s.targetIds)i.F_.has(c)&&(yield i.remoteSyncer.rejectListen(c,o),i.F_.delete(c),i.L_.removeTarget(c))})}(r,e)}catch(n){M("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),n),yield Mc(r,n)}else if(e instanceof pi?r.L_.Ke(e):e instanceof fc?r.L_.He(e):r.L_.We(e),!t.isEqual(K.min()))try{let n=yield Zw(r.localStore);t.compareTo(n)>=0&&(yield function(s,o){let c=s.L_.rt(o);return c.targetChanges.forEach((u,l)=>{if(u.resumeToken.approximateByteSize()>0){let f=s.F_.get(l);f&&s.F_.set(l,f.withResumeToken(u.resumeToken,o))}}),c.targetMismatches.forEach((u,l)=>{let f=s.F_.get(u);if(!f)return;s.F_.set(u,f.withResumeToken(Fe.EMPTY_BYTE_STRING,f.snapshotVersion)),sE(s,u);let p=new Ti(f.target,u,l,f.sequenceNumber);rp(s,p)}),s.remoteSyncer.applyRemoteEvent(c)}(r,t))}catch(n){M("RemoteStore","Failed to raise snapshot:",n),yield Mc(r,n)}})}function Mc(r,e,t){return P(this,null,function*(){if(!zn(e))throw e;r.M_.add(1),yield Mi(r),r.N_.set("Offline"),t||(t=()=>Zw(r.localStore)),r.asyncQueue.enqueueRetryable(()=>P(this,null,function*(){M("RemoteStore","Retrying IndexedDB access"),yield t(),r.M_.delete(1),yield Oo(r)}))})}function aE(r,e){return e().catch(t=>Mc(r,t,e))}function Oi(r){return P(this,null,function*(){let e=F(r),t=jn(e),n=e.v_.length>0?e.v_[e.v_.length-1].batchId:-1;for(;RR(e);)try{let i=yield _R(e.localStore,n);if(i===null){e.v_.length===0&&t.n_();break}n=i.batchId,CR(e,i)}catch(i){yield Mc(e,i)}cE(e)&&uE(e)})}function RR(r){return Bn(r)&&r.v_.length<10}function CR(r,e){r.v_.push(e);let t=jn(r);t.Xo()&&t.E_&&t.d_(e.mutations)}function cE(r){return Bn(r)&&!jn(r).Zo()&&r.v_.length>0}function uE(r){jn(r).start()}function PR(r){return P(this,null,function*(){jn(r).V_()})}function DR(r){return P(this,null,function*(){let e=jn(r);for(let t of r.v_)e.d_(t.mutations)})}function xR(r,e,t){return P(this,null,function*(){let n=r.v_.shift(),i=_d.from(n,e,t);yield aE(r,()=>r.remoteSyncer.applySuccessfulWrite(i)),yield Oi(r)})}function NR(r,e){return P(this,null,function*(){e&&jn(r).E_&&(yield function(n,i){return P(this,null,function*(){if(function(o){return Pw(o)&&o!==C.ABORTED}(i.code)){let s=n.v_.shift();jn(n).t_(),yield aE(n,()=>n.remoteSyncer.rejectFailedWrite(s.batchId,i)),yield Oi(n)}})}(r,e)),cE(r)&&uE(r)})}function V_(r,e){return P(this,null,function*(){let t=F(r);t.asyncQueue.verifyOperationInProgress(),M("RemoteStore","RemoteStore received new credentials");let n=Bn(t);t.M_.add(3),yield Mi(t),n&&t.N_.set("Unknown"),yield t.remoteSyncer.handleCredentialChange(e),t.M_.delete(3),yield Oo(t)})}function ff(r,e){return P(this,null,function*(){let t=F(r);e?(t.M_.delete(2),yield Oo(t)):e||(t.M_.add(2),yield Mi(t),t.N_.set("Unknown"))})}function Vi(r){return r.B_||(r.B_=function(t,n,i){let s=F(t);return s.f_(),new cf(n,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(r.datastore,r.asyncQueue,{Po:IR.bind(null,r),To:AR.bind(null,r),Ao:SR.bind(null,r),h_:bR.bind(null,r)}),r.x_.push(e=>P(this,null,function*(){e?(r.B_.t_(),sp(r)?ip(r):r.N_.set("Unknown")):(yield r.B_.stop(),oE(r))}))),r.B_}function jn(r){return r.k_||(r.k_=function(t,n,i){let s=F(t);return s.f_(),new uf(n,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(r.datastore,r.asyncQueue,{Po:()=>Promise.resolve(),To:PR.bind(null,r),Ao:NR.bind(null,r),R_:DR.bind(null,r),A_:xR.bind(null,r)}),r.x_.push(e=>P(this,null,function*(){e?(r.k_.t_(),yield Oi(r)):(yield r.k_.stop(),r.v_.length>0&&(M("RemoteStore",`Stopping write stream with ${r.v_.length} pending writes`),r.v_=[]))}))),r.k_}var pf=class r{constructor(e,t,n,i,s){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=i,this.removalCallback=s,this.deferred=new Ne,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,n,i,s){let o=Date.now()+n,c=new r(e,t,o,i,s);return c.start(n),c}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new k(C.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}};function Li(r,e){if(Ae("AsyncQueue",`${e}: ${r}`),zn(r))return new k(C.UNAVAILABLE,`${e}: ${r}`);throw r}var Oc=class r{constructor(e){this.comparator=e?(t,n)=>e(t,n)||L.comparator(t.key,n.key):(t,n)=>L.comparator(t.key,n.key),this.keyedMap=eo(),this.sortedSet=new pe(this.comparator)}static emptySet(e){return new r(e.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){let t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,n)=>(e(t),!1))}add(e){let t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){let t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof r)||this.size!==e.size)return!1;let t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){let i=t.getNext().key,s=n.getNext().key;if(!i.isEqual(s))return!1}return!0}toString(){let e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){let n=new r;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}};var Vc=class{constructor(){this.q_=new pe(L.comparator)}track(e){let t=e.doc.key,n=this.q_.get(t);n?e.type!==0&&n.type===3?this.q_=this.q_.insert(t,e):e.type===3&&n.type!==1?this.q_=this.q_.insert(t,{type:n.type,doc:e.doc}):e.type===2&&n.type===2?this.q_=this.q_.insert(t,{type:2,doc:e.doc}):e.type===2&&n.type===0?this.q_=this.q_.insert(t,{type:0,doc:e.doc}):e.type===1&&n.type===0?this.q_=this.q_.remove(t):e.type===1&&n.type===2?this.q_=this.q_.insert(t,{type:1,doc:n.doc}):e.type===0&&n.type===1?this.q_=this.q_.insert(t,{type:2,doc:e.doc}):U():this.q_=this.q_.insert(t,e)}Q_(){let e=[];return this.q_.inorderTraversal((t,n)=>{e.push(n)}),e}},Ri=class r{constructor(e,t,n,i,s,o,c,u,l){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=i,this.mutatedKeys=s,this.fromCache=o,this.syncStateChanged=c,this.excludesMetadataChanges=u,this.hasCachedResults=l}static fromInitialDocuments(e,t,n,i,s){let o=[];return t.forEach(c=>{o.push({type:0,doc:c})}),new r(e,t,Oc.emptySet(t),o,n,i,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&No(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;let t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let i=0;i<t.length;i++)if(t[i].type!==n[i].type||!t[i].doc.isEqual(n[i].doc))return!1;return!0}};var gf=class{constructor(){this.K_=void 0,this.U_=[]}W_(){return this.U_.some(e=>e.G_())}},mf=class{constructor(){this.queries=new $t(e=>pw(e),No),this.onlineState="Unknown",this.z_=new Set}};function op(r,e){return P(this,null,function*(){let t=F(r),n=3,i=e.query,s=t.queries.get(i);s?!s.W_()&&e.G_()&&(n=2):(s=new gf,n=e.G_()?0:1);try{switch(n){case 0:s.K_=yield t.onListen(i,!0);break;case 1:s.K_=yield t.onListen(i,!1);break;case 2:yield t.onFirstRemoteStoreListen(i)}}catch(o){let c=Li(o,`Initialization of query '${ai(e.query)}' failed`);return void e.onError(c)}t.queries.set(i,s),s.U_.push(e),e.j_(t.onlineState),s.K_&&e.H_(s.K_)&&cp(t)})}function ap(r,e){return P(this,null,function*(){let t=F(r),n=e.query,i=3,s=t.queries.get(n);if(s){let o=s.U_.indexOf(e);o>=0&&(s.U_.splice(o,1),s.U_.length===0?i=e.G_()?0:1:!s.W_()&&e.G_()&&(i=2))}switch(i){case 0:return t.queries.delete(n),t.onUnlisten(n,!0);case 1:return t.queries.delete(n),t.onUnlisten(n,!1);case 2:return t.onLastRemoteStoreUnlisten(n);default:return}})}function kR(r,e){let t=F(r),n=!1;for(let i of e){let s=i.query,o=t.queries.get(s);if(o){for(let c of o.U_)c.H_(i)&&(n=!0);o.K_=i}}n&&cp(t)}function MR(r,e,t){let n=F(r),i=n.queries.get(e);if(i)for(let s of i.U_)s.onError(t);n.queries.delete(e)}function cp(r){r.z_.forEach(e=>{e.next()})}var yf,L_;(L_=yf||(yf={})).J_="default",L_.Cache="cache";var So=class{constructor(e,t,n){this.query=e,this.Y_=t,this.Z_=!1,this.X_=null,this.onlineState="Unknown",this.options=n||{}}H_(e){if(!this.options.includeMetadataChanges){let n=[];for(let i of e.docChanges)i.type!==3&&n.push(i);e=new Ri(e.query,e.docs,e.oldDocs,n,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Z_?this.ea(e)&&(this.Y_.next(e),t=!0):this.ta(e,this.onlineState)&&(this.na(e),t=!0),this.X_=e,t}onError(e){this.Y_.error(e)}j_(e){this.onlineState=e;let t=!1;return this.X_&&!this.Z_&&this.ta(this.X_,e)&&(this.na(this.X_),t=!0),t}ta(e,t){if(!e.fromCache||!this.G_())return!0;let n=t!=="Offline";return(!this.options.ra||!n)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}ea(e){if(e.docChanges.length>0)return!0;let t=this.X_&&this.X_.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}na(e){e=Ri.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Z_=!0,this.Y_.next(e)}G_(){return this.options.source!==yf.Cache}};var vf=class{constructor(e,t){this.ia=e,this.byteLength=t}sa(){return"metadata"in this.ia}};var Lc=class{constructor(e){this.serializer=e}Ps(e){return Lt(this.serializer,e)}Is(e){return e.metadata.exists?Lw(this.serializer,e.document,!1):ke.newNoDocument(this.Ps(e.metadata.name),this.Ts(e.metadata.readTime))}Ts(e){return be(e)}},_f=class{constructor(e,t,n){this.oa=e,this.localStore=t,this.serializer=n,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=lE(e)}_a(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.ia.namedQuery)this.queries.push(e.ia.namedQuery);else if(e.ia.documentMetadata){this.documents.push({metadata:e.ia.documentMetadata}),e.ia.documentMetadata.exists||++t;let n=re.fromString(e.ia.documentMetadata.name);this.collectionGroups.add(n.get(n.length-2))}else e.ia.document&&(this.documents[this.documents.length-1].document=e.ia.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}aa(e){let t=new Map,n=new Lc(this.serializer);for(let i of e)if(i.metadata.queries){let s=n.Ps(i.metadata.name);for(let o of i.metadata.queries){let c=(t.get(o)||Z()).add(s);t.set(o,c)}}return t}complete(){return P(this,null,function*(){let e=yield wR(this.localStore,new Lc(this.serializer),this.documents,this.oa.id),t=this.aa(this.documents);for(let n of this.queries)yield ER(this.localStore,n,t.get(n.name));return this.progress.taskState="Success",{progress:this.progress,ua:this.collectionGroups,ca:e}})}};function lE(r){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:r.totalDocuments,totalBytes:r.totalBytes}}var Fc=class{constructor(e){this.key=e}},Uc=class{constructor(e){this.key=e}},jc=class{constructor(e,t){this.query=e,this.la=t,this.ha=null,this.hasCachedResults=!1,this.current=!1,this.Pa=Z(),this.mutatedKeys=Z(),this.Ia=mw(e),this.Ta=new Oc(this.Ia)}get Ea(){return this.la}da(e,t){let n=t?t.Aa:new Vc,i=t?t.Ta:this.Ta,s=t?t.mutatedKeys:this.mutatedKeys,o=i,c=!1,u=this.query.limitType==="F"&&i.size===this.query.limit?i.last():null,l=this.query.limitType==="L"&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal((f,p)=>{let m=i.get(f),T=ko(this.query,p)?p:null,x=!!m&&this.mutatedKeys.has(m.key),N=!!T&&(T.hasLocalMutations||this.mutatedKeys.has(T.key)&&T.hasCommittedMutations),D=!1;m&&T?m.data.isEqual(T.data)?x!==N&&(n.track({type:3,doc:T}),D=!0):this.Ra(m,T)||(n.track({type:2,doc:T}),D=!0,(u&&this.Ia(T,u)>0||l&&this.Ia(T,l)<0)&&(c=!0)):!m&&T?(n.track({type:0,doc:T}),D=!0):m&&!T&&(n.track({type:1,doc:m}),D=!0,(u||l)&&(c=!0)),D&&(T?(o=o.add(T),s=N?s.add(f):s.delete(f)):(o=o.delete(f),s=s.delete(f)))}),this.query.limit!==null)for(;o.size>this.query.limit;){let f=this.query.limitType==="F"?o.last():o.first();o=o.delete(f.key),s=s.delete(f.key),n.track({type:1,doc:f})}return{Ta:o,Aa:n,Xi:c,mutatedKeys:s}}Ra(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n,i){let s=this.Ta;this.Ta=e.Ta,this.mutatedKeys=e.mutatedKeys;let o=e.Aa.Q_();o.sort((f,p)=>function(T,x){let N=D=>{switch(D){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return U()}};return N(T)-N(x)}(f.type,p.type)||this.Ia(f.doc,p.doc)),this.Va(n),i=i!=null&&i;let c=t&&!i?this.ma():[],u=this.Pa.size===0&&this.current&&!i?1:0,l=u!==this.ha;return this.ha=u,o.length!==0||l?{snapshot:new Ri(this.query,e.Ta,s,o,e.mutatedKeys,u===0,l,!1,!!n&&n.resumeToken.approximateByteSize()>0),fa:c}:{fa:c}}j_(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({Ta:this.Ta,Aa:new Vc,mutatedKeys:this.mutatedKeys,Xi:!1},!1)):{fa:[]}}ga(e){return!this.la.has(e)&&!!this.Ta.has(e)&&!this.Ta.get(e).hasLocalMutations}Va(e){e&&(e.addedDocuments.forEach(t=>this.la=this.la.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.la=this.la.delete(t)),this.current=e.current)}ma(){if(!this.current)return[];let e=this.Pa;this.Pa=Z(),this.Ta.forEach(n=>{this.ga(n.key)&&(this.Pa=this.Pa.add(n.key))});let t=[];return e.forEach(n=>{this.Pa.has(n)||t.push(new Uc(n))}),this.Pa.forEach(n=>{e.has(n)||t.push(new Fc(n))}),t}pa(e){this.la=e.hs,this.Pa=Z();let t=this.da(e.documents);return this.applyChanges(t,!0)}ya(){return Ri.fromInitialDocuments(this.query,this.Ta,this.mutatedKeys,this.ha===0,this.hasCachedResults)}},wf=class{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}},Ef=class{constructor(e){this.key=e,this.wa=!1}},Tf=class{constructor(e,t,n,i,s,o){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=i,this.currentUser=s,this.maxConcurrentLimboResolutions=o,this.Sa={},this.ba=new $t(c=>pw(c),No),this.Da=new Map,this.Ca=new Set,this.va=new pe(L.comparator),this.Fa=new Map,this.Ma=new To,this.xa={},this.Oa=new Map,this.Na=Ii.Ln(),this.onlineState="Unknown",this.La=void 0}get isPrimaryClient(){return this.La===!0}};function OR(r,e,t=!0){return P(this,null,function*(){let n=Zc(r),i,s=n.ba.get(e);return s?(n.sharedClientState.addLocalQueryTarget(s.targetId),i=s.view.ya()):i=yield hE(n,e,t,!0),i})}function VR(r,e){return P(this,null,function*(){let t=Zc(r);yield hE(t,e,!0,!1)})}function hE(r,e,t,n){return P(this,null,function*(){let i=yield Ai(r.localStore,Ze(e)),s=i.targetId,o=t?r.sharedClientState.addLocalQueryTarget(s):"not-current",c;return n&&(c=yield up(r,e,s,o==="current",i.resumeToken)),r.isPrimaryClient&&t&&Jc(r.remoteStore,i),c})}function up(r,e,t,n,i){return P(this,null,function*(){r.Ba=(p,m,T)=>function(N,D,j,G){return P(this,null,function*(){let V=D.view.da(j);V.Xi&&(V=yield Cc(N.localStore,D.query,!1).then(({documents:w})=>D.view.da(w,V)));let H=G&&G.targetChanges.get(D.targetId),Q=G&&G.targetMismatches.get(D.targetId)!=null,Y=D.view.applyChanges(V,N.isPrimaryClient,H,Q);return If(N,D.targetId,Y.fa),Y.snapshot})}(r,p,m,T);let s=yield Cc(r.localStore,e,!0),o=new jc(e,s.hs),c=o.da(s.documents),u=vo.createSynthesizedTargetChangeForCurrentChange(t,n&&r.onlineState!=="Offline",i),l=o.applyChanges(c,r.isPrimaryClient,u);If(r,t,l.fa);let f=new wf(e,t,o);return r.ba.set(e,f),r.Da.has(t)?r.Da.get(t).push(e):r.Da.set(t,[e]),l.snapshot})}function LR(r,e,t){return P(this,null,function*(){let n=F(r),i=n.ba.get(e),s=n.Da.get(i.targetId);if(s.length>1)return n.Da.set(i.targetId,s.filter(o=>!No(o,e))),void n.ba.delete(e);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(i.targetId),n.sharedClientState.isActiveQueryTarget(i.targetId)||(yield Si(n.localStore,i.targetId,!1).then(()=>{n.sharedClientState.clearQueryState(i.targetId),t&&bi(n.remoteStore,i.targetId),Ci(n,i.targetId)}).catch($n))):(Ci(n,i.targetId),yield Si(n.localStore,i.targetId,!0))})}function FR(r,e){return P(this,null,function*(){let t=F(r),n=t.ba.get(e),i=t.Da.get(n.targetId);t.isPrimaryClient&&i.length===1&&(t.sharedClientState.removeLocalQueryTarget(n.targetId),bi(t.remoteStore,n.targetId))})}function UR(r,e,t){return P(this,null,function*(){let n=fp(r);try{let i=yield function(o,c){let u=F(o),l=_e.now(),f=c.reduce((T,x)=>T.add(x.key),Z()),p,m;return u.persistence.runTransaction("Locally write mutations","readwrite",T=>{let x=tt(),N=Z();return u.os.getEntries(T,f).next(D=>{x=D,x.forEach((j,G)=>{G.isValidDocument()||(N=N.add(j))})}).next(()=>u.localDocuments.getOverlayedDocuments(T,x)).next(D=>{p=D;let j=[];for(let G of c){let V=Zb(G,p.get(G.key).overlayedDocument);V!=null&&j.push(new It(G.key,V,aw(V.value.mapValue),Te.exists(!0)))}return u.mutationQueue.addMutationBatch(T,l,j,c)}).next(D=>{m=D;let j=D.applyToLocalDocumentSet(p,N);return u.documentOverlayCache.saveOverlays(T,D.batchId,j)})}).then(()=>({batchId:m.batchId,changes:vw(p)}))}(n.localStore,e);n.sharedClientState.addPendingMutation(i.batchId),function(o,c,u){let l=o.xa[o.currentUser.toKey()];l||(l=new pe(J)),l=l.insert(c,u),o.xa[o.currentUser.toKey()]=l}(n,i.batchId,t),yield dn(n,i.changes),yield Oi(n.remoteStore)}catch(i){let s=Li(i,"Failed to persist write");t.reject(s)}})}function dE(r,e){return P(this,null,function*(){let t=F(r);try{let n=yield vR(t.localStore,e);e.targetChanges.forEach((i,s)=>{let o=t.Fa.get(s);o&&(q(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1),i.addedDocuments.size>0?o.wa=!0:i.modifiedDocuments.size>0?q(o.wa):i.removedDocuments.size>0&&(q(o.wa),o.wa=!1))}),yield dn(t,n,e)}catch(n){yield $n(n)}})}function F_(r,e,t){let n=F(r);if(n.isPrimaryClient&&t===0||!n.isPrimaryClient&&t===1){let i=[];n.ba.forEach((s,o)=>{let c=o.view.j_(e);c.snapshot&&i.push(c.snapshot)}),function(o,c){let u=F(o);u.onlineState=c;let l=!1;u.queries.forEach((f,p)=>{for(let m of p.U_)m.j_(c)&&(l=!0)}),l&&cp(u)}(n.eventManager,e),i.length&&n.Sa.h_(i),n.onlineState=e,n.isPrimaryClient&&n.sharedClientState.setOnlineState(e)}}function jR(r,e,t){return P(this,null,function*(){let n=F(r);n.sharedClientState.updateQueryState(e,"rejected",t);let i=n.Fa.get(e),s=i&&i.key;if(s){let o=new pe(L.comparator);o=o.insert(s,ke.newNoDocument(s,K.min()));let c=Z().add(s),u=new yo(K.min(),new Map,new pe(J),o,c);yield dE(n,u),n.va=n.va.remove(s),n.Fa.delete(e),dp(n)}else yield Si(n.localStore,e,!1).then(()=>Ci(n,e,t)).catch($n)})}function $R(r,e){return P(this,null,function*(){let t=F(r),n=e.batch.batchId;try{let i=yield yR(t.localStore,e);hp(t,n,null),lp(t,n),t.sharedClientState.updateMutationState(n,"acknowledged"),yield dn(t,i)}catch(i){yield $n(i)}})}function zR(r,e,t){return P(this,null,function*(){let n=F(r);try{let i=yield function(o,c){let u=F(o);return u.persistence.runTransaction("Reject batch","readwrite-primary",l=>{let f;return u.mutationQueue.lookupMutationBatch(l,c).next(p=>(q(p!==null),f=p.keys(),u.mutationQueue.removeMutationBatch(l,p))).next(()=>u.mutationQueue.performConsistencyCheck(l)).next(()=>u.documentOverlayCache.removeOverlaysForBatchId(l,f,c)).next(()=>u.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(l,f)).next(()=>u.localDocuments.getDocuments(l,f))})}(n.localStore,e);hp(n,e,t),lp(n,e),n.sharedClientState.updateMutationState(e,"rejected",t),yield dn(n,i)}catch(i){yield $n(i)}})}function BR(r,e){return P(this,null,function*(){let t=F(r);Bn(t.remoteStore)||M("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{let n=yield function(o){let c=F(o);return c.persistence.runTransaction("Get highest unacknowledged batch id","readonly",u=>c.mutationQueue.getHighestUnacknowledgedBatchId(u))}(t.localStore);if(n===-1)return void e.resolve();let i=t.Oa.get(n)||[];i.push(e),t.Oa.set(n,i)}catch(n){let i=Li(n,"Initialization of waitForPendingWrites() operation failed");e.reject(i)}})}function lp(r,e){(r.Oa.get(e)||[]).forEach(t=>{t.resolve()}),r.Oa.delete(e)}function hp(r,e,t){let n=F(r),i=n.xa[n.currentUser.toKey()];if(i){let s=i.get(e);s&&(t?s.reject(t):s.resolve(),i=i.remove(e)),n.xa[n.currentUser.toKey()]=i}}function Ci(r,e,t=null){r.sharedClientState.removeLocalQueryTarget(e);for(let n of r.Da.get(e))r.ba.delete(n),t&&r.Sa.ka(n,t);r.Da.delete(e),r.isPrimaryClient&&r.Ma.Vr(e).forEach(n=>{r.Ma.containsKey(n)||fE(r,n)})}function fE(r,e){r.Ca.delete(e.path.canonicalString());let t=r.va.get(e);t!==null&&(bi(r.remoteStore,t),r.va=r.va.remove(e),r.Fa.delete(t),dp(r))}function If(r,e,t){for(let n of t)n instanceof Fc?(r.Ma.addReference(n.key,e),qR(r,n)):n instanceof Uc?(M("SyncEngine","Document no longer in limbo: "+n.key),r.Ma.removeReference(n.key,e),r.Ma.containsKey(n.key)||fE(r,n.key)):U()}function qR(r,e){let t=e.key,n=t.path.canonicalString();r.va.get(t)||r.Ca.has(n)||(M("SyncEngine","New document in limbo: "+t),r.Ca.add(n),dp(r))}function dp(r){for(;r.Ca.size>0&&r.va.size<r.maxConcurrentLimboResolutions;){let e=r.Ca.values().next().value;r.Ca.delete(e);let t=new L(re.fromString(e)),n=r.Na.next();r.Fa.set(n,new Ef(t)),r.va=r.va.insert(t,n),Jc(r.remoteStore,new Ti(Ze(ki(t.path)),n,"TargetPurposeLimboResolution",ct.oe))}}function dn(r,e,t){return P(this,null,function*(){let n=F(r),i=[],s=[],o=[];n.ba.isEmpty()||(n.ba.forEach((c,u)=>{o.push(n.Ba(u,e,t).then(l=>{var f;if((l||t)&&n.isPrimaryClient){let p=l?!l.fromCache:(f=t?.targetChanges.get(u.targetId))===null||f===void 0?void 0:f.current;n.sharedClientState.updateQueryState(u.targetId,p?"current":"not-current")}if(l){i.push(l);let p=ef.Ki(u.targetId,l);s.push(p)}}))}),yield Promise.all(o),n.Sa.h_(i),yield function(u,l){return P(this,null,function*(){let f=F(u);try{yield f.persistence.runTransaction("notifyLocalViewChanges","readwrite",p=>b.forEach(l,m=>b.forEach(m.qi,T=>f.persistence.referenceDelegate.addReference(p,m.targetId,T)).next(()=>b.forEach(m.Qi,T=>f.persistence.referenceDelegate.removeReference(p,m.targetId,T)))))}catch(p){if(!zn(p))throw p;M("LocalStore","Failed to update sequence numbers: "+p)}for(let p of l){let m=p.targetId;if(!p.fromCache){let T=f.ns.get(m),x=T.snapshotVersion,N=T.withLastLimboFreeSnapshotVersion(x);f.ns=f.ns.insert(m,N)}}})}(n.localStore,s))})}function GR(r,e){return P(this,null,function*(){let t=F(r);if(!t.currentUser.isEqual(e)){M("SyncEngine","User change. New user:",e.toKey());let n=yield Jw(t.localStore,e);t.currentUser=e,function(s,o){s.Oa.forEach(c=>{c.forEach(u=>{u.reject(new k(C.CANCELLED,o))})}),s.Oa.clear()}(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,n.removedBatchIds,n.addedBatchIds),yield dn(t,n.us)}})}function KR(r,e){let t=F(r),n=t.Fa.get(e);if(n&&n.wa)return Z().add(n.key);{let i=Z(),s=t.Da.get(e);if(!s)return i;for(let o of s){let c=t.ba.get(o);i=i.unionWith(c.view.Ea)}return i}}function WR(r,e){return P(this,null,function*(){let t=F(r),n=yield Cc(t.localStore,e.query,!0),i=e.view.pa(n);return t.isPrimaryClient&&If(t,e.targetId,i.fa),i})}function HR(r,e){return P(this,null,function*(){let t=F(r);return nE(t.localStore,e).then(n=>dn(t,n))})}function QR(r,e,t,n){return P(this,null,function*(){let i=F(r),s=yield function(c,u){let l=F(c),f=F(l.mutationQueue);return l.persistence.runTransaction("Lookup mutation documents","readonly",p=>f.vn(p,u).next(m=>m?l.localDocuments.getDocuments(p,m):b.resolve(null)))}(i.localStore,e);s!==null?(t==="pending"?yield Oi(i.remoteStore):t==="acknowledged"||t==="rejected"?(hp(i,e,n||null),lp(i,e),function(c,u){F(F(c).mutationQueue).Mn(u)}(i.localStore,e)):U(),yield dn(i,s)):M("SyncEngine","Cannot apply mutation batch with id: "+e)})}function YR(r,e){return P(this,null,function*(){let t=F(r);if(Zc(t),fp(t),e===!0&&t.La!==!0){let n=t.sharedClientState.getAllActiveQueryTargets(),i=yield U_(t,n.toArray());t.La=!0,yield ff(t.remoteStore,!0);for(let s of i)Jc(t.remoteStore,s)}else if(e===!1&&t.La!==!1){let n=[],i=Promise.resolve();t.Da.forEach((s,o)=>{t.sharedClientState.isLocalQueryTarget(o)?n.push(o):i=i.then(()=>(Ci(t,o),Si(t.localStore,o,!0))),bi(t.remoteStore,o)}),yield i,yield U_(t,n),function(o){let c=F(o);c.Fa.forEach((u,l)=>{bi(c.remoteStore,l)}),c.Ma.mr(),c.Fa=new Map,c.va=new pe(L.comparator)}(t),t.La=!1,yield ff(t.remoteStore,!1)}})}function U_(r,e,t){return P(this,null,function*(){let n=F(r),i=[],s=[];for(let o of e){let c,u=n.Da.get(o);if(u&&u.length!==0){c=yield Ai(n.localStore,Ze(u[0]));for(let l of u){let f=n.ba.get(l),p=yield WR(n,f);p.snapshot&&s.push(p.snapshot)}}else{let l=yield tE(n.localStore,o);c=yield Ai(n.localStore,l),yield up(n,pE(l),o,!1,c.resumeToken)}i.push(c)}return n.Sa.h_(s),i})}function pE(r){return fw(r.path,r.collectionGroup,r.orderBy,r.filters,r.limit,"F",r.startAt,r.endAt)}function XR(r){return function(t){return F(F(t).persistence).Bi()}(F(r).localStore)}function JR(r,e,t,n){return P(this,null,function*(){let i=F(r);if(i.La)return void M("SyncEngine","Ignoring unexpected query state notification.");let s=i.Da.get(e);if(s&&s.length>0)switch(t){case"current":case"not-current":{let o=yield nE(i.localStore,gw(s[0])),c=yo.createSynthesizedRemoteEventForCurrentChange(e,t==="current",Fe.EMPTY_BYTE_STRING);yield dn(i,o,c);break}case"rejected":yield Si(i.localStore,e,!0),Ci(i,e,n);break;default:U()}})}function ZR(r,e,t){return P(this,null,function*(){let n=Zc(r);if(n.La){for(let i of e){if(n.Da.has(i)&&n.sharedClientState.isActiveQueryTarget(i)){M("SyncEngine","Adding an already active target "+i);continue}let s=yield tE(n.localStore,i),o=yield Ai(n.localStore,s);yield up(n,pE(s),o.targetId,!1,o.resumeToken),Jc(n.remoteStore,o)}for(let i of t)n.Da.has(i)&&(yield Si(n.localStore,i,!1).then(()=>{bi(n.remoteStore,i),Ci(n,i)}).catch($n))}})}function Zc(r){let e=F(r);return e.remoteStore.remoteSyncer.applyRemoteEvent=dE.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=KR.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=jR.bind(null,e),e.Sa.h_=kR.bind(null,e.eventManager),e.Sa.ka=MR.bind(null,e.eventManager),e}function fp(r){let e=F(r);return e.remoteStore.remoteSyncer.applySuccessfulWrite=$R.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=zR.bind(null,e),e}function e0(r,e,t){let n=F(r);(function(s,o,c){return P(this,null,function*(){try{let u=yield o.getMetadata();if(yield function(T,x){let N=F(T),D=be(x.createTime);return N.persistence.runTransaction("hasNewerBundle","readonly",j=>N.$r.getBundleMetadata(j,x.id)).then(j=>!!j&&j.createTime.compareTo(D)>=0)}(s.localStore,u))return yield o.close(),c._completeWith(function(T){return{taskState:"Success",documentsLoaded:T.totalDocuments,bytesLoaded:T.totalBytes,totalDocuments:T.totalDocuments,totalBytes:T.totalBytes}}(u)),Promise.resolve(new Set);c._updateProgress(lE(u));let l=new _f(u,s.localStore,o.serializer),f=yield o.qa();for(;f;){let m=yield l._a(f);m&&c._updateProgress(m),f=yield o.qa()}let p=yield l.complete();return yield dn(s,p.ca,void 0),yield function(T,x){let N=F(T);return N.persistence.runTransaction("Save bundle","readwrite",D=>N.$r.saveBundleMetadata(D,x))}(s.localStore,u),c._completeWith(p.progress),Promise.resolve(p.ua)}catch(u){return gt("SyncEngine",`Loading bundle failed with ${u}`),c._failWith(u),Promise.resolve(new Set)}})})(n,e,t).then(i=>{n.sharedClientState.notifyBundleLoaded(i)})}var bo=class{constructor(){this.synchronizeTabs=!1}initialize(e){return P(this,null,function*(){this.serializer=Mo(e.databaseInfo.databaseId),this.sharedClientState=this.createSharedClientState(e),this.persistence=this.createPersistence(e),yield this.persistence.start(),this.localStore=this.createLocalStore(e),this.gcScheduler=this.createGarbageCollectionScheduler(e,this.localStore),this.indexBackfillerScheduler=this.createIndexBackfillerScheduler(e,this.localStore)})}createGarbageCollectionScheduler(e,t){return null}createIndexBackfillerScheduler(e,t){return null}createLocalStore(e){return Xw(this.persistence,new Rc,e.initialUser,this.serializer)}createPersistence(e){return new Sc(bc.Hr,this.serializer)}createSharedClientState(e){return new xc}terminate(){return P(this,null,function*(){var e,t;(e=this.gcScheduler)===null||e===void 0||e.stop(),(t=this.indexBackfillerScheduler)===null||t===void 0||t.stop(),this.sharedClientState.shutdown(),yield this.persistence.shutdown()})}};var $c=class r extends bo{constructor(e,t,n){super(),this.Qa=e,this.cacheSizeBytes=t,this.forceOwnership=n,this.synchronizeTabs=!1}initialize(e){return P(this,null,function*(){yield Wu(r.prototype,this,"initialize").call(this,e),yield this.Qa.initialize(this,e),yield fp(this.Qa.syncEngine),yield Oi(this.Qa.remoteStore),yield this.persistence.fi(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))})}createLocalStore(e){return Xw(this.persistence,new Rc,e.initialUser,this.serializer)}createGarbageCollectionScheduler(e,t){let n=this.persistence.referenceDelegate.garbageCollector;return new Ud(n,e.asyncQueue,t)}createIndexBackfillerScheduler(e,t){let n=new rd(t,this.persistence);return new nd(e.asyncQueue,n)}createPersistence(e){let t=np(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),n=this.cacheSizeBytes!==void 0?pt.withCacheSize(this.cacheSizeBytes):pt.DEFAULT;return new Zd(this.synchronizeTabs,t,e.clientId,n,e.asyncQueue,iE(),Za(),this.serializer,this.sharedClientState,!!this.forceOwnership)}createSharedClientState(e){return new xc}},Af=class r extends $c{constructor(e,t){super(e,t,!1),this.Qa=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}initialize(e){return P(this,null,function*(){yield Wu(r.prototype,this,"initialize").call(this,e);let t=this.Qa.syncEngine;this.sharedClientState instanceof oo&&(this.sharedClientState.syncEngine={Zs:QR.bind(null,t),Xs:JR.bind(null,t),eo:ZR.bind(null,t),Bi:XR.bind(null,t),Ys:HR.bind(null,t)},yield this.sharedClientState.start()),yield this.persistence.fi(n=>P(this,null,function*(){yield YR(this.Qa.syncEngine,n),this.gcScheduler&&(n&&!this.gcScheduler.started?this.gcScheduler.start():n||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(n&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():n||this.indexBackfillerScheduler.stop())}))})}createSharedClientState(e){let t=iE();if(!oo.D(t))throw new k(C.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");let n=np(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new oo(t,e.asyncQueue,n,e.clientId,e.initialUser)}},Ro=class{initialize(e,t){return P(this,null,function*(){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=n=>F_(this.syncEngine,n,1),this.remoteStore.remoteSyncer.handleCredentialChange=GR.bind(null,this.syncEngine),yield ff(this.remoteStore,this.syncEngine.isPrimaryClient))})}createEventManager(e){return function(){return new mf}()}createDatastore(e){let t=Mo(e.databaseInfo.databaseId),n=function(s){return new af(s)}(e.databaseInfo);return function(s,o,c,u){return new lf(s,o,c,u)}(e.authCredentials,e.appCheckCredentials,n,t)}createRemoteStore(e){return function(n,i,s,o,c){return new df(n,i,s,o,c)}(this.localStore,this.datastore,e.asyncQueue,t=>F_(this.syncEngine,t,0),function(){return Nc.D()?new Nc:new sf}())}createSyncEngine(e,t){return function(i,s,o,c,u,l,f){let p=new Tf(i,s,o,c,u,l);return f&&(p.La=!0),p}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}terminate(){return P(this,null,function*(){var e;yield function(n){return P(this,null,function*(){let i=F(n);M("RemoteStore","RemoteStore shutting down."),i.M_.add(5),yield Mi(i),i.O_.shutdown(),i.N_.set("Unknown")})}(this.remoteStore),(e=this.datastore)===null||e===void 0||e.terminate()})}};function j_(r,e=10240){let t=0;return{read(){return P(this,null,function*(){if(t<r.byteLength){let i={value:r.slice(t,t+e),done:!1};return t+=e,i}return{done:!0}})},cancel(){return P(this,null,function*(){})},releaseLock(){},closed:Promise.resolve()}}var Pi=class{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.Ka(this.observer.next,e)}error(e){this.observer.error?this.Ka(this.observer.error,e):Ae("Uncaught Error in snapshot listener:",e.toString())}$a(){this.muted=!0}Ka(e,t){this.muted||setTimeout(()=>{this.muted||e(t)},0)}};var Sf=class{constructor(e,t){this.Ua=e,this.serializer=t,this.metadata=new Ne,this.buffer=new Uint8Array,this.Wa=function(){return new TextDecoder("utf-8")}(),this.Ga().then(n=>{n&&n.sa()?this.metadata.resolve(n.ia.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is
             ${JSON.stringify(n?.ia)}`))},n=>this.metadata.reject(n))}close(){return this.Ua.cancel()}getMetadata(){return P(this,null,function*(){return this.metadata.promise})}qa(){return P(this,null,function*(){return yield this.getMetadata(),this.Ga()})}Ga(){return P(this,null,function*(){let e=yield this.za();if(e===null)return null;let t=this.Wa.decode(e),n=Number(t);isNaN(n)&&this.ja(`length string (${t}) is not valid number`);let i=yield this.Ha(n);return new vf(JSON.parse(i),e.length+n)})}Ja(){return this.buffer.findIndex(e=>e===123)}za(){return P(this,null,function*(){for(;this.Ja()<0&&!(yield this.Ya()););if(this.buffer.length===0)return null;let e=this.Ja();e<0&&this.ja("Reached the end of bundle when a length string is expected.");let t=this.buffer.slice(0,e);return this.buffer=this.buffer.slice(e),t})}Ha(e){return P(this,null,function*(){for(;this.buffer.length<e;)(yield this.Ya())&&this.ja("Reached the end of bundle when more is expected.");let t=this.Wa.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t})}ja(e){throw this.Ua.cancel(),new Error(`Invalid bundle format: ${e}`)}Ya(){return P(this,null,function*(){let e=yield this.Ua.read();if(!e.done){let t=new Uint8Array(this.buffer.length+e.value.length);t.set(this.buffer),t.set(e.value,this.buffer.length),this.buffer=t}return e.done})}};var bf=class{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}lookup(e){return P(this,null,function*(){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw this.lastTransactionError=new k(C.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;let t=yield function(i,s){return P(this,null,function*(){let o=F(i),c={documents:s.map(p=>_o(o.serializer,p))},u=yield o.xo("BatchGetDocuments",o.serializer.databaseId,re.emptyPath(),c,s.length),l=new Map;u.forEach(p=>{let m=sR(o.serializer,p);l.set(m.key.toString(),m)});let f=[];return s.forEach(p=>{let m=l.get(p.toString());q(!!m),f.push(m)}),f})}(this.datastore,e);return t.forEach(n=>this.recordVersion(n)),t})}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(n){this.lastTransactionError=n}this.writtenDocs.add(e.toString())}delete(e){this.write(new Un(e,this.precondition(e))),this.writtenDocs.add(e.toString())}commit(){return P(this,null,function*(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;let e=this.readVersions;this.mutations.forEach(t=>{e.delete(t.key.toString())}),e.forEach((t,n)=>{let i=L.fromPath(n);this.mutations.push(new po(i,this.precondition(i)))}),yield function(n,i){return P(this,null,function*(){let s=F(n),o={writes:i.map(c=>wo(s.serializer,c))};yield s.Co("Commit",s.serializer.databaseId,re.emptyPath(),o)})}(this.datastore,this.mutations),this.committed=!0})}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw U();t=K.min()}let n=this.readVersions.get(e.key.toString());if(n){if(!t.isEqual(n))throw new k(C.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){let t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(K.min())?Te.exists(!1):Te.updateTime(t):Te.none()}preconditionForUpdate(e){let t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(K.min()))throw new k(C.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return Te.updateTime(t)}return Te.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}};var Rf=class{constructor(e,t,n,i,s){this.asyncQueue=e,this.datastore=t,this.options=n,this.updateFunction=i,this.deferred=s,this.Za=n.maxAttempts,this.Yo=new Ao(this.asyncQueue,"transaction_retry")}Xa(){this.Za-=1,this.eu()}eu(){this.Yo.$o(()=>P(this,null,function*(){let e=new bf(this.datastore),t=this.tu(e);t&&t.then(n=>{this.asyncQueue.enqueueAndForget(()=>e.commit().then(()=>{this.deferred.resolve(n)}).catch(i=>{this.nu(i)}))}).catch(n=>{this.nu(n)})}))}tu(e){try{let t=this.updateFunction(e);return!Do(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}}nu(e){this.Za>0&&this.ru(e)?(this.Za-=1,this.asyncQueue.enqueueAndForget(()=>(this.eu(),Promise.resolve()))):this.deferred.reject(e)}ru(e){if(e.name==="FirebaseError"){let t=e.code;return t==="aborted"||t==="failed-precondition"||t==="already-exists"||!Pw(t)}return!1}};var Cf=class{constructor(e,t,n,i){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this.databaseInfo=i,this.user=xe.UNAUTHENTICATED,this.clientId=nc.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(n,s=>P(this,null,function*(){M("FirestoreClient","Received user=",s.uid),yield this.authCredentialListener(s),this.user=s})),this.appCheckCredentials.start(n,s=>(M("FirestoreClient","Received new app check token=",s),this.appCheckCredentialListener(s,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new k(C.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();let e=new Ne;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(()=>P(this,null,function*(){try{this._onlineComponents&&(yield this._onlineComponents.terminate()),this._offlineComponents&&(yield this._offlineComponents.terminate()),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){let n=Li(t,"Failed to shutdown persistence");e.reject(n)}})),e.promise}};function ec(r,e){return P(this,null,function*(){r.asyncQueue.verifyOperationInProgress(),M("FirestoreClient","Initializing OfflineComponentProvider");let t=r.configuration;yield e.initialize(t);let n=t.initialUser;r.setCredentialChangeListener(i=>P(this,null,function*(){n.isEqual(i)||(yield Jw(e.localStore,i),n=i)})),e.persistence.setDatabaseDeletedListener(()=>r.terminate()),r._offlineComponents=e})}function Pf(r,e){return P(this,null,function*(){r.asyncQueue.verifyOperationInProgress();let t=yield pp(r);M("FirestoreClient","Initializing OnlineComponentProvider"),yield e.initialize(t,r.configuration),r.setCredentialChangeListener(n=>V_(e.remoteStore,n)),r.setAppCheckTokenChangeListener((n,i)=>V_(e.remoteStore,i)),r._onlineComponents=e})}function gE(r){return r.name==="FirebaseError"?r.code===C.FAILED_PRECONDITION||r.code===C.UNIMPLEMENTED:!(typeof DOMException<"u"&&r instanceof DOMException)||r.code===22||r.code===20||r.code===11}function pp(r){return P(this,null,function*(){if(!r._offlineComponents)if(r._uninitializedComponentsProvider){M("FirestoreClient","Using user provided OfflineComponentProvider");try{yield ec(r,r._uninitializedComponentsProvider._offline)}catch(e){let t=e;if(!gE(t))throw t;gt("Error using user provided cache. Falling back to memory cache: "+t),yield ec(r,new bo)}}else M("FirestoreClient","Using default OfflineComponentProvider"),yield ec(r,new bo);return r._offlineComponents})}function eu(r){return P(this,null,function*(){return r._onlineComponents||(r._uninitializedComponentsProvider?(M("FirestoreClient","Using user provided OnlineComponentProvider"),yield Pf(r,r._uninitializedComponentsProvider._online)):(M("FirestoreClient","Using default OnlineComponentProvider"),yield Pf(r,new Ro))),r._onlineComponents})}function mE(r){return pp(r).then(e=>e.persistence)}function gp(r){return pp(r).then(e=>e.localStore)}function yE(r){return eu(r).then(e=>e.remoteStore)}function mp(r){return eu(r).then(e=>e.syncEngine)}function t0(r){return eu(r).then(e=>e.datastore)}function Di(r){return P(this,null,function*(){let e=yield eu(r),t=e.eventManager;return t.onListen=OR.bind(null,e.syncEngine),t.onUnlisten=LR.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=VR.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=FR.bind(null,e.syncEngine),t})}function n0(r){return r.asyncQueue.enqueue(()=>P(this,null,function*(){let e=yield mE(r),t=yield yE(r);return e.setNetworkEnabled(!0),function(i){let s=F(i);return s.M_.delete(0),Oo(s)}(t)}))}function r0(r){return r.asyncQueue.enqueue(()=>P(this,null,function*(){let e=yield mE(r),t=yield yE(r);return e.setNetworkEnabled(!1),function(i){return P(this,null,function*(){let s=F(i);s.M_.add(0),yield Mi(s),s.N_.set("Offline")})}(t)}))}function i0(r,e){let t=new Ne;return r.asyncQueue.enqueueAndForget(()=>P(this,null,function*(){return function(i,s,o){return P(this,null,function*(){try{let c=yield function(l,f){let p=F(l);return p.persistence.runTransaction("read document","readonly",m=>p.localDocuments.getDocument(m,f))}(i,s);c.isFoundDocument()?o.resolve(c):c.isNoDocument()?o.resolve(null):o.reject(new k(C.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(c){let u=Li(c,`Failed to get document '${s} from cache`);o.reject(u)}})}(yield gp(r),e,t)})),t.promise}function vE(r,e,t={}){let n=new Ne;return r.asyncQueue.enqueueAndForget(()=>P(this,null,function*(){return function(s,o,c,u,l){let f=new Pi({next:m=>{o.enqueueAndForget(()=>ap(s,p));let T=m.docs.has(c);!T&&m.fromCache?l.reject(new k(C.UNAVAILABLE,"Failed to get document because the client is offline.")):T&&m.fromCache&&u&&u.source==="server"?l.reject(new k(C.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):l.resolve(m)},error:m=>l.reject(m)}),p=new So(ki(c.path),f,{includeMetadataChanges:!0,ra:!0});return op(s,p)}(yield Di(r),r.asyncQueue,e,t,n)})),n.promise}function s0(r,e){let t=new Ne;return r.asyncQueue.enqueueAndForget(()=>P(this,null,function*(){return function(i,s,o){return P(this,null,function*(){try{let c=yield Cc(i,s,!0),u=new jc(s,c.hs),l=u.da(c.documents),f=u.applyChanges(l,!1);o.resolve(f.snapshot)}catch(c){let u=Li(c,`Failed to execute query '${s} against cache`);o.reject(u)}})}(yield gp(r),e,t)})),t.promise}function _E(r,e,t={}){let n=new Ne;return r.asyncQueue.enqueueAndForget(()=>P(this,null,function*(){return function(s,o,c,u,l){let f=new Pi({next:m=>{o.enqueueAndForget(()=>ap(s,p)),m.fromCache&&u.source==="server"?l.reject(new k(C.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):l.resolve(m)},error:m=>l.reject(m)}),p=new So(c,f,{includeMetadataChanges:!0,ra:!0});return op(s,p)}(yield Di(r),r.asyncQueue,e,t,n)})),n.promise}function o0(r,e){let t=new Pi(e);return r.asyncQueue.enqueueAndForget(()=>P(this,null,function*(){return function(i,s){F(i).z_.add(s),s.next()}(yield Di(r),t)})),()=>{t.$a(),r.asyncQueue.enqueueAndForget(()=>P(this,null,function*(){return function(i,s){F(i).z_.delete(s)}(yield Di(r),t)}))}}function a0(r,e,t,n){let i=function(o,c){let u;return u=typeof o=="string"?xw().encode(o):o,function(f,p){return new Sf(f,p)}(function(f,p){if(f instanceof Uint8Array)return j_(f,p);if(f instanceof ArrayBuffer)return j_(new Uint8Array(f),p);if(f instanceof ReadableStream)return f.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(u),c)}(t,Mo(e));r.asyncQueue.enqueueAndForget(()=>P(this,null,function*(){e0(yield mp(r),i,n)}))}function c0(r,e){return r.asyncQueue.enqueue(()=>P(this,null,function*(){return function(n,i){let s=F(n);return s.persistence.runTransaction("Get named query","readonly",o=>s.$r.getNamedQuery(o,i))}(yield gp(r),e)}))}function wE(r){let e={};return r.timeoutSeconds!==void 0&&(e.timeoutSeconds=r.timeoutSeconds),e}var $_=new Map;function yp(r,e,t){if(!t)throw new k(C.INVALID_ARGUMENT,`Function ${r}() cannot be called with an empty ${e}.`)}function vp(r,e,t,n){if(e===!0&&n===!0)throw new k(C.INVALID_ARGUMENT,`${r} and ${t} cannot be used together.`)}function z_(r){if(!L.isDocumentKey(r))throw new k(C.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${r} has ${r.length}.`)}function B_(r){if(L.isDocumentKey(r))throw new k(C.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${r} has ${r.length}.`)}function tu(r){if(r===void 0)return"undefined";if(r===null)return"null";if(typeof r=="string")return r.length>20&&(r=`${r.substring(0,20)}...`),JSON.stringify(r);if(typeof r=="number"||typeof r=="boolean")return""+r;if(typeof r=="object"){if(r instanceof Array)return"an array";{let e=function(n){return n.constructor?n.constructor.name:null}(r);return e?`a custom ${e} object`:"an object"}}return typeof r=="function"?"a function":U()}function ie(r,e){if("_delegate"in r&&(r=r._delegate),!(r instanceof e)){if(e.name===r.constructor.name)throw new k(C.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let t=tu(r);throw new k(C.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return r}function EE(r,e){if(e<=0)throw new k(C.INVALID_ARGUMENT,`Function ${r}() requires a positive number, but it was: ${e}.`)}var zc=class{constructor(e){var t,n;if(e.host===void 0){if(e.ssl!==void 0)throw new k(C.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=(t=e.ssl)===null||t===void 0||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<1048576)throw new k(C.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}vp("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=wE((n=e.experimentalLongPollingOptions)!==null&&n!==void 0?n:{}),function(s){if(s.timeoutSeconds!==void 0){if(isNaN(s.timeoutSeconds))throw new k(C.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (must not be NaN)`);if(s.timeoutSeconds<5)throw new k(C.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (minimum allowed value is 5)`);if(s.timeoutSeconds>30)throw new k(C.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(n,i){return n.timeoutSeconds===i.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}},yr=class{constructor(e,t,n,i){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=n,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new zc({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new k(C.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!==void 0}_setSettings(e){if(this._settingsFrozen)throw new k(C.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new zc(e),e.credentials!==void 0&&(this._authCredentials=function(n){if(!n)return new Kh;switch(n.type){case"firstParty":return new Yh(n.sessionIndex||"0",n.iamToken||null,n.authTokenFactory||null);case"provider":return n.client;default:throw new k(C.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){let n=$_.get(t);n&&(M("ComponentProvider","Removing Datastore"),$_.delete(t),n.terminate())}(this),Promise.resolve()}};function nu(r,e,t,n={}){var i;let s=(r=ie(r,yr))._getSettings(),o=`${e}:${t}`;if(s.host!=="firestore.googleapis.com"&&s.host!==o&&gt("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),r._setSettings(Object.assign(Object.assign({},s),{host:o,ssl:!1})),n.mockUserToken){let c,u;if(typeof n.mockUserToken=="string")c=n.mockUserToken,u=xe.MOCK_USER;else{c=ay(n.mockUserToken,(i=r._app)===null||i===void 0?void 0:i.options.projectId);let l=n.mockUserToken.sub||n.mockUserToken.user_id;if(!l)throw new k(C.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");u=new xe(l)}r._authCredentials=new Wh(new tc(c,u))}}var $e=class r{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new r(this.firestore,e,this._query)}},de=class r{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Ft(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new r(this.firestore,e,this._key)}},Ft=class r extends $e{constructor(e,t,n){super(e,t,ki(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let e=this._path.popLast();return e.isEmpty()?null:new de(this.firestore,null,new L(e))}withConverter(e){return new r(this.firestore,e,this._path)}};function ru(r,e,...t){if(r=ye(r),yp("collection","path",e),r instanceof yr){let n=re.fromString(e,...t);return B_(n),new Ft(r,null,n)}{if(!(r instanceof de||r instanceof Ft))throw new k(C.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let n=r._path.child(re.fromString(e,...t));return B_(n),new Ft(r.firestore,null,n)}}function _p(r,e){if(r=ie(r,yr),yp("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new k(C.INVALID_ARGUMENT,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new $e(r,null,function(n){return new Tt(re.emptyPath(),n)}(e))}function Tr(r,e,...t){if(r=ye(r),arguments.length===1&&(e=nc.newId()),yp("doc","path",e),r instanceof yr){let n=re.fromString(e,...t);return z_(n),new de(r,null,new L(n))}{if(!(r instanceof de||r instanceof Ft))throw new k(C.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let n=r._path.child(re.fromString(e,...t));return z_(n),new de(r.firestore,r instanceof Ft?r.converter:null,new L(n))}}function iu(r,e){return r=ye(r),e=ye(e),(r instanceof de||r instanceof Ft)&&(e instanceof de||e instanceof Ft)&&r.firestore===e.firestore&&r.path===e.path&&r.converter===e.converter}function su(r,e){return r=ye(r),e=ye(e),r instanceof $e&&e instanceof $e&&r.firestore===e.firestore&&No(r._query,e._query)&&r.converter===e.converter}var Df=class{constructor(){this.iu=Promise.resolve(),this.su=[],this.ou=!1,this._u=[],this.au=null,this.uu=!1,this.cu=!1,this.lu=[],this.Yo=new Ao(this,"async_queue_retry"),this.hu=()=>{let t=Za();t&&M("AsyncQueue","Visibility state changed to "+t.visibilityState),this.Yo.Wo()};let e=Za();e&&typeof e.addEventListener=="function"&&e.addEventListener("visibilitychange",this.hu)}get isShuttingDown(){return this.ou}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.Pu(),this.Iu(e)}enterRestrictedMode(e){if(!this.ou){this.ou=!0,this.cu=e||!1;let t=Za();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this.hu)}}enqueue(e){if(this.Pu(),this.ou)return new Promise(()=>{});let t=new Ne;return this.Iu(()=>this.ou&&this.cu?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.su.push(e),this.Tu()))}Tu(){return P(this,null,function*(){if(this.su.length!==0){try{yield this.su[0](),this.su.shift(),this.Yo.reset()}catch(e){if(!zn(e))throw e;M("AsyncQueue","Operation failed with retryable error: "+e)}this.su.length>0&&this.Yo.$o(()=>this.Tu())}})}Iu(e){let t=this.iu.then(()=>(this.uu=!0,e().catch(n=>{this.au=n,this.uu=!1;let i=function(o){let c=o.message||"";return o.stack&&(c=o.stack.includes(o.message)?o.stack:o.message+`
`+o.stack),c}(n);throw Ae("INTERNAL UNHANDLED ERROR: ",i),n}).then(n=>(this.uu=!1,n))));return this.iu=t,t}enqueueAfterDelay(e,t,n){this.Pu(),this.lu.indexOf(e)>-1&&(t=0);let i=pf.createAndSchedule(this,e,t,n,s=>this.Eu(s));return this._u.push(i),i}Pu(){this.au&&U()}verifyOperationInProgress(){}du(){return P(this,null,function*(){let e;do e=this.iu,yield e;while(e!==this.iu)})}Au(e){for(let t of this._u)if(t.timerId===e)return!0;return!1}Ru(e){return this.du().then(()=>{this._u.sort((t,n)=>t.targetTimeMs-n.targetTimeMs);for(let t of this._u)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.du()})}Vu(e){this.lu.push(e)}Eu(e){let t=this._u.indexOf(e);this._u.splice(t,1)}};function xf(r){return function(t,n){if(typeof t!="object"||t===null)return!1;let i=t;for(let s of n)if(s in i&&typeof i[s]=="function")return!0;return!1}(r,["next","error","complete"])}var Nf=class{constructor(){this._progressObserver={},this._taskCompletionResolver=new Ne,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,n){this._progressObserver={next:e,error:t,complete:n}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}};var TE=-1,me=class extends yr{constructor(e,t,n,i){super(e,t,n,i),this.type="firestore",this._queue=function(){return new Df}(),this._persistenceKey=i?.name||"[DEFAULT]"}_terminate(){return this._firestoreClient||AE(this),this._firestoreClient.terminate()}};function IE(r,e){let t=typeof r=="object"?r:Tl(),n=typeof r=="string"?r:e||"(default)",i=El(t,"firestore").getImmediate({identifier:n});if(!i._initialized){let s=oy("firestore");s&&nu(i,...s)}return i}function Ve(r){return r._firestoreClient||AE(r),r._firestoreClient.verifyNotTerminated(),r._firestoreClient}function AE(r){var e,t,n;let i=r._freezeSettings(),s=function(c,u,l,f){return new id(c,u,l,f.host,f.ssl,f.experimentalForceLongPolling,f.experimentalAutoDetectLongPolling,wE(f.experimentalLongPollingOptions),f.useFetchStreams)}(r._databaseId,((e=r._app)===null||e===void 0?void 0:e.options.appId)||"",r._persistenceKey,i);r._firestoreClient=new Cf(r._authCredentials,r._appCheckCredentials,r._queue,s),!((t=i.localCache)===null||t===void 0)&&t._offlineComponentProvider&&(!((n=i.localCache)===null||n===void 0)&&n._onlineComponentProvider)&&(r._firestoreClient._uninitializedComponentsProvider={_offlineKind:i.localCache.kind,_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider})}function wp(r,e){bE(r=ie(r,me));let t=Ve(r);if(t._uninitializedComponentsProvider)throw new k(C.FAILED_PRECONDITION,"SDK cache is already specified.");gt("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let n=r._freezeSettings(),i=new Ro;return SE(t,i,new $c(i,n.cacheSizeBytes,e?.forceOwnership))}function Ep(r){bE(r=ie(r,me));let e=Ve(r);if(e._uninitializedComponentsProvider)throw new k(C.FAILED_PRECONDITION,"SDK cache is already specified.");gt("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let t=r._freezeSettings(),n=new Ro;return SE(e,n,new Af(n,t.cacheSizeBytes))}function SE(r,e,t){let n=new Ne;return r.asyncQueue.enqueue(()=>P(this,null,function*(){try{yield ec(r,t),yield Pf(r,e),n.resolve()}catch(i){let s=i;if(!gE(s))throw s;gt("Error enabling indexeddb cache. Falling back to memory cache: "+s),n.reject(s)}})).then(()=>n.promise)}function Tp(r){if(r._initialized&&!r._terminated)throw new k(C.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");let e=new Ne;return r._queue.enqueueAndForgetEvenWhileRestricted(()=>P(this,null,function*(){try{yield function(n){return P(this,null,function*(){if(!Nn.D())return Promise.resolve();let i=n+"main";yield Nn.delete(i)})}(np(r._databaseId,r._persistenceKey)),e.resolve()}catch(t){e.reject(t)}})),e.promise}function Ip(r){return function(t){let n=new Ne;return t.asyncQueue.enqueueAndForget(()=>P(this,null,function*(){return BR(yield mp(t),n)})),n.promise}(Ve(r=ie(r,me)))}function Ap(r){return n0(Ve(r=ie(r,me)))}function Sp(r){return r0(Ve(r=ie(r,me)))}function bp(r,e){let t=Ve(r=ie(r,me)),n=new Nf;return a0(t,r._databaseId,e,n),n}function Rp(r,e){return c0(Ve(r=ie(r,me)),e).then(t=>t?new $e(r,null,t.query):null)}function bE(r){if(r._initialized||r._terminated)throw new k(C.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}var zt=class r{constructor(e){this._byteString=e}static fromBase64String(e){try{return new r(Fe.fromBase64String(e))}catch(t){throw new k(C.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new r(Fe.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}};var At=class{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new k(C.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Se(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}};var ln=class{constructor(e){this._methodName=e}};var vr=class{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new k(C.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new k(C.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return J(this._lat,e._lat)||J(this._long,e._long)}};var u0=/^__.*__$/,kf=class{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return this.fieldMask!==null?new It(e,this.data,this.fieldMask,t,this.fieldTransforms):new Fn(e,this.data,t,this.fieldTransforms)}},Bc=class{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return new It(e,this.data,this.fieldMask,t,this.fieldTransforms)}};function RE(r){switch(r){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw U()}}var qc=class r{constructor(e,t,n,i,s,o){this.settings=e,this.databaseId=t,this.serializer=n,this.ignoreUndefinedProperties=i,s===void 0&&this.mu(),this.fieldTransforms=s||[],this.fieldMask=o||[]}get path(){return this.settings.path}get fu(){return this.settings.fu}gu(e){return new r(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}pu(e){var t;let n=(t=this.path)===null||t===void 0?void 0:t.child(e),i=this.gu({path:n,yu:!1});return i.wu(e),i}Su(e){var t;let n=(t=this.path)===null||t===void 0?void 0:t.child(e),i=this.gu({path:n,yu:!1});return i.mu(),i}bu(e){return this.gu({path:void 0,yu:!0})}Du(e){return Gc(e,this.settings.methodName,this.settings.Cu||!1,this.path,this.settings.vu)}contains(e){return this.fieldMask.find(t=>e.isPrefixOf(t))!==void 0||this.fieldTransforms.find(t=>e.isPrefixOf(t.field))!==void 0}mu(){if(this.path)for(let e=0;e<this.path.length;e++)this.wu(this.path.get(e))}wu(e){if(e.length===0)throw this.Du("Document fields must not be empty");if(RE(this.fu)&&u0.test(e))throw this.Du('Document fields cannot begin and end with "__"')}},Mf=class{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=n||Mo(e)}Fu(e,t,n,i=!1){return new qc({fu:e,methodName:t,vu:n,path:Se.emptyPath(),yu:!1,Cu:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}};function Ir(r){let e=r._freezeSettings(),t=Mo(r._databaseId);return new Mf(r._databaseId,!!e.ignoreUndefinedProperties,t)}function ou(r,e,t,n,i,s={}){let o=r.Fu(s.merge||s.mergeFields?2:0,e,t,i);Dp("Data must be an object, but it was:",o,n);let c=DE(n,o),u,l;if(s.merge)u=new ut(o.fieldMask),l=o.fieldTransforms;else if(s.mergeFields){let f=[];for(let p of s.mergeFields){let m=Uf(e,p,t);if(!o.contains(m))throw new k(C.INVALID_ARGUMENT,`Field '${m}' is specified in your field mask but missing from your input data.`);NE(f,m)||f.push(m)}u=new ut(f),l=o.fieldTransforms.filter(p=>u.covers(p.field))}else u=null,l=o.fieldTransforms;return new kf(new We(c),u,l)}var Co=class r extends ln{_toFieldTransform(e){if(e.fu!==2)throw e.fu===1?e.Du(`${this._methodName}() can only appear at the top level of your update data`):e.Du(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof r}};function CE(r,e,t){return new qc({fu:3,vu:e.settings.vu,methodName:r._methodName,yu:t},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}var Of=class r extends ln{_toFieldTransform(e){return new pr(e.path,new Vn)}isEqual(e){return e instanceof r}},Vf=class r extends ln{constructor(e,t){super(e),this.Mu=t}_toFieldTransform(e){let t=CE(this,e,!0),n=this.Mu.map(s=>Ar(s,t)),i=new cn(n);return new pr(e.path,i)}isEqual(e){return e instanceof r&&wl(this.Mu,e.Mu)}},Lf=class r extends ln{constructor(e,t){super(e),this.Mu=t}_toFieldTransform(e){let t=CE(this,e,!0),n=this.Mu.map(s=>Ar(s,t)),i=new un(n);return new pr(e.path,i)}isEqual(e){return e instanceof r&&wl(this.Mu,e.Mu)}},Ff=class r extends ln{constructor(e,t){super(e),this.xu=t}_toFieldTransform(e){let t=new Ln(e.serializer,Tw(e.serializer,this.xu));return new pr(e.path,t)}isEqual(e){return e instanceof r&&this.xu===e.xu}};function Cp(r,e,t,n){let i=r.Fu(1,e,t);Dp("Data must be an object, but it was:",i,n);let s=[],o=We.empty();Er(n,(u,l)=>{let f=xp(e,u,t);l=ye(l);let p=i.Su(f);if(l instanceof Co)s.push(f);else{let m=Ar(l,p);m!=null&&(s.push(f),o.set(f,m))}});let c=new ut(s);return new Bc(o,c,i.fieldTransforms)}function Pp(r,e,t,n,i,s){let o=r.Fu(1,e,t),c=[Uf(e,n,t)],u=[i];if(s.length%2!=0)throw new k(C.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let m=0;m<s.length;m+=2)c.push(Uf(e,s[m])),u.push(s[m+1]);let l=[],f=We.empty();for(let m=c.length-1;m>=0;--m)if(!NE(l,c[m])){let T=c[m],x=u[m];x=ye(x);let N=o.Su(T);if(x instanceof Co)l.push(T);else{let D=Ar(x,N);D!=null&&(l.push(T),f.set(T,D))}}let p=new ut(l);return new Bc(f,p,o.fieldTransforms)}function PE(r,e,t,n=!1){return Ar(t,r.Fu(n?4:3,e))}function Ar(r,e){if(xE(r=ye(r)))return Dp("Unsupported field value:",e,r),DE(r,e);if(r instanceof ln)return function(n,i){if(!RE(i.fu))throw i.Du(`${n._methodName}() can only be used with update() and set()`);if(!i.path)throw i.Du(`${n._methodName}() is not currently supported inside arrays`);let s=n._toFieldTransform(i);s&&i.fieldTransforms.push(s)}(r,e),null;if(r===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),r instanceof Array){if(e.settings.yu&&e.fu!==4)throw e.Du("Nested arrays are not supported");return function(n,i){let s=[],o=0;for(let c of n){let u=Ar(c,i.bu(o));u==null&&(u={nullValue:"NULL_VALUE"}),s.push(u),o++}return{arrayValue:{values:s}}}(r,e)}return function(n,i){if((n=ye(n))===null)return{nullValue:"NULL_VALUE"};if(typeof n=="number")return Tw(i.serializer,n);if(typeof n=="boolean")return{booleanValue:n};if(typeof n=="string")return{stringValue:n};if(n instanceof Date){let s=_e.fromDate(n);return{timestampValue:Ei(i.serializer,s)}}if(n instanceof _e){let s=new _e(n.seconds,1e3*Math.floor(n.nanoseconds/1e3));return{timestampValue:Ei(i.serializer,s)}}if(n instanceof vr)return{geoPointValue:{latitude:n.latitude,longitude:n.longitude}};if(n instanceof zt)return{bytesValue:Nw(i.serializer,n._byteString)};if(n instanceof de){let s=i.databaseId,o=n.firestore._databaseId;if(!o.isEqual(s))throw i.Du(`Document reference is for database ${o.projectId}/${o.database} but should be for database ${s.projectId}/${s.database}`);return{referenceValue:Zf(n.firestore._databaseId||i.databaseId,n._key.path)}}throw i.Du(`Unsupported field value: ${tu(n)}`)}(r,e)}function DE(r,e){let t={};return iw(r)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Er(r,(n,i)=>{let s=Ar(i,e.pu(n));s!=null&&(t[n]=s)}),{mapValue:{fields:t}}}function xE(r){return!(typeof r!="object"||r===null||r instanceof Array||r instanceof Date||r instanceof _e||r instanceof vr||r instanceof zt||r instanceof de||r instanceof ln)}function Dp(r,e,t){if(!xE(t)||!function(i){return typeof i=="object"&&i!==null&&(Object.getPrototypeOf(i)===Object.prototype||Object.getPrototypeOf(i)===null)}(t)){let n=tu(t);throw n==="an object"?e.Du(r+" a custom object"):e.Du(r+" "+n)}}function Uf(r,e,t){if((e=ye(e))instanceof At)return e._internalPath;if(typeof e=="string")return xp(r,e);throw Gc("Field path arguments must be of type string or ",r,!1,void 0,t)}var l0=new RegExp("[~\\*/\\[\\]]");function xp(r,e,t){if(e.search(l0)>=0)throw Gc(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,r,!1,void 0,t);try{return new At(...e.split("."))._internalPath}catch{throw Gc(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,r,!1,void 0,t)}}function Gc(r,e,t,n,i){let s=n&&!n.isEmpty(),o=i!==void 0,c=`Function ${e}() called with invalid data`;t&&(c+=" (via `toFirestore()`)"),c+=". ";let u="";return(s||o)&&(u+=" (found",s&&(u+=` in field ${n}`),o&&(u+=` in document ${i}`),u+=")"),new k(C.INVALID_ARGUMENT,c+r+u)}function NE(r,e){return r.some(t=>t.isEqual(e))}var _r=class{constructor(e,t,n,i,s){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=i,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new de(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){let e=new jf(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){let t=this._document.data.field(au("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}},jf=class extends _r{data(){return super.data()}};function au(r,e){return typeof e=="string"?xp(r,e):e instanceof At?e._internalPath:e._delegate._internalPath}function kE(r){if(r.limitType==="L"&&r.explicitOrderBy.length===0)throw new k(C.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var Po=class{},wr=class extends Po{};function Bt(r,e,...t){let n=[];e instanceof Po&&n.push(e),n=n.concat(t),function(s){let o=s.filter(u=>u instanceof $f).length,c=s.filter(u=>u instanceof Kc).length;if(o>1||o>0&&c>0)throw new k(C.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(n);for(let i of n)r=i._apply(r);return r}var Kc=class r extends wr{constructor(e,t,n){super(),this._field=e,this._op=t,this._value=n,this.type="where"}static _create(e,t,n){return new r(e,t,n)}_apply(e){let t=this._parse(e);return OE(e._query,t),new $e(e.firestore,e.converter,yd(e._query,t))}_parse(e){let t=Ir(e.firestore);return function(s,o,c,u,l,f,p){let m;if(l.isKeyField()){if(f==="array-contains"||f==="array-contains-any")throw new k(C.INVALID_ARGUMENT,`Invalid Query. You can't perform '${f}' queries on documentId().`);if(f==="in"||f==="not-in"){G_(p,f);let T=[];for(let x of p)T.push(q_(u,s,x));m={arrayValue:{values:T}}}else m=q_(u,s,p)}else f!=="in"&&f!=="not-in"&&f!=="array-contains-any"||G_(p,f),m=PE(c,o,p,f==="in"||f==="not-in");return te.create(l,f,m)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}};function Np(r,e,t){let n=e,i=au("where",r);return Kc._create(i,n,t)}var $f=class r extends Po{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new r(e,t)}_parse(e){let t=this._queryConstraints.map(n=>n._parse(e)).filter(n=>n.getFilters().length>0);return t.length===1?t[0]:ue.create(t,this._getOperator())}_apply(e){let t=this._parse(e);return t.getFilters().length===0?e:(function(i,s){let o=i,c=s.getFlattenedFilters();for(let u of c)OE(o,u),o=yd(o,u)}(e._query,t),new $e(e.firestore,e.converter,yd(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}};var zf=class r extends wr{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new r(e,t)}_apply(e){let t=function(i,s,o){if(i.startAt!==null)throw new k(C.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(i.endAt!==null)throw new k(C.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new dr(s,o)}(e._query,this._field,this._direction);return new $e(e.firestore,e.converter,function(i,s){let o=i.explicitOrderBy.concat([s]);return new Tt(i.path,i.collectionGroup,o,i.filters.slice(),i.limit,i.limitType,i.startAt,i.endAt)}(e._query,t))}};function kp(r,e="asc"){let t=e,n=au("orderBy",r);return zf._create(n,t)}var Wc=class r extends wr{constructor(e,t,n){super(),this.type=e,this._limit=t,this._limitType=n}static _create(e,t,n){return new r(e,t,n)}_apply(e){return new $e(e.firestore,e.converter,dc(e._query,this._limit,this._limitType))}};function Mp(r){return EE("limit",r),Wc._create("limit",r,"F")}function Op(r){return EE("limitToLast",r),Wc._create("limitToLast",r,"L")}var Hc=class r extends wr{constructor(e,t,n){super(),this.type=e,this._docOrFields=t,this._inclusive=n}static _create(e,t,n){return new r(e,t,n)}_apply(e){let t=ME(e,this.type,this._docOrFields,this._inclusive);return new $e(e.firestore,e.converter,function(i,s){return new Tt(i.path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),i.limit,i.limitType,s,i.endAt)}(e._query,t))}};function Vp(...r){return Hc._create("startAt",r,!0)}function Lp(...r){return Hc._create("startAfter",r,!1)}var Qc=class r extends wr{constructor(e,t,n){super(),this.type=e,this._docOrFields=t,this._inclusive=n}static _create(e,t,n){return new r(e,t,n)}_apply(e){let t=ME(e,this.type,this._docOrFields,this._inclusive);return new $e(e.firestore,e.converter,function(i,s){return new Tt(i.path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),i.limit,i.limitType,i.startAt,s)}(e._query,t))}};function Fp(...r){return Qc._create("endBefore",r,!1)}function Up(...r){return Qc._create("endAt",r,!0)}function ME(r,e,t,n){if(t[0]=ye(t[0]),t[0]instanceof _r)return function(s,o,c,u,l){if(!u)throw new k(C.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${c}().`);let f=[];for(let p of fi(s))if(p.field.isKeyField())f.push(hr(o,u.key));else{let m=u.data.field(p.field);if(Xc(m))throw new k(C.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+p.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(m===null){let T=p.field.canonicalString();throw new k(C.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${T}' (used as the orderBy) does not exist.`)}f.push(m)}return new jt(f,l)}(r._query,r.firestore._databaseId,e,t[0]._document,n);{let i=Ir(r.firestore);return function(o,c,u,l,f,p){let m=o.explicitOrderBy;if(f.length>m.length)throw new k(C.INVALID_ARGUMENT,`Too many arguments provided to ${l}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);let T=[];for(let x=0;x<f.length;x++){let N=f[x];if(m[x].field.isKeyField()){if(typeof N!="string")throw new k(C.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${l}(), but got a ${typeof N}`);if(!Xf(o)&&N.indexOf("/")!==-1)throw new k(C.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${l}() must be a plain document ID, but '${N}' contains a slash.`);let D=o.path.child(re.fromString(N));if(!L.isDocumentKey(D))throw new k(C.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${l}() must result in a valid document path, but '${D}' is not because it contains an odd number of segments.`);let j=new L(D);T.push(hr(c,j))}else{let D=PE(u,l,N);T.push(D)}}return new jt(T,p)}(r._query,r.firestore._databaseId,i,e,t,n)}}function q_(r,e,t){if(typeof(t=ye(t))=="string"){if(t==="")throw new k(C.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Xf(e)&&t.indexOf("/")!==-1)throw new k(C.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);let n=e.path.child(re.fromString(t));if(!L.isDocumentKey(n))throw new k(C.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${n}' is not because it has an odd number of segments (${n.length}).`);return hr(r,new L(n))}if(t instanceof de)return hr(r,t._key);throw new k(C.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${tu(t)}.`)}function G_(r,e){if(!Array.isArray(r)||r.length===0)throw new k(C.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function OE(r,e){let t=function(i,s){for(let o of i)for(let c of o.getFlattenedFilters())if(s.indexOf(c.op)>=0)return c.op;return null}(r.filters,function(i){switch(i){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(t!==null)throw t===e.op?new k(C.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new k(C.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}var xi=class{convertValue(e,t="none"){switch(lr(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Ee(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(kn(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 10:return this.convertObject(e.mapValue,t);default:throw U()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){let n={};return Er(e,(i,s)=>{n[i]=this.convertValue(s,t)}),n}convertGeoPoint(e){return new vr(Ee(e.latitude),Ee(e.longitude))}convertArray(e,t){return(e.values||[]).map(n=>this.convertValue(n,t))}convertServerTimestamp(e,t){switch(t){case"previous":let n=Qf(e);return n==null?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(lo(e));default:return null}}convertTimestamp(e){let t=an(e);return new _e(t.seconds,t.nanos)}convertDocumentKey(e,t){let n=re.fromString(e);q(Bw(n));let i=new Mn(n.get(1),n.get(3)),s=new L(n.popFirst(5));return i.isEqual(t)||Ae(`Document ${s} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),s}};function cu(r,e,t){let n;return n=r?t&&(t.merge||t.mergeFields)?r.toFirestore(e,t):r.toFirestore(e):e,n}var Bf=class extends xi{constructor(e){super(),this.firestore=e}convertBytes(e){return new zt(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new de(this.firestore,null,t)}};var on=class{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}},yt=class extends _r{constructor(e,t,n,i,s,o){super(e,t,n,i,o),this._firestore=e,this._firestoreImpl=e,this.metadata=s}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){let t=new Dn(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){let n=this._document.data.field(au("DocumentSnapshot.get",e));if(n!==null)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}},Dn=class extends yt{data(e={}){return super.data(e)}},St=class{constructor(e,t,n,i){this._firestore=e,this._userDataWriter=t,this._snapshot=i,this.metadata=new on(i.hasPendingWrites,i.fromCache),this.query=n}get docs(){let e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(n=>{e.call(t,new Dn(this._firestore,this._userDataWriter,n.key,n,new on(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){let t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new k(C.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(i,s){if(i._snapshot.oldDocs.isEmpty()){let o=0;return i._snapshot.docChanges.map(c=>{let u=new Dn(i._firestore,i._userDataWriter,c.doc.key,c.doc,new on(i._snapshot.mutatedKeys.has(c.doc.key),i._snapshot.fromCache),i.query.converter);return c.doc,{type:"added",doc:u,oldIndex:-1,newIndex:o++}})}{let o=i._snapshot.oldDocs;return i._snapshot.docChanges.filter(c=>s||c.type!==3).map(c=>{let u=new Dn(i._firestore,i._userDataWriter,c.doc.key,c.doc,new on(i._snapshot.mutatedKeys.has(c.doc.key),i._snapshot.fromCache),i.query.converter),l=-1,f=-1;return c.type!==0&&(l=o.indexOf(c.doc.key),o=o.delete(c.doc.key)),c.type!==1&&(o=o.add(c.doc),f=o.indexOf(c.doc.key)),{type:h0(c.type),doc:u,oldIndex:l,newIndex:f}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}};function h0(r){switch(r){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return U()}}function uu(r,e){return r instanceof yt&&e instanceof yt?r._firestore===e._firestore&&r._key.isEqual(e._key)&&(r._document===null?e._document===null:r._document.isEqual(e._document))&&r._converter===e._converter:r instanceof St&&e instanceof St&&r._firestore===e._firestore&&su(r.query,e.query)&&r.metadata.isEqual(e.metadata)&&r._snapshot.isEqual(e._snapshot)}function lu(r){r=ie(r,de);let e=ie(r.firestore,me);return vE(Ve(e),r._key).then(t=>Hp(e,r,t))}var hn=class extends xi{constructor(e){super(),this.firestore=e}convertBytes(e){return new zt(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new de(this.firestore,null,t)}};function jp(r){r=ie(r,de);let e=ie(r.firestore,me),t=Ve(e),n=new hn(e);return i0(t,r._key).then(i=>new yt(e,n,r._key,i,new on(i!==null&&i.hasLocalMutations,!0),r.converter))}function $p(r){r=ie(r,de);let e=ie(r.firestore,me);return vE(Ve(e),r._key,{source:"server"}).then(t=>Hp(e,r,t))}function zp(r){r=ie(r,$e);let e=ie(r.firestore,me),t=Ve(e),n=new hn(e);return kE(r._query),_E(t,r._query).then(i=>new St(e,n,r,i))}function Bp(r){r=ie(r,$e);let e=ie(r.firestore,me),t=Ve(e),n=new hn(e);return s0(t,r._query).then(i=>new St(e,n,r,i))}function qp(r){r=ie(r,$e);let e=ie(r.firestore,me),t=Ve(e),n=new hn(e);return _E(t,r._query,{source:"server"}).then(i=>new St(e,n,r,i))}function Vo(r,e,t){r=ie(r,de);let n=ie(r.firestore,me),i=cu(r.converter,e,t);return Fi(n,[ou(Ir(n),"setDoc",r._key,i,r.converter!==null,t).toMutation(r._key,Te.none())])}function hu(r,e,t,...n){r=ie(r,de);let i=ie(r.firestore,me),s=Ir(i),o;return o=typeof(e=ye(e))=="string"||e instanceof At?Pp(s,"updateDoc",r._key,e,t,n):Cp(s,"updateDoc",r._key,e),Fi(i,[o.toMutation(r._key,Te.exists(!0))])}function Gp(r){return Fi(ie(r.firestore,me),[new Un(r._key,Te.none())])}function Kp(r,e){let t=ie(r.firestore,me),n=Tr(r),i=cu(r.converter,e);return Fi(t,[ou(Ir(r.firestore),"addDoc",n._key,i,r.converter!==null,{}).toMutation(n._key,Te.exists(!1))]).then(()=>n)}function du(r,...e){var t,n,i;r=ye(r);let s={includeMetadataChanges:!1,source:"default"},o=0;typeof e[o]!="object"||xf(e[o])||(s=e[o],o++);let c={includeMetadataChanges:s.includeMetadataChanges,source:s.source};if(xf(e[o])){let p=e[o];e[o]=(t=p.next)===null||t===void 0?void 0:t.bind(p),e[o+1]=(n=p.error)===null||n===void 0?void 0:n.bind(p),e[o+2]=(i=p.complete)===null||i===void 0?void 0:i.bind(p)}let u,l,f;if(r instanceof de)l=ie(r.firestore,me),f=ki(r._key.path),u={next:p=>{e[o]&&e[o](Hp(l,r,p))},error:e[o+1],complete:e[o+2]};else{let p=ie(r,$e);l=ie(p.firestore,me),f=p._query;let m=new hn(l);u={next:T=>{e[o]&&e[o](new St(l,m,p,T))},error:e[o+1],complete:e[o+2]},kE(r._query)}return function(m,T,x,N){let D=new Pi(N),j=new So(T,D,x);return m.asyncQueue.enqueueAndForget(()=>P(this,null,function*(){return op(yield Di(m),j)})),()=>{D.$a(),m.asyncQueue.enqueueAndForget(()=>P(this,null,function*(){return ap(yield Di(m),j)}))}}(Ve(l),f,c,u)}function Wp(r,e){return o0(Ve(r=ie(r,me)),xf(e)?e:{next:e})}function Fi(r,e){return function(n,i){let s=new Ne;return n.asyncQueue.enqueueAndForget(()=>P(this,null,function*(){return UR(yield mp(n),i,s)})),s.promise}(Ve(r),e)}function Hp(r,e,t){let n=t.docs.get(e._key),i=new hn(r);return new yt(r,i,e._key,n,new on(t.hasPendingWrites,t.fromCache),e.converter)}var d0={maxAttempts:5};var Yc=class{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=Ir(e)}set(e,t,n){this._verifyNotCommitted();let i=Cn(e,this._firestore),s=cu(i.converter,t,n),o=ou(this._dataReader,"WriteBatch.set",i._key,s,i.converter!==null,n);return this._mutations.push(o.toMutation(i._key,Te.none())),this}update(e,t,n,...i){this._verifyNotCommitted();let s=Cn(e,this._firestore),o;return o=typeof(t=ye(t))=="string"||t instanceof At?Pp(this._dataReader,"WriteBatch.update",s._key,t,n,i):Cp(this._dataReader,"WriteBatch.update",s._key,t),this._mutations.push(o.toMutation(s._key,Te.exists(!0))),this}delete(e){this._verifyNotCommitted();let t=Cn(e,this._firestore);return this._mutations=this._mutations.concat(new Un(t._key,Te.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new k(C.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}};function Cn(r,e){if((r=ye(r)).firestore!==e)throw new k(C.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return r}var qf=class extends class{constructor(t,n){this._firestore=t,this._transaction=n,this._dataReader=Ir(t)}get(t){let n=Cn(t,this._firestore),i=new Bf(this._firestore);return this._transaction.lookup([n._key]).then(s=>{if(!s||s.length!==1)return U();let o=s[0];if(o.isFoundDocument())return new _r(this._firestore,i,o.key,o,n.converter);if(o.isNoDocument())return new _r(this._firestore,i,n._key,null,n.converter);throw U()})}set(t,n,i){let s=Cn(t,this._firestore),o=cu(s.converter,n,i),c=ou(this._dataReader,"Transaction.set",s._key,o,s.converter!==null,i);return this._transaction.set(s._key,c),this}update(t,n,i,...s){let o=Cn(t,this._firestore),c;return c=typeof(n=ye(n))=="string"||n instanceof At?Pp(this._dataReader,"Transaction.update",o._key,n,i,s):Cp(this._dataReader,"Transaction.update",o._key,n),this._transaction.update(o._key,c),this}delete(t){let n=Cn(t,this._firestore);return this._transaction.delete(n._key),this}}{constructor(e,t){super(e,t),this._firestore=e}get(e){let t=Cn(e,this._firestore),n=new hn(this._firestore);return super.get(e).then(i=>new yt(this._firestore,n,t._key,i._document,new on(!1,!1),t.converter))}};function Qp(r,e,t){r=ie(r,me);let n=Object.assign(Object.assign({},d0),t);return function(s){if(s.maxAttempts<1)throw new k(C.INVALID_ARGUMENT,"Max attempts must be at least 1")}(n),function(s,o,c){let u=new Ne;return s.asyncQueue.enqueueAndForget(()=>P(this,null,function*(){let l=yield t0(s);new Rf(s.asyncQueue,l,c,o,u).Xa()})),u.promise}(Ve(r),i=>e(new qf(r,i)),n)}function Yp(){return new Co("deleteField")}function Xp(){return new Of("serverTimestamp")}function Jp(...r){return new Vf("arrayUnion",r)}function Zp(...r){return new Lf("arrayRemove",r)}function eg(r){return new Ff("increment",r)}(function(e,t=!0){(function(i){Ni=i})(ly),_s(new Yn("firestore",(n,{instanceIdentifier:i,options:s})=>{let o=n.getProvider("app").getImmediate(),c=new me(new Hh(n.getProvider("auth-internal")),new Jh(n.getProvider("app-check-internal")),function(l,f){if(!Object.prototype.hasOwnProperty.apply(l.options,["projectId"]))throw new k(C.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Mn(l.options.projectId,f)}(o,i),o);return s=Object.assign({useFetchStreams:t},s),c._setSettings(s),c},"PUBLIC").setMultipleInstances(!0)),Dt(Kv,"4.6.4",e),Dt(Kv,"4.6.4","esm2017")})();var f0="@firebase/firestore-compat",p0="0.3.33";function og(r,e){if(e===void 0)return{merge:!1};if(e.mergeFields!==void 0&&e.merge!==void 0)throw new k("invalid-argument",`Invalid options passed to function ${r}(): You cannot specify both "merge" and "mergeFields".`);return e}function VE(){if(typeof Uint8Array>"u")throw new k("unimplemented","Uint8Arrays are not available in this environment.")}function LE(){if(!sw())throw new k("unimplemented","Blobs are unavailable in Firestore in this environment.")}var fu=class r{constructor(e){this._delegate=e}static fromBase64String(e){return LE(),new r(zt.fromBase64String(e))}static fromUint8Array(e){return VE(),new r(zt.fromUint8Array(e))}toBase64(){return LE(),this._delegate.toBase64()}toUint8Array(){return VE(),this._delegate.toUint8Array()}isEqual(e){return this._delegate.isEqual(e._delegate)}toString(){return"Blob(base64: "+this.toBase64()+")"}};function tg(r){return g0(r,["next","error","complete"])}function g0(r,e){if(typeof r!="object"||r===null)return!1;let t=r;for(let n of e)if(n in t&&typeof t[n]=="function")return!0;return!1}var ng=class{enableIndexedDbPersistence(e,t){return wp(e._delegate,{forceOwnership:t})}enableMultiTabIndexedDbPersistence(e){return Ep(e._delegate)}clearIndexedDbPersistence(e){return Tp(e._delegate)}},pu=class{constructor(e,t,n){this._delegate=t,this._persistenceProvider=n,this.INTERNAL={delete:()=>this.terminate()},e instanceof Mn||(this._appCompat=e)}get _databaseId(){return this._delegate._databaseId}settings(e){let t=this._delegate._getSettings();!e.merge&&t.host!==e.host&&gt("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),e.merge&&(e=Object.assign(Object.assign({},t),e),delete e.merge),this._delegate._setSettings(e)}useEmulator(e,t,n={}){nu(this._delegate,e,t,n)}enableNetwork(){return Ap(this._delegate)}disableNetwork(){return Sp(this._delegate)}enablePersistence(e){let t=!1,n=!1;return e&&(t=!!e.synchronizeTabs,n=!!e.experimentalForceOwningTab,vp("synchronizeTabs",t,"experimentalForceOwningTab",n)),t?this._persistenceProvider.enableMultiTabIndexedDbPersistence(this):this._persistenceProvider.enableIndexedDbPersistence(this,n)}clearPersistence(){return this._persistenceProvider.clearIndexedDbPersistence(this)}terminate(){return this._appCompat&&(this._appCompat._removeServiceInstance("firestore-compat"),this._appCompat._removeServiceInstance("firestore")),this._delegate._delete()}waitForPendingWrites(){return Ip(this._delegate)}onSnapshotsInSync(e){return Wp(this._delegate,e)}get app(){if(!this._appCompat)throw new k("failed-precondition","Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._appCompat}collection(e){try{return new $i(this,ru(this._delegate,e))}catch(t){throw et(t,"collection()","Firestore.collection()")}}doc(e){try{return new qt(this,Tr(this._delegate,e))}catch(t){throw et(t,"doc()","Firestore.doc()")}}collectionGroup(e){try{return new Cr(this,_p(this._delegate,e))}catch(t){throw et(t,"collectionGroup()","Firestore.collectionGroup()")}}runTransaction(e){return Qp(this._delegate,t=>e(new gu(this,t)))}batch(){return Ve(this._delegate),new mu(new Yc(this._delegate,e=>Fi(this._delegate,e)))}loadBundle(e){return bp(this._delegate,e)}namedQuery(e){return Rp(this._delegate,e).then(t=>t?new Cr(this,t):null)}},Ui=class extends xi{constructor(e){super(),this.firestore=e}convertBytes(e){return new fu(new zt(e))}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return qt.forKey(t,this.firestore,null)}};function m0(r){Gf(r)}var gu=class{constructor(e,t){this._firestore=e,this._delegate=t,this._userDataWriter=new Ui(e)}get(e){let t=Sr(e);return this._delegate.get(t).then(n=>new br(this._firestore,new yt(this._firestore._delegate,this._userDataWriter,n._key,n._document,n.metadata,t.converter)))}set(e,t,n){let i=Sr(e);return n?(og("Transaction.set",n),this._delegate.set(i,t,n)):this._delegate.set(i,t),this}update(e,t,n,...i){let s=Sr(e);return arguments.length===2?this._delegate.update(s,t):this._delegate.update(s,t,n,...i),this}delete(e){let t=Sr(e);return this._delegate.delete(t),this}},mu=class{constructor(e){this._delegate=e}set(e,t,n){let i=Sr(e);return n?(og("WriteBatch.set",n),this._delegate.set(i,t,n)):this._delegate.set(i,t),this}update(e,t,n,...i){let s=Sr(e);return arguments.length===2?this._delegate.update(s,t):this._delegate.update(s,t,n,...i),this}delete(e){let t=Sr(e);return this._delegate.delete(t),this}commit(){return this._delegate.commit()}},ji=class r{constructor(e,t,n){this._firestore=e,this._userDataWriter=t,this._delegate=n}fromFirestore(e,t){let n=new Dn(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,null);return this._delegate.fromFirestore(new Rr(this._firestore,n),t??{})}toFirestore(e,t){return t?this._delegate.toFirestore(e,t):this._delegate.toFirestore(e)}static getInstance(e,t){let n=r.INSTANCES,i=n.get(e);i||(i=new WeakMap,n.set(e,i));let s=i.get(t);return s||(s=new r(e,new Ui(e),t),i.set(t,s)),s}};ji.INSTANCES=new WeakMap;var qt=class r{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new Ui(e)}static forPath(e,t,n){if(e.length%2!==0)throw new k("invalid-argument",`Invalid document reference. Document references must have an even number of segments, but ${e.canonicalString()} has ${e.length}`);return new r(t,new de(t._delegate,n,new L(e)))}static forKey(e,t,n){return new r(t,new de(t._delegate,n,e))}get id(){return this._delegate.id}get parent(){return new $i(this.firestore,this._delegate.parent)}get path(){return this._delegate.path}collection(e){try{return new $i(this.firestore,ru(this._delegate,e))}catch(t){throw et(t,"collection()","DocumentReference.collection()")}}isEqual(e){return e=ye(e),e instanceof de?iu(this._delegate,e):!1}set(e,t){t=og("DocumentReference.set",t);try{return t?Vo(this._delegate,e,t):Vo(this._delegate,e)}catch(n){throw et(n,"setDoc()","DocumentReference.set()")}}update(e,t,...n){try{return arguments.length===1?hu(this._delegate,e):hu(this._delegate,e,t,...n)}catch(i){throw et(i,"updateDoc()","DocumentReference.update()")}}delete(){return Gp(this._delegate)}onSnapshot(...e){let t=FE(e),n=UE(e,i=>new br(this.firestore,new yt(this.firestore._delegate,this._userDataWriter,i._key,i._document,i.metadata,this._delegate.converter)));return du(this._delegate,t,n)}get(e){let t;return e?.source==="cache"?t=jp(this._delegate):e?.source==="server"?t=$p(this._delegate):t=lu(this._delegate),t.then(n=>new br(this.firestore,new yt(this.firestore._delegate,this._userDataWriter,n._key,n._document,n.metadata,this._delegate.converter)))}withConverter(e){return new r(this.firestore,e?this._delegate.withConverter(ji.getInstance(this.firestore,e)):this._delegate.withConverter(null))}};function et(r,e,t){return r.message=r.message.replace(e,t),r}function FE(r){for(let e of r)if(typeof e=="object"&&!tg(e))return e;return{}}function UE(r,e){var t,n;let i;return tg(r[0])?i=r[0]:tg(r[1])?i=r[1]:typeof r[0]=="function"?i={next:r[0],error:r[1],complete:r[2]}:i={next:r[1],error:r[2],complete:r[3]},{next:s=>{i.next&&i.next(e(s))},error:(t=i.error)===null||t===void 0?void 0:t.bind(i),complete:(n=i.complete)===null||n===void 0?void 0:n.bind(i)}}var br=class{constructor(e,t){this._firestore=e,this._delegate=t}get ref(){return new qt(this._firestore,this._delegate.ref)}get id(){return this._delegate.id}get metadata(){return this._delegate.metadata}get exists(){return this._delegate.exists()}data(e){return this._delegate.data(e)}get(e,t){return this._delegate.get(e,t)}isEqual(e){return uu(this._delegate,e._delegate)}},Rr=class extends br{data(e){let t=this._delegate.data(e);return this._delegate._converter||K_(t!==void 0,"Document in a QueryDocumentSnapshot should exist"),t}},Cr=class r{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new Ui(e)}where(e,t,n){try{return new r(this.firestore,Bt(this._delegate,Np(e,t,n)))}catch(i){throw et(i,/(orderBy|where)\(\)/,"Query.$1()")}}orderBy(e,t){try{return new r(this.firestore,Bt(this._delegate,kp(e,t)))}catch(n){throw et(n,/(orderBy|where)\(\)/,"Query.$1()")}}limit(e){try{return new r(this.firestore,Bt(this._delegate,Mp(e)))}catch(t){throw et(t,"limit()","Query.limit()")}}limitToLast(e){try{return new r(this.firestore,Bt(this._delegate,Op(e)))}catch(t){throw et(t,"limitToLast()","Query.limitToLast()")}}startAt(...e){try{return new r(this.firestore,Bt(this._delegate,Vp(...e)))}catch(t){throw et(t,"startAt()","Query.startAt()")}}startAfter(...e){try{return new r(this.firestore,Bt(this._delegate,Lp(...e)))}catch(t){throw et(t,"startAfter()","Query.startAfter()")}}endBefore(...e){try{return new r(this.firestore,Bt(this._delegate,Fp(...e)))}catch(t){throw et(t,"endBefore()","Query.endBefore()")}}endAt(...e){try{return new r(this.firestore,Bt(this._delegate,Up(...e)))}catch(t){throw et(t,"endAt()","Query.endAt()")}}isEqual(e){return su(this._delegate,e._delegate)}get(e){let t;return e?.source==="cache"?t=Bp(this._delegate):e?.source==="server"?t=qp(this._delegate):t=zp(this._delegate),t.then(n=>new Lo(this.firestore,new St(this.firestore._delegate,this._userDataWriter,this._delegate,n._snapshot)))}onSnapshot(...e){let t=FE(e),n=UE(e,i=>new Lo(this.firestore,new St(this.firestore._delegate,this._userDataWriter,this._delegate,i._snapshot)));return du(this._delegate,t,n)}withConverter(e){return new r(this.firestore,e?this._delegate.withConverter(ji.getInstance(this.firestore,e)):this._delegate.withConverter(null))}},rg=class{constructor(e,t){this._firestore=e,this._delegate=t}get type(){return this._delegate.type}get doc(){return new Rr(this._firestore,this._delegate.doc)}get oldIndex(){return this._delegate.oldIndex}get newIndex(){return this._delegate.newIndex}},Lo=class{constructor(e,t){this._firestore=e,this._delegate=t}get query(){return new Cr(this._firestore,this._delegate.query)}get metadata(){return this._delegate.metadata}get size(){return this._delegate.size}get empty(){return this._delegate.empty}get docs(){return this._delegate.docs.map(e=>new Rr(this._firestore,e))}docChanges(e){return this._delegate.docChanges(e).map(t=>new rg(this._firestore,t))}forEach(e,t){this._delegate.forEach(n=>{e.call(t,new Rr(this._firestore,n))})}isEqual(e){return uu(this._delegate,e._delegate)}},$i=class r extends Cr{constructor(e,t){super(e,t),this.firestore=e,this._delegate=t}get id(){return this._delegate.id}get path(){return this._delegate.path}get parent(){let e=this._delegate.parent;return e?new qt(this.firestore,e):null}doc(e){try{return e===void 0?new qt(this.firestore,Tr(this._delegate)):new qt(this.firestore,Tr(this._delegate,e))}catch(t){throw et(t,"doc()","CollectionReference.doc()")}}add(e){return Kp(this._delegate,e).then(t=>new qt(this.firestore,t))}isEqual(e){return iu(this._delegate,e._delegate)}withConverter(e){return new r(this.firestore,e?this._delegate.withConverter(ji.getInstance(this.firestore,e)):this._delegate.withConverter(null))}};function Sr(r){return ie(r,de)}var ig=class r{constructor(...e){this._delegate=new At(...e)}static documentId(){return new r(Se.keyField().canonicalString())}isEqual(e){return e=ye(e),e instanceof At?this._delegate._internalPath.isEqual(e._internalPath):!1}};var sg=class r{constructor(e){this._delegate=e}static serverTimestamp(){let e=Xp();return e._methodName="FieldValue.serverTimestamp",new r(e)}static delete(){let e=Yp();return e._methodName="FieldValue.delete",new r(e)}static arrayUnion(...e){let t=Jp(...e);return t._methodName="FieldValue.arrayUnion",new r(t)}static arrayRemove(...e){let t=Zp(...e);return t._methodName="FieldValue.arrayRemove",new r(t)}static increment(e){let t=eg(e);return t._methodName="FieldValue.increment",new r(t)}isEqual(e){return this._delegate.isEqual(e._delegate)}};var y0={Firestore:pu,GeoPoint:vr,Timestamp:_e,Blob:fu,Transaction:gu,WriteBatch:mu,DocumentReference:qt,DocumentSnapshot:br,Query:Cr,QueryDocumentSnapshot:Rr,QuerySnapshot:Lo,CollectionReference:$i,FieldPath:ig,FieldValue:sg,setLogLevel:m0,CACHE_SIZE_UNLIMITED:TE};function v0(r,e){r.INTERNAL.registerComponent(new Yn("firestore-compat",t=>{let n=t.getProvider("app-compat").getImmediate(),i=t.getProvider("firestore").getImmediate();return e(n,i)},"PUBLIC").setServiceProps(Object.assign({},y0)))}function _0(r){v0(r,(e,t)=>new pu(e,t,new ng)),r.registerVersion(f0,p0)}_0(Ye);function w0(r,e=ta){return new lt(t=>{let n;return e!=null?e.schedule(()=>{n=r.onSnapshot({includeMetadataChanges:!0},t)}):n=r.onSnapshot({includeMetadataChanges:!0},t),()=>{n?.()}})}function jE(r,e){return w0(r,e)}function E0(r,e){return jE(r,e).pipe(Or(void 0),ra(),X(t=>{let[n,i]=t;return i.exists?n?.exists?{payload:i,type:"modified"}:{payload:i,type:"added"}:{payload:i,type:"removed"}}))}function ug(r,e){return jE(r,e).pipe(X(t=>({payload:t,type:"query"})))}var yu=class{ref;afs;constructor(e,t){this.ref=e,this.afs=t}set(e,t){return this.ref.set(e,t)}update(e){return this.ref.update(e)}delete(){return this.ref.delete()}collection(e,t){let n=this.ref.collection(e),{ref:i,query:s}=GE(n,t);return new _u(i,s,this.afs)}snapshotChanges(){return E0(this.ref,this.afs.schedulers.outsideAngular).pipe(Xe)}valueChanges(e={}){return this.snapshotChanges().pipe(X(({payload:t})=>e.idField?Ie(z({},t.data()),{[e.idField]:t.id}):t.data()))}get(e){return ge(this.ref.get(e)).pipe(Xe)}};function vu(r,e){return ug(r,e).pipe(Or(void 0),ra(),X(t=>{let[n,i]=t,s=i.payload.docChanges(),o=s.map(c=>({type:c.type,payload:c}));return n&&JSON.stringify(n.payload.metadata)!==JSON.stringify(i.payload.metadata)&&i.payload.docs.forEach((c,u)=>{let l=s.find(p=>p.doc.ref.isEqual(c.ref)),f=n?.payload.docs.find(p=>p.ref.isEqual(c.ref));l&&JSON.stringify(l.doc.metadata)===JSON.stringify(c.metadata)||!l&&f&&JSON.stringify(f.metadata)===JSON.stringify(c.metadata)||o.push({type:"modified",payload:{oldIndex:u,newIndex:u,type:"modified",doc:c}})}),o}))}function $E(r,e,t){return vu(r,t).pipe(Mr((n,i)=>T0(n,i.map(s=>s.payload),e),[]),Tm(),X(n=>n.map(i=>({type:i.type,payload:i}))))}function T0(r,e,t){return e.forEach(n=>{t.indexOf(n.type)>-1&&(r=I0(r,n))}),r}function ag(r,e,t,...n){let i=r.slice();return i.splice(e,t,...n),i}function I0(r,e){switch(e.type){case"added":if(!(r[e.newIndex]&&r[e.newIndex].doc.ref.isEqual(e.doc.ref)))return ag(r,e.newIndex,0,e);break;case"modified":if(r[e.oldIndex]==null||r[e.oldIndex].doc.ref.isEqual(e.doc.ref))if(e.oldIndex!==e.newIndex){let t=r.slice();return t.splice(e.oldIndex,1),t.splice(e.newIndex,0,e),t}else return ag(r,e.newIndex,1,e);break;case"removed":if(r[e.oldIndex]&&r[e.oldIndex].doc.ref.isEqual(e.doc.ref))return ag(r,e.oldIndex,1);break}return r}function zE(r){return(!r||r.length===0)&&(r=["added","removed","modified"]),r}var _u=class{ref;query;afs;constructor(e,t,n){this.ref=e,this.query=t,this.afs=n}stateChanges(e){let t=vu(this.query,this.afs.schedulers.outsideAngular);return e&&e.length>0&&(t=t.pipe(X(n=>n.filter(i=>e.indexOf(i.type)>-1)))),t.pipe(Or(void 0),ra(),it(([n,i])=>i.length>0||!n),X(([,n])=>n),Xe)}auditTrail(e){return this.stateChanges(e).pipe(Mr((t,n)=>[...t,...n],[]))}snapshotChanges(e){let t=zE(e);return $E(this.query,t,this.afs.schedulers.outsideAngular).pipe(Xe)}valueChanges(e={}){return ug(this.query,this.afs.schedulers.outsideAngular).pipe(X(t=>t.payload.docs.map(n=>e.idField?Ie(z({},n.data()),{[e.idField]:n.id}):n.data())),Xe)}get(e){return ge(this.query.get(e)).pipe(Xe)}add(e){return this.ref.add(e)}doc(e){return new yu(this.ref.doc(e),this.afs)}},cg=class{query;afs;constructor(e,t){this.query=e,this.afs=t}stateChanges(e){return!e||e.length===0?vu(this.query,this.afs.schedulers.outsideAngular).pipe(Xe):vu(this.query,this.afs.schedulers.outsideAngular).pipe(X(t=>t.filter(n=>e.indexOf(n.type)>-1)),it(t=>t.length>0),Xe)}auditTrail(e){return this.stateChanges(e).pipe(Mr((t,n)=>[...t,...n],[]))}snapshotChanges(e){let t=zE(e);return $E(this.query,t,this.afs.schedulers.outsideAngular).pipe(Xe)}valueChanges(e={}){return ug(this.query,this.afs.schedulers.outsideAngular).pipe(X(n=>n.payload.docs.map(i=>e.idField?z({[e.idField]:i.id},i.data()):i.data())),Xe)}get(e){return ge(this.query.get(e)).pipe(Xe)}},BE=new oe("angularfire2.enableFirestorePersistence"),qE=new oe("angularfire2.firestore.persistenceSettings"),A0=new oe("angularfire2.firestore.settings"),S0=new oe("angularfire2.firestore.use-emulator");function GE(r,e=t=>t){return{query:e(r),ref:r}}var lg=(()=>{class r{schedulers;firestore;persistenceEnabled$;constructor(t,n,i,s,o,c,u,l,f,p,m,T,x,N,D,j,G){this.schedulers=u;let V=Ks(t,c,n),H=f;p&&kh(V,c,m,x,N,D,T,j),[this.firestore,this.persistenceEnabled$]=La(`${V.name}.firestore`,"AngularFirestore",V.name,()=>{let Q=c.runOutsideAngular(()=>V.firestore());if(s&&Q.settings(s),H&&Q.useEmulator(...H),i&&!Jt(o)){let Y=()=>{try{return ge(Q.enablePersistence(l||void 0).then(()=>!0,()=>!1))}catch(w){return typeof console<"u"&&console.warn(w),B(!1)}};return[Q,c.runOutsideAngular(Y)]}else return[Q,B(!1)]},[s,H,i])}collection(t,n){let i;typeof t=="string"?i=this.firestore.collection(t):i=t;let{ref:s,query:o}=GE(i,n),c=this.schedulers.ngZone.run(()=>s);return new _u(c,o,this)}collectionGroup(t,n){let i=n||(o=>o),s=this.firestore.collectionGroup(t);return new cg(i(s),this)}doc(t){let n;typeof t=="string"?n=this.firestore.doc(t):n=t;let i=this.schedulers.ngZone.run(()=>n);return new yu(i,this)}createId(){return this.firestore.collection("_").doc().id}static \u0275fac=function(n){return new(n||r)($(Xr),$(Jr,8),$(BE,8),$(A0,8),$(st),$(Ce),$(Yr),$(qE,8),$(S0,8),$(Mh,8),$(Rh,8),$(Ch,8),$(Ph,8),$(Dh,8),$(xh,8),$(Nh,8),$(Zt,8))};static \u0275prov=se({token:r,factory:r.\u0275fac,providedIn:"any"})}return r})(),nO=(()=>{class r{constructor(){Ye.registerVersion("angularfire",en.full,"fst-compat")}static enablePersistence(t){return{ngModule:r,providers:[{provide:BE,useValue:!0},{provide:qE,useValue:t}]}}static \u0275fac=function(n){return new(n||r)};static \u0275mod=Yt({type:r});static \u0275inj=Qt({providers:[lg]})}return r})();var KE=tn(Il,!0);var WE=tn(Al,!0);var HE=tn(Sl,!0);var wu=tn(Tr,!0);var hg=tn(lu,!0);var Eu=tn(IE,!0);var QE=tn(Vo,!0);var P1=(()=>{let e=class e{get user(){return z({},this._user)}constructor(n,i){this.afs=n,this.router=i,this._userCollection=this.afs.collection("users")}createTestingUser(){this.register({email:"test@test.com",password:"password"}).subscribe()}register(n){let i=Fr();return new lt(s=>{KE(i,n.email,n.password).then(o=>{let c=o.user,u=wu(Eu(),"users",c.uid);QE(u,{email:n.email,uid:c.uid,password:n.password}).then(()=>{this._user={email:n.email,uid:c.uid,password:n.password},s.next(!0),s.complete()}).catch(l=>{console.error("Error guardando datos adicionales del usuario en Firestore:",l),s.error(l)})}).catch(o=>{console.error("Error registrando usuario:",o),s.error(o)})}).pipe(Rt(s=>B(!1)))}login(n,i){let s=Fr();return new lt(o=>{WE(s,n,i).then(c=>{let u=c.user;if(u){let l=wu(Eu(),"users",u.uid);hg(l).then(f=>{if(f.exists()){let p=f.data();this._user=Ie(z({},p),{uid:u.uid}),o.next(!0),o.complete()}else console.log("El documento del usuario no existe"),o.next(!1),o.complete()}).catch(f=>{console.error("Error al obtener datos adicionales del usuario:",f),o.error(f)})}}).catch(c=>{console.error("Error signing in:",c),o.error(c)})}).pipe(Rt(o=>B(!1)))}logout(){let n=Fr();HE(n).then(()=>{this._user=void 0,this.router.navigate(["/portafolio"])}).catch(i=>{console.error("Error logging out:",i)})}validateUser(){return B(!!this._user)}getUserById(n){let i=Eu(),s=wu(i,"users",n);return ge(hg(s)).pipe(X(o=>{if(o.exists()){let c=o.data();return Ie(z({},c),{uid:n})}else throw new Error("User not found")}),Rt(o=>{throw o}))}};e.\u0275fac=function(i){return new(i||e)($(lg),$(_t))},e.\u0275prov=se({token:e,factory:e.\u0275fac,providedIn:"root"});let r=e;return r})();export{Ty as a,uP as b,lP as c,En as d,NI as e,_t as f,kP as g,MP as h,OP as i,en as j,Zt as k,Yr as l,GP as m,Xe as n,tn as o,Xr as p,Jr as q,Ks as r,eD as s,La as t,vM as u,lg as v,nO as w,P1 as x};
